/*!
 * PixiJS - v8.0.0-beta.6
 * Compiled Fri, 20 Oct 2023 15:15:22 UTC
 *
 * PixiJS is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var PIXI=function(h){"use strict";class Y{constructor(e=0,r=0){this.x=0,this.y=0,this.x=e,this.y=r}clone(){return new Y(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,r=e){return this.x=e,this.y=r,this}static get shared(){return as.x=0,as.y=0,as}}const as=new Y;class Lt{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Lt.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Y,this.page=new Y,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,r,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,r,n,i,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var $0=Object.defineProperty,V0=Object.defineProperties,z0=Object.getOwnPropertyDescriptors,ml=Object.getOwnPropertySymbols,H0=Object.prototype.hasOwnProperty,W0=Object.prototype.propertyIsEnumerable,bl=(t,e,r)=>e in t?$0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,vl=(t,e)=>{for(var r in e||(e={}))H0.call(e,r)&&bl(t,r,e[r]);if(ml)for(var r of ml(e))W0.call(e,r)&&bl(t,r,e[r]);return t},X0=(t,e)=>V0(t,z0(e)),v=(t=>(t.Renderer="renderer",t.Application="application",t.WebGLPipes="webgl-pipes",t.WebGLPipesAdaptor="webgl-pipes-adaptor",t.WebGLSystem="webgl-system",t.WebGPUPipes="webgpu-pipes",t.WebGPUPipesAdaptor="webgpu-pipes-adaptor",t.WebGPUSystem="webgpu-system",t.CanvasSystem="canvas-system",t.CanvasPipesAdaptor="canvas-pipes-adaptor",t.CanvasPipes="canvas-pipes",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t.MaskEffect="mask-effect",t.BlendMode="blend-mode",t.TextureSource="texture-source",t.Environment="environment",t))(v||{});const us=t=>{if(typeof t=="function"||typeof t=="object"&&t.extension){const e=typeof t.extension!="object"?{type:t.extension}:t.extension;t=X0(vl({},e),{ref:t})}if(typeof t=="object")t=vl({},t);else throw new Error("Invalid extension type");return typeof t.type=="string"&&(t.type=[t.type]),t},gr=(t,e)=>{var r;return(r=us(t).priority)!=null?r:e},V={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(us).forEach(e=>{e.type.forEach(r=>{var n,i;return(i=(n=this._removeHandlers)[r])==null?void 0:i.call(n,e)})}),this},add(...t){return t.map(us).forEach(e=>{e.type.forEach(r=>{const n=this._addHandlers,i=this._queue;n[r]?n[r](e):(i[r]=i[r]||[],i[r].push(e))})}),this},handle(t,e,r){const n=this._addHandlers,i=this._removeHandlers;n[t]=e,i[t]=r;const s=this._queue;return s[t]&&(s[t].forEach(o=>e(o)),delete s[t]),this},handleByMap(t,e){return this.handle(t,r=>{e[r.name]=r.ref},r=>{delete e[r.name]})},handleByNamedList(t,e,r=-1){return this.handle(t,n=>{e.findIndex(i=>i.name===n.name)>=0||(e.push({name:n.name,value:n.ref}),e.sort((i,s)=>gr(s.value,r)-gr(i.value,r)))},n=>{const i=e.findIndex(s=>s.name===n.name);i!==-1&&e.splice(i,1)})},handleByList(t,e,r=-1){return this.handle(t,n=>{e.includes(n.ref)||(e.push(n.ref),e.sort((i,s)=>gr(s,r)-gr(i,r)))},n=>{const i=e.indexOf(n.ref);i!==-1&&e.splice(i,1)})}};var eT=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function tT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function yl(t,e,r){return r={path:e,exports:{},require:function(n,i){return j0(n,i==null?r.path:i)}},t(r,r.exports),r.exports}function rT(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function nT(t){return t&&Object.prototype.hasOwnProperty.call(t,"default")&&Object.keys(t).length===1?t.default:t}function iT(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}function j0(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var ge=yl(function(t){"use strict";var e=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function s(u,l,c,d,p){if(typeof c!="function")throw new TypeError("The listener must be a function");var f=new i(c,d||u,p),g=r?r+l:l;return u._events[g]?u._events[g].fn?u._events[g]=[u._events[g],f]:u._events[g].push(f):(u._events[g]=f,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,d;if(this._eventsCount===0)return l;for(d in c=this._events)e.call(c,d)&&l.push(r?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=r?r+l:l,d=this._events[c];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,f=d.length,g=new Array(f);p<f;p++)g[p]=d[p].fn;return g},a.prototype.listenerCount=function(l){var c=r?r+l:l,d=this._events[c];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,c,d,p,f,g){var b=r?r+l:l;if(!this._events[b])return!1;var m=this._events[b],x=arguments.length,y,_;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),x){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,d),!0;case 4:return m.fn.call(m.context,c,d,p),!0;case 5:return m.fn.call(m.context,c,d,p,f),!0;case 6:return m.fn.call(m.context,c,d,p,f,g),!0}for(_=1,y=new Array(x-1);_<x;_++)y[_-1]=arguments[_];m.fn.apply(m.context,y)}else{var A=m.length,T;for(_=0;_<A;_++)switch(m[_].once&&this.removeListener(l,m[_].fn,void 0,!0),x){case 1:m[_].fn.call(m[_].context);break;case 2:m[_].fn.call(m[_].context,c);break;case 3:m[_].fn.call(m[_].context,c,d);break;case 4:m[_].fn.call(m[_].context,c,d,p);break;default:if(!y)for(T=1,y=new Array(x-1);T<x;T++)y[T-1]=arguments[T];m[_].fn.apply(m[_].context,y)}}return!0},a.prototype.on=function(l,c,d){return s(this,l,c,d,!1)},a.prototype.once=function(l,c,d){return s(this,l,c,d,!0)},a.prototype.removeListener=function(l,c,d,p){var f=r?r+l:l;if(!this._events[f])return this;if(!c)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===c&&(!p||g.once)&&(!d||g.context===d)&&o(this,f);else{for(var b=0,m=[],x=g.length;b<x;b++)(g[b].fn!==c||p&&!g[b].once||d&&g[b].context!==d)&&m.push(g[b]);m.length?this._events[f]=m.length===1?m[0]:m:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&o(this,c)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,t.exports=a}),Y0={grad:.9,turn:360,rad:360/(2*Math.PI)},je=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},ce=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Se=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},_l=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},xl=function(t){return{r:Se(t.r,0,255),g:Se(t.g,0,255),b:Se(t.b,0,255),a:Se(t.a)}},ls=function(t){return{r:ce(t.r),g:ce(t.g),b:ce(t.b),a:ce(t.a,3)}},Z0=/^#([0-9a-f]{3,8})$/i,vn=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},Al=function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=Math.max(e,r,n),o=s-Math.min(e,r,n),a=o?s===e?(r-n)/o:s===r?2+(n-e)/o:4+(e-r)/o:0;return{h:60*(a<0?a+6:a),s:s?o/s*100:0,v:s/255*100,a:i}},Cl=function(t){var e=t.h,r=t.s,n=t.v,i=t.a;e=e/360*6,r/=100,n/=100;var s=Math.floor(e),o=n*(1-r),a=n*(1-(e-s)*r),u=n*(1-(1-e+s)*r),l=s%6;return{r:255*[n,a,o,o,u,n][l],g:255*[u,n,n,a,o,o][l],b:255*[o,o,u,n,n,a][l],a:i}},wl=function(t){return{h:_l(t.h),s:Se(t.s,0,100),l:Se(t.l,0,100),a:Se(t.a)}},Tl=function(t){return{h:ce(t.h),s:ce(t.s),l:ce(t.l),a:ce(t.a,3)}},Sl=function(t){return Cl((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},mr=function(t){return{h:(e=Al(t)).h,s:(i=(200-(r=e.s))*(n=e.v)/100)>0&&i<200?r*n/100/(i<=100?i:200-i)*100:0,l:i/2,a:e.a};var e,r,n,i},q0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,K0=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,J0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Q0=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,cs={string:[[function(t){var e=Z0.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?ce(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?ce(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=J0.exec(t)||Q0.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:xl({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=q0.exec(t)||K0.exec(t);if(!e)return null;var r,n,i=wl({h:(r=e[1],n=e[2],n===void 0&&(n="deg"),Number(r)*(Y0[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return Sl(i)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,i=t.a,s=i===void 0?1:i;return je(e)&&je(r)&&je(n)?xl({r:Number(e),g:Number(r),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,i=t.a,s=i===void 0?1:i;if(!je(e)||!je(r)||!je(n))return null;var o=wl({h:Number(e),s:Number(r),l:Number(n),a:Number(s)});return Sl(o)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,i=t.a,s=i===void 0?1:i;if(!je(e)||!je(r)||!je(n))return null;var o=function(a){return{h:_l(a.h),s:Se(a.s,0,100),v:Se(a.v,0,100),a:Se(a.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(s)});return Cl(o)},"hsv"]]},El=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Il=function(t){return typeof t=="string"?El(t.trim(),cs.string):typeof t=="object"&&t!==null?El(t,cs.object):[null,void 0]},sT=function(t){return Il(t)[1]},hs=function(t,e){var r=mr(t);return{h:r.h,s:Se(r.s+100*e,0,100),l:r.l,a:r.a}},ds=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},Pl=function(t,e){var r=mr(t);return{h:r.h,s:r.s,l:Se(r.l+100*e,0,100),a:r.a}},yn=function(){function t(e){this.parsed=Il(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return ce(ds(this.rgba),2)},t.prototype.isDark=function(){return ds(this.rgba)<.5},t.prototype.isLight=function(){return ds(this.rgba)>=.5},t.prototype.toHex=function(){return e=ls(this.rgba),r=e.r,n=e.g,i=e.b,o=(s=e.a)<1?vn(ce(255*s)):"","#"+vn(r)+vn(n)+vn(i)+o;var e,r,n,i,s,o},t.prototype.toRgb=function(){return ls(this.rgba)},t.prototype.toRgbString=function(){return e=ls(this.rgba),r=e.r,n=e.g,i=e.b,(s=e.a)<1?"rgba("+r+", "+n+", "+i+", "+s+")":"rgb("+r+", "+n+", "+i+")";var e,r,n,i,s},t.prototype.toHsl=function(){return Tl(mr(this.rgba))},t.prototype.toHslString=function(){return e=Tl(mr(this.rgba)),r=e.h,n=e.s,i=e.l,(s=e.a)<1?"hsla("+r+", "+n+"%, "+i+"%, "+s+")":"hsl("+r+", "+n+"%, "+i+"%)";var e,r,n,i,s},t.prototype.toHsv=function(){return e=Al(this.rgba),{h:ce(e.h),s:ce(e.s),v:ce(e.v),a:ce(e.a,3)};var e},t.prototype.invert=function(){return Ne({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),Ne(hs(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),Ne(hs(this.rgba,-e))},t.prototype.grayscale=function(){return Ne(hs(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),Ne(Pl(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),Ne(Pl(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?Ne({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):ce(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=mr(this.rgba);return typeof e=="number"?Ne({h:e,s:r.s,l:r.l,a:r.a}):ce(r.h)},t.prototype.isEqual=function(e){return this.toHex()===Ne(e).toHex()},t}(),Ne=function(t){return t instanceof yn?t:new yn(t)},Bl=[],ev=function(t){t.forEach(function(e){Bl.indexOf(e)<0&&(e(yn,cs),Bl.push(e))})},oT=function(){return new yn({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})};function tv(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var i in r)n[r[i]]=i;var s={};t.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,u,l=n[this.toHex()];if(l)return l;if(o!=null&&o.closest){var c=this.toRgb(),d=1/0,p="black";if(!s.length)for(var f in r)s[f]=new t(r[f]).toRgb();for(var g in r){var b=(a=c,u=s[g],Math.pow(a.r-u.r,2)+Math.pow(a.g-u.g,2)+Math.pow(a.b-u.b,2));b<d&&(d=b,p=g)}return p}},e.string.push([function(o){var a=o.toLowerCase(),u=a==="transparent"?"#0000":r[a];return u?new t(u).toRgb():null},"name"])}var rv=Object.defineProperty,Ml=Object.getOwnPropertySymbols,nv=Object.prototype.hasOwnProperty,iv=Object.prototype.propertyIsEnumerable,Dl=(t,e,r)=>e in t?rv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,sv=(t,e)=>{for(var r in e||(e={}))nv.call(e,r)&&Dl(t,r,e[r]);if(Ml)for(var r of Ml(e))iv.call(e,r)&&Dl(t,r,e[r]);return t};ev([tv]);const lt=class{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof lt)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._normalize(t),this._value=this._cloneSource(t))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?sv({},t):t}_isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,i)=>n===e[i]);if(t!==null&&e!==null){const n=Object.keys(t),i=Object.keys(e);return n.length!==i.length?!1:n.every(s=>t[s]===e[s])}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t=t||this._arrayRgb,t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(n*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t=t||this._arrayRgba;const[e,r,n,i]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t=t||this._arrayRgb;const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toBgrNumber(){const[t,e,r]=this.toUint8RgbArray();return(r<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,n,i]=lt._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=i,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,i=this._int&255;return e&&(r=r*t+.5|0,n=n*t+.5|0,i=i*t+.5|0),(t*255<<24)+(r<<16)+(n<<8)+i}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,r,n,i;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const s=t;e=(s>>16&255)/255,r=(s>>8&255)/255,n=(s&255)/255,i=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,i=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,i=255]=t,e/=255,r/=255,n/=255,i/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const o=lt.HEX_PATTERN.exec(t);o&&(t=`#${o[2]}`)}const s=Ne(t);s.isValid()&&({r:e,g:r,b:n,a:i}=s.rgba,e/=255,r/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=i,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((n,i)=>{t[i]=Math.min(Math.max(n,e),r)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof lt||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};let X=lt;X.shared=new lt,X._temp=new lt,X.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;const Rl=Math.PI*2,Fl=180/Math.PI,Gl=Math.PI/180;class R{constructor(e=1,r=0,n=0,i=1,s=0,o=0){this.array=null,this.a=e,this.b=r,this.c=n,this.d=i,this.tx=s,this.ty=o}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,r,n,i,s,o){return this.a=e,this.b=r,this.c=n,this.d=i,this.tx=s,this.ty=o,this}toArray(e,r){this.array||(this.array=new Float32Array(9));const n=r||this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(e,r){r=r||new Y;const n=e.x,i=e.y;return r.x=this.a*n+this.c*i+this.tx,r.y=this.b*n+this.d*i+this.ty,r}applyInverse(e,r){r=r||new Y;const n=this.a,i=this.b,s=this.c,o=this.d,a=this.tx,u=this.ty,l=1/(n*o+s*-i),c=e.x,d=e.y;return r.x=o*l*c+-s*l*d+(u*s-a*o)*l,r.y=n*l*d+-i*l*c+(-u*n+a*i)*l,r}translate(e,r){return this.tx+=e,this.ty+=r,this}scale(e,r){return this.a*=e,this.d*=r,this.c*=e,this.b*=r,this.tx*=e,this.ty*=r,this}rotate(e){const r=Math.cos(e),n=Math.sin(e),i=this.a,s=this.c,o=this.tx;return this.a=i*r-this.b*n,this.b=i*n+this.b*r,this.c=s*r-this.d*n,this.d=s*n+this.d*r,this.tx=o*r-this.ty*n,this.ty=o*n+this.ty*r,this}append(e){const r=this.a,n=this.b,i=this.c,s=this.d;return this.a=e.a*r+e.b*i,this.b=e.a*n+e.b*s,this.c=e.c*r+e.d*i,this.d=e.c*n+e.d*s,this.tx=e.tx*r+e.ty*i+this.tx,this.ty=e.tx*n+e.ty*s+this.ty,this}appendFrom(e,r){const n=e.a,i=e.b,s=e.c,o=e.d,a=e.tx,u=e.ty,l=r.a,c=r.b,d=r.c,p=r.d;return this.a=n*l+i*d,this.b=n*c+i*p,this.c=s*l+o*d,this.d=s*c+o*p,this.tx=a*l+u*d+r.tx,this.ty=a*c+u*p+r.ty,this}setTransform(e,r,n,i,s,o,a,u,l){return this.a=Math.cos(a+l)*s,this.b=Math.sin(a+l)*s,this.c=-Math.sin(a-u)*o,this.d=Math.cos(a-u)*o,this.tx=e-(n*this.a+i*this.c),this.ty=r-(n*this.b+i*this.d),this}prepend(e){const r=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const n=this.a,i=this.c;this.a=n*e.a+this.b*e.c,this.b=n*e.b+this.b*e.d,this.c=i*e.a+this.d*e.c,this.d=i*e.b+this.d*e.d}return this.tx=r*e.a+this.ty*e.c+e.tx,this.ty=r*e.b+this.ty*e.d+e.ty,this}decompose(e){const r=this.a,n=this.b,i=this.c,s=this.d,o=e.pivot,a=-Math.atan2(-i,s),u=Math.atan2(n,r),l=Math.abs(a+u);return l<1e-5||Math.abs(Rl-l)<1e-5?(e.rotation=u,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=a,e.skew.y=u),e.scale.x=Math.sqrt(r*r+n*n),e.scale.y=Math.sqrt(i*i+s*s),e.position.x=this.tx+(o.x*r+o.y*i),e.position.y=this.ty+(o.x*n+o.y*s),e}invert(){const e=this.a,r=this.b,n=this.c,i=this.d,s=this.tx,o=e*i-r*n;return this.a=i/o,this.b=-r/o,this.c=-n/o,this.d=e/o,this.tx=(n*this.ty-i*s)/o,this.ty=-(e*this.ty-r*s)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new R;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return av.identity()}static get shared(){return ov.identity()}}const ov=new R,av=new R;class ue{constructor(e,r,n){this._x=r||0,this._y=n||0,this._observer=e}clone(e){return new ue(e!=null?e:this._observer,this._x,this._y)}set(e=0,r=e){return(this._x!==e||this._y!==r)&&(this._x=e,this._y=r,this._observer.onUpdate()),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this._observer.onUpdate()),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this._observer.onUpdate(this))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this._observer.onUpdate(this))}}const fs={default:-1};function J(t="default"){return fs[t]===void 0&&(fs[t]=-1),++fs[t]}const kl={},$="8.0.0";function G(t,e,r=3){if(kl[e])return;let n=new Error().stack;typeof n=="undefined"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`):(n=n.split(`
`).splice(r).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${t}`),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${t}`),console.warn(n))),kl[e]=!0}function ps(t,e,r){const n=t.length;let i;if(e>=n||r===0)return;r=e+r>n?n-e:r;const s=n-r;for(i=e;i<s;++i)t[i]=t[i+r];t.length=s}const Ol={allowChildren:!0,removeChildren(t=0,e){const r=e!=null?e:this.children.length,n=r-t,i=[];if(n>0&&n<=r){for(let s=r-1;s>=t;s--){const o=this.children[s];o&&(this.layerGroup&&this.layerGroup.removeChild(o),i.push(o),o.parent=null)}ps(this.children,t,r);for(let s=0;s<i.length;++s)this.emit("childRemoved",i[s],this,s),i[s].emit("removed",this);return i}else if(n===0&&this.children.length===0)return i;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(t){const e=this.getChildAt(t);return this.removeChild(e)},getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]},setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);this.getChildIndex(t),this.addChildAt(t,e)},getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied Container must be a child of the caller");return e},addChildAt(t,e){this.allowChildren||G($,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:r}=this;if(e<0||e>r.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${r.length}`);if(t.parent){const n=t.parent.children.indexOf(t);if(t.parent===this&&n===e)return t;n!==-1&&t.parent.children.splice(n,1)}return e===r.length?r.push(t):r.splice(e,0,t),t.parent=this,t.didChange=!0,t.didViewUpdate=!1,t._updateFlags=15,this.layerGroup&&this.layerGroup.addChild(t),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",t,this,e),t.emit("added",this),t},swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t},removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}};class _n{constructor(e){this.pipe="filter",this.priority=1,this.filters=e==null?void 0:e.filters}destroy(){for(let e=0;e<this.filters.length;e++)this.filters[e].destroy();this.filters=null}}const Ul=[];function Ll(t){const e=Ul.pop()||new _n;return e.filters=t,e}function Nl(t){t.filters=null,Ul.push(t)}class $l{constructor(e,r){this._pool=[],this._count=0,this._index=0,this._classType=e,r&&this.prepopulate(r)}prepopulate(e){for(let r=0;r<e;r++)this._pool[this._index++]=new this._classType;this._count+=e}get(e){var r;let n;return this._index>0?n=this._pool[--this._index]:n=new this._classType,(r=n.init)==null||r.call(n,e),n}return(e){var r;(r=e.reset)==null||r.call(e),this._pool[this._index++]=e}get totalSize(){return this._count}get totalFree(){return this._pool.length}get totalUsed(){return this._count-this._pool.length}}class Vl{constructor(){this._poolsByClass=new Map}prepopulate(e,r){this.getPool(e).prepopulate(r)}get(e,r){return this.getPool(e).get(r)}return(e){this.getPool(e.constructor).return(e)}getPool(e){return this._poolsByClass.has(e)||this._poolsByClass.set(e,new $l(e)),this._poolsByClass.get(e)}stats(){const e={};return this._poolsByClass.forEach(r=>{const n=e[r._classType.name]?r._classType.name+r._classType.ID:r._classType.name;e[n]={free:r.totalFree,used:r.totalUsed,size:r.totalSize}}),e}}const H=new Vl;class zl{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(e=>{this.add({test:e.test,maskClass:e})}))}add(e){this._tests.push(e)}getMaskEffect(e){this._initialized||this.init();for(let r=0;r<this._tests.length;r++){const n=this._tests[r];if(n.test(e))return H.get(n.maskClass,e)}return e}returnMaskEffect(e){H.return(e)}}const xn=new zl;V.handleByList(v.MaskEffect,xn._effectClasses);const Hl={_mask:null,_filters:null,effects:[],addEffect(t){this.effects.indexOf(t)===-1&&(this.effects.push(t),this.effects.sort((e,r)=>e.priority-r.priority),!this.isLayerRoot&&this.layerGroup&&(this.layerGroup.structureDidChange=!0),this._updateIsSimple())},removeEffect(t){const e=this.effects.indexOf(t);e!==-1&&(this.effects.splice(e,1),!this.isLayerRoot&&this.layerGroup&&(this.layerGroup.structureDidChange=!0),this._updateIsSimple())},set mask(t){if(this._mask||(this._mask={mask:null,effect:null}),this._mask.mask===t||(this._mask.effect&&(this.removeEffect(this._mask.effect),xn.returnMaskEffect(this._mask.effect),this._mask.effect=null),this._mask.mask=t,t==null))return;const e=xn.getMaskEffect(t);this._mask.effect=e,this.addEffect(e)},get mask(){var t;return(t=this._mask)==null?void 0:t.mask},set filters(t){if(!Array.isArray(t)&&t!==null&&(t=[t]),this._filters||(this._filters={filters:null,effect:null}),this._filters.filters===t||(this._filters.effect&&(this.removeEffect(this._filters.effect),Nl(this._filters.effect),this._filters.effect=null),this._filters.filters=t,!t))return;const e=Ll(t);this._filters.effect=e,this.addEffect(e)},get filters(){var t;return(t=this._filters)==null?void 0:t.filters}},Wl={label:null,get name(){return G($,"Container.name property has been removed, use Container.label instead"),this.label},set name(t){G($,"Container.name property has been removed, use Container.label instead"),this.label=t},getChildByName(t,e=!1){return this.getChildByLabel(t,e)},getChildByLabel(t,e=!1){const r=this.children;for(let n=0;n<r.length;n++){const i=r[n];if(i.label===t||t instanceof RegExp&&t.test(i.label))return i}if(e)for(let n=0;n<r.length;n++){const i=r[n].getChildByLabel(t,!0);if(i)return i}return null},getChildrenByLabel(t,e=!1,r=[]){const n=this.children;for(let i=0;i<n.length;i++){const s=n[i];(s.label===t||t instanceof RegExp&&t.test(s.label))&&r.push(s)}if(e)for(let i=0;i<n.length;i++)n[i].getChildrenByLabel(t,!0,r);return r}},An=[new Y,new Y,new Y,new Y];class te{constructor(e=0,r=0,n=0,i=0){this.type="rectangle",this.x=Number(e),this.y=Number(r),this.width=Number(n),this.height=Number(i)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new te(0,0,0,0)}clone(){return new te(this.x,this.y,this.width,this.height)}copyFromBounds(e){return this.x=e.minX,this.y=e.minY,this.width=e.maxX-e.minX,this.height=e.maxY-e.minY,this}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&r>=this.y&&r<this.y+this.height}intersects(e,r){if(!r){const S=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=S)return!1;const C=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>C}const n=this.left,i=this.right,s=this.top,o=this.bottom;if(i<=n||o<=s)return!1;const a=An[0].set(e.left,e.top),u=An[1].set(e.left,e.bottom),l=An[2].set(e.right,e.top),c=An[3].set(e.right,e.bottom);if(l.x<=a.x||u.y<=a.y)return!1;const d=Math.sign(r.a*r.d-r.b*r.c);if(d===0||(r.apply(a,a),r.apply(u,u),r.apply(l,l),r.apply(c,c),Math.max(a.x,u.x,l.x,c.x)<=n||Math.min(a.x,u.x,l.x,c.x)>=i||Math.max(a.y,u.y,l.y,c.y)<=s||Math.min(a.y,u.y,l.y,c.y)>=o))return!1;const p=d*(u.y-a.y),f=d*(a.x-u.x),g=p*n+f*s,b=p*i+f*s,m=p*n+f*o,x=p*i+f*o;if(Math.max(g,b,m,x)<=p*a.x+f*a.y||Math.min(g,b,m,x)>=p*c.x+f*c.y)return!1;const y=d*(a.y-l.y),_=d*(l.x-a.x),A=y*n+_*s,T=y*i+_*s,P=y*n+_*o,M=y*i+_*o;return!(Math.max(A,T,P,M)<=y*a.x+_*a.y||Math.min(A,T,P,M)>=y*c.x+_*c.y)}pad(e=0,r=e){return this.x-=e,this.y-=r,this.width+=e*2,this.height+=r*2,this}fit(e){const r=Math.max(this.x,e.x),n=Math.min(this.x+this.width,e.x+e.width),i=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=r,this.width=Math.max(n-r,0),this.y=i,this.height=Math.max(s-i,0),this}ceil(e=1,r=.001){const n=Math.ceil((this.x+this.width-r)*e)/e,i=Math.ceil((this.y+this.height-r)*e)/e;return this.x=Math.floor((this.x+r)*e)/e,this.y=Math.floor((this.y+r)*e)/e,this.width=n-this.x,this.height=i-this.y,this}enlarge(e){const r=Math.min(this.x,e.x),n=Math.max(this.x+this.width,e.x+e.width),i=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=r,this.width=n-r,this.y=i,this.height=s-i,this}getBounds(e){return e=e||new te,e.copyFrom(this),e}}class be{constructor(e=1/0,r=1/0,n=-1/0,i=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this._matrixStack=[],this.matrix=new R,this.minX=e,this.minY=r,this.maxX=n,this.maxY=i}get rectangle(){this._rectangle||(this._rectangle=new te);const e=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(e.x=0,e.y=0,e.width=0,e.height=0):e.copyFromBounds(this),e}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this._matrixStack.length=0,this.matrix.identity()}pushMatrix(e){this._matrixStack.push(e),this._matrixStack.length>1?(this.matrix.copyFrom(this._matrixStack[this._matrixStack.length-2]),this.matrix.append(e)):this.matrix.copyFrom(e)}popMatrix(){this._matrixStack.pop(),this._matrixStack.length>1?(this.matrix.copyFrom(this._matrixStack[this._matrixStack.length-2]),this.matrix.append(this._matrixStack[this._matrixStack.length-1])):this._matrixStack.length===1?this.matrix.copyFrom(this._matrixStack[0]):this.matrix.identity()}setMatrix(e){this.matrix.copyFrom(e)}set(e,r,n,i){this.minX=e,this.minY=r,this.maxX=n,this.maxY=i}addFrame(e,r,n,i){const s=this.matrix,o=s.a,a=s.b,u=s.c,l=s.d,c=s.tx,d=s.ty;let p=this.minX,f=this.minY,g=this.maxX,b=this.maxY,m=o*e+u*r+c,x=a*e+l*r+d;p=m<p?m:p,f=x<f?x:f,g=m>g?m:g,b=x>b?x:b,m=o*n+u*r+c,x=a*n+l*r+d,p=m<p?m:p,f=x<f?x:f,g=m>g?m:g,b=x>b?x:b,m=o*e+u*i+c,x=a*e+l*i+d,p=m<p?m:p,f=x<f?x:f,g=m>g?m:g,b=x>b?x:b,m=o*n+u*i+c,x=a*n+l*i+d,p=m<p?m:p,f=x<f?x:f,g=m>g?m:g,b=x>b?x:b,this.minX=p,this.minY=f,this.maxX=g,this.maxY=b}addRect(e){this.addFrame(e.x,e.y,e.x+e.width,e.y+e.height)}addBounds(e){this.addFrame(e.minX,e.minY,e.maxX,e.maxY)}addBoundsMask(e){this.minX=this.minX>e.minX?this.minX:e.minX,this.minY=this.minY>e.minY?this.minY:e.minY,this.maxX=this.maxX<e.maxX?this.maxX:e.maxX,this.maxY=this.maxY<e.maxY?this.maxY:e.maxY}applyMatrix(e){const r=this.minX,n=this.minY,i=this.maxX,s=this.maxY,{a:o,b:a,c:u,d:l,tx:c,ty:d}=e;let p=o*r+u*n+c,f=a*r+l*n+d;this.minX=p,this.minY=f,this.maxX=p,this.maxY=f,p=o*i+u*n+c,f=a*i+l*n+d,this.minX=p<this.minX?p:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=p>this.maxX?p:this.maxX,this.maxY=f>this.maxY?f:this.maxY,p=o*r+u*s+c,f=a*r+l*s+d,this.minX=p<this.minX?p:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=p>this.maxX?p:this.maxX,this.maxY=f>this.maxY?f:this.maxY,p=o*i+u*s+c,f=a*i+l*s+d,this.minX=p<this.minX?p:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=p>this.maxX?p:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(e){return this.minX<e.left&&(this.minX=e.left),this.maxX>e.right&&(this.maxX=e.right),this.minY<e.top&&(this.minY=e.top),this.maxY>e.bottom&&(this.maxY=e.bottom),this}pad(e,r=e){return this.minX-=e,this.maxX+=e,this.minY-=r,this.maxY+=r,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new be(this.minX,this.minY,this.maxX,this.maxY)}scale(e,r=e){return this.minX*=e,this.minY*=r,this.maxX*=e,this.maxY*=r,this}get x(){return this.minX}get y(){return this.minY}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(e,r,n){let i=this.minX,s=this.minY,o=this.maxX,a=this.maxY;const u=this.matrix,l=u.a,c=u.b,d=u.c,p=u.d,f=u.tx,g=u.ty;for(let b=r;b<n;b+=2){const m=e[b],x=e[b+1],y=l*m+d*x+f,_=c*m+p*x+g;i=y<i?y:i,s=_<s?_:s,o=y>o?y:o,a=_>a?_:a}this.minX=i,this.minY=s,this.maxX=o,this.maxY=a}toString(){return`[@pixi:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}}function Ye(t,e){const r=e._scale,n=e._pivot,i=e._position,s=r._x,o=r._y,a=n._x,u=n._y;t.a=e._cx*s,t.b=e._sx*s,t.c=e._cy*o,t.d=e._sy*o,t.tx=i._x-(a*t.a+u*t.c),t.ty=i._y-(a*t.b+u*t.d)}function br(t,e,r){r.clear();let n;return t.parent?e?n=t.parent.worldTransform:n=vr(t,new R):n=R.IDENTITY,gs(t,r,n,e),r.isValid||r.set(0,0,0,0),r}function gs(t,e,r,n){var i,s;if(!t.visible||!t.measurable)return;let o;n?o=t.worldTransform:(t.didChange&&Ye(t.localTransform,t),o=R.shared.appendFrom(t.localTransform,r).clone());const a=e,u=!!t.effects.length;u&&(e=e.clone()),t.view&&(e.setMatrix(o),t.view.addBounds(e));for(let l=0;l<t.children.length;l++)gs(t.children[l],e,o,n);if(u){for(let l=0;l<t.effects.length;l++)(s=(i=t.effects[l]).addBounds)==null||s.call(i,e);a.setMatrix(R.IDENTITY),a.addBounds(e)}}function vr(t,e){const r=t.parent;return r&&(vr(r,e),r.didChange&&Ye(r.localTransform,r),e.append(r.localTransform)),e}function nt(t,e,r){e.clear(),r||(r=new R),t.view&&(e.setMatrix(r),t.view.addBounds(e));for(let n=0;n<t.children.length;n++)Xl(t.children[n],e,r,t);return e.isValid||e.set(0,0,0,0),e}function Xl(t,e,r,n){var i,s;if(!t.visible||!t.measurable)return;t.didChange&&Ye(t.localTransform,t);const o=t.localTransform,a=R.shared.appendFrom(o,r).clone(),u=e,l=!!t.effects.length;l&&(e=new be),t.view&&(e.setMatrix(a),t.view.addBounds(e));for(let c=0;c<t.children.length;c++)Xl(t.children[c],e,a,n);if(l){for(let c=0;c<t.effects.length;c++)(s=(i=t.effects[c]).addLocalBounds)==null||s.call(i,e,n);u.setMatrix(R.IDENTITY),u.addBounds(e)}}function jl(t,e,r){const n=t.parent;n&&n!==e&&(jl(n,e,r),Ye(n.localTransform,n),r.append(n.localTransform))}const yr=new be,_r=new R,Yl={get width(){return Math.abs(this.scale.x*nt(this,yr,_r).width)},set width(t){const e=nt(this,yr,_r).width;e!==0?this.scale.x=t/e:this.scale.x=1},get height(){return Math.abs(this.scale.y*nt(this,yr,_r).height)},set height(t){const e=nt(this,yr,_r).height;e!==0?this.scale.y=t/e:this.scale.y=1},getLocalBounds(t){const e=nt(this,new be,_r);return t?t.copyFromBounds(e):e.rectangle.clone()},getBounds(t,e){const r=br(this,t,yr);return e?e.copyFromBounds(r):r.rectangle.clone()}},Zl={_onRender:null,set onRender(t){const e=this.layerGroup;if(!t){this._onRender&&(e==null||e.removeOnRender(this)),this._onRender=null;return}this._onRender||e==null||e.addOnRender(this),this._onRender=t},get onRender(){return this._onRender}},ql={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(uv))}};function uv(t,e){return t._zIndex-e._zIndex}const Kl={getGlobalPosition(t=new Y,e=!1){return this.parent?this.parent.toGlobal(this._position,t,e):(t.x=this._position.x,t.y=this._position.y),t},toGlobal(t,e,r=!1){if(!r){this.didChange&&Ye(this.localTransform,this);const n=vr(this,new R);return n.append(this.localTransform),n.apply(t,e)}return this.worldTransform.apply(t,e)},toLocal(t,e,r,n){if(e&&(t=e.toGlobal(t,r,n)),!n){this.didChange&&Ye(this.localTransform,this);const i=vr(this,new R);return i.append(this.localTransform),i.applyInverse(t,r)}return this.worldTransform.applyInverse(t,r)}};class ms{constructor(){this.uid=J("instructionSet"),this.instructions=[],this.instructionSize=0}reset(){this.instructionSize=0}add(e){this.instructions[this.instructionSize++]=e}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}lastInstruction(){return this.instructions[this.instructionSize-1]}}class Jl{constructor(e){this.type="layer",this.root=null,this.canBundle=!1,this.layerGroupParent=null,this.layerGroupChildren=[],this._children=[],this.worldTransform=new R,this.worldColor=4294967295,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new ms,this._onRenderContainers=[],this.root=e,this.addChild(e)}get localTransform(){return this.root.localTransform}get layerTransform(){return this.root.layerTransform}addLayerGroupChild(e){e.layerGroupParent&&e.layerGroupParent._removeLayerGroupChild(e),e.layerGroupParent=this,this.onChildUpdate(e.root),this.layerGroupChildren.push(e)}_removeLayerGroupChild(e){e.root.didChange&&this._removeChildFromUpdate(e.root);const r=this.layerGroupChildren.indexOf(e);r>-1&&this.layerGroupChildren.splice(r,1),e.layerGroupParent=null}addChild(e){if(this.structureDidChange=!0,e!==this.root&&(this._children.push(e),e.updateTick=-1,e.parent===this.root?e.relativeLayerDepth=1:e.relativeLayerDepth=e.parent.relativeLayerDepth+1,e._onRender&&this.addOnRender(e)),e.layerGroup){if(e.layerGroup.root===e){this.addLayerGroupChild(e.layerGroup);return}}else e.layerGroup=this,e.didChange=!0;const r=e.children;e.isLayerRoot||this.onChildUpdate(e);for(let n=0;n<r.length;n++)this.addChild(r[n])}removeChild(e){if(this.structureDidChange=!0,e._onRender&&this.removeOnRender(e),e.layerGroup.root!==e){const n=e.children;for(let i=0;i<n.length;i++)this.removeChild(n[i]);e.didChange&&e.layerGroup._removeChildFromUpdate(e),e.layerGroup=null}else this._removeLayerGroupChild(e.layerGroup);const r=this._children.indexOf(e);r>-1&&this._children.splice(r,1)}onChildUpdate(e){let r=this.childrenToUpdate[e.relativeLayerDepth];r||(r=this.childrenToUpdate[e.relativeLayerDepth]={index:0,list:[]}),r.list[r.index++]=e}updateRenderable(e){e.layerVisibleRenderable<3||(e.didViewUpdate=!1,this.instructionSet.renderPipes[e.view.renderPipeId].updateRenderable(e))}onChildViewUpdate(e){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=e}_removeChildFromUpdate(e){const r=this.childrenToUpdate[e.relativeLayerDepth];if(!r)return;const n=r.list.indexOf(e);n>-1&&r.list.splice(n,1),r.index--}get isRenderable(){const e=this.worldColor>>24&255;return this.root.localVisibleRenderable===3&&e>0}addOnRender(e){this._onRenderContainers.push(e)}removeOnRender(e){this._onRenderContainers.splice(this._onRenderContainers.indexOf(e),1)}runOnRender(){this._onRenderContainers.forEach(e=>{e._onRender()})}}function ct(t){return Object.fromEntries(Object.entries(t).filter(([e,r])=>r!==void 0))}const Ql=new ue(null),bs=new ue(null),vs=new ue(null,1,1),Cn=1,ys=2,wn=4,lv=8;class K extends ge{constructor(e={}){var r,n;super(),this.uid=J("renderable"),this._updateFlags=15,this.isLayerRoot=!1,this.layerGroup=null,this.didChange=!1,this.didViewUpdate=!1,this.relativeLayerDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new R,this.layerTransform=new R,this.destroyed=!1,this._position=new ue(this,0,0),this._scale=vs,this._pivot=bs,this._skew=Ql,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=4294967295,this.layerColor=4294967295,this.localBlendMode="inherit",this.layerBlendMode="normal",this.localVisibleRenderable=3,this.layerVisibleRenderable=3,e.view&&(this.view=e.view,this.view.owner=this,e.view=void 0),Object.assign(this,ct(e)),this.children=[],(r=e.children)==null||r.forEach(i=>this.addChild(i)),this.effects=[],(n=e.effects)==null||n.forEach(i=>this.addEffect(i))}static mixin(e){Object.defineProperties(K.prototype,Object.getOwnPropertyDescriptors(e))}addChild(...e){if(this.allowChildren||G($,"addChild: Only Containers will be allowed to add children in v8.0.0"),e.length>1){for(let n=0;n<e.length;n++)this.addChild(e[n]);return e[0]}const r=e[0];return r.parent===this?(this.children.splice(this.children.indexOf(r),1),this.children.push(r),this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),r):(r.parent&&r.parent.removeChild(r),this.children.push(r),this.sortableChildren&&(this.sortDirty=!0),r.parent=this,r.didChange=!0,r.didViewUpdate=!1,r._updateFlags=15,this.layerGroup&&this.layerGroup.addChild(r),this.emit("childAdded",r,this,this.children.length-1),r.emit("added",this),r._zIndex!==0&&r.depthOfChildModified(),r)}removeChild(...e){if(e.length>1){for(let i=0;i<e.length;i++)this.removeChild(e[i]);return e[0]}const r=e[0],n=this.children.indexOf(r);return n>-1&&(this.children.splice(n,1),this.layerGroup&&this.layerGroup.removeChild(r)),r.parent=null,this.emit("childRemoved",r,this,n),r.emit("removed",this),r}onUpdate(e){if(e&&e===this._skew&&this._updateSkew(),!this.didChange)if(this.didChange=!0,this.isLayerRoot){const r=this.layerGroup.layerGroupParent;r&&r.onChildUpdate(this)}else this.layerGroup&&this.layerGroup.onChildUpdate(this)}onViewUpdate(){this.didViewUpdate||(this.didViewUpdate=!0,this.layerGroup&&this.layerGroup.onChildViewUpdate(this))}set layer(e){if(this.isLayerRoot&&e===!1)throw new Error("[Pixi] cannot undo a layer just yet");e&&this.enableLayer()}get layer(){return this.isLayerRoot}enableLayer(){if(this.layerGroup&&this.layerGroup.root===this)return;this.isLayerRoot=!0;const e=this.layerGroup;if(e&&e.removeChild(this),this.layerGroup=new Jl(this),e){for(let r=0;r<e.layerGroupChildren.length;r++){const n=e.layerGroupChildren[r];let i=n.root;for(;i;){if(i===this){this.layerGroup.addLayerGroupChild(n);break}i=i.parent}}e.addLayerGroupChild(this.layerGroup)}this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.isLayerRoot&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new R),this.layerGroup&&(this.isLayerRoot?this._worldTransform.copyFrom(this.layerGroup.worldTransform):this._worldTransform.appendFrom(this.layerTransform,this.layerGroup.worldTransform)),this._worldTransform}get x(){return this._position.x}set x(e){this._position.x=e}get y(){return this._position.y}set y(e){this._position.y=e}get position(){return this._position}set position(e){this._position.copyFrom(e)}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.onUpdate(this._skew))}get angle(){return this.rotation*Fl}set angle(e){this.rotation=e*Gl}get pivot(){return this._pivot===bs&&(this._pivot=new ue(this,0,0)),this._pivot}set pivot(e){this._pivot===bs&&(this._pivot=new ue(this,0,0)),this._pivot.copyFrom(e)}get skew(){return this._skew===Ql&&(this._skew=new ue(this,0,0)),this._skew}get scale(){return this._scale===vs&&(this._scale=new ue(this,1,1)),this._scale}set scale(e){this._scale===vs&&(this._scale=new ue(this,0,0)),this._scale.copyFrom(e)}_updateSkew(){const e=this._rotation,r=this._skew;this._cx=Math.cos(e+r._y),this._sx=Math.sin(e+r._y),this._cy=-Math.sin(e-r._x),this._sy=Math.cos(e-r._x)}set alpha(e){e=e*255|0,e!==(this.localColor>>24&255)&&(this.localColor=this.localColor&16777215|e<<24,this._updateFlags|=Cn,this.onUpdate())}get alpha(){return(this.localColor>>24&255)/255}set tint(e){const r=X.shared.setValue(e).toBgrNumber();r!==(this.localColor&16777215)&&(this.localColor=this.localColor&4278190080|r&16777215,this._updateFlags|=Cn,this.onUpdate())}get tint(){const e=this.localColor&16777215;return((e&255)<<16)+(e&65280)+(e>>16&255)}set blendMode(e){this.localBlendMode!==e&&(this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this._updateFlags|=ys,this.localBlendMode=e,this.onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localVisibleRenderable&2)}set visible(e){const r=e?1:0;(this.localVisibleRenderable&2)>>1!==r&&(this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this._updateFlags|=wn,this.localVisibleRenderable=this.localVisibleRenderable&1|r<<1,this.onUpdate())}get renderable(){return!!(this.localVisibleRenderable&1)}set renderable(e){const r=e?1:0;(this.localVisibleRenderable&1)!==r&&(this.localVisibleRenderable=this.localVisibleRenderable&2|r,this._updateFlags|=wn,this.layerGroup&&!this.isLayerRoot&&(this.layerGroup.structureDidChange=!0),this.onUpdate())}get isRenderable(){const e=this.layerColor>>24&255;return this.localVisibleRenderable===3&&e>0}destroy(e=!1){if(this.destroyed)return;this.destroyed=!0,this.removeFromParent(),this.parent=null,this._mask=null,this._filters=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._skew=null,this.emit("destroyed"),this.removeAllListeners();const r=typeof e=="boolean"?e:e==null?void 0:e.children,n=this.removeChildren(0,this.children.length);if(r)for(let i=0;i<n.length;++i)n[i].destroy(e);this.view&&(this.view.destroy(e),this.view.owner=null)}}K.mixin(Ol),K.mixin(Kl),K.mixin(Zl),K.mixin(Yl),K.mixin(Hl),K.mixin(Wl),K.mixin(ql);var _s=/iPhone/i,ec=/iPod/i,tc=/iPad/i,rc=/\biOS-universal(?:.+)Mac\b/i,xs=/\bAndroid(?:.+)Mobile\b/i,nc=/Android/i,Nt=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Tn=/Silk/i,Ze=/Windows Phone/i,ic=/\bWindows(?:.+)ARM\b/i,sc=/BlackBerry/i,oc=/BB10/i,ac=/Opera Mini/i,uc=/\b(CriOS|Chrome)(?:.+)Mobile/i,lc=/Mobile(?:.+)Firefox\b/i,cc=function(t){return typeof t!="undefined"&&t.platform==="MacIntel"&&typeof t.maxTouchPoints=="number"&&t.maxTouchPoints>1&&typeof MSStream=="undefined"};function cv(t){return function(e){return e.test(t)}}function hc(t){var e={userAgent:"",platform:"",maxTouchPoints:0};!t&&typeof navigator!="undefined"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof t=="string"?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0});var r=e.userAgent,n=r.split("[FBAN");typeof n[1]!="undefined"&&(r=n[0]),n=r.split("Twitter"),typeof n[1]!="undefined"&&(r=n[0]);var i=cv(r),s={apple:{phone:i(_s)&&!i(Ze),ipod:i(ec),tablet:!i(_s)&&(i(tc)||cc(e))&&!i(Ze),universal:i(rc),device:(i(_s)||i(ec)||i(tc)||i(rc)||cc(e))&&!i(Ze)},amazon:{phone:i(Nt),tablet:!i(Nt)&&i(Tn),device:i(Nt)||i(Tn)},android:{phone:!i(Ze)&&i(Nt)||!i(Ze)&&i(xs),tablet:!i(Ze)&&!i(Nt)&&!i(xs)&&(i(Tn)||i(nc)),device:!i(Ze)&&(i(Nt)||i(Tn)||i(xs)||i(nc))||i(/\bokhttp\b/i)},windows:{phone:i(Ze),tablet:i(ic),device:i(Ze)||i(ic)},other:{blackberry:i(sc),blackberry10:i(oc),opera:i(ac),firefox:i(lc),chrome:i(uc),device:i(sc)||i(oc)||i(ac)||i(lc)||i(uc)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}var dc;const fc=((dc=hc.default)!=null?dc:hc)(globalThis.navigator),As={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};K.mixin(As);const hv=9,Sn=100,dv=0,fv=0,pc=2,gc=1,pv=-1e3,gv=-1e3,mv=2;class En{constructor(e,r=fc){this._mobileInfo=r,this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(r.tablet||r.phone)&&this._createTouchHook();const n=document.createElement("div");n.style.width=`${Sn}px`,n.style.height=`${Sn}px`,n.style.position="absolute",n.style.top=`${dv}px`,n.style.left=`${fv}px`,n.style.zIndex=pc.toString(),this._div=n,this._renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const e=document.createElement("button");e.style.width=`${gc}px`,e.style.height=`${gc}px`,e.style.position="absolute",e.style.top=`${pv}px`,e.style.left=`${gv}px`,e.style.zIndex=mv.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){var e;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.add(this),(e=this._renderer.view.canvas.parentNode)==null||e.appendChild(this._div))}_deactivate(){var e;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this),(e=this._div.parentNode)==null||e.removeChild(this._div))}_updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this._addChild(e),e.renderId=this._renderId);const r=e.children;if(r)for(let n=0;n<r.length;n++)this._updateAccessibleObjects(r[n])}init(e){var r;this.debug=(r=e==null?void 0:e.debug)!=null?r:this.debug,this._renderer.runners.postrender.remove(this)}postrender(){const e=performance.now();if(this._mobileInfo.android.device&&e<this._androidUpdateCount||(this._androidUpdateCount=e+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered);const{x:r,y:n,width:i,height:s}=this._renderer.view.canvas.getBoundingClientRect(),{width:o,height:a,resolution:u}=this._renderer,l=i/o*u,c=s/a*u;let d=this._div;d.style.left=`${r}px`,d.style.top=`${n}px`,d.style.width=`${o}px`,d.style.height=`${a}px`;for(let p=0;p<this._children.length;p++){const f=this._children[p];if(f.renderId!==this._renderId)f._accessibleActive=!1,ps(this._children,p,1),this._div.removeChild(f._accessibleDiv),this._pool.push(f._accessibleDiv),f._accessibleDiv=null,p--;else{d=f._accessibleDiv;let g=f.hitArea;const b=f.worldTransform;f.hitArea?(d.style.left=`${(b.tx+g.x*b.a)*l}px`,d.style.top=`${(b.ty+g.y*b.d)*c}px`,d.style.width=`${g.width*b.a*l}px`,d.style.height=`${g.height*b.d*c}px`):(g=f.getBounds(),this.capHitArea(g),d.style.left=`${g.x*l}px`,d.style.top=`${g.y*c}px`,d.style.width=`${g.width*l}px`,d.style.height=`${g.height*c}px`,d.title!==f.accessibleTitle&&f.accessibleTitle!==null&&(d.title=f.accessibleTitle),d.getAttribute("aria-label")!==f.accessibleHint&&f.accessibleHint!==null&&d.setAttribute("aria-label",f.accessibleHint)),(f.accessibleTitle!==d.title||f.tabIndex!==d.tabIndex)&&(d.title=f.accessibleTitle,d.tabIndex=f.tabIndex,this.debug&&this.updateDebugHTML(d))}}this._renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:r,height:n}=this._renderer;e.x+e.width>r&&(e.width=r-e.x),e.y+e.height>n&&(e.height=n-e.y)}_addChild(e){let r=this._pool.pop();r||(r=document.createElement("button"),r.style.width=`${Sn}px`,r.style.height=`${Sn}px`,r.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",r.style.position="absolute",r.style.zIndex=pc.toString(),r.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?r.setAttribute("aria-live","off"):r.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?r.setAttribute("aria-relevant","additions"):r.setAttribute("aria-relevant","text"),r.addEventListener("click",this._onClick.bind(this)),r.addEventListener("focus",this._onFocus.bind(this)),r.addEventListener("focusout",this._onFocusOut.bind(this))),r.style.pointerEvents=e.accessiblePointerEvents,r.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?r.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(r.title=`container ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&r.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(r),e._accessibleActive=!0,e._accessibleDiv=r,r.container=e,this._children.push(e),this._div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,r){const{container:n}=e.target,i=this._renderer.events.rootBoundary,s=Object.assign(new Lt(i),{target:n});i.rootTarget=this._renderer.lastObjectRendered,r.forEach(o=>i.dispatchEvent(s,o))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===hv&&this._activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this._deactivate()}destroy(){this._destroyTouchHook(),this._div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this._pool=null,this._children=null,this._renderer=null}}En.extension={type:[v.WebGLSystem,v.WebGPUSystem],name:"accessibility"},V.add(En),V.add(En),K.mixin(As);const mc={extension:{type:v.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await Promise.resolve().then(function(){return x_})}},bc={extension:{type:v.Environment,name:"webworker",priority:0},test:()=>typeof self!="undefined"&&self.WorkerGlobalScope!==void 0,load:async()=>{await Promise.resolve().then(function(){return px})}},Cs=[];V.handleByNamedList(v.Environment,Cs),V.add(mc,bc);async function vc(t){if(t)for(let e=0;e<Cs.length;e++){const r=Cs[e];if(r.value.test()){await r.value.load();return}}}const yc={createCanvas:(t,e)=>{const r=document.createElement("canvas");return r.width=t,r.height=e,r},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>{var t;return(t=document.baseURI)!=null?t:window.location.href},getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new DOMParser().parseFromString(t,"text/xml")};let _c=yc;const Z={get(){return _c},set(t){_c=t}};class In{constructor(e){this.items=[],this._name=e}emit(e,r,n,i,s,o,a,u){const{name:l,items:c}=this;for(let d=0,p=c.length;d<p;d++)c[d][l](e,r,n,i,s,o,a,u);return this}add(e){return e[this._name]&&(this.remove(e),this.items.push(e)),this}remove(e){const r=this.items.indexOf(e);return r!==-1&&this.items.splice(r,1),this}contains(e){return this.items.indexOf(e)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}var bv=Object.defineProperty,xc=Object.getOwnPropertySymbols,vv=Object.prototype.hasOwnProperty,yv=Object.prototype.propertyIsEnumerable,Ac=(t,e,r)=>e in t?bv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pn=(t,e)=>{for(var r in e||(e={}))vv.call(e,r)&&Ac(t,r,e[r]);if(xc)for(var r of xc(e))yv.call(e,r)&&Ac(t,r,e[r]);return t};const _v=["init","destroy","contextChange","resolutionChange","reset","renderEnd","renderStart","render","update","postrender","prerender"],Cc=class{constructor(t){this.runners=Object.create(null),this.renderPipes=Object.create(null),this._systemsHash=Object.create(null);var e;this.type=t.type,this.name=t.name;const r=[..._v,...(e=t.runners)!=null?e:[]];this._addRunners(...r),this._addSystems(t.systems),this._addPipes(t.renderPipes,t.renderPipeAdaptors)}async init(t={}){for(const e in this._systemsHash){const r=this._systemsHash[e].constructor.defaultOptions;t=Pn(Pn({},r),t)}t=Pn(Pn({},Cc.defaultOptions),t),this._roundPixels=t.roundPixels?1:0;for(let e=0;e<this.runners.init.items.length;e++)await this.runners.init.items[e].init(t)}render(t,e){let r=t;if(r instanceof K&&(r={container:r},e&&(G($,"passing a second argument is deprecated, please use render options instead"),r.target=e.renderTexture)),r.target||(r.target=this.view.texture),r.target===this.view.texture&&(this._lastObjectRendered=r.container),r.clearColor){const n=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=n?r.clearColor:X.shared.setValue(r.clearColor).toArray()}this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(t,e,r){this.view.resize(t,e,r)}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frameWidth}get height(){return this.view.texture.frameHeight}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new In(e)})}_addSystems(t){let e;for(e in t){const r=t[e];this._addSystem(r.value,r.name)}}_addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}_addPipes(t,e){const r=e.reduce((n,i)=>(n[i.name]=i.value,n),{});t.forEach(n=>{const i=n.value,s=n.name,o=r[s];this.renderPipes[s]=new i(this,o?new o:null)})}destroy(t=!1){const e=this;this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(r=>{r.destroy()}),e.runners=null,this._systemsHash=null,e.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}};let $t=Cc;$t.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let ws;function Bn(t){return ws!==void 0||(ws=(()=>{var e;const r={stencil:!0,failIfMajorPerformanceCaveat:t!=null?t:$t.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Z.get().getWebGLRenderingContext())return!1;let n=Z.get().createCanvas().getContext("webgl2",r);const i=!!((e=n==null?void 0:n.getContextAttributes())!=null&&e.stencil);if(n){const s=n.getExtension("WEBGL_lose_context");s&&s.loseContext()}return n=null,i}catch(n){return!1}})()),ws}let Ts;async function Mn(t={}){return Ts!==void 0||(Ts=await(async()=>{if(!Z.get().getNavigator().gpu)return!1;try{return await(await navigator.gpu.requestAdapter(t)).requestDevice(),!0}catch(e){return!1}})()),Ts}var xv=Object.defineProperty,wc=Object.getOwnPropertySymbols,Av=Object.prototype.hasOwnProperty,Cv=Object.prototype.propertyIsEnumerable,Tc=(t,e,r)=>e in t?xv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,xr=(t,e)=>{for(var r in e||(e={}))Av.call(e,r)&&Tc(t,r,e[r]);if(wc)for(var r of wc(e))Cv.call(e,r)&&Tc(t,r,e[r]);return t};const Sc=["webgpu","webgl","canvas"];async function Ec(t){var e,r;let n=[];t.preference?(n.push(t.preference),Sc.forEach(a=>{a!==t.preference&&n.push(a)})):n=Sc.slice();let i;await vc((e=t.manageImports)!=null?e:!0);let s={};for(let a=0;a<n.length;a++){const u=n[a];if(u==="webgpu"&&await Mn()){const{WebGPURenderer:l}=await Promise.resolve().then(function(){return XC});i=l,s=xr(xr({},t),t.webgpu);break}else if(u==="webgl"&&Bn((r=t.failIfMajorPerformanceCaveat)!=null?r:$t.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:l}=await Promise.resolve().then(function(){return FC});i=l,s=xr(xr({},t),t.webgl);break}else if(u==="canvas"){s=xr({},t);break}}delete s.webgpu,delete s.webgl;const o=new i;return await o.init(s),o}var wv=Object.defineProperty,Ic=Object.getOwnPropertySymbols,Tv=Object.prototype.hasOwnProperty,Sv=Object.prototype.propertyIsEnumerable,Pc=(t,e,r)=>e in t?wv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ev=(t,e)=>{for(var r in e||(e={}))Tv.call(e,r)&&Pc(t,r,e[r]);if(Ic)for(var r of Ic(e))Sv.call(e,r)&&Pc(t,r,e[r]);return t};const Ss=class{constructor(){this.stage=new K}async init(t){t=Ev({},t),this.renderer=await Ec(t),Ss._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1){const e=Ss._plugins.slice(0);e.reverse(),e.forEach(r=>{r.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Es=Ss;Es._plugins=[],V.handleByList(v.Application,Es._plugins);var ht=(t=>(t[t.INTERACTION=50]="INTERACTION",t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(ht||{});class Dn{constructor(e,r=null,n=0,i=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=e,this._context=r,this.priority=n,this._once=i}match(e,r=null){return this._fn===e&&this._context===r}emit(e){this._fn&&(this._context?this._fn.call(this._context,e):this._fn(e));const r=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),r}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const r=this.next;return this.next=e?null:r,this.previous=null,r}}const Ce=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new Dn(null,null,1/0),this.deltaMS=1/Ce.targetFPMS,this.elapsedMS=1/Ce.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=ht.NORMAL){return this._addListener(new Dn(t,e,r))}addOnce(t,e,r=ht.NORMAL){return this._addListener(new Dn(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const i=t-this._lastFrame|0;if(i<this._minElapsedMS)return;this._lastFrame=t-i%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Ce.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,Ce.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Ce._shared){const t=Ce._shared=new Ce;t.autoStart=!0,t._protected=!0}return Ce._shared}static get system(){if(!Ce._system){const t=Ce._system=new Ce;t.autoStart=!0,t._protected=!0}return Ce._system}};let ve=Ce;ve.targetFPMS=.06;class Is{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,ht.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?ve.shared:new ve,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Is.extension=v.Application;class Ps{static init(e){Object.defineProperty(this,"resizeTo",{set(r){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let r,n;if(this._resizeTo===globalThis.window)r=globalThis.innerWidth,n=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:s}=this._resizeTo;r=i,n=s}this.renderer.resize(r,n),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Ps.extension=v.Application,V.add(Ps),V.add(Is);class Bc{constructor(e,r=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=r}add(e){e.forEach(r=>{this._assetList.push(r)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],r=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<r;n++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const Ee=(t,e,r=!1)=>(Array.isArray(t)||(t=[t]),e?t.map(n=>typeof n=="string"||r?e(n):n):t);class Iv{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){return this._cache.get(e)}set(e,r){const n=Ee(e);let i;for(let u=0;u<this.parsers.length;u++){const l=this.parsers[u];if(l.test(r)){i=l.getCacheableAssets(n,r);break}}const s=new Map(Object.entries(i||{}));i||n.forEach(u=>{s.set(u,r)});const o=[...s.keys()],a={cacheKeys:o,keys:n};n.forEach(u=>{this._cacheMap.set(u,a)}),o.forEach(u=>{this._cache.has(u)&&this._cache.get(u),this._cache.set(u,s.get(u))})}remove(e){if(!this._cacheMap.has(e))return;const r=this._cacheMap.get(e);r.cacheKeys.forEach(n=>{this._cache.delete(n)}),r.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const re=new Iv;function Fe(t){if(typeof t!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Ar(t){return t.split("?")[0].split("#")[0]}function Pv(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Bv(t,e,r){return t.replace(new RegExp(Pv(e),"g"),r)}function Mv(t,e){let r="",n=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(r.length<2||n!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){const u=r.lastIndexOf("/");if(u!==r.length-1){u===-1?(r="",n=0):(r=r.slice(0,u),n=r.length-1-r.lastIndexOf("/")),i=a,s=0;continue}}else if(r.length===2||r.length===1){r="",n=0,i=a,s=0;continue}}e&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+=`/${t.slice(i+1,a)}`:r=t.slice(i+1,a),n=a-i-1;i=a,s=0}else o===46&&s!==-1?++s:s=-1}return r}const ye={toPosix(t){return Bv(t,"\\","/")},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl(t){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t)},isBlobUrl(t){return t.startsWith("blob:")},hasProtocol(t){return/^[^/:]+:/.test(this.toPosix(t))},getProtocol(t){Fe(t),t=this.toPosix(t);const e=/^file:\/\/\//.exec(t);if(e)return e[0];const r=/^[^/:]+:\/{0,2}/.exec(t);return r?r[0]:""},toAbsolute(t,e,r){if(Fe(t),this.isDataUrl(t)||this.isBlobUrl(t))return t;const n=Ar(this.toPosix(e!=null?e:Z.get().getBaseUrl())),i=Ar(this.toPosix(r!=null?r:this.rootname(n)));return t=this.toPosix(t),t.startsWith("/")?ye.join(i,t.slice(1)):this.isAbsolute(t)?t:this.join(n,t)},normalize(t){if(Fe(t),t.length===0)return".";if(this.isDataUrl(t)||this.isBlobUrl(t))return t;t=this.toPosix(t);let e="";const r=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const n=t.endsWith("/");return t=Mv(t,!1),t.length>0&&n&&(t+="/"),r?`/${t}`:e+t},isAbsolute(t){return Fe(t),t=this.toPosix(t),this.hasProtocol(t)?!0:t.startsWith("/")},join(...t){var e;if(t.length===0)return".";let r;for(let n=0;n<t.length;++n){const i=t[n];if(Fe(i),i.length>0)if(r===void 0)r=i;else{const s=(e=t[n-1])!=null?e:"";this.extname(s)?r+=`/../${i}`:r+=`/${i}`}}return r===void 0?".":this.normalize(r)},dirname(t){if(Fe(t),t.length===0)return".";t=this.toPosix(t);let e=t.charCodeAt(0);const r=e===47;let n=-1,i=!0;const s=this.getProtocol(t),o=t;t=t.slice(s.length);for(let a=t.length-1;a>=1;--a)if(e=t.charCodeAt(a),e===47){if(!i){n=a;break}}else i=!1;return n===-1?r?"/":this.isUrl(o)?s+t:s:r&&n===1?"//":s+t.slice(0,n)},rootname(t){Fe(t),t=this.toPosix(t);let e="";if(t.startsWith("/")?e="/":e=this.getProtocol(t),this.isUrl(t)){const r=t.indexOf("/",e.length);r!==-1?e=t.slice(0,r):e=t,e.endsWith("/")||(e+="/")}return e},basename(t,e){Fe(t),e&&Fe(e),t=Ar(this.toPosix(t));let r=0,n=-1,i=!0,s;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(s=t.length-1;s>=0;--s){const u=t.charCodeAt(s);if(u===47){if(!i){r=s+1;break}}else a===-1&&(i=!1,a=s+1),o>=0&&(u===e.charCodeAt(o)?--o===-1&&(n=s):(o=-1,n=a))}return r===n?n=a:n===-1&&(n=t.length),t.slice(r,n)}for(s=t.length-1;s>=0;--s)if(t.charCodeAt(s)===47){if(!i){r=s+1;break}}else n===-1&&(i=!1,n=s+1);return n===-1?"":t.slice(r,n)},extname(t){Fe(t),t=Ar(this.toPosix(t));let e=-1,r=0,n=-1,i=!0,s=0;for(let o=t.length-1;o>=0;--o){const a=t.charCodeAt(o);if(a===47){if(!i){r=o+1;break}continue}n===-1&&(i=!1,n=o+1),a===46?e===-1?e=o:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||n===-1||s===0||s===1&&e===n-1&&e===r+1?"":t.slice(e,n)},parse(t){Fe(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;t=Ar(this.toPosix(t));let r=t.charCodeAt(0);const n=this.isAbsolute(t);let i;const s="";e.root=this.rootname(t),n||this.hasProtocol(t)?i=1:i=0;let o=-1,a=0,u=-1,l=!0,c=t.length-1,d=0;for(;c>=i;--c){if(r=t.charCodeAt(c),r===47){if(!l){a=c+1;break}continue}u===-1&&(l=!1,u=c+1),r===46?o===-1?o=c:d!==1&&(d=1):o!==-1&&(d=-1)}return o===-1||u===-1||d===0||d===1&&o===u-1&&o===a+1?u!==-1&&(a===0&&n?e.base=e.name=t.slice(1,u):e.base=e.name=t.slice(a,u)):(a===0&&n?(e.name=t.slice(1,o),e.base=t.slice(1,u)):(e.name=t.slice(a,o),e.base=t.slice(a,u)),e.ext=t.slice(o,u)),e.dir=this.dirname(t),s&&(e.dir=s+e.dir),e},sep:"/",delimiter:":"},Cr=t=>!Array.isArray(t);var Dv=Object.defineProperty,Rv=Object.defineProperties,Fv=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,Gv=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,Dc=(t,e,r)=>e in t?Dv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ov=(t,e)=>{for(var r in e||(e={}))Gv.call(e,r)&&Dc(t,r,e[r]);if(Mc)for(var r of Mc(e))kv.call(e,r)&&Dc(t,r,e[r]);return t},Uv=(t,e)=>Rv(t,Fv(e));class Rc{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,r,n)=>(this._parsersValidated=!1,e[r]=n,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,r){const n={promise:null,parser:null};return n.promise=(async()=>{var i,s;let o=null,a=null;if(r.loadParser&&(a=this._parserHash[r.loadParser]),!a){for(let u=0;u<this.parsers.length;u++){const l=this.parsers[u];if(l.load&&(i=l.test)!=null&&i.call(l,e,r,this)){a=l;break}}if(!a)return null}o=await a.load(e,r,this),n.parser=a;for(let u=0;u<this.parsers.length;u++){const l=this.parsers[u];l.parse&&l.parse&&await((s=l.testParse)==null?void 0:s.call(l,o,r,this))&&(o=await l.parse(o,r,this)||o,n.parser=l)}return o})(),n}async load(e,r){this._parsersValidated||this._validateParsers();let n=0;const i={},s=Cr(e),o=Ee(e,l=>({alias:[l],src:l})),a=o.length,u=o.map(async l=>{const c=ye.toAbsolute(l.src);if(!i[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),i[l.src]=await this.promiseCache[c].promise,r&&r(++n/a)}catch(d){throw delete this.promiseCache[c],delete i[l.src],new Error(`[Loader.load] Failed to load ${c}.
${d}`)}});return await Promise.all(u),s?i[o[0].src]:i}async unload(e){const r=Ee(e,n=>({alias:[n],src:n})).map(async n=>{var i,s;const o=ye.toAbsolute(n.src),a=this.promiseCache[o];if(a){const u=await a.promise;delete this.promiseCache[o],(s=(i=a.parser)==null?void 0:i.unload)==null||s.call(i,u,n,this)}});await Promise.all(r)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,r)=>(r.name&&e[r.name],Uv(Ov({},e),{[r.name]:r})),{})}}function Fc(t,e,r,n,i){const s=e[r];for(let o=0;o<s.length;o++){const a=s[o];r<e.length-1?Fc(t.replace(n[r],a),e,r+1,n,i):i.push(t.replace(n[r],a))}}function Gc(t){const e=/\{(.*?)\}/g,r=t.match(e),n=[];if(r){const i=[];r.forEach(s=>{const o=s.substring(1,s.length-1).split(",");i.push(o)}),Fc(t,i,0,r,n)}else n.push(t);return n}var Lv=Object.defineProperty,Nv=Object.defineProperties,$v=Object.getOwnPropertyDescriptors,kc=Object.getOwnPropertySymbols,Vv=Object.prototype.hasOwnProperty,zv=Object.prototype.propertyIsEnumerable,Oc=(t,e,r)=>e in t?Lv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Vt=(t,e)=>{for(var r in e||(e={}))Vv.call(e,r)&&Oc(t,r,e[r]);if(kc)for(var r of kc(e))zv.call(e,r)&&Oc(t,r,e[r]);return t},Uc=(t,e)=>Nv(t,$v(e));class dt{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,r)=>`${e}${this._bundleIdConnector}${r}`,extractAssetIdFromBundle:(e,r)=>r.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){var r,n,i;if(this._bundleIdConnector=(r=e.connector)!=null?r:this._bundleIdConnector,this._createBundleAssetId=(n=e.createBundleAssetId)!=null?n:this._createBundleAssetId,this._extractAssetIdFromBundle=(i=e.extractAssetIdFromBundle)!=null?i:this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(r=>{this._preferredOrder.push(r),r.priority||(r.priority=Object.keys(r.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const r=e;this._defaultSearchParams=Object.keys(r).map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n])}`).join("&")}}getAlias(e){const{alias:r,name:n,src:i,srcs:s}=e;return Ee(r||n||i||s,o=>{var a;return typeof o=="string"?o:Array.isArray(o)?o.map(u=>{var l,c;return(c=(l=u==null?void 0:u.src)!=null?l:u==null?void 0:u.srcs)!=null?c:u}):o!=null&&o.src||o!=null&&o.srcs?(a=o.src)!=null?a:o.srcs:o},!0)}addManifest(e){this._manifest,this._manifest=e,e.bundles.forEach(r=>{this.addBundle(r.name,r.assets)})}addBundle(e,r){const n=[];Array.isArray(r)?r.forEach(i=>{var s,o;const a=(s=i.src)!=null?s:i.srcs,u=(o=i.alias)!=null?o:i.name;let l;if(typeof u=="string"){const c=this._createBundleAssetId(e,u);n.push(c),l=[u,c]}else{const c=u.map(d=>this._createBundleAssetId(e,d));n.push(...c),l=[...u,...c]}this.add(Uc(Vt({},i),{alias:l,src:a}))}):Object.keys(r).forEach(i=>{var s;const o=[i,this._createBundleAssetId(e,i)];if(typeof r[i]=="string")this.add({alias:o,src:r[i]});else if(Array.isArray(r[i]))this.add({alias:o,src:r[i]});else{const a=r[i],u=(s=a.src)!=null?s:a.srcs;this.add(Uc(Vt({},a),{alias:o,src:Array.isArray(u)?u:[u]}))}n.push(...o)}),this._bundles[e]=n}add(e){const r=[];Array.isArray(e)?r.push(...e):r.push(e);let n;Ee(r).forEach(i=>{const{src:s,srcs:o}=i;let{data:a,format:u,loadParser:l}=i;const c=Ee(s||o).map(f=>typeof f=="string"?Gc(f):Array.isArray(f)?f:[f]),d=this.getAlias(i),p=[];c.forEach(f=>{f.forEach(g=>{var b,m,x;let y={};if(typeof g!="object"){y.src=g;for(let _=0;_<this._parsers.length;_++){const A=this._parsers[_];if(A.test(g)){y=A.parse(g);break}}}else a=(b=g.data)!=null?b:a,u=(m=g.format)!=null?m:u,l=(x=g.loadParser)!=null?x:l,y=Vt(Vt({},y),g);if(!d)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this._buildResolvedAsset(y,{aliases:d,data:a,format:u,loadParser:l}),p.push(y)})}),d.forEach(f=>{this._assetMap[f]=p})})}resolveBundle(e){const r=Cr(e);e=Ee(e);const n={};return e.forEach(i=>{const s=this._bundles[i];if(s){const o=this.resolve(s),a={};for(const u in o){const l=o[u];a[this._extractAssetIdFromBundle(i,u)]=l}n[i]=a}}),r?n[e[0]]:n}resolveUrl(e){const r=this.resolve(e);if(typeof e!="string"){const n={};for(const i in r)n[i]=r[i].src;return n}return r.src}resolve(e){const r=Cr(e);e=Ee(e);const n={};return e.forEach(i=>{if(!this._resolverHash[i])if(this._assetMap[i]){let s=this._assetMap[i];const o=this._getPreferredOrder(s);o==null||o.priority.forEach(a=>{o.params[a].forEach(u=>{const l=s.filter(c=>c[a]?c[a]===u:!1);l.length&&(s=l)})}),this._resolverHash[i]=s[0]}else this._resolverHash[i]=this._buildResolvedAsset({alias:[i],src:i},{});n[i]=this._resolverHash[i]}),r?n[e[0]]:n}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let r=0;r<e.length;r++){const n=e[0],i=this._preferredOrder.find(s=>s.params.format.includes(n.format));if(i)return i}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const r=/\?/.test(e)?"&":"?";return`${e}${r}${this._defaultSearchParams}`}_buildResolvedAsset(e,r){var n,i;const{aliases:s,data:o,loadParser:a,format:u}=r;return(this._basePath||this._rootPath)&&(e.src=ye.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=(n=s!=null?s:e.alias)!=null?n:[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data=Vt(Vt({},o||{}),e.data),e.loadParser=a!=null?a:e.loadParser,e.format=(i=u!=null?u:e.format)!=null?i:e.src.split(".").pop(),e.srcs=e.src,e.name=e.alias,e}}dt.RETINA_PREFIX=/@([0-9\.]+)x/;class Lc{constructor(){this._detections=[],this._initialized=!1,this.resolver=new dt,this.loader=new Rc,this.cache=re,this._backgroundLoader=new Bc(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){var r,n,i;if(this._initialized)return;if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let u=e.manifest;typeof u=="string"&&(u=await this.load(u)),this.resolver.addManifest(u)}const s=(n=(r=e.texturePreference)==null?void 0:r.resolution)!=null?n:1,o=typeof s=="number"?[s]:s,a=await this._detectFormats({preferredFormats:(i=e.texturePreference)==null?void 0:i.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:a,resolution:o}}),e.preferences&&this.setPreferences(e.preferences)}add(e){this.resolver.add(e)}async load(e,r){this._initialized||await this.init();const n=Cr(e),i=Ee(e).map(a=>{if(typeof a!="string"){const u=this.resolver.getAlias(a);return u.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(u)?u[0]:u}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),s=this.resolver.resolve(i),o=await this._mapLoadToResolve(s,r);return n?o[i[0]]:o}addBundle(e,r){this.resolver.addBundle(e,r)}async loadBundle(e,r){this._initialized||await this.init();let n=!1;typeof e=="string"&&(n=!0,e=[e]);const i=this.resolver.resolveBundle(e),s={},o=Object.keys(i);let a=0,u=0;const l=()=>{r==null||r(++a/u)},c=o.map(d=>{const p=i[d];return u+=Object.keys(p).length,this._mapLoadToResolve(p,l).then(f=>{s[d]=f})});return await Promise.all(c),n?s[e[0]]:s}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(r))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const r=this.resolver.resolveBundle(e);Object.values(r).forEach(n=>{this._backgroundLoader.add(Object.values(n))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return re.get(e);const r={};for(let n=0;n<e.length;n++)r[n]=re.get(e[n]);return r}async _mapLoadToResolve(e,r){const n=Object.values(e),i=Object.keys(e);this._backgroundLoader.active=!1;const s=await this.loader.load(n,r);this._backgroundLoader.active=!0;const o={};return n.forEach((a,u)=>{const l=s[a.src],c=[a.src];a.alias&&c.push(...a.alias),o[i[u]]=l,re.set(c,l)}),o}async unload(e){this._initialized||await this.init();const r=Ee(e).map(i=>typeof i!="string"?i.src:i),n=this.resolver.resolve(r);await this._unloadFromResolved(n)}async unloadBundle(e){this._initialized||await this.init(),e=Ee(e);const r=this.resolver.resolveBundle(e),n=Object.keys(r).map(i=>this._unloadFromResolved(r[i]));await Promise.all(n)}async _unloadFromResolved(e){const r=Object.values(e);r.forEach(n=>{re.remove(n.src)}),await this.loader.unload(r)}async _detectFormats(e){let r=[];e.preferredFormats&&(r=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const n of e.detections)e.skipDetections||await n.test()?r=await n.add(r):e.skipDetections||(r=await n.remove(r));return r=r.filter((n,i)=>r.indexOf(n)===i),r}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(r=>{r.config&&Object.keys(r.config).filter(n=>n in e).forEach(n=>{r.config[n]=e[n]})})}}const wr=new Lc;V.handleByList(v.LoadParser,wr.loader.parsers).handleByList(v.ResolveParser,wr.resolver.parsers).handleByList(v.CacheParser,wr.cache.parsers).handleByList(v.DetectionParser,wr.detections);const Bs=()=>{},Ms=[];V.handleByList(v.TextureSource,Ms);function Nc(t={}){for(let e=0;e<Ms.length;e++){const r=Ms[e];if(r.test(t.resource))return new r(t)}throw new Error(`Could not find a source type for resource: ${t.resource}`)}function $c(t={},e=!1){const{resource:r}=t;if(!e&&re.has(r))return re.get(r);const n=new E({source:Nc(t)});return n.on("destroy",()=>{re.has(r)&&re.remove(r)}),e||re.set(r,n),n}const Ds=Object.create(null),Vc=Object.create(null);function Rn(t,e){let r=Vc[t];return r===void 0&&(Ds[e]===void 0&&(Ds[e]=1),Vc[t]=r=Ds[e]++),r}var Hv=Object.defineProperty,zc=Object.getOwnPropertySymbols,Wv=Object.prototype.hasOwnProperty,Xv=Object.prototype.propertyIsEnumerable,Hc=(t,e,r)=>e in t?Hv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wc=(t,e)=>{for(var r in e||(e={}))Wv.call(e,r)&&Hc(t,r,e[r]);if(zc)for(var r of zc(e))Xv.call(e,r)&&Hc(t,r,e[r]);return t};const Xc=class extends ge{constructor(t={}){var e,r,n,i,s,o,a;super(),this.resourceType="textureSampler",this.touched=0,this._maxAnisotropy=1,t=Wc(Wc({},Xc.defaultOptions),t),this.addressMode=t.addressMode,this.addressModeU=(e=t.addressModeU)!=null?e:this.addressModeU,this.addressModeV=(r=t.addressModeV)!=null?r:this.addressModeV,this.addressModeW=(n=t.addressModeW)!=null?n:this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=(i=t.magFilter)!=null?i:this.magFilter,this.minFilter=(s=t.minFilter)!=null?s:this.minFilter,this.mipmapFilter=(o=t.mipmapFilter)!=null?o:this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=(a=t.maxAnisotropy)!=null?a:1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){G("8","TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get resourceId(){return this._resourceId||this._generateResourceId()}update(){this.emit("change",this),this._resourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._resourceId=Rn(t,"sampler"),this._resourceId}destroy(){this.emit("destroy",this),this.removeAllListeners()}};let Tr=Xc;Tr.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};var jv=Object.defineProperty,jc=Object.getOwnPropertySymbols,Yv=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable,Yc=(t,e,r)=>e in t?jv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zc=(t,e)=>{for(var r in e||(e={}))Yv.call(e,r)&&Yc(t,r,e[r]);if(jc)for(var r of jc(e))Zv.call(e,r)&&Yc(t,r,e[r]);return t};const qc=class extends ge{constructor(t={}){var e,r,n,i,s,o;super(),this.options=t,this.uid=J("textureSource"),this.label="",this.resourceType="textureSource",this.resourceId=J("textureResource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this.depthStencil=!0,this.touched=0,this._batchTick=-1,this._textureBindLocation=-1,t=Zc(Zc({},qc.defaultOptions),t),(e=this.label)!=null||(this.label=t.label),this.resource=t.resource,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=(n=(r=t.resource)==null?void 0:r.width)!=null?n:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=(s=(i=t.resource)==null?void 0:i.height)!=null?s:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode;const a=(o=t.style)!=null?o:{};this.style=a instanceof Tr?a:new Tr(a),this.destroyed=!1}get source(){return this}get style(){return this._style}set style(t){var e,r;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(r=this._style)==null||r.on("change",this._onStyleChange,this),this._onStyleChange())}_onStyleChange(){this.emit("styleChange",this)}update(){this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this.resourceId++,this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,r){r=r||this._resolution,t=t||this.width,e=e||this.height;const n=Math.round(t*r),i=Math.round(e*r);this.width=n/r,this.height=i/r,this._resolution=r,!(this.pixelWidth===n&&this.pixelHeight===i)&&(this.pixelWidth=n,this.pixelHeight=i,this.emit("resize",this),this.resourceId++,this.emit("change",this))}set wrapMode(t){G($,"TextureSource.wrapMode property has been deprecated. Use TextureSource.style.addressMode instead."),this._style.wrapMode=t}get wrapMode(){return G($,"TextureSource.wrapMode property has been deprecated. Use TextureSource.style.addressMode instead."),this._style.wrapMode}set scaleMode(t){G($,"TextureSource.scaleMode property has been deprecated. Use TextureSource.style.scaleMode instead."),this._style.scaleMode=t}get scaleMode(){return G($,"TextureSource.scaleMode property has been deprecated. Use TextureSource.style.scaleMode instead."),this._style.scaleMode}static test(t){throw new Error("Unimplemented")}};let fe=qc;fe.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"no-premultiply-alpha",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,style:{}};const ft=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],pt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],gt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],mt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Rs=[],Kc=[],Fn=Math.sign;function qv(){for(let t=0;t<16;t++){const e=[];Rs.push(e);for(let r=0;r<16;r++){const n=Fn(ft[t]*ft[r]+gt[t]*pt[r]),i=Fn(pt[t]*ft[r]+mt[t]*pt[r]),s=Fn(ft[t]*gt[r]+gt[t]*mt[r]),o=Fn(pt[t]*gt[r]+mt[t]*mt[r]);for(let a=0;a<16;a++)if(ft[a]===n&&pt[a]===i&&gt[a]===s&&mt[a]===o){e.push(a);break}}}for(let t=0;t<16;t++){const e=new R;e.set(ft[t],pt[t],gt[t],mt[t],0,0),Kc.push(e)}}qv();const L={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>ft[t],uY:t=>pt[t],vX:t=>gt[t],vY:t=>mt[t],inv:t=>t&8?t&15:-t&7,add:(t,e)=>Rs[t][e],sub:(t,e)=>Rs[t][L.inv(e)],rotate180:t=>t^4,isVertical:t=>(t&3)===2,byDirection:(t,e)=>Math.abs(t)*2<=Math.abs(e)?e>=0?L.S:L.N:Math.abs(e)*2<=Math.abs(t)?t>0?L.E:L.W:e>0?t>0?L.SE:L.SW:t>0?L.NE:L.NW,matrixAppendRotationInv:(t,e,r=0,n=0)=>{const i=Kc[L.inv(e)];i.tx=r,i.ty=n,t.append(i)}};class Fs extends ge{constructor(e={}){var r;super(),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=e.frame||new te(0,0,1,1),this.orig=e.orig||this.frame,this.rotate=(r=e.rotate)!=null?r:0,this.trim=e.trim,this.defaultAnchor=e.defaultAnchor,this.defaultBorders=e.defaultBorders,this.updateUvs()}updateUvs(){const e=this.uvs,r=this.frame;let n=this.rotate;if(n){const i=r.width/2,s=r.height/2,o=r.x+i,a=r.y+s;n=L.add(n,L.NW),e.x0=o+i*L.uX(n),e.y0=a+s*L.uY(n),n=L.add(n,2),e.x1=o+i*L.uX(n),e.y1=a+s*L.uY(n),n=L.add(n,2),e.x2=o+i*L.uX(n),e.y2=a+s*L.uY(n),n=L.add(n,2),e.x3=o+i*L.uX(n),e.y3=a+s*L.uY(n)}else e.x0=r.x,e.y0=r.y,e.x1=r.x+r.width,e.y1=r.y,e.x2=r.x+r.width,e.y2=r.y+r.height,e.x3=r.x,e.y3=r.y+r.height}update(){this.updateUvs(),this.emit("update",this)}destroy(){this.emit("destroy",this),this.removeAllListeners(),this.frame=null,this.orig=null,this.trim=null,this.defaultAnchor=null,this.uvs=null}}const Jc=new R;class Gs{constructor(e,r){this.mapCoord=new R,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof r=="undefined"?.5:r,this.isSimple=!1,this.texture=e}get texture(){return this._texture}set texture(e){var r;this.texture!==e&&((r=this._texture)==null||r.removeListener("update",this.update,this),this._texture=e,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(e,r){r===void 0&&(r=e);const n=this.mapCoord;for(let i=0;i<e.length;i+=2){const s=e[i],o=e[i+1];r[i]=s*n.a+o*n.c+n.tx,r[i+1]=s*n.b+o*n.d+n.ty}return r}update(){const e=this._texture;this._updateID++;const r=e.layout.uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.layout.orig,i=e.layout.trim;i&&(Jc.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Jc));const s=e.source,o=this.uClampFrame,a=this.clampMargin/s._resolution,u=this.clampOffset;return o[0]=(e.frameX+a+u)/s.width,o[1]=(e.frameY+a+u)/s.height,o[2]=(e.frameX+e.frameWidth-a+u)/s.width,o[3]=(e.frameY+e.frameHeight-a+u)/s.height,this.uClampOffset[0]=u/s.pixelWidth,this.uClampOffset[1]=u/s.pixelHeight,this.isSimple=e.frameWidth===s.width&&e.frameHeight===s.height&&e.layout.rotate===0,!0}}class E extends ge{constructor({source:e,layout:r,label:n,frame:i}={}){var s;if(super(),this.id=J("texture"),this.styleSourceKey=0,this.label=n,this.source=(s=e==null?void 0:e.source)!=null?s:new fe,r=r instanceof Fs?r:new Fs(r),i){const{width:o,height:a}=this._source;r.frame.x=i.x/o,r.frame.y=i.y/a,r.frame.width=i.width/o,r.frame.height=i.height/a,r.updateUvs()}this.layout=r,this.destroyed=!1}static from(e,r=!1){return typeof e=="string"?re.get(e):e instanceof fe?new E({source:e}):$c(e,r)}set source(e){this._source&&this._source.off("resize",this.onUpdate,this),this._source=e,e.on("resize",this.onUpdate,this),this.emit("update",this)}get source(){return this._source}get layout(){return this._layout}set layout(e){var r;(r=this._layout)==null||r.off("update",this.onUpdate,this),this._layout=e,e.on("update",this.onUpdate,this),this.emit("update",this)}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Gs(this)),this._textureMatrix}set frameWidth(e){this._layout.frame.width=e/this._source.width}get frameWidth(){return this._source.pixelWidth/this._source._resolution*this._layout.frame.width}set frameHeight(e){this._layout.frame.height=e/this._source.height}get frameHeight(){return this._source.pixelHeight/this._source._resolution*this._layout.frame.height}set frameX(e){if(e===0){this._layout.frame.x=0;return}this._layout.frame.x=this._source.width/e}get frameX(){return this._source.width*this._layout.frame.x}set frameY(e){if(e===0){this._layout.frame.y=0;return}this._layout.frame.y=this._source.height/e}get frameY(){return this._source.height*this._layout.frame.y}get width(){return this._source.width*this._layout.orig.width}get height(){return this._source.height*this._layout.orig.height}destroy(e=!1){this._layout&&(this._layout.destroy(),this._layout=null),this._source&&e&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}onUpdate(){this.emit("update",this)}get baseTexture(){return G($,"Texture.baseTexture is now Texture.source"),this._source}}E.EMPTY=new E({}),E.EMPTY.label="EMPTY",E.EMPTY.destroy=Bs;const Qc={extension:v.CacheParser,test:t=>Array.isArray(t)&&t.every(e=>e instanceof E),getCacheableAssets:(t,e)=>{const r={};return t.forEach(n=>{e.forEach((i,s)=>{r[n+(s===0?"":s+1)]=i})}),r}};async function ks(t){if("Image"in globalThis)return new Promise(e=>{const r=new Image;r.onload=()=>{e(!0)},r.onerror=()=>{e(!1)},r.src=t});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(t)).blob();await createImageBitmap(e)}catch(e){return!1}return!0}return!1}const eh={extension:{type:v.DetectionParser,priority:1},test:async()=>ks("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async t=>[...t,"avif"],remove:async t=>t.filter(e=>e!=="avif")},th=["png","jpg","jpeg"],rh={extension:{type:v.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...th],remove:async t=>t.filter(e=>!th.includes(e))},Kv="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Gn(t){return Kv?!1:document.createElement("video").canPlayType(t)!==""}const nh={extension:{type:v.DetectionParser,priority:0},test:async()=>Gn("video/mp4"),add:async t=>[...t,"mp4","m4v"],remove:async t=>t.filter(e=>e!=="mp4"&&e!=="m4v")},ih={extension:{type:v.DetectionParser,priority:0},test:async()=>Gn("video/ogg"),add:async t=>[...t,"ogv"],remove:async t=>t.filter(e=>e!=="ogv")},sh={extension:{type:v.DetectionParser,priority:0},test:async()=>Gn("video/webm"),add:async t=>[...t,"webm"],remove:async t=>t.filter(e=>e!=="webm")},oh={extension:{type:v.DetectionParser,priority:0},test:async()=>ks("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async t=>[...t,"webp"],remove:async t=>t.filter(e=>e!=="webp")};var Ie=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Ie||{});const kn=(t,e)=>{const r=e.split("?")[1];return r&&(t+=`?${r}`),t};class Os extends ge{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return G($,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return G($,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return G($,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return G($,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return G($,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(){this.emit("destroy",this),this.removeAllListeners();for(const e in this.chars)this.chars[e].texture.destroy();this.chars=null}}class On extends Os{constructor(e){var r;super();const{textures:n,data:i}=e;Object.keys(i.pages).forEach(o=>{const a=i.pages[parseInt(o,10)],u=n[a.id];this.pages.push({texture:u})}),Object.keys(i.chars).forEach(o=>{var a;const u=i.chars[o],l=n[u.page].source,c=new te(u.x/l.width,u.y/l.height,u.width/l.width,u.height/l.height),d=new E({source:l,layout:{frame:c}});this.chars[o]={id:o.codePointAt(0),xOffset:u.xOffset,yOffset:u.yOffset,xAdvance:u.xAdvance,kerning:(a=u.kerning)!=null?a:{},texture:d}}),this.baseRenderedFontSize=i.fontSize;const s=this;s.baseMeasurementFontSize=i.fontSize,s.fontMetrics={ascent:0,descent:0,fontSize:i.fontSize},s.baseLineOffset=i.baseLineOffset,s.lineHeight=i.lineHeight,s.fontFamily=i.fontFamily,s.distanceField=(r=i.distanceField)!=null?r:{type:"none",range:0}}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:r}=this.pages[e];r.destroy(!0)}this.pages=null}}const Un={test(t){return typeof t=="string"&&t.startsWith("info face=")},parse(t){var e,r;const n=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const f in n){const g=n[f].match(/^[a-z]+/gm)[0],b=n[f].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const x in b){const y=b[x].split("="),_=y[0],A=y[1].replace(/"/gm,""),T=parseFloat(A),P=isNaN(T)?A:T;m[_]=P}i[g].push(m)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[o]=i.info,[a]=i.common,[u]=(e=i.distanceField)!=null?e:[];u&&(s.distanceField={range:parseInt(u.distanceRange,10),type:u.fieldType}),s.fontSize=parseInt(o.size,10),s.fontFamily=o.face,s.lineHeight=parseInt(a.lineHeight,10);const l=i.page;for(let f=0;f<l.length;f++)s.pages.push({id:parseInt(l[f].id,10)||0,file:l[f].file});const c={};s.baseLineOffset=s.lineHeight-parseInt(a.base,10);const d=i.char;for(let f=0;f<d.length;f++){const g=d[f],b=parseInt(g.id,10);let m=(r=g.letter)!=null?r:g.char;m==="space"&&(m=" "),c[b]=m,s.chars[m]={id:b,page:parseInt(g.page,10)||0,x:parseInt(g.x,10),y:parseInt(g.y,10),width:parseInt(g.width,10),height:parseInt(g.height,10),xOffset:parseInt(g.xoffset,10),yOffset:parseInt(g.yoffset,10),xAdvance:parseInt(g.xadvance,10),kerning:{}}}const p=i.kerning||[];for(let f=0;f<p.length;f++){const g=parseInt(p[f].first,10),b=parseInt(p[f].second,10),m=parseInt(p[f].amount,10);s.chars[c[b]].kerning[c[g]]=m}return s}},Us={test(t){const e=t;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(t){var e;const r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},n=t.getElementsByTagName("info")[0],i=t.getElementsByTagName("common")[0],s=t.getElementsByTagName("distanceField")[0];s&&(r.distanceField={type:s.getAttribute("fieldType"),range:parseInt(s.getAttribute("distanceRange"),10)});const o=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),u=t.getElementsByTagName("kerning");r.fontSize=parseInt(n.getAttribute("size"),10),r.fontFamily=n.getAttribute("face"),r.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let c=0;c<o.length;c++)r.pages.push({id:parseInt(o[c].getAttribute("id"),10)||0,file:o[c].getAttribute("file")});const l={};r.baseLineOffset=r.lineHeight-parseInt(i.getAttribute("base"),10);for(let c=0;c<a.length;c++){const d=a[c],p=parseInt(d.getAttribute("id"),10);let f=(e=d.getAttribute("letter"))!=null?e:d.getAttribute("char");f==="space"&&(f=" "),l[p]=f,r.chars[f]={id:p,page:parseInt(d.getAttribute("page"),10)||0,x:parseInt(d.getAttribute("x"),10),y:parseInt(d.getAttribute("y"),10),width:parseInt(d.getAttribute("width"),10),height:parseInt(d.getAttribute("height"),10),xOffset:parseInt(d.getAttribute("xoffset"),10),yOffset:parseInt(d.getAttribute("yoffset"),10),xAdvance:parseInt(d.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<u.length;c++){const d=parseInt(u[c].getAttribute("first"),10),p=parseInt(u[c].getAttribute("second"),10),f=parseInt(u[c].getAttribute("amount"),10);r.chars[l[p]].kerning[l[d]]=f}return r}},Ls={test(t){return typeof t=="string"&&t.includes("<font>")?Us.test(Z.get().parseXML(t)):!1},parse(t){return Us.parse(Z.get().parseXML(t))}},Jv=[".xml",".fnt"],ah={extension:v.CacheParser,test:t=>t instanceof On,getCacheableAssets(t,e){const r={};return t.forEach(n=>{r[n]=e}),r[e.fontFamily]=e,r}},uh={extension:{type:v.LoadParser,priority:Ie.Normal},test(t){return Jv.includes(ye.extname(t).toLowerCase())},async testParse(t){return Un.test(t)||Ls.test(t)},async parse(t,e,r){const n=Un.test(t)?Un.parse(t):Ls.parse(t),{src:i}=e,{pages:s}=n,o=[];for(let l=0;l<s.length;++l){const c=s[l].file;let d=ye.join(ye.dirname(i),c);d=kn(d,i),o.push(d)}const a=await r.load(o),u=o.map(l=>a[l]);return new On({data:n,textures:u})},async load(t,e){return await(await Z.get().fetch(t)).text()},unload(t){t.destroy()}};function bt(t,e){if(Array.isArray(e)){for(const r of e)if(t.startsWith(`data:${r}`))return!0;return!1}return t.startsWith(`data:${e}`)}function Ge(t,e){const r=t.split("?")[0],n=ye.extname(r).toLowerCase();return Array.isArray(e)?e.includes(n):n===e}const Qv=".json",e2="application/json",lh={extension:{type:v.LoadParser,priority:Ie.Low},name:"loadJson",test(t){return bt(t,e2)||Ge(t,Qv)},async load(t){return await(await Z.get().fetch(t)).json()}},t2=".txt",r2="text/plain",ch={name:"loadTxt",extension:{type:v.LoadParser,priority:Ie.Low},test(t){return bt(t,r2)||Ge(t,t2)},async load(t){return await(await Z.get().fetch(t)).text()}};var n2=Object.defineProperty,i2=Object.defineProperties,s2=Object.getOwnPropertyDescriptors,hh=Object.getOwnPropertySymbols,o2=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,dh=(t,e,r)=>e in t?n2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,u2=(t,e)=>{for(var r in e||(e={}))o2.call(e,r)&&dh(t,r,e[r]);if(hh)for(var r of hh(e))a2.call(e,r)&&dh(t,r,e[r]);return t},l2=(t,e)=>i2(t,s2(e));const c2=["normal","bold","100","200","300","400","500","600","700","800","900"],h2=[".ttf",".otf",".woff",".woff2"],d2=["font/ttf","font/otf","font/woff","font/woff2"],f2=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function fh(t){const e=ye.extname(t),r=ye.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let n=r.length>0;for(const s of r)if(!s.match(f2)){n=!1;break}let i=r.join(" ");return n||(i=`"${i.replace(/[\\"]/g,"\\$&")}"`),i}const p2=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function g2(t){return p2.test(t)?t:encodeURI(t)}const ph={extension:{type:v.LoadParser,priority:Ie.Low},name:"loadWebFont",test(t){return bt(t,d2)||Ge(t,h2)},async load(t,e){var r,n,i,s,o,a;const u=Z.get().getFontFaceSet();if(u){const l=[],c=(n=(r=e.data)==null?void 0:r.family)!=null?n:fh(t),d=(o=(s=(i=e.data)==null?void 0:i.weights)==null?void 0:s.filter(f=>c2.includes(f)))!=null?o:["normal"],p=(a=e.data)!=null?a:{};for(let f=0;f<d.length;f++){const g=d[f],b=new FontFace(c,`url(${g2(t)})`,l2(u2({},p),{weight:g}));await b.load(),u.add(b),l.push(b)}return re.set(c,{url:t,fontFaces:l}),l.length===1?l[0]:l}return null},unload(t){(Array.isArray(t)?t:[t]).forEach(e=>{re.remove(e.family),Z.get().getFontFaceSet().delete(e)})}};var m2=v2,Ns={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},b2=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function v2(t){var e=[];return t.replace(b2,function(r,n,i){var s=n.toLowerCase();for(i=_2(i),s=="m"&&i.length>2&&(e.push([n].concat(i.splice(0,2))),s="l",n=n=="m"?"l":"L");;){if(i.length==Ns[s])return i.unshift(n),e.push(i);if(i.length<Ns[s])throw new Error("malformed path data");e.push([n].concat(i.splice(0,Ns[s])))}}),e}var y2=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function _2(t){var e=t.match(y2);return e?e.map(Number):[]}function gh(t,e){const r=m2(t),n=[];let i=null,s=0,o=0;for(let a=0;a<r.length;a++){const u=r[a],l=u[0],c=u;switch(l){case"M":s=c[1],o=c[2],e.moveTo(s,o);break;case"m":s+=c[1],o+=c[2],e.moveTo(s,o);break;case"H":s=c[1],e.lineTo(s,o);break;case"h":s+=c[1],e.lineTo(s,o);break;case"V":o=c[1],e.lineTo(s,o);break;case"v":o+=c[1],e.lineTo(s,o);break;case"L":s=c[1],o=c[2],e.lineTo(s,o);break;case"l":s+=c[1],o+=c[2],e.lineTo(s,o);break;case"C":s=c[5],o=c[6],e.bezierCurveTo(c[1],c[2],c[3],c[4],s,o);break;case"c":e.bezierCurveTo(s+c[1],o+c[2],s+c[3],o+c[4],s+c[5],o+c[6]),s+=c[5],o+=c[6];break;case"S":s=c[3],o=c[4],e.bezierCurveToShort(c[1],c[2],s,o);break;case"s":e.bezierCurveToShort(s+c[1],o+c[2],s+c[3],o+c[4]),s+=c[3],o+=c[4];break;case"Q":s=c[3],o=c[4],e.quadraticCurveTo(c[1],c[2],s,o);break;case"q":e.quadraticCurveTo(s+c[1],o+c[2],s+c[3],o+c[4]),s+=c[3],o+=c[4];break;case"T":s=c[1],o=c[2],e.quadraticCurveToShort(s,o);break;case"t":s+=c[1],o+=c[2],e.quadraticCurveToShort(s,o);break;case"A":s=c[6],o=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],s,o);break;case"a":s+=c[6],o+=c[7],e.arcToSvg(c[1],c[2],c[3],c[4],c[5],s,o);break;case"Z":case"z":e.closePath(),n.length>0&&(i=n.pop(),i?(s=i.startX,o=i.startY):(s=0,o=0)),i=null;break;default:}l!=="Z"&&l!=="z"&&i===null&&(i={startX:s,startY:o},n.push(i))}return e}class Ln{constructor(e=0,r=0,n=0){this.type="circle",this.x=e,this.y=r,this.radius=n}clone(){return new Ln(this.x,this.y,this.radius)}contains(e,r){if(this.radius<=0)return!1;const n=this.radius*this.radius;let i=this.x-e,s=this.y-r;return i*=i,s*=s,i+s<=n}getBounds(e){return e=e||new te,e.x=this.x-this.radius,e.y=this.y-this.radius,e.width=this.radius*2,e.height=this.radius*2,e}copyFrom(e){return this.x=e.x,this.y=e.y,this.radius=e.radius,this}copyTo(e){return e.copyFrom(this),e}}class Nn{constructor(e=0,r=0,n=0,i=0){this.type="ellipse",this.x=e,this.y=r,this.halfWidth=n,this.halfHeight=i}clone(){return new Nn(this.x,this.y,this.halfWidth,this.halfHeight)}contains(e,r){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let n=(e-this.x)/this.halfWidth,i=(r-this.y)/this.halfHeight;return n*=n,i*=i,n+i<=1}getBounds(){return new te(this.x-this.halfWidth,this.y-this.halfHeight,this.halfWidth*2,this.halfHeight*2)}copyFrom(e){return this.x=e.x,this.y=e.y,this.halfWidth=e.halfWidth,this.halfHeight=e.halfHeight,this}copyTo(e){return e.copyFrom(this),e}}class vt{constructor(...e){this.type="polygon";let r=Array.isArray(e[0])?e[0]:e;if(typeof r[0]!="number"){const n=[];for(let i=0,s=r.length;i<s;i++)n.push(r[i].x,r[i].y);r=n}this.points=r,this.closePath=!0}clone(){const e=this.points.slice(),r=new vt(e);return r.closePath=this.closePath,r}contains(e,r){let n=!1;const i=this.points.length/2;for(let s=0,o=i-1;s<i;o=s++){const a=this.points[s*2],u=this.points[s*2+1],l=this.points[o*2],c=this.points[o*2+1];u>r!=c>r&&e<(l-a)*((r-u)/(c-u))+a&&(n=!n)}return n}getBounds(e){e=e||new te;const r=this.points;let n=1/0,i=-1/0,s=1/0,o=-1/0;for(let a=0,u=r.length;a<u;a+=2){const l=r[a],c=r[a+1];n=l<n?l:n,i=l>i?l:i,s=c<s?c:s,o=c>o?c:o}return e.x=n,e.width=i-n,e.y=s,e.height=o-s,e}copyFrom(e){return this.points=e.points.slice(),this.closePath=e.closePath,this}copyTo(e){return e.copyFrom(this),e}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return this.points[this.points.length-2]}get y(){return this.points[this.points.length-1]}}class $n{constructor(e=0,r=0,n=0,i=0,s=20){this.type="roundedRectangle",this.x=e,this.y=r,this.width=n,this.height=i,this.radius=s}getBounds(e){return e=e||new te,e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}clone(){return new $n(this.x,this.y,this.width,this.height,this.radius)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.copyFrom(this),e}contains(e,r){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&r>=this.y&&r<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(r>=this.y+n&&r<=this.y+this.height-n||e>=this.x+n&&e<=this.x+this.width-n)return!0;let i=e-(this.x+n),s=r-(this.y+n);const o=n*n;if(i*i+s*s<=o||(i=e-(this.x+this.width-n),i*i+s*s<=o)||(s=r-(this.y+this.height-n),i*i+s*s<=o)||(i=e-(this.x+n),i*i+s*s<=o))return!0}return!1}}const uT=8,Vn=11920929e-14,x2=1,$s=.01,zt=0,yt=0;function Vs(t,e,r,n,i,s,o,a,u){let l=x2/1;return l*=l,A2(e,r,n,i,s,o,a,u,t,l),t}function A2(t,e,r,n,i,s,o,a,u,l){zs(t,e,r,n,i,s,o,a,u,l,0),u.push(o,a)}function zs(t,e,r,n,i,s,o,a,u,l,c){if(c>8)return;const d=Math.PI,p=(t+r)/2,f=(e+n)/2,g=(r+i)/2,b=(n+s)/2,m=(i+o)/2,x=(s+a)/2,y=(p+g)/2,_=(f+b)/2,A=(g+m)/2,T=(b+x)/2,P=(y+A)/2,M=(_+T)/2;if(c>0){let S=o-t,C=a-e;const w=Math.abs((r-o)*C-(n-a)*S),F=Math.abs((i-o)*C-(s-a)*S);let N,D;if(w>Vn&&F>Vn){if((w+F)*(w+F)<=l*(S*S+C*C)){if(zt<$s){u.push(P,M);return}const I=Math.atan2(s-n,i-r);if(N=Math.abs(I-Math.atan2(n-e,r-t)),D=Math.abs(Math.atan2(a-s,o-i)-I),N>=d&&(N=2*d-N),D>=d&&(D=2*d-D),N+D<zt){u.push(P,M);return}if(yt!==0){if(N>yt){u.push(r,n);return}if(D>yt){u.push(i,s);return}}}}else if(w>Vn){if(w*w<=l*(S*S+C*C)){if(zt<$s){u.push(P,M);return}if(N=Math.abs(Math.atan2(s-n,i-r)-Math.atan2(n-e,r-t)),N>=d&&(N=2*d-N),N<zt){u.push(r,n),u.push(i,s);return}if(yt!==0&&N>yt){u.push(r,n);return}}}else if(F>Vn){if(F*F<=l*(S*S+C*C)){if(zt<$s){u.push(P,M);return}if(N=Math.abs(Math.atan2(a-s,o-i)-Math.atan2(s-n,i-r)),N>=d&&(N=2*d-N),N<zt){u.push(r,n),u.push(i,s);return}if(yt!==0&&N>yt){u.push(i,s);return}}}else if(S=P-(t+o)/2,C=M-(e+a)/2,S*S+C*C<=l){u.push(P,M);return}}zs(t,e,p,f,y,_,P,M,u,l,c+1),zs(P,M,A,T,m,x,o,a,u,l,c+1)}const lT=8,C2=11920929e-14,w2=1,T2=.01,mh=0;function bh(t,e,r,n,i,s,o){let a=w2/1;return a*=a,S2(e,r,n,i,s,o,t,a),t}function S2(t,e,r,n,i,s,o,a){Hs(o,t,e,r,n,i,s,a,0),o.push(i,s)}function Hs(t,e,r,n,i,s,o,a,u){if(u>8)return;const l=Math.PI,c=(e+n)/2,d=(r+i)/2,p=(n+s)/2,f=(i+o)/2,g=(c+p)/2,b=(d+f)/2;let m=s-e,x=o-r;const y=Math.abs((n-s)*x-(i-o)*m);if(y>C2){if(y*y<=a*(m*m+x*x)){if(mh<T2){t.push(g,b);return}let _=Math.abs(Math.atan2(o-i,s-n)-Math.atan2(i-r,n-e));if(_>=l&&(_=2*l-_),_<mh){t.push(g,b);return}}}else if(m=g-(e+s)/2,x=b-(r+o)/2,m*m+x*x<=a){t.push(g,b);return}Hs(t,e,r,c,d,g,b,a,u+1),Hs(t,g,b,p,f,s,o,a,u+1)}function Ws(t,e,r,n,i,s,o,a){let u=Math.abs(i-s);(!o&&i>s||o&&s>i)&&(u=2*Math.PI-u),a=a||Math.max(6,Math.floor(6*Math.pow(n,.3333333333333333)*(u/Math.PI))),a=Math.max(a,3);let l=u/a,c=i;l*=o?-1:1;for(let d=0;d<a+1;d++){const p=Math.cos(c),f=Math.sin(c),g=e+p*n,b=r+f*n;t.push(g,b),c+=l}}function vh(t,e,r,n,i,s){const o=t[t.length-2],a=t[t.length-1]-r,u=o-e,l=i-r,c=n-e,d=Math.abs(a*c-u*l);if(d<1e-8||s===0){(t[t.length-2]!==e||t[t.length-1]!==r)&&t.push(e,r);return}const p=a*a+u*u,f=l*l+c*c,g=a*l+u*c,b=s*Math.sqrt(p)/d,m=s*Math.sqrt(f)/d,x=b*g/p,y=m*g/f,_=b*c+m*u,A=b*l+m*a,T=u*(m+x),P=a*(m+x),M=c*(b+y),S=l*(b+y),C=Math.atan2(P-A,T-_),w=Math.atan2(S-A,M-_);Ws(t,_+e,A+r,s,C,w,u*l>c*a)}const Sr=Math.PI*2,Xs={centerX:0,centerY:0,ang1:0,ang2:0},js=({x:t,y:e},r,n,i,s,o,a,u)=>{t*=r,e*=n;const l=i*t-s*e,c=s*t+i*e;return u.x=l+o,u.y=c+a,u};function E2(t,e){const r=e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),n=e===1.5707963267948966?.551915024494:r,i=Math.cos(t),s=Math.sin(t),o=Math.cos(t+e),a=Math.sin(t+e);return[{x:i-s*n,y:s+i*n},{x:o+a*n,y:a-o*n},{x:o,y:a}]}const yh=(t,e,r,n)=>{const i=t*n-e*r<0?-1:1;let s=t*r+e*n;return s>1&&(s=1),s<-1&&(s=-1),i*Math.acos(s)},I2=(t,e,r,n,i,s,o,a,u,l,c,d,p)=>{const f=Math.pow(i,2),g=Math.pow(s,2),b=Math.pow(c,2),m=Math.pow(d,2);let x=f*g-f*m-g*b;x<0&&(x=0),x/=f*m+g*b,x=Math.sqrt(x)*(o===a?-1:1);const y=x*i/s*d,_=x*-s/i*c,A=l*y-u*_+(t+r)/2,T=u*y+l*_+(e+n)/2,P=(c-y)/i,M=(d-_)/s,S=(-c-y)/i,C=(-d-_)/s,w=yh(1,0,P,M);let F=yh(P,M,S,C);a===0&&F>0&&(F-=Sr),a===1&&F<0&&(F+=Sr),p.centerX=A,p.centerY=T,p.ang1=w,p.ang2=F};function _h(t,e,r,n,i,s,o,a=0,u=0,l=0){if(s===0||o===0)return;const c=Math.sin(a*Sr/360),d=Math.cos(a*Sr/360),p=d*(e-n)/2+c*(r-i)/2,f=-c*(e-n)/2+d*(r-i)/2;if(p===0&&f===0)return;s=Math.abs(s),o=Math.abs(o);const g=Math.pow(p,2)/Math.pow(s,2)+Math.pow(f,2)/Math.pow(o,2);g>1&&(s*=Math.sqrt(g),o*=Math.sqrt(g)),I2(e,r,n,i,s,o,u,l,c,d,p,f,Xs);let{ang1:b,ang2:m}=Xs;const{centerX:x,centerY:y}=Xs;let _=Math.abs(m)/(Sr/4);Math.abs(1-_)<1e-7&&(_=1);const A=Math.max(Math.ceil(_),1);m/=A;let T=t[t.length-2],P=t[t.length-1];const M={x:0,y:0};for(let S=0;S<A;S++){const C=E2(b,m),{x:w,y:F}=js(C[0],s,o,d,c,x,y,M),{x:N,y:D}=js(C[1],s,o,d,c,x,y,M),{x:I,y:q}=js(C[2],s,o,d,c,x,y,M);Vs(t,T,P,w,F,N,D,I,q),T=I,P=q,b+=m}}const P2=new te;class xh{constructor(e){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new be,this._graphicsPath2D=e}moveTo(e,r){return this.startPoly(e,r),this}lineTo(e,r){this._ensurePoly();const n=this._currentPoly.points,i=n[n.length-2],s=n[n.length-1];return(i!==e||s!==r)&&n.push(e,r),this}arc(e,r,n,i,s,o){this._ensurePoly(!1);const a=this._currentPoly.points;return Ws(a,e,r,n,i,s,o),this}arcTo(e,r,n,i,s){this._ensurePoly();const o=this._currentPoly.points;return vh(o,e,r,n,i,s),this}arcToSvg(e,r,n,i,s,o,a){const u=this._currentPoly.points;return _h(u,this._currentPoly.lastX,this._currentPoly.lastY,o,a,e,r,n,i,s),this}bezierCurveTo(e,r,n,i,s,o){this._ensurePoly();const a=this._currentPoly;return Vs(this._currentPoly.points,a.lastX,a.lastY,e,r,n,i,s,o),this}quadraticCurveTo(e,r,n,i){this._ensurePoly();const s=this._currentPoly;return bh(this._currentPoly.points,s.lastX,s.lastY,e,r,n,i),this}closePath(){return this.endPoly(!0),this}addPath(e,r){this.endPoly(),r&&!r.isIdentity()&&(e=e.clone(!0),e.transform(r));for(let n=0;n<e.instructions.length;n++){const i=e.instructions[n];this[i.action](...i.data)}return this}finish(e=!1){this.endPoly(e)}rect(e,r,n,i,s){return this.drawShape(new te(e,r,n,i),s),this}circle(e,r,n,i){return this.drawShape(new Ln(e,r,n),i),this}poly(e,r,n){const i=new vt(e);i.closePath=r,this.drawShape(i,n)}ellipse(e,r,n,i,s){return this.drawShape(new Nn(e,r,n,i),s),this}roundRect(e,r,n,i,s,o){return this.drawShape(new $n(e,r,n,i,s),o),this}drawShape(e,r){return this.endPoly(),this.shapePrimitives.push({shape:e,transform:r}),this}startPoly(e,r){let n=this._currentPoly;return n&&this.endPoly(),n=new vt,n.points.push(e,r),this._currentPoly=n,this}endPoly(e=!1){const r=this._currentPoly;return r&&r.points.length>2&&(r.closePath=e,this.shapePrimitives.push({shape:r})),this._currentPoly=null,this}_ensurePoly(e=!0){if(!this._currentPoly&&(this._currentPoly=new vt,e)){const r=this.shapePrimitives[this.shapePrimitives.length-1];if(r){let n=r.shape.x,i=r.shape.y;if(r.transform.isIdentity()){const s=r.transform,o=n;n=s.a*n+s.c*i+s.tx,i=s.b*o+s.d*i+s.ty}this._currentPoly.points.push(n,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const e=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let r=0;r<e.instructions.length;r++){const n=e.instructions[r];this[n.action](...n.data)}this.finish()}get bounds(){const e=this._bounds;e.clear();const r=this.shapePrimitives;for(let n=0;n<r.length;n++){const i=r[n],s=i.shape.getBounds(P2);i.transform?(e.pushMatrix(i.transform),e.addRect(s),e.popMatrix()):e.addRect(s)}return e}}class _t{constructor(e){this.instructions=[],this.uid=J("graphicsPath"),this._dirty=!0;var r;typeof e=="string"?gh(e,this):this.instructions=(r=e==null?void 0:e.slice())!=null?r:[]}get shapePath(){return this._shapePath||(this._shapePath=new xh(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(e,r){return e=e.clone(),this.instructions.push({action:"addPath",data:[e,r]}),this._dirty=!0,this}arc(...e){return this.instructions.push({action:"arc",data:e}),this._dirty=!0,this}arcTo(...e){return this.instructions.push({action:"arcTo",data:e}),this._dirty=!0,this}arcToSvg(...e){return this.instructions.push({action:"arcToSvg",data:e}),this._dirty=!0,this}bezierCurveTo(...e){return this.instructions.push({action:"bezierCurveTo",data:e}),this._dirty=!0,this}bezierCurveToShort(e,r,n,i){const s=this.instructions[this.instructions.length-1],o=this._getLastPoint(Y.shared);let a=0,u=0;if(!s||s.action!=="bezierCurveTo")a=o.x,u=o.y;else{a=s.data[2],u=s.data[3];const l=o.x,c=o.y;a=l+(l-a),u=c+(c-u)}return this.instructions.push({action:"bezierCurveTo",data:[a,u,e,r,n,i]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...e){return this.instructions.push({action:"ellipse",data:e}),this._dirty=!0,this}lineTo(...e){return this.instructions.push({action:"lineTo",data:e}),this._dirty=!0,this}moveTo(...e){return this.instructions.push({action:"moveTo",data:e}),this}quadraticCurveTo(...e){return this.instructions.push({action:"quadraticCurveTo",data:e}),this._dirty=!0,this}quadraticCurveToShort(e,r){const n=this.instructions[this.instructions.length-1],i=this._getLastPoint(Y.shared);let s=0,o=0;if(!n||n.action!=="quadraticCurveTo")s=i.x,o=i.y;else{s=n.data[0],o=n.data[1];const a=i.x,u=i.y;s=a+(a-s),o=u+(u-o)}return this.instructions.push({action:"quadraticCurveTo",data:[s,o,e,r]}),this._dirty=!0,this}rect(e,r,n,i,s){return this.instructions.push({action:"rect",data:[e,r,n,i,s]}),this._dirty=!0,this}circle(e,r,n,i){return this.instructions.push({action:"circle",data:[e,r,n,i]}),this._dirty=!0,this}roundRect(...e){return this.instructions.push({action:"roundRect",data:e}),this._dirty=!0,this}poly(...e){return this.instructions.push({action:"poly",data:e}),this._dirty=!0,this}star(e,r,n,i,s,o=0,a){s=s||i/2;const u=-1*Math.PI/2+o,l=n*2,c=Math.PI*2/l,d=[];for(let p=0;p<l;p++){const f=p%2?s:i,g=p*c+u;d.push(e+f*Math.cos(g),r+f*Math.sin(g))}return this.poly(d,!0,a),this}clone(e=!1){const r=new _t;if(!e)r.instructions=this.instructions.slice();else for(let n=0;n<this.instructions.length;n++){const i=this.instructions[n];r.instructions.push({action:i.action,data:i.data.slice()})}return r}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(e){if(e.isIdentity())return this;const r=e.a,n=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty;let u=0,l=0,c=0,d=0,p=0,f=0,g=0,b=0;for(let m=0;m<this.instructions.length;m++){const x=this.instructions[m],y=x.data;switch(x.action){case"moveTo":case"lineTo":u=y[0],l=y[1],y[0]=r*u+i*l+o,y[1]=n*u+s*l+a;break;case"bezierCurveTo":c=y[0],d=y[1],p=y[2],f=y[3],u=y[4],l=y[5],y[0]=r*c+i*d+o,y[1]=n*c+s*d+a,y[2]=r*p+i*f+o,y[3]=n*p+s*f+a,y[4]=r*u+i*l+o,y[5]=n*u+s*l+a;break;case"quadraticCurveTo":c=y[0],d=y[1],u=y[2],l=y[3],y[0]=r*c+i*d+o,y[1]=n*c+s*d+a,y[2]=r*u+i*l+o,y[3]=n*u+s*l+a;break;case"arcToSvg":u=y[5],l=y[6],g=y[0],b=y[1],y[0]=r*g+i*b,y[1]=n*g+s*b,y[5]=r*u+i*l+o,y[6]=n*u+s*l+a;break;case"rect":y[4]=Ys(y[4],e);break;case"ellipse":y[8]=Ys(y[8],e);break;case"roundRect":y[5]=Ys(y[5],e);break;case"addPath":y[0].transform(e);break;default:break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}_getLastPoint(e){let r=this.instructions.length-1,n=this.instructions[r];if(!n)return e.x=0,e.y=0,e;for(;n.action==="closePath";){if(r--,r<0)return e.x=0,e.y=0,e;n=this.instructions[r]}let i,s,o;switch(n.action){case"moveTo":case"lineTo":e.x=n.data[0],e.y=n.data[1];break;case"quadraticCurveTo":e.x=n.data[2],e.y=n.data[3];break;case"bezierCurveTo":e.x=n.data[4],e.y=n.data[5];break;case"arc":case"arcToSvg":e.x=n.data[5],e.y=n.data[6];break;case"addPath":e.x=n.data[0].lastX,e.y=n.data[2].lastY;break;case"rect":if(o=n.data[4],i=n.data[0],s=n.data[1],o){const{a,b:u,c:l,d:c,tx:d,ty:p}=o;e.x=a*i+l*s+d,e.y=u*i+c*s+p}else e.x=i,e.y=s;break;default:break}return e}}function Ys(t,e){return t?t.prepend(e):e.clone()}var B2=Object.defineProperty,Ah=Object.getOwnPropertySymbols,M2=Object.prototype.hasOwnProperty,D2=Object.prototype.propertyIsEnumerable,Ch=(t,e,r)=>e in t?B2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,zn=(t,e)=>{for(var r in e||(e={}))M2.call(e,r)&&Ch(t,r,e[r]);if(Ah)for(var r of Ah(e))D2.call(e,r)&&Ch(t,r,e[r]);return t};function wh(t,e){if(typeof t=="string"){const n=document.createElement("div");n.innerHTML=t.trim(),t=n.querySelector("svg")}const r={context:e,path:new _t};return Th(t,r,null,null),e}function Th(t,e,r,n){const i=t.children,{fillStyle:s,strokeStyle:o}=R2(t);s&&r?r=zn(zn({},r),s):s&&(r=s),o&&n?n=zn(zn({},n),o):o&&(n=o),e.context.fillStyle=r,e.context.strokeStyle=n;let a,u,l,c,d,p,f,g,b,m,x,y,_,A,T,P,M;switch(t.nodeName.toLowerCase()){case"path":A=t.getAttribute("d"),T=new _t(A),e.context.path(T),r&&e.context.fill(),n&&e.context.stroke();break;case"circle":f=he(t,"cx",0),g=he(t,"cy",0),b=he(t,"r",0),e.context.ellipse(f,g,b,b),r&&e.context.fill(),n&&e.context.stroke();break;case"rect":a=he(t,"x",0),u=he(t,"y",0),P=he(t,"width",0),M=he(t,"height",0),m=he(t,"rx",0),x=he(t,"ry",0),m||x?e.context.roundRect(a,u,P,M,m||x):e.context.rect(a,u,P,M),r&&e.context.fill(),n&&e.context.stroke();break;case"ellipse":f=he(t,"cx",0),g=he(t,"cy",0),m=he(t,"rx",0),x=he(t,"ry",0),e.context.beginPath(),e.context.ellipse(f,g,m,x),r&&e.context.fill(),n&&e.context.stroke();break;case"line":l=he(t,"x1",0),c=he(t,"y1",0),d=he(t,"x2",0),p=he(t,"y2",0),e.context.beginPath(),e.context.moveTo(l,c),e.context.lineTo(d,p),n&&e.context.stroke();break;case"polygon":_=t.getAttribute("points"),y=_.match(/\d+/g).map(S=>parseInt(S,10)),e.context.poly(y,!0),r&&e.context.fill(),n&&e.context.stroke();break;case"polyline":_=t.getAttribute("points"),y=_.match(/\d+/g).map(S=>parseInt(S,10)),e.context.poly(y,!1),n&&e.context.stroke();break;case"g":case"svg":break;default:{console.info(`[SVG parser] <${t.nodeName}> elements unsupported`);break}}for(let S=0;S<i.length;S++)Th(i[S],e,r,n)}function he(t,e,r){const n=t.getAttribute(e);return n?Number(n):r}function R2(t){const e=t.getAttribute("style"),r={},n={};let i=!1,s=!1;if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const u=o[a],[l,c]=u.split(":");switch(l){case"stroke":c!=="none"&&(r.color=X.shared.setValue(c).toNumber(),s=!0);break;case"stroke-width":r.width=Number(c);break;case"fill":c!=="none"&&(i=!0,n.color=X.shared.setValue(c).toNumber());break;case"fill-opacity":n.alpha=Number(c);break;case"stroke-opacity":r.alpha=Number(c);break;case"opacity":n.alpha=Number(c),r.alpha=Number(c);break}}}else{const o=t.getAttribute("stroke");o&&o!=="none"&&(s=!0,r.color=X.shared.setValue(o).toNumber(),r.width=he(t,"stroke-width",1));const a=t.getAttribute("fill");a&&a!=="none"&&(i=!0,n.color=X.shared.setValue(a).toNumber())}return{strokeStyle:s?r:null,fillStyle:i?n:null}}class xt extends fe{constructor(){super(...arguments),this.uploadMethodId="image"}static test(e){return typeof HTMLImageElement!="undefined"&&e instanceof HTMLImageElement||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}}xt.extension=v.TextureSource;const Hn=Z.get().createCanvas(),At=1;Hn.width=At,Hn.height=At;const qe=Hn.getContext("2d");qe.fillStyle="#ffffff",qe.fillRect(0,0,At,At),qe.beginPath(),qe.moveTo(0,0),qe.lineTo(At,0),qe.lineTo(At,At),qe.closePath(),qe.fillStyle="#ffffff",qe.fill(),E.WHITE=new E({source:new xt({resource:Hn})}),E.WHITE.label="WHITE",E.WHITE.destroy=Bs;const Zs=class{constructor(t,e,r,n){this.uid=J("fillGradient"),this.type="linear",this.gradientStops=[],this.x0=t,this.y0=e,this.x1=r,this.y1=n}addColorStop(t,e){return this.gradientStops.push({offset:t,color:X.shared.setValue(e).toHex()}),this}buildLinearGradient(){const t=Zs.defaultTextureSize,{gradientStops:e}=this,r=Z.get().createCanvas();r.width=t,r.height=t;const n=r.getContext("2d"),i=n.createLinearGradient(0,0,Zs.defaultTextureSize,1);for(let g=0;g<e.length;g++){const b=e[g];i.addColorStop(b.offset,b.color)}n.fillStyle=i,n.fillRect(0,0,t,t),this.texture=new E({source:new xt({resource:r,style:{addressModeU:"clamp-to-edge",addressModeV:"repeat"}})});const{x0:s,y0:o,x1:a,y1:u}=this,l=new R,c=a-s,d=u-o,p=Math.sqrt(c*c+d*d),f=Math.atan2(d,c);l.translate(-s,-o),l.scale(1/t,1/t),l.rotate(-f),l.scale(256/p,1),this.transform=l}};let Er=Zs;Er.defaultTextureSize=256;const Sh={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class qs{constructor(e,r){this.uid=J("fillPattern"),this.transform=new R,this.texture=e,this.transform.scale(1/e.frameWidth,1/e.frameHeight),r&&(e.source.style.addressModeU=Sh[r].addressModeU,e.source.style.addressModeV=Sh[r].addressModeV)}setTransform(e){const r=this.texture;this.transform.copyFrom(e),this.transform.invert(),this.transform.scale(1/r.frameWidth,1/r.frameHeight)}}var F2=Object.defineProperty,G2=Object.defineProperties,k2=Object.getOwnPropertyDescriptors,Eh=Object.getOwnPropertySymbols,O2=Object.prototype.hasOwnProperty,U2=Object.prototype.propertyIsEnumerable,Ih=(t,e,r)=>e in t?F2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ct=(t,e)=>{for(var r in e||(e={}))O2.call(e,r)&&Ih(t,r,e[r]);if(Eh)for(var r of Eh(e))U2.call(e,r)&&Ih(t,r,e[r]);return t},Ks=(t,e)=>G2(t,k2(e));function wt(t,e){var r;if(!t)return null;let n,i;if(t!=null&&t.fill?(i=t.fill,n=Ct(Ct({},e),t)):(i=t,n=e),X.isColorLike(i)){const o=X.shared.setValue(i!=null?i:0);return Ks(Ct({},n),{color:o.toNumber(),alpha:o.alpha===1?n.alpha:o.alpha,texture:E.WHITE})}else if(i instanceof qs){const o=i;return Ks(Ct({},n),{color:16777215,texture:o.texture,matrix:o.transform,fill:(r=n.fill)!=null?r:null})}else if(i instanceof Er){const o=i;return o.buildLinearGradient(),Ks(Ct({},n),{color:16777215,texture:o.texture,matrix:o.transform})}const s=Ct(Ct({},e),t);if(s.texture!==E.WHITE){const o=s.matrix||new R;o.scale(1/s.texture.frameWidth,1/s.texture.frameHeight),s.matrix=o,s.color=16777215}return s.color=X.shared.setValue(s.color).toNumber(),s}var L2=Object.defineProperty,Ph=Object.getOwnPropertySymbols,N2=Object.prototype.hasOwnProperty,$2=Object.prototype.propertyIsEnumerable,Bh=(t,e,r)=>e in t?L2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wn=(t,e)=>{for(var r in e||(e={}))N2.call(e,r)&&Bh(t,r,e[r]);if(Ph)for(var r of Ph(e))$2.call(e,r)&&Bh(t,r,e[r]);return t};const Ht=new Y,Mh=new R,Tt=class extends ge{constructor(){super(...arguments),this.uid=J("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new _t,this._transform=new R,this._fillStyle=Wn({},Tt.defaultFillStyle),this._strokeStyle=Wn({},Tt.defaultStrokeStyle),this._stateStack=[],this._tick=0,this._bounds=new be,this._boundsDirty=!0}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=wt(t,Tt.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=wt(t,Tt.defaultStrokeStyle)}texture(t,e,r,n,i,s){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:n||0,dw:i||t.frameWidth,dh:s||t.frameHeight,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?X.shared.setValue(e).toNumber():0}}),this.onUpdate(),this}beginPath(){return this._activePath=new _t,this}fill(t,e){let r;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?r=n.data.path:r=this._activePath.clone(),r?(t&&(e!==void 0&&typeof t=="number"&&(G("8.0.0","GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=wt(t,Tt.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._activePath.instructions.length=0,this._tick=0,this):this}stroke(t){let e;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r&&r.action==="fill"?e=r.data.path:e=this._activePath.clone(),e?(t&&(this._strokeStyle=wt(t,Tt.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._activePath.instructions.length=0,this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();e&&(e.action==="stroke"||e.action==="fill")&&(e.data.hole=r)}return this._activePath.instructions.length=0,this}arc(t,e,r,n,i,s){this._tick++;const o=this._transform;return this._activePath.arc(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,r,n,i,s),this}arcTo(t,e,r,n,i){this._tick++;const s=this._transform;return this._activePath.arcTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty,s.a*r+s.c*n+s.tx,s.b*r+s.d*n+s.ty,i),this}arcToSvg(t,e,r,n,i,s,o){this._tick++;const a=this._transform;return this._activePath.arcToSvg(t,e,r,n,i,a.a*s+a.c*o+a.tx,a.b*s+a.d*o+a.ty),this}bezierCurveTo(t,e,r,n,i,s){this._tick++;const o=this._transform;return this._activePath.bezierCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*r+o.c*n+o.tx,o.b*r+o.d*n+o.ty,o.a*i+o.c*s+o.tx,o.b*i+o.d*s+o.ty),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,r,n){return this._tick++,this._activePath.ellipse(t,e,r,n,this._transform.clone()),this}circle(t,e,r){return this._tick++,this._activePath.circle(t,e,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}moveTo(t,e){this._tick++;const r=this._transform;return this._activePath.moveTo(r.a*t+r.c*e+r.tx,r.b*t+r.d*e+r.ty),this}quadraticCurveTo(t,e,r,n){this._tick++;const i=this._transform;this._activePath.quadraticCurveTo(i.a*t+i.c*e+i.tx,i.b*t+i.d*e+i.ty,i.a*r+i.c*n+i.tx,i.b*r+i.d*n+i.ty)}rect(t,e,r,n){return this._tick++,this._activePath.rect(t,e,r,n,this._transform.clone()),this}roundRect(t,e,r,n,i){return this._tick++,this._activePath.roundRect(t,e,r,n,i,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}star(t,e,r,n,i,s){return this._tick++,this._activePath.star(t,e,r,n,i,s,this._transform.clone()),this}svg(t){this._tick++,wh(t,this)}restore(){const t=this._stateStack.pop();t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle)}save(){this._stateStack.push({transform:this._transform.clone(),fillStyle:Wn({},this._fillStyle),strokeStyle:Wn({},this._strokeStyle)})}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,r,n,i,s){return t instanceof R?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,r,n,i,s),this)}transform(t,e,r,n,i,s){return t instanceof R?(this._transform.append(t),this):(Mh.set(t,e,r,n,i,s),this._transform.append(Mh),this)}translate(t,e){return this._transform.translate(t,e),this}clear(){return this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const r=this.instructions[e],n=r.action;if(n==="fill"){const i=r.data;t.addBounds(i.path.bounds)}else if(n==="texture"){const i=r.data;t.pushMatrix(i.transform),t.addFrame(i.dx,i.dy,i.dx+i.dw,i.dy+i.dh),t.popMatrix()}}return t}containsPoint(t){const e=this.instructions;let r=!1;return e.forEach(n=>{var i;const s=n.data,o=s.path;if(!n.action||!o)return;const a=s.style,u=(i=o.shapePath)==null?void 0:i.shapePrimitives;this._forEachShape(u,l=>{var c;if(!a||!l)return;typeof a!="number"&&a.matrix?a.matrix.applyInverse(t,Ht):Ht.copyFrom(t),r=l.contains(Ht.x,Ht.y);const d=s.hole;if(!d)return;const p=(c=d.shapePath)==null?void 0:c.shapePrimitives;p&&this._forEachShape(p,f=>{f.contains(Ht.x,Ht.y)&&(r=!1)})})}),r}_forEachShape(t,e){t==null||t.forEach(r=>{const n=r==null?void 0:r.shape;n&&e(n)})}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(e),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(e)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};let it=Tt;it.defaultFillStyle={color:0,alpha:1,texture:E.WHITE,matrix:null,fill:null},it.defaultStrokeStyle={width:1,color:0,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:E.WHITE,matrix:null,fill:null};const V2=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,z2=".svg",H2="image/svg+xml",Dh={extension:{type:v.LoadParser,priority:Ie.Low},name:"loadSVG",test(t){return bt(t,H2)||Ge(t,z2)},async testParse(t){return typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&V2.test(t)},async parse(t){const e=new it;return e.svg(t),e},async load(t){return(await Z.get().fetch(t)).text()},unload(t){t.destroy(!0)}};function Js(t,e=1){var r;const n=(r=dt.RETINA_PREFIX)==null?void 0:r.exec(t);return n?parseFloat(n[1]):e}let Rh=0,Qs;const W2="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",X2={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${W2}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},j2={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let eo;class Y2{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const r=URL.createObjectURL(new Blob([X2.code],{type:"application/javascript"})),n=new Worker(r);n.addEventListener("message",i=>{n.terminate(),URL.revokeObjectURL(r),e(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Qs===void 0&&(Qs=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<Qs&&(eo||(eo=URL.createObjectURL(new Blob([j2.code],{type:"application/javascript"}))),this._createdWorkers++,e=new Worker(eo),e.addEventListener("message",r=>{this._complete(r.data),this._returnWorker(r.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),this._resolveHash[e.uuid]=null}async _run(e,r){await this._initWorkers();const n=new Promise((i,s)=>{this._queue.push({id:e,arguments:r,resolve:i,reject:s})});return this._next(),n}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const r=this._queue.pop(),n=r.id;this._resolveHash[Rh]={resolve:r.resolve,reject:r.reject},e.postMessage({data:r.arguments,uuid:Rh++,id:n})}}const to=new Y2;function Wt(t,e,r){t.label=r;const n=new E({source:t,label:r}),i=()=>{delete e.promiseCache[r],re.has(r)&&re.remove(r)};return n.once("destroy",()=>{r in e.promiseCache&&i()}),n.source.once("destroy",()=>{t.destroyed||i()}),n}var Z2=Object.defineProperty,Fh=Object.getOwnPropertySymbols,q2=Object.prototype.hasOwnProperty,K2=Object.prototype.propertyIsEnumerable,Gh=(t,e,r)=>e in t?Z2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,J2=(t,e)=>{for(var r in e||(e={}))q2.call(e,r)&&Gh(t,r,e[r]);if(Fh)for(var r of Fh(e))K2.call(e,r)&&Gh(t,r,e[r]);return t};const Q2=[".jpeg",".jpg",".png",".webp",".avif"],ey=["image/jpeg","image/png","image/webp","image/avif"];async function kh(t){const e=await Z.get().fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const r=await e.blob();return await createImageBitmap(r)}const ro={name:"loadTextures",extension:{type:v.LoadParser,priority:Ie.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(t){return bt(t,ey)||Ge(t,Q2)},async load(t,e,r){var n;let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await to.isImageBitmapSupported()?i=await to.loadImageBitmap(t):i=await kh(t):i=await new Promise(o=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=t,i.complete?o(i):i.onload=()=>{o(i)}});const s=new xt(J2({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:((n=e.data)==null?void 0:n.resolution)||Js(t)},e.data));return Wt(s,r,t)},unload(t){t.destroy(!0)}};let no;async function io(){return no!=null||(no=(async()=>{var t;const e=document.createElement("canvas").getContext("webgl");if(!e)return"premultiply-alpha-on-upload";const r=await new Promise(o=>{const a=document.createElement("video");a.onloadeddata=()=>o(a),a.onerror=()=>o(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!r)return"premultiply-alpha-on-upload";const n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r);const s=new Uint8Array(4);return e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,s),e.deleteFramebuffer(i),e.deleteTexture(n),(t=e.getExtension("WEBGL_lose_context"))==null||t.loseContext(),s[0]<=s[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),no}var ty=Object.defineProperty,ry=Object.defineProperties,ny=Object.getOwnPropertyDescriptors,Oh=Object.getOwnPropertySymbols,iy=Object.prototype.hasOwnProperty,sy=Object.prototype.propertyIsEnumerable,Uh=(t,e,r)=>e in t?ty(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,so=(t,e)=>{for(var r in e||(e={}))iy.call(e,r)&&Uh(t,r,e[r]);if(Oh)for(var r of Oh(e))sy.call(e,r)&&Uh(t,r,e[r]);return t},oy=(t,e)=>ry(t,ny(e));const Lh=class extends fe{constructor(t){var e;super(t),this.isReady=!1,this.uploadMethodId="video",t=so(so({},Lh.defaultOptions),t),this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=(e=t.alphaMode)!=null?e:"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=ve.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(this.options.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this.alphaMode=await io(),this._load=new Promise((e,r)=>{this.isValid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.resource;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(ve.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(ve.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(ve.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||globalThis.VideoFrame&&t instanceof VideoFrame}};let st=Lh;st.extension=v.TextureSource,st.defaultOptions=oy(so({},fe.defaultOptions),{autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1}),st.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};var ay=Object.defineProperty,uy=Object.defineProperties,ly=Object.getOwnPropertyDescriptors,Nh=Object.getOwnPropertySymbols,cy=Object.prototype.hasOwnProperty,hy=Object.prototype.propertyIsEnumerable,$h=(t,e,r)=>e in t?ay(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oo=(t,e)=>{for(var r in e||(e={}))cy.call(e,r)&&$h(t,r,e[r]);if(Nh)for(var r of Nh(e))hy.call(e,r)&&$h(t,r,e[r]);return t},Vh=(t,e)=>uy(t,ly(e));const zh=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],dy=zh.map(t=>`video/${t.substring(1)}`);function Hh(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Wh(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}function Wh(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location;const r=new URL(t,document.baseURI);return r.hostname!==e.hostname||r.port!==e.port||r.protocol!==e.protocol?"anonymous":""}const Xh={name:"loadVideo",extension:{type:v.LoadParser},config:null,test(t){const e=bt(t,dy),r=Ge(t,zh);return e||r},async load(t,e,r){var n,i;const s=oo(Vh(oo({},st.defaultOptions),{resolution:((n=e.data)==null?void 0:n.resolution)||Js(t),alphaMode:((i=e.data)==null?void 0:i.alphaMode)||await io()}),e.data),o=document.createElement("video"),a={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(a).forEach(d=>{const p=a[d];p!==void 0&&o.setAttribute(d,p)}),s.muted===!0&&(o.muted=!0),Hh(o,t,s.crossorigin);const u=document.createElement("source");let l;if(t.startsWith("data:"))l=t.slice(5,t.indexOf(";"));else if(!t.startsWith("blob:")){const d=t.split("?")[0].slice(t.lastIndexOf(".")+1).toLowerCase();l=st.MIME_TYPES[d]||`video/${d}`}u.src=t,l&&(u.type=l),o.appendChild(u);const c=new st(Vh(oo({},s),{resource:o}));return Wt(c,r,t)},unload(t){t.destroy(!0)}},jh={extension:v.ResolveParser,test:ro.test,parse:t=>{var e,r;return{resolution:parseFloat((r=(e=dt.RETINA_PREFIX.exec(t))==null?void 0:e[1])!=null?r:"1"),format:t.split(".").pop(),src:t}}};V.add(Qc,rh,eh,oh,nh,ih,sh,lh,ch,ph,Dh,ro,Xh,jh,uh,ah);const Yh={loader:v.LoadParser,resolver:v.ResolveParser,cache:v.CacheParser,detection:v.DetectionParser};V.handle(v.Asset,t=>{const e=t.ref;Object.entries(Yh).filter(([r])=>!!e[r]).forEach(([r,n])=>{var i;return V.add(Object.assign(e[r],{extension:(i=e[r].extension)!=null?i:n}))})},t=>{const e=t.ref;Object.keys(Yh).filter(r=>!!e[r]).forEach(r=>V.remove(e[r]))});const Zh={extension:{type:v.DetectionParser,priority:3},test:async()=>!!(await Mn()||Bn()),add:async t=>[...t,"basis"],remove:async t=>t.filter(e=>e!=="basis")};class Xn extends fe{constructor(e){super(e),this.uploadMethodId="compressed",this.resource=e.resource,this.mipLevelCount=this.resource.length}}let jn;function ao(){if(jn)return jn;const t=document.createElement("canvas").getContext("webgl");return t?(jn=[...t.getExtension("WEBGL_compressed_texture_s3tc")?["bc2-rgba-unorm","bc3-rgba-unorm","bc7-rgba-unorm"]:[],...t.getExtension("WEBGL_compressed_texture_s3tc_srgb")?["bc2-rgba-unorm-srgb","bc3-rgba-unorm-srgb","bc7-rgba-unorm-srgb"]:[],...t.getExtension("WEBGL_compressed_texture_astc")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","eac-r11unorm","eac-rg11unorm"]:[],...t.getExtension("WEBGL_compressed_texture_astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],jn):[]}let Yn;async function uo(){if(Yn)return Yn;const t=await navigator.gpu.requestAdapter();return Yn=[...t.features.has("texture-compression-bc")?["bc1-rgba-unorm","bc1-rgba-unorm-srgb","bc2-rgba-unorm","bc2-rgba-unorm-srgb","bc3-rgba-unorm","bc3-rgba-unorm-srgb","bc4-r-unorm","bc4-r-snorm","bc5-rg-unorm","bc5-rg-snorm","bc6h-rgb-ufloat","bc6h-rgb-float","bc7-rgba-unorm","bc7-rgba-unorm-srgb"]:[],...t.features.has("texture-compression-etc2")?["etc2-rgb8unorm","etc2-rgb8unorm-srgb","etc2-rgb8a1unorm","etc2-rgb8a1unorm-srgb","etc2-rgba8unorm","etc2-rgba8unorm-srgb","eac-r11unorm","eac-r11snorm","eac-rg11unorm","eac-rg11snorm"]:[],...t.features.has("texture-compression-astc")?["astc-4x4-unorm","astc-4x4-unorm-srgb","astc-5x4-unorm","astc-5x4-unorm-srgb","astc-5x5-unorm","astc-5x5-unorm-srgb","astc-6x5-unorm","astc-6x5-unorm-srgb","astc-6x6-unorm","astc-6x6-unorm-srgb","astc-8x5-unorm","astc-8x5-unorm-srgb","astc-8x6-unorm","astc-8x6-unorm-srgb","astc-8x8-unorm","astc-8x8-unorm-srgb","astc-10x5-unorm","astc-10x5-unorm-srgb","astc-10x6-unorm","astc-10x6-unorm-srgb","astc-10x8-unorm","astc-10x8-unorm-srgb","astc-10x10-unorm","astc-10x10-unorm-srgb","astc-12x10-unorm","astc-12x10-unorm-srgb","astc-12x12-unorm","astc-12x12-unorm-srgb"]:[]],Yn}let lo;async function co(){return lo!==void 0||(lo=await(async()=>{const t=await Mn(),e=Bn();if(t&&e){const r=await uo(),n=ao();return r.filter(i=>n.includes(i))}else{if(t)return await uo();if(e)return ao()}return[]})()),lo}const qh=["r8unorm","r8snorm","r8uint","r8sint","r16uint","r16sint","r16float","rg8unorm","rg8snorm","rg8uint","rg8sint","r32uint","r32sint","r32float","rg16uint","rg16sint","rg16float","rgba8unorm","rgba8unorm-srgb","rgba8snorm","rgba8uint","rgba8sint","bgra8unorm","bgra8unorm-srgb","rgb9e5ufloat","rgb10a2unorm","rg11b10ufloat","rg32uint","rg32sint","rg32float","rgba16uint","rgba16sint","rgba16float","rgba32uint","rgba32sint","rgba32float","stencil8","depth16unorm","depth24plus","depth24plus-stencil8","depth32float","depth32float-stencil8"];let Zn;async function qn(){if(Zn!==void 0)return Zn;const t=await co();return Zn=[...qh,...t],Zn}function fy(t,e){var r=atob(t);if(e){for(var n=new Uint8Array(r.length),i=0,s=r.length;i<s;++i)n[i]=r.charCodeAt(i);return new TextDecoder("utf-16le").decode(new Uint16Array(n.buffer))}return r}function py(t,e,r){var n=e===void 0?null:e,i=r===void 0?!1:r,s=fy(t,i),o=s.indexOf(`
`,10)+1,a=s.substring(o)+(n?"//# sourceMappingURL="+n:""),u=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(u)}function Kh(t,e,r){var n;return function(s){return n=n||py(t,e,r),new Worker(n,s)}}var gy=Kh("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIGZ1bmN0aW9uIGNyZWF0ZUxldmVsQnVmZmVycyhiYXNpc1RleHR1cmUsIGJhc2lzVHJhbnNjb2RlckZvcm1hdCkgewogICAgICBjb25zdCBpbWFnZXMgPSBiYXNpc1RleHR1cmUuZ2V0TnVtSW1hZ2VzKCk7CiAgICAgIGNvbnN0IGxldmVscyA9IGJhc2lzVGV4dHVyZS5nZXROdW1MZXZlbHMoMCk7CiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBiYXNpc1RleHR1cmUuc3RhcnRUcmFuc2NvZGluZygpOwogICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInN0YXJ0VHJhbnNjb2RpbmcgZmFpbGVkIik7CiAgICAgIH0KICAgICAgY29uc3QgbGV2ZWxCdWZmZXJzID0gW107CiAgICAgIGZvciAobGV0IGxldmVsSW5kZXggPSAwOyBsZXZlbEluZGV4IDwgbGV2ZWxzOyArK2xldmVsSW5kZXgpIHsKICAgICAgICBmb3IgKGxldCBzbGljZUluZGV4ID0gMDsgc2xpY2VJbmRleCA8IGltYWdlczsgKytzbGljZUluZGV4KSB7CiAgICAgICAgICBjb25zdCB0cmFuc2NvZGVTaXplID0gYmFzaXNUZXh0dXJlLmdldEltYWdlVHJhbnNjb2RlZFNpemVJbkJ5dGVzKHNsaWNlSW5kZXgsIGxldmVsSW5kZXgsIGJhc2lzVHJhbnNjb2RlckZvcm1hdCk7CiAgICAgICAgICBjb25zdCBsZXZlbEJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KHRyYW5zY29kZVNpemUpOwogICAgICAgICAgY29uc3Qgc3VjY2VzczIgPSBiYXNpc1RleHR1cmUudHJhbnNjb2RlSW1hZ2UobGV2ZWxCdWZmZXIsIHNsaWNlSW5kZXgsIGxldmVsSW5kZXgsIGJhc2lzVHJhbnNjb2RlckZvcm1hdCwgMSwgMCk7CiAgICAgICAgICBpZiAoIXN1Y2Nlc3MyKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigidHJhbnNjb2RlSW1hZ2UgZmFpbGVkIik7CiAgICAgICAgICB9CiAgICAgICAgICBsZXZlbEJ1ZmZlcnMucHVzaChsZXZlbEJ1ZmZlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBsZXZlbEJ1ZmZlcnM7CiAgICB9CgogICAgY29uc3QgZ3B1Rm9ybWF0VG9CYXNpc1RyYW5zY29kZXJGb3JtYXRNYXAgPSB7CiAgICAgICJiYzMtcmdiYS11bm9ybSI6IDMsCiAgICAgIC8vIGNURkJDM19SR0JBCiAgICAgICJiYzctcmdiYS11bm9ybSI6IDYsCiAgICAgIC8vIGNURkJDN19SR0JBLAogICAgICAiZXRjMi1yZ2JhOHVub3JtIjogMSwKICAgICAgLy8gY1RGRVRDMl9SR0JBLAogICAgICAiYXN0Yy00eDQtdW5vcm0iOiAxMCwKICAgICAgLy8gY1RGQVNUQ180eDRfUkdCQSwKICAgICAgLy8gVW5jb21wcmVzc2VkCiAgICAgIHJnYmE4dW5vcm06IDEzLAogICAgICAvLyBjVEZSR0JBMzIsCiAgICAgIHJnYmE0dW5vcm06IDE2CiAgICAgIC8vIGNURlJHQkE0NDQ0LAogICAgfTsKICAgIGZ1bmN0aW9uIGdwdUZvcm1hdFRvQmFzaXNUcmFuc2NvZGVyRm9ybWF0KHRyYW5zY29kZXJGb3JtYXQpIHsKICAgICAgY29uc3QgZm9ybWF0ID0gZ3B1Rm9ybWF0VG9CYXNpc1RyYW5zY29kZXJGb3JtYXRNYXBbdHJhbnNjb2RlckZvcm1hdF07CiAgICAgIGlmIChmb3JtYXQpIHsKICAgICAgICByZXR1cm4gZm9ybWF0OwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdHJhbnNjb2RlckZvcm1hdDogJHt0cmFuc2NvZGVyRm9ybWF0fWApOwogICAgfQoKICAgIGNvbnN0IHNldHRpbmdzID0gewogICAgICBqc1VybDogImJhc2lzL2Jhc2lzX3RyYW5zY29kZXIuanMiLAogICAgICB3YXNtVXJsOiAiYmFzaXMvYmFzaXNfdHJhbnNjb2Rlci53YXNtIgogICAgfTsKICAgIGxldCBiYXNpc1RyYW5zY29kZXJGb3JtYXQ7CiAgICBsZXQgYmFzaXNUcmFuc2NvZGVkVGV4dHVyZUZvcm1hdDsKICAgIGxldCBiYXNpc1Byb21pc2U7CiAgICBhc3luYyBmdW5jdGlvbiBnZXRCYXNpcygpIHsKICAgICAgaWYgKCFiYXNpc1Byb21pc2UpIHsKICAgICAgICBjb25zdCBhYnNvbHV0ZUpzVXJsID0gbmV3IFVSTChzZXR0aW5ncy5qc1VybCwgbG9jYXRpb24ub3JpZ2luKS5ocmVmOwogICAgICAgIGNvbnN0IGFic29sdXRlV2FzbVVybCA9IG5ldyBVUkwoc2V0dGluZ3Mud2FzbVVybCwgbG9jYXRpb24ub3JpZ2luKS5ocmVmOwogICAgICAgIGltcG9ydFNjcmlwdHMoYWJzb2x1dGVKc1VybCk7CiAgICAgICAgYmFzaXNQcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgIEJBU0lTKHsKICAgICAgICAgICAgbG9jYXRlRmlsZTogKF9maWxlKSA9PiBhYnNvbHV0ZVdhc21VcmwKICAgICAgICAgIH0pLnRoZW4oKG1vZHVsZSkgPT4gewogICAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZUJhc2lzKCk7CiAgICAgICAgICAgIHJlc29sdmUobW9kdWxlLkJhc2lzRmlsZSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gYmFzaXNQcm9taXNlOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hCYXNpc1RleHR1cmUodXJsLCBCYXNpc1RleHR1cmUpIHsKICAgICAgY29uc3QgYmFzaXNSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgICAgIGlmIChiYXNpc1Jlc3BvbnNlLm9rKSB7CiAgICAgICAgY29uc3QgYmFzaXNBcnJheUJ1ZmZlciA9IGF3YWl0IGJhc2lzUmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgICByZXR1cm4gbmV3IEJhc2lzVGV4dHVyZShuZXcgVWludDhBcnJheShiYXNpc0FycmF5QnVmZmVyKSk7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBCYXNpcyB0ZXh0dXJlOiAke3VybH1gKTsKICAgIH0KICAgIGNvbnN0IHByZWZlcnJlZFRyYW5zY29kZWRGb3JtYXQgPSBbCiAgICAgICJldGMyLXJnYmE4dW5vcm0iLAogICAgICAiYmM3LXJnYmEtdW5vcm0iLAogICAgICAiYmMzLXJnYmEtdW5vcm0iLAogICAgICAiYXN0Yy00eDQtdW5vcm0iLAogICAgICAicmdiYTh1bm9ybSIKICAgIF07CiAgICBhc3luYyBmdW5jdGlvbiBsb2FkKHVybCkgewogICAgICBjb25zdCBCYXNpc1RleHR1cmUgPSBhd2FpdCBnZXRCYXNpcygpOwogICAgICBjb25zdCBiYXNpc1RleHR1cmUgPSBhd2FpdCBmZXRjaEJhc2lzVGV4dHVyZSh1cmwsIEJhc2lzVGV4dHVyZSk7CiAgICAgIGNvbnN0IGxldmVsQnVmZmVycyA9IGNyZWF0ZUxldmVsQnVmZmVycyhiYXNpc1RleHR1cmUsIGJhc2lzVHJhbnNjb2RlckZvcm1hdCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IGJhc2lzVGV4dHVyZS5nZXRJbWFnZVdpZHRoKDAsIDApLAogICAgICAgIGhlaWdodDogYmFzaXNUZXh0dXJlLmdldEltYWdlSGVpZ2h0KDAsIDApLAogICAgICAgIGZvcm1hdDogYmFzaXNUcmFuc2NvZGVkVGV4dHVyZUZvcm1hdCwKICAgICAgICByZXNvdXJjZTogbGV2ZWxCdWZmZXJzCiAgICAgIH07CiAgICB9CiAgICBhc3luYyBmdW5jdGlvbiBpbml0KGpzVXJsLCB3YXNtVXJsLCBzdXBwb3J0ZWRUZXh0dXJlcykgewogICAgICBpZiAoanNVcmwpCiAgICAgICAgc2V0dGluZ3MuanNVcmwgPSBqc1VybDsKICAgICAgaWYgKHdhc21VcmwpCiAgICAgICAgc2V0dGluZ3Mud2FzbVVybCA9IHdhc21Vcmw7CiAgICAgIGJhc2lzVHJhbnNjb2RlZFRleHR1cmVGb3JtYXQgPSBwcmVmZXJyZWRUcmFuc2NvZGVkRm9ybWF0LmZpbHRlcigoZm9ybWF0KSA9PiBzdXBwb3J0ZWRUZXh0dXJlcy5pbmNsdWRlcyhmb3JtYXQpKVswXTsKICAgICAgYmFzaXNUcmFuc2NvZGVyRm9ybWF0ID0gZ3B1Rm9ybWF0VG9CYXNpc1RyYW5zY29kZXJGb3JtYXQoYmFzaXNUcmFuc2NvZGVkVGV4dHVyZUZvcm1hdCk7CiAgICAgIGF3YWl0IGdldEJhc2lzKCk7CiAgICB9CiAgICBjb25zdCBtZXNzYWdlSGFuZGxlcnMgPSB7CiAgICAgIGluaXQ6IGFzeW5jIChkYXRhKSA9PiB7CiAgICAgICAgY29uc3QgeyBqc1VybCwgd2FzbVVybCwgc3VwcG9ydGVkVGV4dHVyZXMgfSA9IGRhdGE7CiAgICAgICAgYXdhaXQgaW5pdChqc1VybCwgd2FzbVVybCwgc3VwcG9ydGVkVGV4dHVyZXMpOwogICAgICB9LAogICAgICBsb2FkOiBhc3luYyAoZGF0YSkgPT4gewogICAgICAgIHRyeSB7CiAgICAgICAgICBjb25zdCB0ZXh0dXJlT3B0aW9ucyA9IGF3YWl0IGxvYWQoZGF0YS51cmwpOwogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgdHlwZTogImxvYWQiLAogICAgICAgICAgICB1cmw6IGRhdGEudXJsLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlLAogICAgICAgICAgICB0ZXh0dXJlT3B0aW9ucywKICAgICAgICAgICAgdHJhbnNmZXJhYmxlczogdGV4dHVyZU9wdGlvbnMucmVzb3VyY2U/Lm1hcCgoYXJyKSA9PiBhcnIuYnVmZmVyKQogICAgICAgICAgfTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIHNlbGYub25tZXNzYWdlID0gYXN5bmMgKG1lc3NhZ2VFdmVudCkgPT4gewogICAgICBjb25zdCBtZXNzYWdlID0gbWVzc2FnZUV2ZW50LmRhdGE7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbWVzc2FnZUhhbmRsZXJzW21lc3NhZ2UudHlwZV0obWVzc2FnZSk7CiAgICAgIGlmIChyZXNwb25zZSkgewogICAgICAgIHNlbGYucG9zdE1lc3NhZ2UocmVzcG9uc2UsIHJlc3BvbnNlLnRyYW5zZmVyYWJsZXMpOwogICAgICB9CiAgICB9OwoKfSkoKTsKCg==",null,!1);const Kn={jsUrl:"./basis/basis_transcoder.js",wasmUrl:"./basis/basis_transcoder.wasm"};function my(t){Object.assign(Kn,t)}let Ir;const Jh={};function by(t){return Ir||(Ir=new gy,Ir.onmessage=e=>{const{success:r,url:n,textureOptions:i}=e.data;r||console.warn("Failed to load Basis texture",n),Jh[n](i)},Ir.postMessage({type:"init",jsUrl:Kn.jsUrl,wasmUrl:Kn.wasmUrl,supportedTextures:t})),Ir}function Qh(t,e){const r=by(e);return new Promise(n=>{Jh[t]=n,r.postMessage({type:"load",url:t})})}const ed={extension:{type:v.LoadParser,priority:Ie.High},name:"loadBasis",test(t){return Ge(t,[".basis"])},async load(t,e,r){const n=await qn(),i=await Qh(t,n),s=new Xn(i);return Wt(s,r,t)},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};V.add(ed,Zh);function td(t,e){const r=t.getNumImages(),n=t.getNumLevels(0);if(!t.startTranscoding())throw new Error("startTranscoding failed");const i=[];for(let s=0;s<n;++s)for(let o=0;o<r;++o){const a=t.getImageTranscodedSizeInBytes(o,s,e),u=new Uint8Array(a);if(!t.transcodeImage(u,o,s,e,1,0))throw new Error("transcodeImage failed");i.push(u)}return i}const vy={"bc3-rgba-unorm":3,"bc7-rgba-unorm":6,"etc2-rgba8unorm":1,"astc-4x4-unorm":10,rgba8unorm:13,rgba4unorm:16};function rd(t){const e=vy[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)}const Jn={jsUrl:"basis/basis_transcoder.js",wasmUrl:"basis/basis_transcoder.wasm"};let nd,ho,fo;async function id(){if(!fo){const t=new URL(Jn.jsUrl,location.origin).href,e=new URL(Jn.wasmUrl,location.origin).href;importScripts(t),fo=new Promise(r=>{BASIS({locateFile:n=>e}).then(n=>{n.initializeBasis(),r(n.BasisFile)})})}return fo}async function yy(t,e){const r=await fetch(t);if(r.ok){const n=await r.arrayBuffer();return new e(new Uint8Array(n))}throw new Error(`Failed to load Basis texture: ${t}`)}const _y=["etc2-rgba8unorm","bc7-rgba-unorm","bc3-rgba-unorm","astc-4x4-unorm","rgba8unorm"];async function xy(t){const e=await id(),r=await yy(t,e),n=td(r,nd);return{width:r.getImageWidth(0,0),height:r.getImageHeight(0,0),format:ho,resource:n}}async function Ay(t,e,r){t&&(Jn.jsUrl=t),e&&(Jn.wasmUrl=e),ho=_y.filter(n=>r.includes(n))[0],nd=rd(ho),await id()}const Cy={init:async t=>{const{jsUrl:e,wasmUrl:r,supportedTextures:n}=t;await Ay(e,r,n)},load:async t=>{var e;try{const r=await xy(t.url);return{type:"load",url:t.url,success:!0,textureOptions:r,transferables:(e=r.resource)==null?void 0:e.map(n=>n.buffer)}}catch(r){throw r}}};self.onmessage=async t=>{const e=t.data,r=await Cy[e.type](e);r&&self.postMessage(r,r.transferables)};const Qn=["basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"],po={extension:v.ResolveParser,test:t=>Ge(t,[".ktx",".ktx2",".dds"]),parse:t=>{var e,r;let n;const i=t.split(".");if(i.length>2){const s=i[i.length-2];Qn.includes(s),n=s}else n=i[i.length-1];return{resolution:parseFloat((r=(e=dt.RETINA_PREFIX.exec(t))==null?void 0:e[1])!=null?r:"1"),format:n,src:t}}};let ei;const sd={extension:{type:v.DetectionParser,priority:2},test:async()=>!!(await Mn()||Bn()),add:async t=>{const e=await co();return ei=wy(e),[...ei,...t]},remove:async t=>ei?t.filter(e=>!(e in ei)):t};function wy(t){const e=["basis"],r={};return t.forEach(n=>{const i=n.split("-")[0];i&&!r[i]&&(r[i]=!0,e.push(i))}),e.sort((n,i)=>{const s=Qn.indexOf(n),o=Qn.indexOf(i);return s===-1?1:o===-1?-1:s-o}),e}const cT=542327876,hT=131072,dT=4;function go(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function Ty(t){return String.fromCharCode(t&255,t>>8&255,t>>16&255,t>>24&255)}const Sy=go("DXT1"),Ey=go("DXT3"),Iy=go("DXT5"),Py=31,By=0,My=1,Dy=2,Ry=3,Fy=4,Gy=7,ky=20,Oy=21,Uy=22,Ly=23,Ny=24,$y=25;function od(t,e){const r=new Int32Array(t,0,Py);if(r[By]!==542327876)throw new Error("Invalid magic number in DDS header");if((r[ky]===0?1:0)&4)throw new Error("Unsupported format, must contain a FourCC code");const n=r[Oy];let i=0,s=0,o;switch(n){case Sy:i=8,o="bc1-rgba-unorm";break;case Ey:i=16,o="bc2-rgba-unorm";break;case Iy:i=16,o="bc3-rgba-unorm";break;default:{const g=r[Uy],b=r[Ly],m=r[Ny],x=r[$y];g===32&&(b&255&&m&65280&&x&16711680?(o="rgba8unorm",s=4):b&16711680&&m&65280&&x&255&&(o="bgra8unorm",s=4))}}const a=r[Fy],u=r[Ry];let l=r[My]+4;if(e.indexOf(o)===-1)throw new Error(`Unsupported texture format: ${Ty(n)} ${o}`);if(i===0)return{format:o,width:a,height:u,resource:[new Uint8Array(t,l,a*u*s)]};let c=1;r[Dy]&131072&&(c=Math.max(1,r[Gy]));const d=[];let p=a,f=u;for(let g=0;g<c;++g){const b=i?Math.max(4,p)/4*Math.max(4,f)/4*i:p*f*4,m=new Uint8Array(t,l,b);d.push(m),l+=b,p=Math.max(p>>1,1),f=Math.max(f>>1,1)}return{format:o,width:a,height:u,resource:d}}const ad={extension:{type:v.LoadParser,priority:Ie.High},name:"loadDDS",test(t){return Ge(t,[".dds"])},async load(t,e,r){const n=await qn(),i=await(await fetch(t)).arrayBuffer(),s=od(i,n),o=new Xn(s);return Wt(o,r,t)},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};V.add(ad,sd,po);var Vy=Kh("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICAgJ3VzZSBzdHJpY3QnOwoKICAgIGNvbnN0IGNvbnZlcnRlcnMgPSB7CiAgICAgIHJnYjh1bm9ybTogewogICAgICAgIGNvbnZlcnRlZEZvcm1hdDogInJnYmE4dW5vcm0iLAogICAgICAgIGNvbnZlcnRGdW5jdGlvbjogY29udmVydFJHQnRvUkdCQQogICAgICB9LAogICAgICAicmdiOHVub3JtLXNyZ2IiOiB7CiAgICAgICAgY29udmVydGVkRm9ybWF0OiAicmdiYTh1bm9ybS1zcmdiIiwKICAgICAgICBjb252ZXJ0RnVuY3Rpb246IGNvbnZlcnRSR0J0b1JHQkEKICAgICAgfQogICAgfTsKICAgIGZ1bmN0aW9uIGNvbnZlcnRGb3JtYXRJZlJlcXVpcmVkKHRleHR1cmVPcHRpb25zKSB7CiAgICAgIGNvbnN0IGZvcm1hdCA9IHRleHR1cmVPcHRpb25zLmZvcm1hdDsKICAgICAgaWYgKGNvbnZlcnRlcnNbZm9ybWF0XSkgewogICAgICAgIGNvbnN0IGNvbnZlcnRGdW5jdGlvbiA9IGNvbnZlcnRlcnNbZm9ybWF0XS5jb252ZXJ0RnVuY3Rpb247CiAgICAgICAgY29uc3QgbGV2ZWxCdWZmZXJzID0gdGV4dHVyZU9wdGlvbnMucmVzb3VyY2U7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZXZlbEJ1ZmZlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGxldmVsQnVmZmVyc1tpXSA9IGNvbnZlcnRGdW5jdGlvbihsZXZlbEJ1ZmZlcnNbaV0pOwogICAgICAgIH0KICAgICAgICB0ZXh0dXJlT3B0aW9ucy5mb3JtYXQgPSBjb252ZXJ0ZXJzW2Zvcm1hdF0uY29udmVydGVkRm9ybWF0OwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBjb252ZXJ0UkdCdG9SR0JBKGxldmVsQnVmZmVyKSB7CiAgICAgIGNvbnN0IHBpeGVsQ291bnQgPSBsZXZlbEJ1ZmZlci5ieXRlTGVuZ3RoIC8gMzsKICAgICAgY29uc3QgbGV2ZWxCdWZmZXJXaXRoQWxwaGEgPSBuZXcgVWludDMyQXJyYXkocGl4ZWxDb3VudCk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGl4ZWxDb3VudDsgKytpKSB7CiAgICAgICAgbGV2ZWxCdWZmZXJXaXRoQWxwaGFbaV0gPSBsZXZlbEJ1ZmZlcltpICogM10gKyAobGV2ZWxCdWZmZXJbaSAqIDMgKyAxXSA8PCA4KSArIChsZXZlbEJ1ZmZlcltpICogMyArIDJdIDw8IDE2KSArIDQyNzgxOTAwODA7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGxldmVsQnVmZmVyV2l0aEFscGhhLmJ1ZmZlcik7CiAgICB9CgogICAgZnVuY3Rpb24gY3JlYXRlTGV2ZWxCdWZmZXJzRnJvbUtUWChrdHhUZXh0dXJlKSB7CiAgICAgIGNvbnN0IGxldmVsQnVmZmVycyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGt0eFRleHR1cmUubnVtTGV2ZWxzOyBpKyspIHsKICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBrdHhUZXh0dXJlLmdldEltYWdlRGF0YShpLCAwLCAwKTsKICAgICAgICBjb25zdCBsZXZlbEJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGltYWdlRGF0YS5ieXRlTGVuZ3RoKTsKICAgICAgICBsZXZlbEJ1ZmZlci5zZXQoaW1hZ2VEYXRhKTsKICAgICAgICBsZXZlbEJ1ZmZlcnMucHVzaChsZXZlbEJ1ZmZlcik7CiAgICAgIH0KICAgICAgcmV0dXJuIGxldmVsQnVmZmVyczsKICAgIH0KCiAgICBjb25zdCBnbEZvcm1hdFRvR1BVRm9ybWF0TWFwID0gewogICAgICA2NDA4OiAicmdiYTh1bm9ybSIsCiAgICAgIDMyODU2OiAiYmdyYTh1bm9ybSIsCiAgICAgIC8vCiAgICAgIDMyODU3OiAicmdiMTBhMnVub3JtIiwKICAgICAgMzMxODk6ICJkZXB0aDE2dW5vcm0iLAogICAgICAzMzE5MDogImRlcHRoMjRwbHVzIiwKICAgICAgMzMzMjE6ICJyOHVub3JtIiwKICAgICAgMzMzMjM6ICJyZzh1bm9ybSIsCiAgICAgIDMzMzI1OiAicjE2ZmxvYXQiLAogICAgICAzMzMyNjogInIzMmZsb2F0IiwKICAgICAgMzMzMjc6ICJyZzE2ZmxvYXQiLAogICAgICAzMzMyODogInJnMzJmbG9hdCIsCiAgICAgIDMzMzI5OiAicjhzaW50IiwKICAgICAgMzMzMzA6ICJyOHVpbnQiLAogICAgICAzMzMzMTogInIxNnNpbnQiLAogICAgICAzMzMzMjogInIxNnVpbnQiLAogICAgICAzMzMzMzogInIzMnNpbnQiLAogICAgICAzMzMzNDogInIzMnVpbnQiLAogICAgICAzMzMzNTogInJnOHNpbnQiLAogICAgICAzMzMzNjogInJnOHVpbnQiLAogICAgICAzMzMzNzogInJnMTZzaW50IiwKICAgICAgMzMzMzg6ICJyZzE2dWludCIsCiAgICAgIDMzMzM5OiAicmczMnNpbnQiLAogICAgICAzMzM0MDogInJnMzJ1aW50IiwKICAgICAgMzM3Nzg6ICJiYzItcmdiYS11bm9ybSIsCiAgICAgIDMzNzc5OiAiYmMzLXJnYmEtdW5vcm0iLAogICAgICAzNDgzNjogInJnYmEzMmZsb2F0IiwKICAgICAgMzQ4NDI6ICJyZ2JhMTZmbG9hdCIsCiAgICAgIDM1MDU2OiAiZGVwdGgyNHBsdXMtc3RlbmNpbDgiLAogICAgICAzNTg5ODogInJnMTFiMTB1ZmxvYXQiLAogICAgICAzNTkwMTogInJnYjllNXVmbG9hdCIsCiAgICAgIDM1OTA3OiAicmdiYTh1bm9ybS1zcmdiIiwKICAgICAgLy8gYmdyYTh1bm9ybS1zcmdiCiAgICAgIDM2MDEyOiAiZGVwdGgzMmZsb2F0IiwKICAgICAgMzYwMTM6ICJkZXB0aDMyZmxvYXQtc3RlbmNpbDgiLAogICAgICAzNjE2ODogInN0ZW5jaWw4IiwKICAgICAgMzYyMDg6ICJyZ2JhMzJ1aW50IiwKICAgICAgMzYyMTQ6ICJyZ2JhMTZ1aW50IiwKICAgICAgMzYyMjA6ICJyZ2JhOHVpbnQiLAogICAgICAzNjIyNjogInJnYmEzMnNpbnQiLAogICAgICAzNjIzMjogInJnYmExNnNpbnQiLAogICAgICAzNjIzODogInJnYmE4c2ludCIsCiAgICAgIDM2NDkyOiAiYmM3LXJnYmEtdW5vcm0iLAogICAgICAzNjc1NjogInI4c25vcm0iLAogICAgICAzNjc1NzogInJnOHNub3JtIiwKICAgICAgMzY3NTk6ICJyZ2JhOHNub3JtIiwKICAgICAgMzc0OTY6ICJldGMyLXJnYmE4dW5vcm0iLAogICAgICAzNzgwODogImFzdGMtNHg0LXVub3JtIgogICAgfTsKICAgIGZ1bmN0aW9uIGdsRm9ybWF0VG9HUFVGb3JtYXQoZ2xJbnRlcm5hbEZvcm1hdCkgewogICAgICBjb25zdCBmb3JtYXQgPSBnbEZvcm1hdFRvR1BVRm9ybWF0TWFwW2dsSW50ZXJuYWxGb3JtYXRdOwogICAgICBpZiAoZm9ybWF0KSB7CiAgICAgICAgcmV0dXJuIGZvcm1hdDsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGdsSW50ZXJuYWxGb3JtYXQ6ICR7Z2xJbnRlcm5hbEZvcm1hdH1gKTsKICAgIH0KCiAgICBjb25zdCB2a0Zvcm1hdFRvR1BVRm9ybWF0TWFwID0gewogICAgICAyMzogInJnYjh1bm9ybSIsCiAgICAgIC8vIFZLX0ZPUk1BVF9SOEc4QjhfVU5PUk0KICAgICAgMzc6ICJyZ2JhOHVub3JtIiwKICAgICAgLy8gVktfRk9STUFUX1I4RzhCOEE4X1VOT1JNCiAgICAgIDQzOiAicmdiYTh1bm9ybS1zcmdiIgogICAgICAvLyBWS19GT1JNQVRfUjhHOEI4QThfU1JHQgogICAgICAvLyBUT0RPIGFkZCBtb3JlIQogICAgfTsKICAgIGZ1bmN0aW9uIHZrRm9ybWF0VG9HUFVGb3JtYXQodmtGb3JtYXQpIHsKICAgICAgY29uc3QgZm9ybWF0ID0gdmtGb3JtYXRUb0dQVUZvcm1hdE1hcFt2a0Zvcm1hdF07CiAgICAgIGlmIChmb3JtYXQpIHsKICAgICAgICByZXR1cm4gZm9ybWF0OwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgVmtGb3JtYXQ6ICR7dmtGb3JtYXR9YCk7CiAgICB9CgogICAgZnVuY3Rpb24gZ2V0VGV4dHVyZUZvcm1hdEZyb21LVFhUZXh0dXJlKGt0eFRleHR1cmUpIHsKICAgICAgaWYgKGt0eFRleHR1cmUuY2xhc3NJZCA9PT0gMikgewogICAgICAgIHJldHVybiB2a0Zvcm1hdFRvR1BVRm9ybWF0KGt0eFRleHR1cmUudmtGb3JtYXQpOwogICAgICB9CiAgICAgIHJldHVybiBnbEZvcm1hdFRvR1BVRm9ybWF0KGt0eFRleHR1cmUuZ2xJbnRlcm5hbGZvcm1hdCk7CiAgICB9CgogICAgY29uc3QgZ3B1Rm9ybWF0VG9CYXNpc1RyYW5zY29kZXJGb3JtYXRNYXAgPSB7CiAgICAgICJiYzMtcmdiYS11bm9ybSI6ICJCQzNfUkdCQSIsCiAgICAgICJiYzctcmdiYS11bm9ybSI6ICJCQzdfTTVfUkdCQSIsCiAgICAgICJldGMyLXJnYmE4dW5vcm0iOiAiRVRDMl9SR0JBIiwKICAgICAgImFzdGMtNHg0LXVub3JtIjogIkFTVENfNHg0X1JHQkEiLAogICAgICAvLyBVbmNvbXByZXNzZWQKICAgICAgcmdiYTh1bm9ybTogIlJHQkEzMiIsCiAgICAgIHJnMTFiMTB1ZmxvYXQ6ICJSMTFGX0cxMUZfQjEwRiIKICAgIH07CiAgICBmdW5jdGlvbiBncHVGb3JtYXRUb0tUWEJhc2lzVHJhbnNjb2RlckZvcm1hdCh0cmFuc2NvZGVyRm9ybWF0KSB7CiAgICAgIGNvbnN0IGZvcm1hdCA9IGdwdUZvcm1hdFRvQmFzaXNUcmFuc2NvZGVyRm9ybWF0TWFwW3RyYW5zY29kZXJGb3JtYXRdOwogICAgICBpZiAoZm9ybWF0KSB7CiAgICAgICAgcmV0dXJuIGZvcm1hdDsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHRyYW5zY29kZXJGb3JtYXQ6ICR7dHJhbnNjb2RlckZvcm1hdH1gKTsKICAgIH0KCiAgICBjb25zdCBzZXR0aW5ncyA9IHsKICAgICAganNVcmw6ICIiLAogICAgICB3YXNtVXJsOiAiIgogICAgfTsKICAgIGxldCBiYXNpc1RyYW5zY29kZXJGb3JtYXQ7CiAgICBsZXQgYmFzaXNUcmFuc2NvZGVkVGV4dHVyZUZvcm1hdDsKICAgIGxldCBrdHhQcm9taXNlOwogICAgYXN5bmMgZnVuY3Rpb24gZ2V0S1RYKCkgewogICAgICBpZiAoIWt0eFByb21pc2UpIHsKICAgICAgICBjb25zdCBhYnNvbHV0ZUpzVXJsID0gbmV3IFVSTChzZXR0aW5ncy5qc1VybCwgbG9jYXRpb24ub3JpZ2luKS5ocmVmOwogICAgICAgIGNvbnN0IGFic29sdXRlV2FzbVVybCA9IG5ldyBVUkwoc2V0dGluZ3Mud2FzbVVybCwgbG9jYXRpb24ub3JpZ2luKS5ocmVmOwogICAgICAgIGltcG9ydFNjcmlwdHMoYWJzb2x1dGVKc1VybCk7CiAgICAgICAga3R4UHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7CiAgICAgICAgICBMSUJLVFgoewogICAgICAgICAgICBsb2NhdGVGaWxlOiAoX2ZpbGUpID0+IGFic29sdXRlV2FzbVVybAogICAgICAgICAgfSkudGhlbigobGlia3R4KSA9PiB7CiAgICAgICAgICAgIHJlc29sdmUobGlia3R4KTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBrdHhQcm9taXNlOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gZmV0Y2hLVFhUZXh0dXJlKHVybCwga3R4KSB7CiAgICAgIGNvbnN0IGt0eDJSZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgICAgIGlmIChrdHgyUmVzcG9uc2Uub2spIHsKICAgICAgICBjb25zdCBrdHgyQXJyYXlCdWZmZXIgPSBhd2FpdCBrdHgyUmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsKICAgICAgICByZXR1cm4gbmV3IGt0eC5rdHhUZXh0dXJlKG5ldyBVaW50OEFycmF5KGt0eDJBcnJheUJ1ZmZlcikpOwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgS1RYKDIpIHRleHR1cmU6ICR7dXJsfWApOwogICAgfQogICAgY29uc3QgcHJlZmVycmVkVHJhbnNjb2RlZEZvcm1hdCA9IFsKICAgICAgImV0YzItcmdiYTh1bm9ybSIsCiAgICAgICJiYzctcmdiYS11bm9ybSIsCiAgICAgICJiYzMtcmdiYS11bm9ybSIsCiAgICAgICJhc3RjLTR4NC11bm9ybSIsCiAgICAgICJyZ2JhOHVub3JtIgogICAgXTsKICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWQodXJsKSB7CiAgICAgIGNvbnN0IGt0eCA9IGF3YWl0IGdldEtUWCgpOwogICAgICBjb25zdCBrdHhUZXh0dXJlID0gYXdhaXQgZmV0Y2hLVFhUZXh0dXJlKHVybCwga3R4KTsKICAgICAgbGV0IGZvcm1hdDsKICAgICAgaWYgKGt0eFRleHR1cmUubmVlZHNUcmFuc2NvZGluZykgewogICAgICAgIGZvcm1hdCA9IGJhc2lzVHJhbnNjb2RlZFRleHR1cmVGb3JtYXQ7CiAgICAgICAgY29uc3QgdHJhbnNjb2RlRm9ybWF0ID0ga3R4LlRyYW5zY29kZVRhcmdldFtiYXNpc1RyYW5zY29kZXJGb3JtYXRdOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGt0eFRleHR1cmUudHJhbnNjb2RlQmFzaXModHJhbnNjb2RlRm9ybWF0LCAwKTsKICAgICAgICBpZiAocmVzdWx0ICE9PSBrdHguRXJyb3JDb2RlLlNVQ0NFU1MpIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5hYmxlIHRvIHRyYW5zY29kZSBiYXNpcyB0ZXh0dXJlLiIpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3JtYXQgPSBnZXRUZXh0dXJlRm9ybWF0RnJvbUtUWFRleHR1cmUoa3R4VGV4dHVyZSk7CiAgICAgIH0KICAgICAgY29uc3QgbGV2ZWxCdWZmZXJzID0gY3JlYXRlTGV2ZWxCdWZmZXJzRnJvbUtUWChrdHhUZXh0dXJlKTsKICAgICAgY29uc3QgdGV4dHVyZU9wdGlvbnMgPSB7CiAgICAgICAgd2lkdGg6IGt0eFRleHR1cmUuYmFzZVdpZHRoLAogICAgICAgIGhlaWdodDoga3R4VGV4dHVyZS5iYXNlSGVpZ2h0LAogICAgICAgIGZvcm1hdCwKICAgICAgICBtaXBMZXZlbENvdW50OiBrdHhUZXh0dXJlLm51bUxldmVscywKICAgICAgICByZXNvdXJjZTogbGV2ZWxCdWZmZXJzCiAgICAgIH07CiAgICAgIGNvbnZlcnRGb3JtYXRJZlJlcXVpcmVkKHRleHR1cmVPcHRpb25zKTsKICAgICAgcmV0dXJuIHRleHR1cmVPcHRpb25zOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gaW5pdChqc1VybCwgd2FzbVVybCwgc3VwcG9ydGVkVGV4dHVyZXMpIHsKICAgICAgaWYgKGpzVXJsKQogICAgICAgIHNldHRpbmdzLmpzVXJsID0ganNVcmw7CiAgICAgIGlmICh3YXNtVXJsKQogICAgICAgIHNldHRpbmdzLndhc21VcmwgPSB3YXNtVXJsOwogICAgICBiYXNpc1RyYW5zY29kZWRUZXh0dXJlRm9ybWF0ID0gcHJlZmVycmVkVHJhbnNjb2RlZEZvcm1hdC5maWx0ZXIoKGZvcm1hdCkgPT4gc3VwcG9ydGVkVGV4dHVyZXMuaW5jbHVkZXMoZm9ybWF0KSlbMF07CiAgICAgIGJhc2lzVHJhbnNjb2RlckZvcm1hdCA9IGdwdUZvcm1hdFRvS1RYQmFzaXNUcmFuc2NvZGVyRm9ybWF0KGJhc2lzVHJhbnNjb2RlZFRleHR1cmVGb3JtYXQpOwogICAgICBhd2FpdCBnZXRLVFgoKTsKICAgIH0KICAgIGNvbnN0IG1lc3NhZ2VIYW5kbGVycyA9IHsKICAgICAgaW5pdDogYXN5bmMgKGRhdGEpID0+IHsKICAgICAgICBjb25zdCB7IGpzVXJsLCB3YXNtVXJsLCBzdXBwb3J0ZWRUZXh0dXJlcyB9ID0gZGF0YTsKICAgICAgICBhd2FpdCBpbml0KGpzVXJsLCB3YXNtVXJsLCBzdXBwb3J0ZWRUZXh0dXJlcyk7CiAgICAgIH0sCiAgICAgIGxvYWQ6IGFzeW5jIChkYXRhKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHRleHR1cmVPcHRpb25zID0gYXdhaXQgbG9hZChkYXRhLnVybCk7CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICB0eXBlOiAibG9hZCIsCiAgICAgICAgICAgIHVybDogZGF0YS51cmwsCiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgICAgICAgIHRleHR1cmVPcHRpb25zLAogICAgICAgICAgICB0cmFuc2ZlcmFibGVzOiB0ZXh0dXJlT3B0aW9ucy5yZXNvdXJjZT8ubWFwKChhcnIpID0+IGFyci5idWZmZXIpCiAgICAgICAgICB9OwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgc2VsZi5vbm1lc3NhZ2UgPSBhc3luYyAobWVzc2FnZUV2ZW50KSA9PiB7CiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBtZXNzYWdlRXZlbnQuZGF0YTsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtZXNzYWdlSGFuZGxlcnNbbWVzc2FnZS50eXBlXShtZXNzYWdlKTsKICAgICAgaWYgKHJlc3BvbnNlKSB7CiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZShyZXNwb25zZSwgcmVzcG9uc2UudHJhbnNmZXJhYmxlcyk7CiAgICAgIH0KICAgIH07Cgp9KSgpOwoK",null,!1);const ti={jsUrl:"./ktx/libktx.js",wasmUrl:"./ktx/libktx.wasm"};function zy(t){Object.assign(ti,t)}let Pr;const ud={};function Hy(t){return Pr||(Pr=new Vy,Pr.onmessage=e=>{const{success:r,url:n,textureOptions:i}=e.data;r||console.warn("Failed to load KTX texture",n),ud[n](i)},Pr.postMessage({type:"init",jsUrl:ti.jsUrl,wasmUrl:ti.wasmUrl,supportedTextures:t})),Pr}function ld(t,e){const r=Hy(e);return new Promise(n=>{ud[t]=n,r.postMessage({type:"load",url:t})})}const cd={extension:{type:v.LoadParser,priority:Ie.High},name:"loadKTX",test(t){return Ge(t,[".ktx2",".ktx"])},async load(t,e,r){const n=await qn(),i=await ld(t,n),s=new Xn(i);return Wt(s,r,t)},unload(t){Array.isArray(t)?t.forEach(e=>e.destroy(!0)):t.destroy(!0)}};V.add(cd),V.add(po),V.add(sd);function hd(t){const e=[];for(let r=0;r<t.numLevels;r++){const n=t.getImageData(r,0,0),i=new Uint8Array(n.byteLength);i.set(n),e.push(i)}return e}const Wy={6408:"rgba8unorm",32856:"bgra8unorm",32857:"rgb10a2unorm",33189:"depth16unorm",33190:"depth24plus",33321:"r8unorm",33323:"rg8unorm",33325:"r16float",33326:"r32float",33327:"rg16float",33328:"rg32float",33329:"r8sint",33330:"r8uint",33331:"r16sint",33332:"r16uint",33333:"r32sint",33334:"r32uint",33335:"rg8sint",33336:"rg8uint",33337:"rg16sint",33338:"rg16uint",33339:"rg32sint",33340:"rg32uint",33778:"bc2-rgba-unorm",33779:"bc3-rgba-unorm",34836:"rgba32float",34842:"rgba16float",35056:"depth24plus-stencil8",35898:"rg11b10ufloat",35901:"rgb9e5ufloat",35907:"rgba8unorm-srgb",36012:"depth32float",36013:"depth32float-stencil8",36168:"stencil8",36208:"rgba32uint",36214:"rgba16uint",36220:"rgba8uint",36226:"rgba32sint",36232:"rgba16sint",36238:"rgba8sint",36492:"bc7-rgba-unorm",36756:"r8snorm",36757:"rg8snorm",36759:"rgba8snorm",37496:"etc2-rgba8unorm",37808:"astc-4x4-unorm"};function dd(t){const e=Wy[t];if(e)return e;throw new Error(`Unsupported glInternalFormat: ${t}`)}const Xy={23:"rgb8unorm",37:"rgba8unorm",43:"rgba8unorm-srgb"};function fd(t){const e=Xy[t];if(e)return e;throw new Error(`Unsupported VkFormat: ${t}`)}function pd(t){return t.classId===2?fd(t.vkFormat):dd(t.glInternalformat)}const jy={"bc3-rgba-unorm":"BC3_RGBA","bc7-rgba-unorm":"BC7_M5_RGBA","etc2-rgba8unorm":"ETC2_RGBA","astc-4x4-unorm":"ASTC_4x4_RGBA",rgba8unorm:"RGBA32",rg11b10ufloat:"R11F_G11F_B10F"};function gd(t){const e=jy[t];if(e)return e;throw new Error(`Unsupported transcoderFormat: ${t}`)}const mo={rgb8unorm:{convertedFormat:"rgba8unorm",convertFunction:md},"rgb8unorm-srgb":{convertedFormat:"rgba8unorm-srgb",convertFunction:md}};function Yy(t){const e=t.format;if(mo[e]){const r=mo[e].convertFunction,n=t.resource;for(let i=0;i<n.length;i++)n[i]=r(n[i]);t.format=mo[e].convertedFormat}}function md(t){const e=t.byteLength/3,r=new Uint32Array(e);for(let n=0;n<e;++n)r[n]=t[n*3]+(t[n*3+1]<<8)+(t[n*3+2]<<16)+4278190080;return new Uint8Array(r.buffer)}const ri={jsUrl:"",wasmUrl:""};let bd,bo,vo;async function vd(){if(!vo){const t=new URL(ri.jsUrl,location.origin).href,e=new URL(ri.wasmUrl,location.origin).href;importScripts(t),vo=new Promise(r=>{LIBKTX({locateFile:n=>e}).then(n=>{r(n)})})}return vo}async function Zy(t,e){const r=await fetch(t);if(r.ok){const n=await r.arrayBuffer();return new e.ktxTexture(new Uint8Array(n))}throw new Error(`Failed to load KTX(2) texture: ${t}`)}const qy=["etc2-rgba8unorm","bc7-rgba-unorm","bc3-rgba-unorm","astc-4x4-unorm","rgba8unorm"];async function Ky(t){const e=await vd(),r=await Zy(t,e);let n;if(r.needsTranscoding){n=bo;const o=e.TranscodeTarget[bd];if(r.transcodeBasis(o,0)!==e.ErrorCode.SUCCESS)throw new Error("Unable to transcode basis texture.")}else n=pd(r);const i=hd(r),s={width:r.baseWidth,height:r.baseHeight,format:n,mipLevelCount:r.numLevels,resource:i};return Yy(s),s}async function Jy(t,e,r){t&&(ri.jsUrl=t),e&&(ri.wasmUrl=e),bo=qy.filter(n=>r.includes(n))[0],bd=gd(bo),await vd()}const Qy={init:async t=>{const{jsUrl:e,wasmUrl:r,supportedTextures:n}=t;await Jy(e,r,n)},load:async t=>{var e;try{const r=await Ky(t.url);return{type:"load",url:t.url,success:!0,textureOptions:r,transferables:(e=r.resource)==null?void 0:e.map(n=>n.buffer)}}catch(r){throw r}}};self.onmessage=async t=>{const e=t.data,r=await Qy[e.type](e);r&&self.postMessage(r,r.transferables)};class e_{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this._tickerAdded||!this.domElement||(ve.system.add(this._tickerUpdate,this,ht.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(ve.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events._rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}_tickerUpdate(e){this._deltaTime+=e.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}}const Ke=new e_;class Br extends Lt{constructor(){super(...arguments),this.client=new Y,this.movement=new Y,this.offset=new Y,this.global=new Y,this.screen=new Y}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,r,n){return e.worldTransform.applyInverse(n||this.global,r)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,r,n,i,s,o,a,u,l,c,d,p,f,g,b){throw new Error("Method not implemented.")}}class Pe extends Br{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class St extends Br{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}St.DOM_DELTA_PIXEL=0,St.DOM_DELTA_LINE=1,St.DOM_DELTA_PAGE=2;const t_=2048,r_=new Y,Mr=new Y;class yd{constructor(e){this.dispatch=new ge,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,r){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:r,priority:0}),this.mappingTable[e].sort((n,i)=>n.priority-i.priority)}dispatchEvent(e,r){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,r),this.dispatch.emit(r||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const r=this.mappingTable[e.type];if(r)for(let n=0,i=r.length;n<i;n++)r[n].fn(e)}hitTest(e,r){Ke.pauseUpdate=!0;const n=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",i=this[n](this.rootTarget,this.rootTarget.eventMode,r_.set(e,r),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(e,r){if(!e.target)return;const n=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let i=0,s=n.length-1;i<s;i++)if(e.currentTarget=n[i],this.notifyTarget(e,r),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,r),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let i=n.length-2;i>=0;i--)if(e.currentTarget=n[i],this.notifyTarget(e,r),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,r,n=this._allInteractiveElements){if(n.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const i=Array.isArray(r)?r:[r];for(let s=n.length-1;s>=0;s--)i.forEach(o=>{e.currentTarget=n[s],this.notifyTarget(e,o)})}propagationPath(e){const r=[e];for(let n=0;n<t_&&e!==this.rootTarget&&e.parent;n++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");r.push(e.parent),e=e.parent}return r.reverse(),r}hitTestMoveRecursive(e,r,n,i,s,o=!1){let a=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||r==="dynamic")&&(Ke.pauseUpdate=!1),e.interactiveChildren&&e.children){const c=e.children;for(let d=c.length-1;d>=0;d--){const p=c[d],f=this.hitTestMoveRecursive(p,this._isInteractive(r)?r:p.eventMode,n,i,s,o||s(e,n));if(f){if(f.length>0&&!f[f.length-1].parent)continue;const g=e.isInteractive();(f.length>0||g)&&(g&&this._allInteractiveElements.push(e),f.push(e)),this._hitElements.length===0&&(this._hitElements=f),a=!0}}}const u=this._isInteractive(r),l=e.isInteractive();return l&&l&&this._allInteractiveElements.push(e),o||this._hitElements.length>0?null:a?this._hitElements:u&&!s(e,n)&&i(e,n)?l?[e]:[]:null}hitTestRecursive(e,r,n,i,s){if(this._interactivePrune(e)||s(e,n))return null;if((e.eventMode==="dynamic"||r==="dynamic")&&(Ke.pauseUpdate=!1),e.interactiveChildren&&e.children){const u=e.children,l=n;for(let c=u.length-1;c>=0;c--){const d=u[c],p=this.hitTestRecursive(d,this._isInteractive(r)?r:d.eventMode,l,i,s);if(p){if(p.length>0&&!p[p.length-1].parent)continue;const f=e.isInteractive();return(p.length>0||f)&&p.push(e),p}}}const o=this._isInteractive(r),a=e.isInteractive();return o&&i(e,n)?a?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!e||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren}hitPruneFn(e,r){if(e.hitArea&&(e.worldTransform.applyInverse(r,Mr),!e.hitArea.contains(Mr.x,Mr.y)))return!0;if(e.effects&&e.effects.length)for(let n=0;n<e.effects.length;n++){const i=e.effects[n];if(i.containsPoint&&!i.containsPoint(r,this.hitTestFn))return!0}return!1}hitTestFn(e,r){var n;return e.hitArea?!0:(n=e.view)!=null&&n.containsPoint?(e.worldTransform.applyInverse(r,Mr),e.view.containsPoint(Mr)):!1}notifyTarget(e,r){var n,i;r=r!=null?r:e.type;const s=`on${r}`;(i=(n=e.currentTarget)[s])==null||i.call(n,e);const o=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${r}capture`:r;this._notifyListeners(e,o),e.eventPhase===e.AT_TARGET&&this._notifyListeners(e,r)}mapPointerDown(e){if(!(e instanceof Pe))return;const r=this.createPointerEvent(e);if(this.dispatchEvent(r,"pointerdown"),r.pointerType==="touch")this.dispatchEvent(r,"touchstart");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const i=r.button===2;this.dispatchEvent(r,i?"rightdown":"mousedown")}const n=this.trackingData(e.pointerId);n.pressTargetsByButton[e.button]=r.composedPath(),this.freeEvent(r)}mapPointerMove(e){var r,n,i;if(!(e instanceof Pe))return;this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const o=s.pointerType==="mouse"||s.pointerType==="pen",a=this.trackingData(e.pointerId),u=this.findMountedTarget(a.overTargets);if(((r=a.overTargets)==null?void 0:r.length)>0&&u!==s.target){const d=e.type==="mousemove"?"mouseout":"pointerout",p=this.createPointerEvent(e,d,u);if(this.dispatchEvent(p,"pointerout"),o&&this.dispatchEvent(p,"mouseout"),!s.composedPath().includes(u)){const f=this.createPointerEvent(e,"pointerleave",u);for(f.eventPhase=f.AT_TARGET;f.target&&!s.composedPath().includes(f.target);)f.currentTarget=f.target,this.notifyTarget(f),o&&this.notifyTarget(f,"mouseleave"),f.target=f.target.parent;this.freeEvent(f)}this.freeEvent(p)}if(u!==s.target){const d=e.type==="mousemove"?"mouseover":"pointerover",p=this.clonePointerEvent(s,d);this.dispatchEvent(p,"pointerover"),o&&this.dispatchEvent(p,"mouseover");let f=u==null?void 0:u.parent;for(;f&&f!==this.rootTarget.parent&&f!==s.target;)f=f.parent;if(!f||f===this.rootTarget.parent){const g=this.clonePointerEvent(s,"pointerenter");for(g.eventPhase=g.AT_TARGET;g.target&&g.target!==u&&g.target!==this.rootTarget.parent;)g.currentTarget=g.target,this.notifyTarget(g),o&&this.notifyTarget(g,"mouseenter"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(p)}const l=[],c=(n=this.enableGlobalMoveEvents)!=null?n:!0;this.moveOnAll?l.push("pointermove"):this.dispatchEvent(s,"pointermove"),c&&l.push("globalpointermove"),s.pointerType==="touch"&&(this.moveOnAll?l.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),c&&l.push("globaltouchmove")),o&&(this.moveOnAll?l.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),c&&l.push("globalmousemove"),this.cursor=(i=s.target)==null?void 0:i.cursor),l.length>0&&this.all(s,l),this._allInteractiveElements.length=0,this._hitElements.length=0,a.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(e){var r;if(!(e instanceof Pe))return;const n=this.trackingData(e.pointerId),i=this.createPointerEvent(e),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=(r=i.target)==null?void 0:r.cursor);const o=this.clonePointerEvent(i,"pointerenter");for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),s&&this.notifyTarget(o,"mouseenter"),o.target=o.target.parent;n.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(o)}mapPointerOut(e){if(!(e instanceof Pe))return;const r=this.trackingData(e.pointerId);if(r.overTargets){const n=e.pointerType==="mouse"||e.pointerType==="pen",i=this.findMountedTarget(r.overTargets),s=this.createPointerEvent(e,"pointerout",i);this.dispatchEvent(s),n&&this.dispatchEvent(s,"mouseout");const o=this.createPointerEvent(e,"pointerleave",i);for(o.eventPhase=o.AT_TARGET;o.target&&o.target!==this.rootTarget.parent;)o.currentTarget=o.target,this.notifyTarget(o),n&&this.notifyTarget(o,"mouseleave"),o.target=o.target.parent;r.overTargets=null,this.freeEvent(s),this.freeEvent(o)}this.cursor=null}mapPointerUp(e){if(!(e instanceof Pe))return;const r=performance.now(),n=this.createPointerEvent(e);if(this.dispatchEvent(n,"pointerup"),n.pointerType==="touch")this.dispatchEvent(n,"touchend");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const a=n.button===2;this.dispatchEvent(n,a?"rightup":"mouseup")}const i=this.trackingData(e.pointerId),s=this.findMountedTarget(i.pressTargetsByButton[e.button]);let o=s;if(s&&!n.composedPath().includes(s)){let a=s;for(;a&&!n.composedPath().includes(a);){if(n.currentTarget=a,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch")this.notifyTarget(n,"touchendoutside");else if(n.pointerType==="mouse"||n.pointerType==="pen"){const u=n.button===2;this.notifyTarget(n,u?"rightupoutside":"mouseupoutside")}a=a.parent}delete i.pressTargetsByButton[e.button],o=a}if(o){const a=this.clonePointerEvent(n,"click");a.target=o,a.path=null,i.clicksByButton[e.button]||(i.clicksByButton[e.button]={clickCount:0,target:a.target,timeStamp:r});const u=i.clicksByButton[e.button];if(u.target===a.target&&r-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=a.target,u.timeStamp=r,a.detail=u.clickCount,a.pointerType==="mouse"){const l=a.button===2;this.dispatchEvent(a,l?"rightclick":"click")}else a.pointerType==="touch"&&this.dispatchEvent(a,"tap");this.dispatchEvent(a,"pointertap"),this.freeEvent(a)}this.freeEvent(n)}mapPointerUpOutside(e){if(!(e instanceof Pe))return;const r=this.trackingData(e.pointerId),n=this.findMountedTarget(r.pressTargetsByButton[e.button]),i=this.createPointerEvent(e);if(n){let s=n;for(;s;)i.currentTarget=s,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch"?this.notifyTarget(i,"touchendoutside"):(i.pointerType==="mouse"||i.pointerType==="pen")&&this.notifyTarget(i,i.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete r.pressTargetsByButton[e.button]}this.freeEvent(i)}mapWheel(e){if(!(e instanceof St))return;const r=this.createWheelEvent(e);this.dispatchEvent(r),this.freeEvent(r)}findMountedTarget(e){if(!e)return null;let r=e[0];for(let n=1;n<e.length&&e[n].parent===r;n++)r=e[n];return r}createPointerEvent(e,r,n){var i;const s=this.allocateEvent(Pe);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=(i=n!=null?n:this.hitTest(s.global.x,s.global.y))!=null?i:this._hitElements[0],typeof r=="string"&&(s.type=r),s}createWheelEvent(e){const r=this.allocateEvent(St);return this.copyWheelData(e,r),this.copyMouseData(e,r),this.copyData(e,r),r.nativeEvent=e.nativeEvent,r.originalEvent=e,r.target=this.hitTest(r.global.x,r.global.y),r}clonePointerEvent(e,r){const n=this.allocateEvent(Pe);return n.nativeEvent=e.nativeEvent,n.originalEvent=e.originalEvent,this.copyPointerData(e,n),this.copyMouseData(e,n),this.copyData(e,n),n.target=e.target,n.path=e.composedPath().slice(),n.type=r!=null?r:n.type,n}copyWheelData(e,r){r.deltaMode=e.deltaMode,r.deltaX=e.deltaX,r.deltaY=e.deltaY,r.deltaZ=e.deltaZ}copyPointerData(e,r){e instanceof Pe&&r instanceof Pe&&(r.pointerId=e.pointerId,r.width=e.width,r.height=e.height,r.isPrimary=e.isPrimary,r.pointerType=e.pointerType,r.pressure=e.pressure,r.tangentialPressure=e.tangentialPressure,r.tiltX=e.tiltX,r.tiltY=e.tiltY,r.twist=e.twist)}copyMouseData(e,r){e instanceof Br&&r instanceof Br&&(r.altKey=e.altKey,r.button=e.button,r.buttons=e.buttons,r.client.copyFrom(e.client),r.ctrlKey=e.ctrlKey,r.metaKey=e.metaKey,r.movement.copyFrom(e.movement),r.screen.copyFrom(e.screen),r.shiftKey=e.shiftKey,r.global.copyFrom(e.global))}copyData(e,r){r.isTrusted=e.isTrusted,r.srcElement=e.srcElement,r.timeStamp=performance.now(),r.type=e.type,r.detail=e.detail,r.view=e.view,r.which=e.which,r.layer.copyFrom(e.layer),r.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const r=this.eventPool.get(e).pop()||new e(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=null,r.target=null,r}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const r=e.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(e)}_notifyListeners(e,r){const n=e.currentTarget._events[r];if(n&&e.currentTarget.isInteractive())if("fn"in n)n.once&&e.currentTarget.removeListener(r,n.fn,void 0,!0),n.fn.call(n.context,e);else for(let i=0,s=n.length;i<s&&!e.propagationImmediatelyStopped;i++)n[i].once&&e.currentTarget.removeListener(r,n[i].fn,void 0,!0),n[i].fn.call(n[i].context,e)}}var n_=Object.defineProperty,_d=Object.getOwnPropertySymbols,i_=Object.prototype.hasOwnProperty,s_=Object.prototype.propertyIsEnumerable,xd=(t,e,r)=>e in t?n_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,o_=(t,e)=>{for(var r in e||(e={}))i_.call(e,r)&&xd(t,r,e[r]);if(_d)for(var r of _d(e))s_.call(e,r)&&xd(t,r,e[r]);return t};const a_=1,u_={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},yo=class{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new yd(null),Ke.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new Pe(null),this._rootWheelEvent=new St(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy(o_({},yo.defaultEventFeatures),{set:(e,r,n)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[r]=n,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){var e,r;const{canvas:n,resolution:i}=this.renderer;this.setTargetElement(n),this.resolution=i,yo._defaultEventMode=(e=t.eventMode)!=null?e:"passive",Object.assign(this.features,(r=t.eventFeatures)!=null?r:{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this._currentCursor===t)return;this._currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const i=e[r],s=this._bootstrapEvent(this._rootPointerEvent,i);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Ke.pointerMoved();const e=this._normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const i=this._bootstrapEvent(this._rootPointerEvent,e[r]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this._normalizeToPointerData(t);for(let i=0,s=n.length;i<s;i++){const o=this._bootstrapEvent(this._rootPointerEvent,n[i]);o.type+=r,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this._normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const i=this._bootstrapEvent(this._rootPointerEvent,e[r]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this._removeEvents(),this.domElement=t,Ke.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;Ke.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;Ke.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},i=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*i,t.y=(r-n.top)*(this.domElement.height/n.height)*i}_normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const i=t.changedTouches[r];typeof i.button=="undefined"&&(i.button=0),typeof i.buttons=="undefined"&&(i.buttons=1),typeof i.isPrimary=="undefined"&&(i.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof i.width=="undefined"&&(i.width=i.radiusX||1),typeof i.height=="undefined"&&(i.height=i.radiusY||1),typeof i.tiltX=="undefined"&&(i.tiltX=0),typeof i.tiltY=="undefined"&&(i.tiltY=0),typeof i.pointerType=="undefined"&&(i.pointerType="touch"),typeof i.pointerId=="undefined"&&(i.pointerId=i.identifier||0),typeof i.pressure=="undefined"&&(i.pressure=i.force||.5),typeof i.twist=="undefined"&&(i.twist=0),typeof i.tangentialPressure=="undefined"&&(i.tangentialPressure=0),typeof i.layerX=="undefined"&&(i.layerX=i.offsetX=i.clientX),typeof i.layerY=="undefined"&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,i.type=t.type,e.push(i)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary=="undefined"&&(r.isPrimary=!0),typeof r.width=="undefined"&&(r.width=1),typeof r.height=="undefined"&&(r.height=1),typeof r.tiltX=="undefined"&&(r.tiltX=0),typeof r.tiltY=="undefined"&&(r.tiltY=0),typeof r.pointerType=="undefined"&&(r.pointerType="mouse"),typeof r.pointerId=="undefined"&&(r.pointerId=a_),typeof r.pressure=="undefined"&&(r.pressure=.5),typeof r.twist=="undefined"&&(r.twist=0),typeof r.tangentialPressure=="undefined"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this._rootWheelEvent;return this._transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}_bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this._transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=u_[t.type]||t.type),t}_transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};let Dr=yo;Dr.extension={name:"events",type:[v.WebGLSystem,v.CanvasSystem,v.WebGPUSystem],priority:-1},Dr.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};const Ad={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(t){this.eventMode=t?"static":"passive"},_internalEventMode:void 0,get eventMode(){var t;return(t=this._internalEventMode)!=null?t:Dr.defaultEventMode},set eventMode(t){this._internalEventMode=t},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(t,e,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof e=="function"?void 0:e;t=n?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.on(t,e,i)},removeEventListener(t,e,r){const n=typeof r=="boolean"&&r||typeof r=="object"&&r.capture,i=typeof e=="function"?void 0:e;t=n?`${t}capture`:t,e=typeof e=="function"?e:e.handleEvent,this.off(t,e,i)},dispatchEvent(t){if(!(t instanceof Lt))throw new Error("Container cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};V.add(Dr),K.mixin(Ad);const Rr=class{constructor(t,e){this.linkedSheets=[],this._texture=t instanceof E?t:null,this.textureSource=t.source,this.textures={},this.animations={},this.data=e;const r=parseFloat(e.meta.scale);r?(this.resolution=r,t.source.resolution=this.resolution):this.resolution=t.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Rr.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Rr.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const n=this._frameKeys[e],i=this._frames[n],s=i.frame;if(s){let o=null,a=null;const u=i.trimmed!==!1&&i.sourceSize?i.sourceSize:i.frame,l=new te(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);i.rotated?o=new te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):o=new te(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),i.trimmed!==!1&&i.spriteSourceSize&&(a=new te(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),a.x/=this.textureSource.width,a.y/=this.textureSource.height,a.width/=this.textureSource.width,a.height/=this.textureSource.height),o.x/=this.textureSource.width,o.y/=this.textureSource.height,o.width/=this.textureSource.width,o.height/=this.textureSource.height,l.x/=this.textureSource.width,l.y/=this.textureSource.height,l.width/=this.textureSource.width,l.height/=this.textureSource.height,this.textures[n]=new E({source:this.textureSource,layout:{frame:o,orig:l,trim:a,rotate:i.rotated?2:0,defaultAnchor:i.anchor,defaultBorders:i.borders},label:n.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Rr.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Rr.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};let ni=Rr;ni.BATCH_SIZE=1e3;const l_=["jpg","png","jpeg","avif","webp"];function Cd(t,e,r){const n={};if(t.forEach(i=>{n[i]=e}),Object.keys(e.textures).forEach(i=>{n[i]=e.textures[i]}),!r){const i=ye.dirname(t[0]);e.linkedSheets.forEach((s,o)=>{const a=Cd([`${i}/${e.data.meta.related_multi_packs[o]}`],s,!0);Object.assign(n,a)})}return n}const wd={extension:v.Asset,cache:{test:t=>t instanceof ni,getCacheableAssets:(t,e)=>Cd(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),r=e.pop(),n=e.pop();return r==="json"&&l_.includes(n)},parse:t=>{var e,r;const n=t.split(".");return{resolution:parseFloat((r=(e=dt.RETINA_PREFIX.exec(t))==null?void 0:e[1])!=null?r:"1"),format:n[n.length-2],src:t}}},loader:{name:"spritesheetLoader",extension:{type:v.LoadParser,priority:Ie.Normal},async testParse(t,e){return ye.extname(e.src).toLowerCase()===".json"&&!!t.frames},async parse(t,e,r){var n,i;let s=ye.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let o=s+t.meta.image;o=kn(o,e.src);const a=(await r.load([o]))[o],u=new ni(a.source,t);await u.parse();const l=(n=t==null?void 0:t.meta)==null?void 0:n.related_multi_packs;if(Array.isArray(l)){const c=[];for(const p of l){if(typeof p!="string")continue;let f=s+p;(i=e.data)!=null&&i.ignoreMultiPack||(f=kn(f,e.src),c.push(r.load({src:f,data:{ignoreMultiPack:!0}})))}const d=await Promise.all(c);u.linkedSheets=d,d.forEach(p=>{p.linkedSheets=[u].concat(u.linkedSheets.filter(f=>f!==p))})}return u},unload(t){t.destroy(!0)}}};V.add(wd);const Xt={onViewUpdate:()=>{}};function Fr(t,e,r,n){const i=r._source,s=r.layout,o=s.orig,a=s.trim,u=i.width,l=i.height,c=u*o.width,d=l*o.height;if(a){const p=u*a.width,f=l*a.height;t[0]=a.x*u-e._x*c-n,t[1]=t[0]+p,t[2]=a.y*l-e._y*d-n,t[3]=t[2]+f}else t[0]=-e._x*c-n,t[1]=t[0]+c,t[2]=-e._y*d-n,t[3]=t[2]+d}class Td{constructor(e){this.renderPipeId="sprite",this.owner=Xt,this.uid=J("spriteView"),this.batched=!0,this._didUpdate=!1,this._bounds=[0,1,0,0],this._sourceBounds=[0,1,0,0],this._boundsDirty=!0,this._sourceBoundsDirty=!0,this.roundPixels=0;var r,n;this.anchor=new ue(this,((r=e.layout.defaultAnchor)==null?void 0:r.x)||0,((n=e.layout.defaultAnchor)==null?void 0:n.y)||0),this.texture=e}set texture(e){e||(e=E.EMPTY),this._texture!==e&&(this._texture&&this._texture.off("update",this.onUpdate,this),e.on("update",this.onUpdate,this),this._texture=e,this.onUpdate())}get texture(){return this._texture}get bounds(){return this._boundsDirty&&(this._updateBounds(),this._boundsDirty=!1),this._bounds}get sourceBounds(){return this._sourceBoundsDirty&&(this._updateSourceBounds(),this._sourceBoundsDirty=!1),this._sourceBounds}containsPoint(e){const r=this._texture.frameWidth,n=this._texture.frameHeight,i=-r*this.anchor.x;let s=0;return e.x>=i&&e.x<i+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<s+n)}addBounds(e){if(this._texture._layout.trim){const r=this.sourceBounds;e.addFrame(r[0],r[2],r[1],r[3])}else{const r=this.bounds;e.addFrame(r[0],r[2],r[1],r[3])}}onUpdate(){this._didUpdate=!0,this._sourceBoundsDirty=this._boundsDirty=!0,this.owner.onViewUpdate()}_updateBounds(){Fr(this._bounds,this.anchor,this._texture,0)}_updateSourceBounds(){const e=this.anchor,r=this._texture,n=r._source,i=r.layout.orig,s=this._sourceBounds,o=n.width*i.width,a=n.height*i.height;s[1]=-e._x*o,s[0]=s[1]+o,s[3]=-e._y*a,s[2]=s[3]+a}destroy(e=!1){if(this.anchor=null,typeof e=="boolean"?e:e==null?void 0:e.texture){const r=typeof e=="boolean"?e:e==null?void 0:e.textureSource;this._texture.destroy(r)}this._texture=null,this._bounds=null,this._sourceBounds=null}}var c_=Object.defineProperty,ii=Object.getOwnPropertySymbols,Sd=Object.prototype.hasOwnProperty,Ed=Object.prototype.propertyIsEnumerable,Id=(t,e,r)=>e in t?c_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h_=(t,e)=>{for(var r in e||(e={}))Sd.call(e,r)&&Id(t,r,e[r]);if(ii)for(var r of ii(e))Ed.call(e,r)&&Id(t,r,e[r]);return t},d_=(t,e)=>{var r={};for(var n in t)Sd.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&ii)for(var n of ii(t))e.indexOf(n)<0&&Ed.call(t,n)&&(r[n]=t[n]);return r};class $e extends K{static from(e){return typeof e=="string"?new $e(re.get(e)):new $e(e)}constructor(e=E.EMPTY){e instanceof E&&(e={texture:e});const r=e,{texture:n}=r,i=d_(r,["texture"]);super(h_({view:new Td(n!=null?n:E.EMPTY),label:"Sprite"},i)),this.allowChildren=!1}get anchor(){return this.view.anchor}set anchor(e){this.view.anchor.x=e.x,this.view.anchor.y=e.y}get texture(){return this.view.texture}set texture(e){this.view.texture=e}get roundPixels(){return!!this.view.roundPixels}set roundPixels(e){this.view.roundPixels=e?1:0}}const f_=new be;function si(t,e,r){const n=f_;t.measurable=!0,br(t,r,n),e.addBoundsMask(n),t.measurable=!1}function oi(t,e,r){const n=new be;t.measurable=!0;const i=_o(t,r,new R);nt(t,n,i),t.measurable=!1,e.addBoundsMask(n)}function _o(t,e,r){return t&&t!==e&&(_o(t.parent,e,r),t.didChange&&Ye(t.localTransform,t),r.append(t.localTransform)),r}class xo{constructor(e){this.priority=0,this.pipe="alphaMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e,this.renderMaskToTexture=!(e instanceof $e),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(e,r){si(this.mask,e,r)}addLocalBounds(e,r){oi(this.mask,e,r)}containsPoint(e,r){const n=this.mask;return r(n,e)}destroy(){this.reset()}static test(e){return e instanceof $e}}xo.extension=v.MaskEffect;class Ao{constructor(e){this.priority=0,this.pipe="colorMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e}destroy(){}static test(e){return typeof e=="number"}}Ao.extension=v.MaskEffect;class Co{constructor(e){this.priority=0,this.pipe="stencilMask",e!=null&&e.mask&&this.init(e.mask)}init(e){this.mask=e,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(e,r){si(this.mask,e,r)}addLocalBounds(e,r){oi(this.mask,e,r)}containsPoint(e,r){const n=this.mask;return r(n,e)}destroy(){this.reset()}static test(e){return e instanceof K}}Co.extension=v.MaskEffect;var p_=Object.defineProperty,g_=Object.defineProperties,m_=Object.getOwnPropertyDescriptors,Pd=Object.getOwnPropertySymbols,b_=Object.prototype.hasOwnProperty,v_=Object.prototype.propertyIsEnumerable,Bd=(t,e,r)=>e in t?p_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,y_=(t,e)=>{for(var r in e||(e={}))b_.call(e,r)&&Bd(t,r,e[r]);if(Pd)for(var r of Pd(e))v_.call(e,r)&&Bd(t,r,e[r]);return t},__=(t,e)=>g_(t,m_(e));class wo extends fe{constructor(e){const r=e.resource||new Float32Array(e.width*e.height*4);let n=e.format;n||(r instanceof Float32Array?n="rgba32float":r instanceof Int32Array||r instanceof Uint32Array?n="rgba32uint":r instanceof Int16Array||r instanceof Uint16Array?n="rgba16uint":(r instanceof Int8Array,n="bgra8unorm")),super(__(y_({},e),{resource:r,format:n})),this.uploadMethodId="buffer"}static test(e){return e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}wo.extension=v.TextureSource;class ai extends fe{constructor(e){var r;e.resource||(e.resource=Z.get().createCanvas()),e.width||(e.width=e.resource.width,e.autoDensity||(e.width/=e.resolution)),e.height||(e.height=e.resource.height,e.autoDensity||(e.height/=e.resolution)),(r=e.alphaMode)!=null||(e.alphaMode="premultiply-alpha-on-upload"),super(e),this.uploadMethodId="image",this.autoDensity=e.autoDensity;const n=e.resource;(this.pixelWidth!==n.width||this.pixelWidth!==n.height)&&this.resizeCanvas()}resizeCanvas(){this.autoDensity&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight}resize(e=this.width,r=this.height,n=this._resolution){super.resize(e,r,n),this.resizeCanvas()}static test(e){return globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&e instanceof OffscreenCanvas}}ai.extension=v.TextureSource,V.add(xo,Ao,Co,st,xt,ai,wo);var x_={__proto__:null};function A_(t,e,r){if(r===void 0&&(r=Array.prototype),t&&typeof r.find=="function")return r.find.call(t,e);for(var n=0;n<t.length;n++)if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[n];if(e.call(void 0,i,n,t))return i}}function To(t,e){return e===void 0&&(e=Object),e&&typeof e.freeze=="function"?e.freeze(t):t}function C_(t,e){if(t===null||typeof t!="object")throw new TypeError("target is not an object");for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}var Md=To({HTML:"text/html",isHTML:function(t){return t===Md.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),Dd=To({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(t){return t===Dd.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"}),w_=C_,T_=A_,S_=To,E_=Md,I_=Dd,Gr={assign:w_,find:T_,freeze:S_,MIME_TYPE:E_,NAMESPACE:I_},Ve=Gr.find,kr=Gr.NAMESPACE;function P_(t){return t!==""}function B_(t){return t?t.split(/[\t\n\f\r ]+/).filter(P_):[]}function M_(t,e){return t.hasOwnProperty(e)||(t[e]=!0),t}function Rd(t){if(!t)return[];var e=B_(t);return Object.keys(e.reduce(M_,{}))}function D_(t){return function(e){return t&&t.indexOf(e)!==-1}}function Or(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}function _e(t,e){var r=t.prototype;if(!(r instanceof e)){let n=function(){};n.prototype=e.prototype,n=new n,Or(r,n),t.prototype=r=n}r.constructor!=t&&(typeof t!="function"&&console.error("unknown Class:"+t),r.constructor=t)}var xe={},ke=xe.ELEMENT_NODE=1,jt=xe.ATTRIBUTE_NODE=2,ui=xe.TEXT_NODE=3,Fd=xe.CDATA_SECTION_NODE=4,Gd=xe.ENTITY_REFERENCE_NODE=5,R_=xe.ENTITY_NODE=6,kd=xe.PROCESSING_INSTRUCTION_NODE=7,Od=xe.COMMENT_NODE=8,Ud=xe.DOCUMENT_NODE=9,Ld=xe.DOCUMENT_TYPE_NODE=10,Je=xe.DOCUMENT_FRAGMENT_NODE=11,F_=xe.NOTATION_NODE=12,me={},de={},fT=me.INDEX_SIZE_ERR=(de[1]="Index size error",1),pT=me.DOMSTRING_SIZE_ERR=(de[2]="DOMString size error",2),Ae=me.HIERARCHY_REQUEST_ERR=(de[3]="Hierarchy request error",3),gT=me.WRONG_DOCUMENT_ERR=(de[4]="Wrong document",4),mT=me.INVALID_CHARACTER_ERR=(de[5]="Invalid character",5),bT=me.NO_DATA_ALLOWED_ERR=(de[6]="No data allowed",6),vT=me.NO_MODIFICATION_ALLOWED_ERR=(de[7]="No modification allowed",7),Nd=me.NOT_FOUND_ERR=(de[8]="Not found",8),yT=me.NOT_SUPPORTED_ERR=(de[9]="Not supported",9),$d=me.INUSE_ATTRIBUTE_ERR=(de[10]="Attribute in use",10),_T=me.INVALID_STATE_ERR=(de[11]="Invalid state",11),xT=me.SYNTAX_ERR=(de[12]="Syntax error",12),AT=me.INVALID_MODIFICATION_ERR=(de[13]="Invalid modification",13),CT=me.NAMESPACE_ERR=(de[14]="Invalid namespace",14),wT=me.INVALID_ACCESS_ERR=(de[15]="Invalid access",15);function se(t,e){if(e instanceof Error)var r=e;else r=this,Error.call(this,de[t]),this.message=de[t],Error.captureStackTrace&&Error.captureStackTrace(this,se);return r.code=t,e&&(this.message=this.message+": "+e),r}se.prototype=Error.prototype,Or(me,se);function Qe(){}Qe.prototype={length:0,item:function(t){return t>=0&&t<this.length?this[t]:null},toString:function(t,e){for(var r=[],n=0;n<this.length;n++)Zt(this[n],r,t,e);return r.join("")},filter:function(t){return Array.prototype.filter.call(this,t)},indexOf:function(t){return Array.prototype.indexOf.call(this,t)}};function Yt(t,e){this._node=t,this._refresh=e,So(this)}function So(t){var e=t._node._inc||t._node.ownerDocument._inc;if(t._inc!==e){var r=t._refresh(t._node);if(sf(t,"length",r.length),!t.$$length||r.length<t.$$length)for(var n=r.length;n in t;n++)Object.prototype.hasOwnProperty.call(t,n)&&delete t[n];Or(r,t),t._inc=e}}Yt.prototype.item=function(t){return So(this),this[t]||null},_e(Yt,Qe);function li(){}function Vd(t,e){for(var r=t.length;r--;)if(t[r]===e)return r}function zd(t,e,r,n){if(n?e[Vd(e,n)]=r:e[e.length++]=r,t){r.ownerElement=t;var i=t.ownerDocument;i&&(n&&jd(i,t,n),G_(i,t,r))}}function Hd(t,e,r){var n=Vd(e,r);if(n>=0){for(var i=e.length-1;n<i;)e[n]=e[++n];if(e.length=i,t){var s=t.ownerDocument;s&&(jd(s,t,r),r.ownerElement=null)}}else throw new se(Nd,new Error(t.tagName+"@"+r))}li.prototype={length:0,item:Qe.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var r=this[e];if(r.nodeName==t)return r}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new se($d);var r=this.getNamedItem(t.nodeName);return zd(this._ownerElement,this,t,r),r},setNamedItemNS:function(t){var e=t.ownerElement,r;if(e&&e!=this._ownerElement)throw new se($d);return r=this.getNamedItemNS(t.namespaceURI,t.localName),zd(this._ownerElement,this,t,r),r},removeNamedItem:function(t){var e=this.getNamedItem(t);return Hd(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var r=this.getNamedItemNS(t,e);return Hd(this._ownerElement,this,r),r},getNamedItemNS:function(t,e){for(var r=this.length;r--;){var n=this[r];if(n.localName==e&&n.namespaceURI==t)return n}return null}};function Wd(){}Wd.prototype={hasFeature:function(t,e){return!0},createDocument:function(t,e,r){var n=new Lr;if(n.implementation=this,n.childNodes=new Qe,n.doctype=r||null,r&&n.appendChild(r),e){var i=n.createElementNS(t,e);n.appendChild(i)}return n},createDocumentType:function(t,e,r){var n=new di;return n.name=t,n.nodeName=t,n.publicId=e||"",n.systemId=r||"",n}};function j(){}j.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return ci(this,t,e)},replaceChild:function(t,e){ci(this,t,e,Kd),e&&this.removeChild(e)},removeChild:function(t){return Yd(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(t){return Go(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==ui&&t.nodeType==ui?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var r=e._nsMap;if(r){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)&&r[n]===t)return n}e=e.nodeType==jt?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var r=e._nsMap;if(r&&Object.prototype.hasOwnProperty.call(r,t))return r[t];e=e.nodeType==jt?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){var e=this.lookupPrefix(t);return e==null}};function Xd(t){return t=="<"&&"&lt;"||t==">"&&"&gt;"||t=="&"&&"&amp;"||t=='"'&&"&quot;"||"&#"+t.charCodeAt()+";"}Or(xe,j),Or(xe,j.prototype);function Ur(t,e){if(e(t))return!0;if(t=t.firstChild)do if(Ur(t,e))return!0;while(t=t.nextSibling)}function Lr(){this.ownerDocument=this}function G_(t,e,r){t&&t._inc++;var n=r.namespaceURI;n===kr.XMLNS&&(e._nsMap[r.prefix?r.localName:""]=r.value)}function jd(t,e,r,n){t&&t._inc++;var i=r.namespaceURI;i===kr.XMLNS&&delete e._nsMap[r.prefix?r.localName:""]}function Eo(t,e,r){if(t&&t._inc){t._inc++;var n=e.childNodes;if(r)n[n.length++]=r;else{for(var i=e.firstChild,s=0;i;)n[s++]=i,i=i.nextSibling;n.length=s,delete n[n.length]}}}function Yd(t,e){var r=e.previousSibling,n=e.nextSibling;return r?r.nextSibling=n:t.firstChild=n,n?n.previousSibling=r:t.lastChild=r,e.parentNode=null,e.previousSibling=null,e.nextSibling=null,Eo(t.ownerDocument,t),e}function k_(t){return t&&(t.nodeType===j.DOCUMENT_NODE||t.nodeType===j.DOCUMENT_FRAGMENT_NODE||t.nodeType===j.ELEMENT_NODE)}function O_(t){return t&&(ze(t)||Io(t)||et(t)||t.nodeType===j.DOCUMENT_FRAGMENT_NODE||t.nodeType===j.COMMENT_NODE||t.nodeType===j.PROCESSING_INSTRUCTION_NODE)}function et(t){return t&&t.nodeType===j.DOCUMENT_TYPE_NODE}function ze(t){return t&&t.nodeType===j.ELEMENT_NODE}function Io(t){return t&&t.nodeType===j.TEXT_NODE}function Zd(t,e){var r=t.childNodes||[];if(Ve(r,ze)||et(e))return!1;var n=Ve(r,et);return!(e&&n&&r.indexOf(n)>r.indexOf(e))}function qd(t,e){var r=t.childNodes||[];function n(s){return ze(s)&&s!==e}if(Ve(r,n))return!1;var i=Ve(r,et);return!(e&&i&&r.indexOf(i)>r.indexOf(e))}function U_(t,e,r){if(!k_(t))throw new se(Ae,"Unexpected parent node type "+t.nodeType);if(r&&r.parentNode!==t)throw new se(Nd,"child not in parent");if(!O_(e)||et(e)&&t.nodeType!==j.DOCUMENT_NODE)throw new se(Ae,"Unexpected node type "+e.nodeType+" for parent node type "+t.nodeType)}function L_(t,e,r){var n=t.childNodes||[],i=e.childNodes||[];if(e.nodeType===j.DOCUMENT_FRAGMENT_NODE){var s=i.filter(ze);if(s.length>1||Ve(i,Io))throw new se(Ae,"More than one element or text in fragment");if(s.length===1&&!Zd(t,r))throw new se(Ae,"Element in fragment can not be inserted before doctype")}if(ze(e)&&!Zd(t,r))throw new se(Ae,"Only one element can be added and only after doctype");if(et(e)){if(Ve(n,et))throw new se(Ae,"Only one doctype is allowed");var o=Ve(n,ze);if(r&&n.indexOf(o)<n.indexOf(r))throw new se(Ae,"Doctype can only be inserted before an element");if(!r&&o)throw new se(Ae,"Doctype can not be appended since element is present")}}function Kd(t,e,r){var n=t.childNodes||[],i=e.childNodes||[];if(e.nodeType===j.DOCUMENT_FRAGMENT_NODE){var s=i.filter(ze);if(s.length>1||Ve(i,Io))throw new se(Ae,"More than one element or text in fragment");if(s.length===1&&!qd(t,r))throw new se(Ae,"Element in fragment can not be inserted before doctype")}if(ze(e)&&!qd(t,r))throw new se(Ae,"Only one element can be added and only after doctype");if(et(e)){if(Ve(n,function(u){return et(u)&&u!==r}))throw new se(Ae,"Only one doctype is allowed");var o=Ve(n,ze);if(r&&n.indexOf(o)<n.indexOf(r))throw new se(Ae,"Doctype can only be inserted before an element")}}function ci(t,e,r,n){U_(t,e,r),t.nodeType===j.DOCUMENT_NODE&&(n||L_)(t,e,r);var i=e.parentNode;if(i&&i.removeChild(e),e.nodeType===Je){var s=e.firstChild;if(s==null)return e;var o=e.lastChild}else s=o=e;var a=r?r.previousSibling:t.lastChild;s.previousSibling=a,o.nextSibling=r,a?a.nextSibling=s:t.firstChild=s,r==null?t.lastChild=o:r.previousSibling=o;do s.parentNode=t;while(s!==o&&(s=s.nextSibling));return Eo(t.ownerDocument||t,t),e.nodeType==Je&&(e.firstChild=e.lastChild=null),e}function N_(t,e){return e.parentNode&&e.parentNode.removeChild(e),e.parentNode=t,e.previousSibling=t.lastChild,e.nextSibling=null,e.previousSibling?e.previousSibling.nextSibling=e:t.firstChild=e,t.lastChild=e,Eo(t.ownerDocument,t,e),e}Lr.prototype={nodeName:"#document",nodeType:Ud,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==Je){for(var r=t.firstChild;r;){var n=r.nextSibling;this.insertBefore(r,e),r=n}return t}return ci(this,t,e),t.ownerDocument=this,this.documentElement===null&&t.nodeType===ke&&(this.documentElement=t),t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),Yd(this,t)},replaceChild:function(t,e){ci(this,t,e,Kd),t.ownerDocument=this,e&&this.removeChild(e),ze(t)&&(this.documentElement=t)},importNode:function(t,e){return nf(this,t,e)},getElementById:function(t){var e=null;return Ur(this.documentElement,function(r){if(r.nodeType==ke&&r.getAttribute("id")==t)return e=r,!0}),e},getElementsByClassName:function(t){var e=Rd(t);return new Yt(this,function(r){var n=[];return e.length>0&&Ur(r.documentElement,function(i){if(i!==r&&i.nodeType===ke){var s=i.getAttribute("class");if(s){var o=t===s;if(!o){var a=Rd(s);o=e.every(D_(a))}o&&n.push(i)}}}),n})},createElement:function(t){var e=new Et;e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.localName=t,e.childNodes=new Qe;var r=e.attributes=new li;return r._ownerElement=e,e},createDocumentFragment:function(){var t=new fi;return t.ownerDocument=this,t.childNodes=new Qe,t},createTextNode:function(t){var e=new Po;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new Bo;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new Mo;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var r=new Ro;return r.ownerDocument=this,r.tagName=r.nodeName=r.target=t,r.nodeValue=r.data=e,r},createAttribute:function(t){var e=new hi;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new Do;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var r=new Et,n=e.split(":"),i=r.attributes=new li;return r.childNodes=new Qe,r.ownerDocument=this,r.nodeName=e,r.tagName=e,r.namespaceURI=t,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,i._ownerElement=r,r},createAttributeNS:function(t,e){var r=new hi,n=e.split(":");return r.ownerDocument=this,r.nodeName=e,r.name=e,r.namespaceURI=t,r.specified=!0,n.length==2?(r.prefix=n[0],r.localName=n[1]):r.localName=e,r}},_e(Lr,j);function Et(){this._nsMap={}}Et.prototype={nodeType:ke,hasAttribute:function(t){return this.getAttributeNode(t)!=null},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var r=this.ownerDocument.createAttribute(t);r.value=r.nodeValue=""+e,this.setAttributeNode(r)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===Je?this.insertBefore(t,null):N_(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);r&&this.removeAttributeNode(r)},hasAttributeNS:function(t,e){return this.getAttributeNodeNS(t,e)!=null},getAttributeNS:function(t,e){var r=this.getAttributeNodeNS(t,e);return r&&r.value||""},setAttributeNS:function(t,e,r){var n=this.ownerDocument.createAttributeNS(t,e);n.value=n.nodeValue=""+r,this.setAttributeNode(n)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new Yt(this,function(e){var r=[];return Ur(e,function(n){n!==e&&n.nodeType==ke&&(t==="*"||n.tagName==t)&&r.push(n)}),r})},getElementsByTagNameNS:function(t,e){return new Yt(this,function(r){var n=[];return Ur(r,function(i){i!==r&&i.nodeType===ke&&(t==="*"||i.namespaceURI===t)&&(e==="*"||i.localName==e)&&n.push(i)}),n})}},Lr.prototype.getElementsByTagName=Et.prototype.getElementsByTagName,Lr.prototype.getElementsByTagNameNS=Et.prototype.getElementsByTagNameNS,_e(Et,j);function hi(){}hi.prototype.nodeType=jt,_e(hi,j);function Nr(){}Nr.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(de[Ae])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,r){var n=this.data.substring(0,t),i=this.data.substring(t+e);r=n+r+i,this.nodeValue=this.data=r,this.length=r.length}},_e(Nr,j);function Po(){}Po.prototype={nodeName:"#text",nodeType:ui,splitText:function(t){var e=this.data,r=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var n=this.ownerDocument.createTextNode(r);return this.parentNode&&this.parentNode.insertBefore(n,this.nextSibling),n}},_e(Po,Nr);function Bo(){}Bo.prototype={nodeName:"#comment",nodeType:Od},_e(Bo,Nr);function Mo(){}Mo.prototype={nodeName:"#cdata-section",nodeType:Fd},_e(Mo,Nr);function di(){}di.prototype.nodeType=Ld,_e(di,j);function Jd(){}Jd.prototype.nodeType=F_,_e(Jd,j);function Qd(){}Qd.prototype.nodeType=R_,_e(Qd,j);function Do(){}Do.prototype.nodeType=Gd,_e(Do,j);function fi(){}fi.prototype.nodeName="#document-fragment",fi.prototype.nodeType=Je,_e(fi,j);function Ro(){}Ro.prototype.nodeType=kd,_e(Ro,j);function ef(){}ef.prototype.serializeToString=function(t,e,r){return tf.call(t,e,r)},j.prototype.toString=tf;function tf(t,e){var r=[],n=this.nodeType==9&&this.documentElement||this,i=n.prefix,s=n.namespaceURI;if(s&&i==null){var i=n.lookupPrefix(s);if(i==null)var o=[{namespace:s,prefix:null}]}return Zt(this,r,t,e,o),r.join("")}function rf(t,e,r){var n=t.prefix||"",i=t.namespaceURI;if(!i||n==="xml"&&i===kr.XML||i===kr.XMLNS)return!1;for(var s=r.length;s--;){var o=r[s];if(o.prefix===n)return o.namespace!==i}return!0}function Fo(t,e,r){t.push(" ",e,'="',r.replace(/[<>&"\t\n\r]/g,Xd),'"')}function Zt(t,e,r,n,i){if(i||(i=[]),n)if(t=n(t),t){if(typeof t=="string"){e.push(t);return}}else return;switch(t.nodeType){case ke:var s=t.attributes,o=s.length,x=t.firstChild,a=t.tagName;r=kr.isHTML(t.namespaceURI)||r;var u=a;if(!r&&!t.prefix&&t.namespaceURI){for(var l,c=0;c<s.length;c++)if(s.item(c).name==="xmlns"){l=s.item(c).value;break}if(!l)for(var d=i.length-1;d>=0;d--){var p=i[d];if(p.prefix===""&&p.namespace===t.namespaceURI){l=p.namespace;break}}if(l!==t.namespaceURI)for(var d=i.length-1;d>=0;d--){var p=i[d];if(p.namespace===t.namespaceURI){p.prefix&&(u=p.prefix+":"+a);break}}}e.push("<",u);for(var f=0;f<o;f++){var g=s.item(f);g.prefix=="xmlns"?i.push({prefix:g.localName,namespace:g.value}):g.nodeName=="xmlns"&&i.push({prefix:"",namespace:g.value})}for(var f=0;f<o;f++){var g=s.item(f);if(rf(g,r,i)){var b=g.prefix||"",m=g.namespaceURI;Fo(e,b?"xmlns:"+b:"xmlns",m),i.push({prefix:b,namespace:m})}Zt(g,e,r,n,i)}if(a===u&&rf(t,r,i)){var b=t.prefix||"",m=t.namespaceURI;Fo(e,b?"xmlns:"+b:"xmlns",m),i.push({prefix:b,namespace:m})}if(x||r&&!/^(?:meta|link|img|br|hr|input)$/i.test(a)){if(e.push(">"),r&&/^script$/i.test(a))for(;x;)x.data?e.push(x.data):Zt(x,e,r,n,i.slice()),x=x.nextSibling;else for(;x;)Zt(x,e,r,n,i.slice()),x=x.nextSibling;e.push("</",u,">")}else e.push("/>");return;case Ud:case Je:for(var x=t.firstChild;x;)Zt(x,e,r,n,i.slice()),x=x.nextSibling;return;case jt:return Fo(e,t.name,t.value);case ui:return e.push(t.data.replace(/[<&>]/g,Xd));case Fd:return e.push("<![CDATA[",t.data,"]]>");case Od:return e.push("<!--",t.data,"-->");case Ld:var y=t.publicId,_=t.systemId;if(e.push("<!DOCTYPE ",t.name),y)e.push(" PUBLIC ",y),_&&_!="."&&e.push(" ",_),e.push(">");else if(_&&_!=".")e.push(" SYSTEM ",_,">");else{var A=t.internalSubset;A&&e.push(" [",A,"]"),e.push(">")}return;case kd:return e.push("<?",t.target," ",t.data,"?>");case Gd:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function nf(t,e,r){var n;switch(e.nodeType){case ke:n=e.cloneNode(!1),n.ownerDocument=t;case Je:break;case jt:r=!0;break}if(n||(n=e.cloneNode(!1)),n.ownerDocument=t,n.parentNode=null,r)for(var i=e.firstChild;i;)n.appendChild(nf(t,i,r)),i=i.nextSibling;return n}function Go(t,e,r){var n=new e.constructor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s!="object"&&s!=n[i]&&(n[i]=s)}switch(e.childNodes&&(n.childNodes=new Qe),n.ownerDocument=t,n.nodeType){case ke:var o=e.attributes,a=n.attributes=new li,u=o.length;a._ownerElement=n;for(var l=0;l<u;l++)n.setAttributeNode(Go(t,o.item(l),!0));break;case jt:r=!0}if(r)for(var c=e.firstChild;c;)n.appendChild(Go(t,c,r)),c=c.nextSibling;return n}function sf(t,e,r){t[e]=r}try{if(Object.defineProperty){let t=function(e){switch(e.nodeType){case ke:case Je:var r=[];for(e=e.firstChild;e;)e.nodeType!==7&&e.nodeType!==8&&r.push(t(e)),e=e.nextSibling;return r.join("");default:return e.nodeValue}};Object.defineProperty(Yt.prototype,"length",{get:function(){return So(this),this.$$length}}),Object.defineProperty(j.prototype,"textContent",{get:function(){return t(this)},set:function(e){switch(this.nodeType){case ke:case Je:for(;this.firstChild;)this.removeChild(this.firstChild);(e||String(e))&&this.appendChild(this.ownerDocument.createTextNode(e));break;default:this.data=e,this.value=e,this.nodeValue=e}}}),sf=function(e,r,n){e["$$"+r]=n}}}catch(t){}var $_=di,V_=se,z_=Wd,H_=Et,W_=j,X_=Qe,j_=ef,ko={DocumentType:$_,DOMException:V_,DOMImplementation:z_,Element:H_,Node:W_,NodeList:X_,XMLSerializer:j_},of=yl(function(t,e){"use strict";var r=Gr.freeze;e.XML_ENTITIES=r({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),e.HTML_ENTITIES=r({Aacute:"\xC1",aacute:"\xE1",Abreve:"\u0102",abreve:"\u0103",ac:"\u223E",acd:"\u223F",acE:"\u223E\u0333",Acirc:"\xC2",acirc:"\xE2",acute:"\xB4",Acy:"\u0410",acy:"\u0430",AElig:"\xC6",aelig:"\xE6",af:"\u2061",Afr:"\u{1D504}",afr:"\u{1D51E}",Agrave:"\xC0",agrave:"\xE0",alefsym:"\u2135",aleph:"\u2135",Alpha:"\u0391",alpha:"\u03B1",Amacr:"\u0100",amacr:"\u0101",amalg:"\u2A3F",AMP:"&",amp:"&",And:"\u2A53",and:"\u2227",andand:"\u2A55",andd:"\u2A5C",andslope:"\u2A58",andv:"\u2A5A",ang:"\u2220",ange:"\u29A4",angle:"\u2220",angmsd:"\u2221",angmsdaa:"\u29A8",angmsdab:"\u29A9",angmsdac:"\u29AA",angmsdad:"\u29AB",angmsdae:"\u29AC",angmsdaf:"\u29AD",angmsdag:"\u29AE",angmsdah:"\u29AF",angrt:"\u221F",angrtvb:"\u22BE",angrtvbd:"\u299D",angsph:"\u2222",angst:"\xC5",angzarr:"\u237C",Aogon:"\u0104",aogon:"\u0105",Aopf:"\u{1D538}",aopf:"\u{1D552}",ap:"\u2248",apacir:"\u2A6F",apE:"\u2A70",ape:"\u224A",apid:"\u224B",apos:"'",ApplyFunction:"\u2061",approx:"\u2248",approxeq:"\u224A",Aring:"\xC5",aring:"\xE5",Ascr:"\u{1D49C}",ascr:"\u{1D4B6}",Assign:"\u2254",ast:"*",asymp:"\u2248",asympeq:"\u224D",Atilde:"\xC3",atilde:"\xE3",Auml:"\xC4",auml:"\xE4",awconint:"\u2233",awint:"\u2A11",backcong:"\u224C",backepsilon:"\u03F6",backprime:"\u2035",backsim:"\u223D",backsimeq:"\u22CD",Backslash:"\u2216",Barv:"\u2AE7",barvee:"\u22BD",Barwed:"\u2306",barwed:"\u2305",barwedge:"\u2305",bbrk:"\u23B5",bbrktbrk:"\u23B6",bcong:"\u224C",Bcy:"\u0411",bcy:"\u0431",bdquo:"\u201E",becaus:"\u2235",Because:"\u2235",because:"\u2235",bemptyv:"\u29B0",bepsi:"\u03F6",bernou:"\u212C",Bernoullis:"\u212C",Beta:"\u0392",beta:"\u03B2",beth:"\u2136",between:"\u226C",Bfr:"\u{1D505}",bfr:"\u{1D51F}",bigcap:"\u22C2",bigcirc:"\u25EF",bigcup:"\u22C3",bigodot:"\u2A00",bigoplus:"\u2A01",bigotimes:"\u2A02",bigsqcup:"\u2A06",bigstar:"\u2605",bigtriangledown:"\u25BD",bigtriangleup:"\u25B3",biguplus:"\u2A04",bigvee:"\u22C1",bigwedge:"\u22C0",bkarow:"\u290D",blacklozenge:"\u29EB",blacksquare:"\u25AA",blacktriangle:"\u25B4",blacktriangledown:"\u25BE",blacktriangleleft:"\u25C2",blacktriangleright:"\u25B8",blank:"\u2423",blk12:"\u2592",blk14:"\u2591",blk34:"\u2593",block:"\u2588",bne:"=\u20E5",bnequiv:"\u2261\u20E5",bNot:"\u2AED",bnot:"\u2310",Bopf:"\u{1D539}",bopf:"\u{1D553}",bot:"\u22A5",bottom:"\u22A5",bowtie:"\u22C8",boxbox:"\u29C9",boxDL:"\u2557",boxDl:"\u2556",boxdL:"\u2555",boxdl:"\u2510",boxDR:"\u2554",boxDr:"\u2553",boxdR:"\u2552",boxdr:"\u250C",boxH:"\u2550",boxh:"\u2500",boxHD:"\u2566",boxHd:"\u2564",boxhD:"\u2565",boxhd:"\u252C",boxHU:"\u2569",boxHu:"\u2567",boxhU:"\u2568",boxhu:"\u2534",boxminus:"\u229F",boxplus:"\u229E",boxtimes:"\u22A0",boxUL:"\u255D",boxUl:"\u255C",boxuL:"\u255B",boxul:"\u2518",boxUR:"\u255A",boxUr:"\u2559",boxuR:"\u2558",boxur:"\u2514",boxV:"\u2551",boxv:"\u2502",boxVH:"\u256C",boxVh:"\u256B",boxvH:"\u256A",boxvh:"\u253C",boxVL:"\u2563",boxVl:"\u2562",boxvL:"\u2561",boxvl:"\u2524",boxVR:"\u2560",boxVr:"\u255F",boxvR:"\u255E",boxvr:"\u251C",bprime:"\u2035",Breve:"\u02D8",breve:"\u02D8",brvbar:"\xA6",Bscr:"\u212C",bscr:"\u{1D4B7}",bsemi:"\u204F",bsim:"\u223D",bsime:"\u22CD",bsol:"\\",bsolb:"\u29C5",bsolhsub:"\u27C8",bull:"\u2022",bullet:"\u2022",bump:"\u224E",bumpE:"\u2AAE",bumpe:"\u224F",Bumpeq:"\u224E",bumpeq:"\u224F",Cacute:"\u0106",cacute:"\u0107",Cap:"\u22D2",cap:"\u2229",capand:"\u2A44",capbrcup:"\u2A49",capcap:"\u2A4B",capcup:"\u2A47",capdot:"\u2A40",CapitalDifferentialD:"\u2145",caps:"\u2229\uFE00",caret:"\u2041",caron:"\u02C7",Cayleys:"\u212D",ccaps:"\u2A4D",Ccaron:"\u010C",ccaron:"\u010D",Ccedil:"\xC7",ccedil:"\xE7",Ccirc:"\u0108",ccirc:"\u0109",Cconint:"\u2230",ccups:"\u2A4C",ccupssm:"\u2A50",Cdot:"\u010A",cdot:"\u010B",cedil:"\xB8",Cedilla:"\xB8",cemptyv:"\u29B2",cent:"\xA2",CenterDot:"\xB7",centerdot:"\xB7",Cfr:"\u212D",cfr:"\u{1D520}",CHcy:"\u0427",chcy:"\u0447",check:"\u2713",checkmark:"\u2713",Chi:"\u03A7",chi:"\u03C7",cir:"\u25CB",circ:"\u02C6",circeq:"\u2257",circlearrowleft:"\u21BA",circlearrowright:"\u21BB",circledast:"\u229B",circledcirc:"\u229A",circleddash:"\u229D",CircleDot:"\u2299",circledR:"\xAE",circledS:"\u24C8",CircleMinus:"\u2296",CirclePlus:"\u2295",CircleTimes:"\u2297",cirE:"\u29C3",cire:"\u2257",cirfnint:"\u2A10",cirmid:"\u2AEF",cirscir:"\u29C2",ClockwiseContourIntegral:"\u2232",CloseCurlyDoubleQuote:"\u201D",CloseCurlyQuote:"\u2019",clubs:"\u2663",clubsuit:"\u2663",Colon:"\u2237",colon:":",Colone:"\u2A74",colone:"\u2254",coloneq:"\u2254",comma:",",commat:"@",comp:"\u2201",compfn:"\u2218",complement:"\u2201",complexes:"\u2102",cong:"\u2245",congdot:"\u2A6D",Congruent:"\u2261",Conint:"\u222F",conint:"\u222E",ContourIntegral:"\u222E",Copf:"\u2102",copf:"\u{1D554}",coprod:"\u2210",Coproduct:"\u2210",COPY:"\xA9",copy:"\xA9",copysr:"\u2117",CounterClockwiseContourIntegral:"\u2233",crarr:"\u21B5",Cross:"\u2A2F",cross:"\u2717",Cscr:"\u{1D49E}",cscr:"\u{1D4B8}",csub:"\u2ACF",csube:"\u2AD1",csup:"\u2AD0",csupe:"\u2AD2",ctdot:"\u22EF",cudarrl:"\u2938",cudarrr:"\u2935",cuepr:"\u22DE",cuesc:"\u22DF",cularr:"\u21B6",cularrp:"\u293D",Cup:"\u22D3",cup:"\u222A",cupbrcap:"\u2A48",CupCap:"\u224D",cupcap:"\u2A46",cupcup:"\u2A4A",cupdot:"\u228D",cupor:"\u2A45",cups:"\u222A\uFE00",curarr:"\u21B7",curarrm:"\u293C",curlyeqprec:"\u22DE",curlyeqsucc:"\u22DF",curlyvee:"\u22CE",curlywedge:"\u22CF",curren:"\xA4",curvearrowleft:"\u21B6",curvearrowright:"\u21B7",cuvee:"\u22CE",cuwed:"\u22CF",cwconint:"\u2232",cwint:"\u2231",cylcty:"\u232D",Dagger:"\u2021",dagger:"\u2020",daleth:"\u2138",Darr:"\u21A1",dArr:"\u21D3",darr:"\u2193",dash:"\u2010",Dashv:"\u2AE4",dashv:"\u22A3",dbkarow:"\u290F",dblac:"\u02DD",Dcaron:"\u010E",dcaron:"\u010F",Dcy:"\u0414",dcy:"\u0434",DD:"\u2145",dd:"\u2146",ddagger:"\u2021",ddarr:"\u21CA",DDotrahd:"\u2911",ddotseq:"\u2A77",deg:"\xB0",Del:"\u2207",Delta:"\u0394",delta:"\u03B4",demptyv:"\u29B1",dfisht:"\u297F",Dfr:"\u{1D507}",dfr:"\u{1D521}",dHar:"\u2965",dharl:"\u21C3",dharr:"\u21C2",DiacriticalAcute:"\xB4",DiacriticalDot:"\u02D9",DiacriticalDoubleAcute:"\u02DD",DiacriticalGrave:"`",DiacriticalTilde:"\u02DC",diam:"\u22C4",Diamond:"\u22C4",diamond:"\u22C4",diamondsuit:"\u2666",diams:"\u2666",die:"\xA8",DifferentialD:"\u2146",digamma:"\u03DD",disin:"\u22F2",div:"\xF7",divide:"\xF7",divideontimes:"\u22C7",divonx:"\u22C7",DJcy:"\u0402",djcy:"\u0452",dlcorn:"\u231E",dlcrop:"\u230D",dollar:"$",Dopf:"\u{1D53B}",dopf:"\u{1D555}",Dot:"\xA8",dot:"\u02D9",DotDot:"\u20DC",doteq:"\u2250",doteqdot:"\u2251",DotEqual:"\u2250",dotminus:"\u2238",dotplus:"\u2214",dotsquare:"\u22A1",doublebarwedge:"\u2306",DoubleContourIntegral:"\u222F",DoubleDot:"\xA8",DoubleDownArrow:"\u21D3",DoubleLeftArrow:"\u21D0",DoubleLeftRightArrow:"\u21D4",DoubleLeftTee:"\u2AE4",DoubleLongLeftArrow:"\u27F8",DoubleLongLeftRightArrow:"\u27FA",DoubleLongRightArrow:"\u27F9",DoubleRightArrow:"\u21D2",DoubleRightTee:"\u22A8",DoubleUpArrow:"\u21D1",DoubleUpDownArrow:"\u21D5",DoubleVerticalBar:"\u2225",DownArrow:"\u2193",Downarrow:"\u21D3",downarrow:"\u2193",DownArrowBar:"\u2913",DownArrowUpArrow:"\u21F5",DownBreve:"\u0311",downdownarrows:"\u21CA",downharpoonleft:"\u21C3",downharpoonright:"\u21C2",DownLeftRightVector:"\u2950",DownLeftTeeVector:"\u295E",DownLeftVector:"\u21BD",DownLeftVectorBar:"\u2956",DownRightTeeVector:"\u295F",DownRightVector:"\u21C1",DownRightVectorBar:"\u2957",DownTee:"\u22A4",DownTeeArrow:"\u21A7",drbkarow:"\u2910",drcorn:"\u231F",drcrop:"\u230C",Dscr:"\u{1D49F}",dscr:"\u{1D4B9}",DScy:"\u0405",dscy:"\u0455",dsol:"\u29F6",Dstrok:"\u0110",dstrok:"\u0111",dtdot:"\u22F1",dtri:"\u25BF",dtrif:"\u25BE",duarr:"\u21F5",duhar:"\u296F",dwangle:"\u29A6",DZcy:"\u040F",dzcy:"\u045F",dzigrarr:"\u27FF",Eacute:"\xC9",eacute:"\xE9",easter:"\u2A6E",Ecaron:"\u011A",ecaron:"\u011B",ecir:"\u2256",Ecirc:"\xCA",ecirc:"\xEA",ecolon:"\u2255",Ecy:"\u042D",ecy:"\u044D",eDDot:"\u2A77",Edot:"\u0116",eDot:"\u2251",edot:"\u0117",ee:"\u2147",efDot:"\u2252",Efr:"\u{1D508}",efr:"\u{1D522}",eg:"\u2A9A",Egrave:"\xC8",egrave:"\xE8",egs:"\u2A96",egsdot:"\u2A98",el:"\u2A99",Element:"\u2208",elinters:"\u23E7",ell:"\u2113",els:"\u2A95",elsdot:"\u2A97",Emacr:"\u0112",emacr:"\u0113",empty:"\u2205",emptyset:"\u2205",EmptySmallSquare:"\u25FB",emptyv:"\u2205",EmptyVerySmallSquare:"\u25AB",emsp:"\u2003",emsp13:"\u2004",emsp14:"\u2005",ENG:"\u014A",eng:"\u014B",ensp:"\u2002",Eogon:"\u0118",eogon:"\u0119",Eopf:"\u{1D53C}",eopf:"\u{1D556}",epar:"\u22D5",eparsl:"\u29E3",eplus:"\u2A71",epsi:"\u03B5",Epsilon:"\u0395",epsilon:"\u03B5",epsiv:"\u03F5",eqcirc:"\u2256",eqcolon:"\u2255",eqsim:"\u2242",eqslantgtr:"\u2A96",eqslantless:"\u2A95",Equal:"\u2A75",equals:"=",EqualTilde:"\u2242",equest:"\u225F",Equilibrium:"\u21CC",equiv:"\u2261",equivDD:"\u2A78",eqvparsl:"\u29E5",erarr:"\u2971",erDot:"\u2253",Escr:"\u2130",escr:"\u212F",esdot:"\u2250",Esim:"\u2A73",esim:"\u2242",Eta:"\u0397",eta:"\u03B7",ETH:"\xD0",eth:"\xF0",Euml:"\xCB",euml:"\xEB",euro:"\u20AC",excl:"!",exist:"\u2203",Exists:"\u2203",expectation:"\u2130",ExponentialE:"\u2147",exponentiale:"\u2147",fallingdotseq:"\u2252",Fcy:"\u0424",fcy:"\u0444",female:"\u2640",ffilig:"\uFB03",fflig:"\uFB00",ffllig:"\uFB04",Ffr:"\u{1D509}",ffr:"\u{1D523}",filig:"\uFB01",FilledSmallSquare:"\u25FC",FilledVerySmallSquare:"\u25AA",fjlig:"fj",flat:"\u266D",fllig:"\uFB02",fltns:"\u25B1",fnof:"\u0192",Fopf:"\u{1D53D}",fopf:"\u{1D557}",ForAll:"\u2200",forall:"\u2200",fork:"\u22D4",forkv:"\u2AD9",Fouriertrf:"\u2131",fpartint:"\u2A0D",frac12:"\xBD",frac13:"\u2153",frac14:"\xBC",frac15:"\u2155",frac16:"\u2159",frac18:"\u215B",frac23:"\u2154",frac25:"\u2156",frac34:"\xBE",frac35:"\u2157",frac38:"\u215C",frac45:"\u2158",frac56:"\u215A",frac58:"\u215D",frac78:"\u215E",frasl:"\u2044",frown:"\u2322",Fscr:"\u2131",fscr:"\u{1D4BB}",gacute:"\u01F5",Gamma:"\u0393",gamma:"\u03B3",Gammad:"\u03DC",gammad:"\u03DD",gap:"\u2A86",Gbreve:"\u011E",gbreve:"\u011F",Gcedil:"\u0122",Gcirc:"\u011C",gcirc:"\u011D",Gcy:"\u0413",gcy:"\u0433",Gdot:"\u0120",gdot:"\u0121",gE:"\u2267",ge:"\u2265",gEl:"\u2A8C",gel:"\u22DB",geq:"\u2265",geqq:"\u2267",geqslant:"\u2A7E",ges:"\u2A7E",gescc:"\u2AA9",gesdot:"\u2A80",gesdoto:"\u2A82",gesdotol:"\u2A84",gesl:"\u22DB\uFE00",gesles:"\u2A94",Gfr:"\u{1D50A}",gfr:"\u{1D524}",Gg:"\u22D9",gg:"\u226B",ggg:"\u22D9",gimel:"\u2137",GJcy:"\u0403",gjcy:"\u0453",gl:"\u2277",gla:"\u2AA5",glE:"\u2A92",glj:"\u2AA4",gnap:"\u2A8A",gnapprox:"\u2A8A",gnE:"\u2269",gne:"\u2A88",gneq:"\u2A88",gneqq:"\u2269",gnsim:"\u22E7",Gopf:"\u{1D53E}",gopf:"\u{1D558}",grave:"`",GreaterEqual:"\u2265",GreaterEqualLess:"\u22DB",GreaterFullEqual:"\u2267",GreaterGreater:"\u2AA2",GreaterLess:"\u2277",GreaterSlantEqual:"\u2A7E",GreaterTilde:"\u2273",Gscr:"\u{1D4A2}",gscr:"\u210A",gsim:"\u2273",gsime:"\u2A8E",gsiml:"\u2A90",Gt:"\u226B",GT:">",gt:">",gtcc:"\u2AA7",gtcir:"\u2A7A",gtdot:"\u22D7",gtlPar:"\u2995",gtquest:"\u2A7C",gtrapprox:"\u2A86",gtrarr:"\u2978",gtrdot:"\u22D7",gtreqless:"\u22DB",gtreqqless:"\u2A8C",gtrless:"\u2277",gtrsim:"\u2273",gvertneqq:"\u2269\uFE00",gvnE:"\u2269\uFE00",Hacek:"\u02C7",hairsp:"\u200A",half:"\xBD",hamilt:"\u210B",HARDcy:"\u042A",hardcy:"\u044A",hArr:"\u21D4",harr:"\u2194",harrcir:"\u2948",harrw:"\u21AD",Hat:"^",hbar:"\u210F",Hcirc:"\u0124",hcirc:"\u0125",hearts:"\u2665",heartsuit:"\u2665",hellip:"\u2026",hercon:"\u22B9",Hfr:"\u210C",hfr:"\u{1D525}",HilbertSpace:"\u210B",hksearow:"\u2925",hkswarow:"\u2926",hoarr:"\u21FF",homtht:"\u223B",hookleftarrow:"\u21A9",hookrightarrow:"\u21AA",Hopf:"\u210D",hopf:"\u{1D559}",horbar:"\u2015",HorizontalLine:"\u2500",Hscr:"\u210B",hscr:"\u{1D4BD}",hslash:"\u210F",Hstrok:"\u0126",hstrok:"\u0127",HumpDownHump:"\u224E",HumpEqual:"\u224F",hybull:"\u2043",hyphen:"\u2010",Iacute:"\xCD",iacute:"\xED",ic:"\u2063",Icirc:"\xCE",icirc:"\xEE",Icy:"\u0418",icy:"\u0438",Idot:"\u0130",IEcy:"\u0415",iecy:"\u0435",iexcl:"\xA1",iff:"\u21D4",Ifr:"\u2111",ifr:"\u{1D526}",Igrave:"\xCC",igrave:"\xEC",ii:"\u2148",iiiint:"\u2A0C",iiint:"\u222D",iinfin:"\u29DC",iiota:"\u2129",IJlig:"\u0132",ijlig:"\u0133",Im:"\u2111",Imacr:"\u012A",imacr:"\u012B",image:"\u2111",ImaginaryI:"\u2148",imagline:"\u2110",imagpart:"\u2111",imath:"\u0131",imof:"\u22B7",imped:"\u01B5",Implies:"\u21D2",in:"\u2208",incare:"\u2105",infin:"\u221E",infintie:"\u29DD",inodot:"\u0131",Int:"\u222C",int:"\u222B",intcal:"\u22BA",integers:"\u2124",Integral:"\u222B",intercal:"\u22BA",Intersection:"\u22C2",intlarhk:"\u2A17",intprod:"\u2A3C",InvisibleComma:"\u2063",InvisibleTimes:"\u2062",IOcy:"\u0401",iocy:"\u0451",Iogon:"\u012E",iogon:"\u012F",Iopf:"\u{1D540}",iopf:"\u{1D55A}",Iota:"\u0399",iota:"\u03B9",iprod:"\u2A3C",iquest:"\xBF",Iscr:"\u2110",iscr:"\u{1D4BE}",isin:"\u2208",isindot:"\u22F5",isinE:"\u22F9",isins:"\u22F4",isinsv:"\u22F3",isinv:"\u2208",it:"\u2062",Itilde:"\u0128",itilde:"\u0129",Iukcy:"\u0406",iukcy:"\u0456",Iuml:"\xCF",iuml:"\xEF",Jcirc:"\u0134",jcirc:"\u0135",Jcy:"\u0419",jcy:"\u0439",Jfr:"\u{1D50D}",jfr:"\u{1D527}",jmath:"\u0237",Jopf:"\u{1D541}",jopf:"\u{1D55B}",Jscr:"\u{1D4A5}",jscr:"\u{1D4BF}",Jsercy:"\u0408",jsercy:"\u0458",Jukcy:"\u0404",jukcy:"\u0454",Kappa:"\u039A",kappa:"\u03BA",kappav:"\u03F0",Kcedil:"\u0136",kcedil:"\u0137",Kcy:"\u041A",kcy:"\u043A",Kfr:"\u{1D50E}",kfr:"\u{1D528}",kgreen:"\u0138",KHcy:"\u0425",khcy:"\u0445",KJcy:"\u040C",kjcy:"\u045C",Kopf:"\u{1D542}",kopf:"\u{1D55C}",Kscr:"\u{1D4A6}",kscr:"\u{1D4C0}",lAarr:"\u21DA",Lacute:"\u0139",lacute:"\u013A",laemptyv:"\u29B4",lagran:"\u2112",Lambda:"\u039B",lambda:"\u03BB",Lang:"\u27EA",lang:"\u27E8",langd:"\u2991",langle:"\u27E8",lap:"\u2A85",Laplacetrf:"\u2112",laquo:"\xAB",Larr:"\u219E",lArr:"\u21D0",larr:"\u2190",larrb:"\u21E4",larrbfs:"\u291F",larrfs:"\u291D",larrhk:"\u21A9",larrlp:"\u21AB",larrpl:"\u2939",larrsim:"\u2973",larrtl:"\u21A2",lat:"\u2AAB",lAtail:"\u291B",latail:"\u2919",late:"\u2AAD",lates:"\u2AAD\uFE00",lBarr:"\u290E",lbarr:"\u290C",lbbrk:"\u2772",lbrace:"{",lbrack:"[",lbrke:"\u298B",lbrksld:"\u298F",lbrkslu:"\u298D",Lcaron:"\u013D",lcaron:"\u013E",Lcedil:"\u013B",lcedil:"\u013C",lceil:"\u2308",lcub:"{",Lcy:"\u041B",lcy:"\u043B",ldca:"\u2936",ldquo:"\u201C",ldquor:"\u201E",ldrdhar:"\u2967",ldrushar:"\u294B",ldsh:"\u21B2",lE:"\u2266",le:"\u2264",LeftAngleBracket:"\u27E8",LeftArrow:"\u2190",Leftarrow:"\u21D0",leftarrow:"\u2190",LeftArrowBar:"\u21E4",LeftArrowRightArrow:"\u21C6",leftarrowtail:"\u21A2",LeftCeiling:"\u2308",LeftDoubleBracket:"\u27E6",LeftDownTeeVector:"\u2961",LeftDownVector:"\u21C3",LeftDownVectorBar:"\u2959",LeftFloor:"\u230A",leftharpoondown:"\u21BD",leftharpoonup:"\u21BC",leftleftarrows:"\u21C7",LeftRightArrow:"\u2194",Leftrightarrow:"\u21D4",leftrightarrow:"\u2194",leftrightarrows:"\u21C6",leftrightharpoons:"\u21CB",leftrightsquigarrow:"\u21AD",LeftRightVector:"\u294E",LeftTee:"\u22A3",LeftTeeArrow:"\u21A4",LeftTeeVector:"\u295A",leftthreetimes:"\u22CB",LeftTriangle:"\u22B2",LeftTriangleBar:"\u29CF",LeftTriangleEqual:"\u22B4",LeftUpDownVector:"\u2951",LeftUpTeeVector:"\u2960",LeftUpVector:"\u21BF",LeftUpVectorBar:"\u2958",LeftVector:"\u21BC",LeftVectorBar:"\u2952",lEg:"\u2A8B",leg:"\u22DA",leq:"\u2264",leqq:"\u2266",leqslant:"\u2A7D",les:"\u2A7D",lescc:"\u2AA8",lesdot:"\u2A7F",lesdoto:"\u2A81",lesdotor:"\u2A83",lesg:"\u22DA\uFE00",lesges:"\u2A93",lessapprox:"\u2A85",lessdot:"\u22D6",lesseqgtr:"\u22DA",lesseqqgtr:"\u2A8B",LessEqualGreater:"\u22DA",LessFullEqual:"\u2266",LessGreater:"\u2276",lessgtr:"\u2276",LessLess:"\u2AA1",lesssim:"\u2272",LessSlantEqual:"\u2A7D",LessTilde:"\u2272",lfisht:"\u297C",lfloor:"\u230A",Lfr:"\u{1D50F}",lfr:"\u{1D529}",lg:"\u2276",lgE:"\u2A91",lHar:"\u2962",lhard:"\u21BD",lharu:"\u21BC",lharul:"\u296A",lhblk:"\u2584",LJcy:"\u0409",ljcy:"\u0459",Ll:"\u22D8",ll:"\u226A",llarr:"\u21C7",llcorner:"\u231E",Lleftarrow:"\u21DA",llhard:"\u296B",lltri:"\u25FA",Lmidot:"\u013F",lmidot:"\u0140",lmoust:"\u23B0",lmoustache:"\u23B0",lnap:"\u2A89",lnapprox:"\u2A89",lnE:"\u2268",lne:"\u2A87",lneq:"\u2A87",lneqq:"\u2268",lnsim:"\u22E6",loang:"\u27EC",loarr:"\u21FD",lobrk:"\u27E6",LongLeftArrow:"\u27F5",Longleftarrow:"\u27F8",longleftarrow:"\u27F5",LongLeftRightArrow:"\u27F7",Longleftrightarrow:"\u27FA",longleftrightarrow:"\u27F7",longmapsto:"\u27FC",LongRightArrow:"\u27F6",Longrightarrow:"\u27F9",longrightarrow:"\u27F6",looparrowleft:"\u21AB",looparrowright:"\u21AC",lopar:"\u2985",Lopf:"\u{1D543}",lopf:"\u{1D55D}",loplus:"\u2A2D",lotimes:"\u2A34",lowast:"\u2217",lowbar:"_",LowerLeftArrow:"\u2199",LowerRightArrow:"\u2198",loz:"\u25CA",lozenge:"\u25CA",lozf:"\u29EB",lpar:"(",lparlt:"\u2993",lrarr:"\u21C6",lrcorner:"\u231F",lrhar:"\u21CB",lrhard:"\u296D",lrm:"\u200E",lrtri:"\u22BF",lsaquo:"\u2039",Lscr:"\u2112",lscr:"\u{1D4C1}",Lsh:"\u21B0",lsh:"\u21B0",lsim:"\u2272",lsime:"\u2A8D",lsimg:"\u2A8F",lsqb:"[",lsquo:"\u2018",lsquor:"\u201A",Lstrok:"\u0141",lstrok:"\u0142",Lt:"\u226A",LT:"<",lt:"<",ltcc:"\u2AA6",ltcir:"\u2A79",ltdot:"\u22D6",lthree:"\u22CB",ltimes:"\u22C9",ltlarr:"\u2976",ltquest:"\u2A7B",ltri:"\u25C3",ltrie:"\u22B4",ltrif:"\u25C2",ltrPar:"\u2996",lurdshar:"\u294A",luruhar:"\u2966",lvertneqq:"\u2268\uFE00",lvnE:"\u2268\uFE00",macr:"\xAF",male:"\u2642",malt:"\u2720",maltese:"\u2720",Map:"\u2905",map:"\u21A6",mapsto:"\u21A6",mapstodown:"\u21A7",mapstoleft:"\u21A4",mapstoup:"\u21A5",marker:"\u25AE",mcomma:"\u2A29",Mcy:"\u041C",mcy:"\u043C",mdash:"\u2014",mDDot:"\u223A",measuredangle:"\u2221",MediumSpace:"\u205F",Mellintrf:"\u2133",Mfr:"\u{1D510}",mfr:"\u{1D52A}",mho:"\u2127",micro:"\xB5",mid:"\u2223",midast:"*",midcir:"\u2AF0",middot:"\xB7",minus:"\u2212",minusb:"\u229F",minusd:"\u2238",minusdu:"\u2A2A",MinusPlus:"\u2213",mlcp:"\u2ADB",mldr:"\u2026",mnplus:"\u2213",models:"\u22A7",Mopf:"\u{1D544}",mopf:"\u{1D55E}",mp:"\u2213",Mscr:"\u2133",mscr:"\u{1D4C2}",mstpos:"\u223E",Mu:"\u039C",mu:"\u03BC",multimap:"\u22B8",mumap:"\u22B8",nabla:"\u2207",Nacute:"\u0143",nacute:"\u0144",nang:"\u2220\u20D2",nap:"\u2249",napE:"\u2A70\u0338",napid:"\u224B\u0338",napos:"\u0149",napprox:"\u2249",natur:"\u266E",natural:"\u266E",naturals:"\u2115",nbsp:"\xA0",nbump:"\u224E\u0338",nbumpe:"\u224F\u0338",ncap:"\u2A43",Ncaron:"\u0147",ncaron:"\u0148",Ncedil:"\u0145",ncedil:"\u0146",ncong:"\u2247",ncongdot:"\u2A6D\u0338",ncup:"\u2A42",Ncy:"\u041D",ncy:"\u043D",ndash:"\u2013",ne:"\u2260",nearhk:"\u2924",neArr:"\u21D7",nearr:"\u2197",nearrow:"\u2197",nedot:"\u2250\u0338",NegativeMediumSpace:"\u200B",NegativeThickSpace:"\u200B",NegativeThinSpace:"\u200B",NegativeVeryThinSpace:"\u200B",nequiv:"\u2262",nesear:"\u2928",nesim:"\u2242\u0338",NestedGreaterGreater:"\u226B",NestedLessLess:"\u226A",NewLine:`
`,nexist:"\u2204",nexists:"\u2204",Nfr:"\u{1D511}",nfr:"\u{1D52B}",ngE:"\u2267\u0338",nge:"\u2271",ngeq:"\u2271",ngeqq:"\u2267\u0338",ngeqslant:"\u2A7E\u0338",nges:"\u2A7E\u0338",nGg:"\u22D9\u0338",ngsim:"\u2275",nGt:"\u226B\u20D2",ngt:"\u226F",ngtr:"\u226F",nGtv:"\u226B\u0338",nhArr:"\u21CE",nharr:"\u21AE",nhpar:"\u2AF2",ni:"\u220B",nis:"\u22FC",nisd:"\u22FA",niv:"\u220B",NJcy:"\u040A",njcy:"\u045A",nlArr:"\u21CD",nlarr:"\u219A",nldr:"\u2025",nlE:"\u2266\u0338",nle:"\u2270",nLeftarrow:"\u21CD",nleftarrow:"\u219A",nLeftrightarrow:"\u21CE",nleftrightarrow:"\u21AE",nleq:"\u2270",nleqq:"\u2266\u0338",nleqslant:"\u2A7D\u0338",nles:"\u2A7D\u0338",nless:"\u226E",nLl:"\u22D8\u0338",nlsim:"\u2274",nLt:"\u226A\u20D2",nlt:"\u226E",nltri:"\u22EA",nltrie:"\u22EC",nLtv:"\u226A\u0338",nmid:"\u2224",NoBreak:"\u2060",NonBreakingSpace:"\xA0",Nopf:"\u2115",nopf:"\u{1D55F}",Not:"\u2AEC",not:"\xAC",NotCongruent:"\u2262",NotCupCap:"\u226D",NotDoubleVerticalBar:"\u2226",NotElement:"\u2209",NotEqual:"\u2260",NotEqualTilde:"\u2242\u0338",NotExists:"\u2204",NotGreater:"\u226F",NotGreaterEqual:"\u2271",NotGreaterFullEqual:"\u2267\u0338",NotGreaterGreater:"\u226B\u0338",NotGreaterLess:"\u2279",NotGreaterSlantEqual:"\u2A7E\u0338",NotGreaterTilde:"\u2275",NotHumpDownHump:"\u224E\u0338",NotHumpEqual:"\u224F\u0338",notin:"\u2209",notindot:"\u22F5\u0338",notinE:"\u22F9\u0338",notinva:"\u2209",notinvb:"\u22F7",notinvc:"\u22F6",NotLeftTriangle:"\u22EA",NotLeftTriangleBar:"\u29CF\u0338",NotLeftTriangleEqual:"\u22EC",NotLess:"\u226E",NotLessEqual:"\u2270",NotLessGreater:"\u2278",NotLessLess:"\u226A\u0338",NotLessSlantEqual:"\u2A7D\u0338",NotLessTilde:"\u2274",NotNestedGreaterGreater:"\u2AA2\u0338",NotNestedLessLess:"\u2AA1\u0338",notni:"\u220C",notniva:"\u220C",notnivb:"\u22FE",notnivc:"\u22FD",NotPrecedes:"\u2280",NotPrecedesEqual:"\u2AAF\u0338",NotPrecedesSlantEqual:"\u22E0",NotReverseElement:"\u220C",NotRightTriangle:"\u22EB",NotRightTriangleBar:"\u29D0\u0338",NotRightTriangleEqual:"\u22ED",NotSquareSubset:"\u228F\u0338",NotSquareSubsetEqual:"\u22E2",NotSquareSuperset:"\u2290\u0338",NotSquareSupersetEqual:"\u22E3",NotSubset:"\u2282\u20D2",NotSubsetEqual:"\u2288",NotSucceeds:"\u2281",NotSucceedsEqual:"\u2AB0\u0338",NotSucceedsSlantEqual:"\u22E1",NotSucceedsTilde:"\u227F\u0338",NotSuperset:"\u2283\u20D2",NotSupersetEqual:"\u2289",NotTilde:"\u2241",NotTildeEqual:"\u2244",NotTildeFullEqual:"\u2247",NotTildeTilde:"\u2249",NotVerticalBar:"\u2224",npar:"\u2226",nparallel:"\u2226",nparsl:"\u2AFD\u20E5",npart:"\u2202\u0338",npolint:"\u2A14",npr:"\u2280",nprcue:"\u22E0",npre:"\u2AAF\u0338",nprec:"\u2280",npreceq:"\u2AAF\u0338",nrArr:"\u21CF",nrarr:"\u219B",nrarrc:"\u2933\u0338",nrarrw:"\u219D\u0338",nRightarrow:"\u21CF",nrightarrow:"\u219B",nrtri:"\u22EB",nrtrie:"\u22ED",nsc:"\u2281",nsccue:"\u22E1",nsce:"\u2AB0\u0338",Nscr:"\u{1D4A9}",nscr:"\u{1D4C3}",nshortmid:"\u2224",nshortparallel:"\u2226",nsim:"\u2241",nsime:"\u2244",nsimeq:"\u2244",nsmid:"\u2224",nspar:"\u2226",nsqsube:"\u22E2",nsqsupe:"\u22E3",nsub:"\u2284",nsubE:"\u2AC5\u0338",nsube:"\u2288",nsubset:"\u2282\u20D2",nsubseteq:"\u2288",nsubseteqq:"\u2AC5\u0338",nsucc:"\u2281",nsucceq:"\u2AB0\u0338",nsup:"\u2285",nsupE:"\u2AC6\u0338",nsupe:"\u2289",nsupset:"\u2283\u20D2",nsupseteq:"\u2289",nsupseteqq:"\u2AC6\u0338",ntgl:"\u2279",Ntilde:"\xD1",ntilde:"\xF1",ntlg:"\u2278",ntriangleleft:"\u22EA",ntrianglelefteq:"\u22EC",ntriangleright:"\u22EB",ntrianglerighteq:"\u22ED",Nu:"\u039D",nu:"\u03BD",num:"#",numero:"\u2116",numsp:"\u2007",nvap:"\u224D\u20D2",nVDash:"\u22AF",nVdash:"\u22AE",nvDash:"\u22AD",nvdash:"\u22AC",nvge:"\u2265\u20D2",nvgt:">\u20D2",nvHarr:"\u2904",nvinfin:"\u29DE",nvlArr:"\u2902",nvle:"\u2264\u20D2",nvlt:"<\u20D2",nvltrie:"\u22B4\u20D2",nvrArr:"\u2903",nvrtrie:"\u22B5\u20D2",nvsim:"\u223C\u20D2",nwarhk:"\u2923",nwArr:"\u21D6",nwarr:"\u2196",nwarrow:"\u2196",nwnear:"\u2927",Oacute:"\xD3",oacute:"\xF3",oast:"\u229B",ocir:"\u229A",Ocirc:"\xD4",ocirc:"\xF4",Ocy:"\u041E",ocy:"\u043E",odash:"\u229D",Odblac:"\u0150",odblac:"\u0151",odiv:"\u2A38",odot:"\u2299",odsold:"\u29BC",OElig:"\u0152",oelig:"\u0153",ofcir:"\u29BF",Ofr:"\u{1D512}",ofr:"\u{1D52C}",ogon:"\u02DB",Ograve:"\xD2",ograve:"\xF2",ogt:"\u29C1",ohbar:"\u29B5",ohm:"\u03A9",oint:"\u222E",olarr:"\u21BA",olcir:"\u29BE",olcross:"\u29BB",oline:"\u203E",olt:"\u29C0",Omacr:"\u014C",omacr:"\u014D",Omega:"\u03A9",omega:"\u03C9",Omicron:"\u039F",omicron:"\u03BF",omid:"\u29B6",ominus:"\u2296",Oopf:"\u{1D546}",oopf:"\u{1D560}",opar:"\u29B7",OpenCurlyDoubleQuote:"\u201C",OpenCurlyQuote:"\u2018",operp:"\u29B9",oplus:"\u2295",Or:"\u2A54",or:"\u2228",orarr:"\u21BB",ord:"\u2A5D",order:"\u2134",orderof:"\u2134",ordf:"\xAA",ordm:"\xBA",origof:"\u22B6",oror:"\u2A56",orslope:"\u2A57",orv:"\u2A5B",oS:"\u24C8",Oscr:"\u{1D4AA}",oscr:"\u2134",Oslash:"\xD8",oslash:"\xF8",osol:"\u2298",Otilde:"\xD5",otilde:"\xF5",Otimes:"\u2A37",otimes:"\u2297",otimesas:"\u2A36",Ouml:"\xD6",ouml:"\xF6",ovbar:"\u233D",OverBar:"\u203E",OverBrace:"\u23DE",OverBracket:"\u23B4",OverParenthesis:"\u23DC",par:"\u2225",para:"\xB6",parallel:"\u2225",parsim:"\u2AF3",parsl:"\u2AFD",part:"\u2202",PartialD:"\u2202",Pcy:"\u041F",pcy:"\u043F",percnt:"%",period:".",permil:"\u2030",perp:"\u22A5",pertenk:"\u2031",Pfr:"\u{1D513}",pfr:"\u{1D52D}",Phi:"\u03A6",phi:"\u03C6",phiv:"\u03D5",phmmat:"\u2133",phone:"\u260E",Pi:"\u03A0",pi:"\u03C0",pitchfork:"\u22D4",piv:"\u03D6",planck:"\u210F",planckh:"\u210E",plankv:"\u210F",plus:"+",plusacir:"\u2A23",plusb:"\u229E",pluscir:"\u2A22",plusdo:"\u2214",plusdu:"\u2A25",pluse:"\u2A72",PlusMinus:"\xB1",plusmn:"\xB1",plussim:"\u2A26",plustwo:"\u2A27",pm:"\xB1",Poincareplane:"\u210C",pointint:"\u2A15",Popf:"\u2119",popf:"\u{1D561}",pound:"\xA3",Pr:"\u2ABB",pr:"\u227A",prap:"\u2AB7",prcue:"\u227C",prE:"\u2AB3",pre:"\u2AAF",prec:"\u227A",precapprox:"\u2AB7",preccurlyeq:"\u227C",Precedes:"\u227A",PrecedesEqual:"\u2AAF",PrecedesSlantEqual:"\u227C",PrecedesTilde:"\u227E",preceq:"\u2AAF",precnapprox:"\u2AB9",precneqq:"\u2AB5",precnsim:"\u22E8",precsim:"\u227E",Prime:"\u2033",prime:"\u2032",primes:"\u2119",prnap:"\u2AB9",prnE:"\u2AB5",prnsim:"\u22E8",prod:"\u220F",Product:"\u220F",profalar:"\u232E",profline:"\u2312",profsurf:"\u2313",prop:"\u221D",Proportion:"\u2237",Proportional:"\u221D",propto:"\u221D",prsim:"\u227E",prurel:"\u22B0",Pscr:"\u{1D4AB}",pscr:"\u{1D4C5}",Psi:"\u03A8",psi:"\u03C8",puncsp:"\u2008",Qfr:"\u{1D514}",qfr:"\u{1D52E}",qint:"\u2A0C",Qopf:"\u211A",qopf:"\u{1D562}",qprime:"\u2057",Qscr:"\u{1D4AC}",qscr:"\u{1D4C6}",quaternions:"\u210D",quatint:"\u2A16",quest:"?",questeq:"\u225F",QUOT:'"',quot:'"',rAarr:"\u21DB",race:"\u223D\u0331",Racute:"\u0154",racute:"\u0155",radic:"\u221A",raemptyv:"\u29B3",Rang:"\u27EB",rang:"\u27E9",rangd:"\u2992",range:"\u29A5",rangle:"\u27E9",raquo:"\xBB",Rarr:"\u21A0",rArr:"\u21D2",rarr:"\u2192",rarrap:"\u2975",rarrb:"\u21E5",rarrbfs:"\u2920",rarrc:"\u2933",rarrfs:"\u291E",rarrhk:"\u21AA",rarrlp:"\u21AC",rarrpl:"\u2945",rarrsim:"\u2974",Rarrtl:"\u2916",rarrtl:"\u21A3",rarrw:"\u219D",rAtail:"\u291C",ratail:"\u291A",ratio:"\u2236",rationals:"\u211A",RBarr:"\u2910",rBarr:"\u290F",rbarr:"\u290D",rbbrk:"\u2773",rbrace:"}",rbrack:"]",rbrke:"\u298C",rbrksld:"\u298E",rbrkslu:"\u2990",Rcaron:"\u0158",rcaron:"\u0159",Rcedil:"\u0156",rcedil:"\u0157",rceil:"\u2309",rcub:"}",Rcy:"\u0420",rcy:"\u0440",rdca:"\u2937",rdldhar:"\u2969",rdquo:"\u201D",rdquor:"\u201D",rdsh:"\u21B3",Re:"\u211C",real:"\u211C",realine:"\u211B",realpart:"\u211C",reals:"\u211D",rect:"\u25AD",REG:"\xAE",reg:"\xAE",ReverseElement:"\u220B",ReverseEquilibrium:"\u21CB",ReverseUpEquilibrium:"\u296F",rfisht:"\u297D",rfloor:"\u230B",Rfr:"\u211C",rfr:"\u{1D52F}",rHar:"\u2964",rhard:"\u21C1",rharu:"\u21C0",rharul:"\u296C",Rho:"\u03A1",rho:"\u03C1",rhov:"\u03F1",RightAngleBracket:"\u27E9",RightArrow:"\u2192",Rightarrow:"\u21D2",rightarrow:"\u2192",RightArrowBar:"\u21E5",RightArrowLeftArrow:"\u21C4",rightarrowtail:"\u21A3",RightCeiling:"\u2309",RightDoubleBracket:"\u27E7",RightDownTeeVector:"\u295D",RightDownVector:"\u21C2",RightDownVectorBar:"\u2955",RightFloor:"\u230B",rightharpoondown:"\u21C1",rightharpoonup:"\u21C0",rightleftarrows:"\u21C4",rightleftharpoons:"\u21CC",rightrightarrows:"\u21C9",rightsquigarrow:"\u219D",RightTee:"\u22A2",RightTeeArrow:"\u21A6",RightTeeVector:"\u295B",rightthreetimes:"\u22CC",RightTriangle:"\u22B3",RightTriangleBar:"\u29D0",RightTriangleEqual:"\u22B5",RightUpDownVector:"\u294F",RightUpTeeVector:"\u295C",RightUpVector:"\u21BE",RightUpVectorBar:"\u2954",RightVector:"\u21C0",RightVectorBar:"\u2953",ring:"\u02DA",risingdotseq:"\u2253",rlarr:"\u21C4",rlhar:"\u21CC",rlm:"\u200F",rmoust:"\u23B1",rmoustache:"\u23B1",rnmid:"\u2AEE",roang:"\u27ED",roarr:"\u21FE",robrk:"\u27E7",ropar:"\u2986",Ropf:"\u211D",ropf:"\u{1D563}",roplus:"\u2A2E",rotimes:"\u2A35",RoundImplies:"\u2970",rpar:")",rpargt:"\u2994",rppolint:"\u2A12",rrarr:"\u21C9",Rrightarrow:"\u21DB",rsaquo:"\u203A",Rscr:"\u211B",rscr:"\u{1D4C7}",Rsh:"\u21B1",rsh:"\u21B1",rsqb:"]",rsquo:"\u2019",rsquor:"\u2019",rthree:"\u22CC",rtimes:"\u22CA",rtri:"\u25B9",rtrie:"\u22B5",rtrif:"\u25B8",rtriltri:"\u29CE",RuleDelayed:"\u29F4",ruluhar:"\u2968",rx:"\u211E",Sacute:"\u015A",sacute:"\u015B",sbquo:"\u201A",Sc:"\u2ABC",sc:"\u227B",scap:"\u2AB8",Scaron:"\u0160",scaron:"\u0161",sccue:"\u227D",scE:"\u2AB4",sce:"\u2AB0",Scedil:"\u015E",scedil:"\u015F",Scirc:"\u015C",scirc:"\u015D",scnap:"\u2ABA",scnE:"\u2AB6",scnsim:"\u22E9",scpolint:"\u2A13",scsim:"\u227F",Scy:"\u0421",scy:"\u0441",sdot:"\u22C5",sdotb:"\u22A1",sdote:"\u2A66",searhk:"\u2925",seArr:"\u21D8",searr:"\u2198",searrow:"\u2198",sect:"\xA7",semi:";",seswar:"\u2929",setminus:"\u2216",setmn:"\u2216",sext:"\u2736",Sfr:"\u{1D516}",sfr:"\u{1D530}",sfrown:"\u2322",sharp:"\u266F",SHCHcy:"\u0429",shchcy:"\u0449",SHcy:"\u0428",shcy:"\u0448",ShortDownArrow:"\u2193",ShortLeftArrow:"\u2190",shortmid:"\u2223",shortparallel:"\u2225",ShortRightArrow:"\u2192",ShortUpArrow:"\u2191",shy:"\xAD",Sigma:"\u03A3",sigma:"\u03C3",sigmaf:"\u03C2",sigmav:"\u03C2",sim:"\u223C",simdot:"\u2A6A",sime:"\u2243",simeq:"\u2243",simg:"\u2A9E",simgE:"\u2AA0",siml:"\u2A9D",simlE:"\u2A9F",simne:"\u2246",simplus:"\u2A24",simrarr:"\u2972",slarr:"\u2190",SmallCircle:"\u2218",smallsetminus:"\u2216",smashp:"\u2A33",smeparsl:"\u29E4",smid:"\u2223",smile:"\u2323",smt:"\u2AAA",smte:"\u2AAC",smtes:"\u2AAC\uFE00",SOFTcy:"\u042C",softcy:"\u044C",sol:"/",solb:"\u29C4",solbar:"\u233F",Sopf:"\u{1D54A}",sopf:"\u{1D564}",spades:"\u2660",spadesuit:"\u2660",spar:"\u2225",sqcap:"\u2293",sqcaps:"\u2293\uFE00",sqcup:"\u2294",sqcups:"\u2294\uFE00",Sqrt:"\u221A",sqsub:"\u228F",sqsube:"\u2291",sqsubset:"\u228F",sqsubseteq:"\u2291",sqsup:"\u2290",sqsupe:"\u2292",sqsupset:"\u2290",sqsupseteq:"\u2292",squ:"\u25A1",Square:"\u25A1",square:"\u25A1",SquareIntersection:"\u2293",SquareSubset:"\u228F",SquareSubsetEqual:"\u2291",SquareSuperset:"\u2290",SquareSupersetEqual:"\u2292",SquareUnion:"\u2294",squarf:"\u25AA",squf:"\u25AA",srarr:"\u2192",Sscr:"\u{1D4AE}",sscr:"\u{1D4C8}",ssetmn:"\u2216",ssmile:"\u2323",sstarf:"\u22C6",Star:"\u22C6",star:"\u2606",starf:"\u2605",straightepsilon:"\u03F5",straightphi:"\u03D5",strns:"\xAF",Sub:"\u22D0",sub:"\u2282",subdot:"\u2ABD",subE:"\u2AC5",sube:"\u2286",subedot:"\u2AC3",submult:"\u2AC1",subnE:"\u2ACB",subne:"\u228A",subplus:"\u2ABF",subrarr:"\u2979",Subset:"\u22D0",subset:"\u2282",subseteq:"\u2286",subseteqq:"\u2AC5",SubsetEqual:"\u2286",subsetneq:"\u228A",subsetneqq:"\u2ACB",subsim:"\u2AC7",subsub:"\u2AD5",subsup:"\u2AD3",succ:"\u227B",succapprox:"\u2AB8",succcurlyeq:"\u227D",Succeeds:"\u227B",SucceedsEqual:"\u2AB0",SucceedsSlantEqual:"\u227D",SucceedsTilde:"\u227F",succeq:"\u2AB0",succnapprox:"\u2ABA",succneqq:"\u2AB6",succnsim:"\u22E9",succsim:"\u227F",SuchThat:"\u220B",Sum:"\u2211",sum:"\u2211",sung:"\u266A",Sup:"\u22D1",sup:"\u2283",sup1:"\xB9",sup2:"\xB2",sup3:"\xB3",supdot:"\u2ABE",supdsub:"\u2AD8",supE:"\u2AC6",supe:"\u2287",supedot:"\u2AC4",Superset:"\u2283",SupersetEqual:"\u2287",suphsol:"\u27C9",suphsub:"\u2AD7",suplarr:"\u297B",supmult:"\u2AC2",supnE:"\u2ACC",supne:"\u228B",supplus:"\u2AC0",Supset:"\u22D1",supset:"\u2283",supseteq:"\u2287",supseteqq:"\u2AC6",supsetneq:"\u228B",supsetneqq:"\u2ACC",supsim:"\u2AC8",supsub:"\u2AD4",supsup:"\u2AD6",swarhk:"\u2926",swArr:"\u21D9",swarr:"\u2199",swarrow:"\u2199",swnwar:"\u292A",szlig:"\xDF",Tab:"	",target:"\u2316",Tau:"\u03A4",tau:"\u03C4",tbrk:"\u23B4",Tcaron:"\u0164",tcaron:"\u0165",Tcedil:"\u0162",tcedil:"\u0163",Tcy:"\u0422",tcy:"\u0442",tdot:"\u20DB",telrec:"\u2315",Tfr:"\u{1D517}",tfr:"\u{1D531}",there4:"\u2234",Therefore:"\u2234",therefore:"\u2234",Theta:"\u0398",theta:"\u03B8",thetasym:"\u03D1",thetav:"\u03D1",thickapprox:"\u2248",thicksim:"\u223C",ThickSpace:"\u205F\u200A",thinsp:"\u2009",ThinSpace:"\u2009",thkap:"\u2248",thksim:"\u223C",THORN:"\xDE",thorn:"\xFE",Tilde:"\u223C",tilde:"\u02DC",TildeEqual:"\u2243",TildeFullEqual:"\u2245",TildeTilde:"\u2248",times:"\xD7",timesb:"\u22A0",timesbar:"\u2A31",timesd:"\u2A30",tint:"\u222D",toea:"\u2928",top:"\u22A4",topbot:"\u2336",topcir:"\u2AF1",Topf:"\u{1D54B}",topf:"\u{1D565}",topfork:"\u2ADA",tosa:"\u2929",tprime:"\u2034",TRADE:"\u2122",trade:"\u2122",triangle:"\u25B5",triangledown:"\u25BF",triangleleft:"\u25C3",trianglelefteq:"\u22B4",triangleq:"\u225C",triangleright:"\u25B9",trianglerighteq:"\u22B5",tridot:"\u25EC",trie:"\u225C",triminus:"\u2A3A",TripleDot:"\u20DB",triplus:"\u2A39",trisb:"\u29CD",tritime:"\u2A3B",trpezium:"\u23E2",Tscr:"\u{1D4AF}",tscr:"\u{1D4C9}",TScy:"\u0426",tscy:"\u0446",TSHcy:"\u040B",tshcy:"\u045B",Tstrok:"\u0166",tstrok:"\u0167",twixt:"\u226C",twoheadleftarrow:"\u219E",twoheadrightarrow:"\u21A0",Uacute:"\xDA",uacute:"\xFA",Uarr:"\u219F",uArr:"\u21D1",uarr:"\u2191",Uarrocir:"\u2949",Ubrcy:"\u040E",ubrcy:"\u045E",Ubreve:"\u016C",ubreve:"\u016D",Ucirc:"\xDB",ucirc:"\xFB",Ucy:"\u0423",ucy:"\u0443",udarr:"\u21C5",Udblac:"\u0170",udblac:"\u0171",udhar:"\u296E",ufisht:"\u297E",Ufr:"\u{1D518}",ufr:"\u{1D532}",Ugrave:"\xD9",ugrave:"\xF9",uHar:"\u2963",uharl:"\u21BF",uharr:"\u21BE",uhblk:"\u2580",ulcorn:"\u231C",ulcorner:"\u231C",ulcrop:"\u230F",ultri:"\u25F8",Umacr:"\u016A",umacr:"\u016B",uml:"\xA8",UnderBar:"_",UnderBrace:"\u23DF",UnderBracket:"\u23B5",UnderParenthesis:"\u23DD",Union:"\u22C3",UnionPlus:"\u228E",Uogon:"\u0172",uogon:"\u0173",Uopf:"\u{1D54C}",uopf:"\u{1D566}",UpArrow:"\u2191",Uparrow:"\u21D1",uparrow:"\u2191",UpArrowBar:"\u2912",UpArrowDownArrow:"\u21C5",UpDownArrow:"\u2195",Updownarrow:"\u21D5",updownarrow:"\u2195",UpEquilibrium:"\u296E",upharpoonleft:"\u21BF",upharpoonright:"\u21BE",uplus:"\u228E",UpperLeftArrow:"\u2196",UpperRightArrow:"\u2197",Upsi:"\u03D2",upsi:"\u03C5",upsih:"\u03D2",Upsilon:"\u03A5",upsilon:"\u03C5",UpTee:"\u22A5",UpTeeArrow:"\u21A5",upuparrows:"\u21C8",urcorn:"\u231D",urcorner:"\u231D",urcrop:"\u230E",Uring:"\u016E",uring:"\u016F",urtri:"\u25F9",Uscr:"\u{1D4B0}",uscr:"\u{1D4CA}",utdot:"\u22F0",Utilde:"\u0168",utilde:"\u0169",utri:"\u25B5",utrif:"\u25B4",uuarr:"\u21C8",Uuml:"\xDC",uuml:"\xFC",uwangle:"\u29A7",vangrt:"\u299C",varepsilon:"\u03F5",varkappa:"\u03F0",varnothing:"\u2205",varphi:"\u03D5",varpi:"\u03D6",varpropto:"\u221D",vArr:"\u21D5",varr:"\u2195",varrho:"\u03F1",varsigma:"\u03C2",varsubsetneq:"\u228A\uFE00",varsubsetneqq:"\u2ACB\uFE00",varsupsetneq:"\u228B\uFE00",varsupsetneqq:"\u2ACC\uFE00",vartheta:"\u03D1",vartriangleleft:"\u22B2",vartriangleright:"\u22B3",Vbar:"\u2AEB",vBar:"\u2AE8",vBarv:"\u2AE9",Vcy:"\u0412",vcy:"\u0432",VDash:"\u22AB",Vdash:"\u22A9",vDash:"\u22A8",vdash:"\u22A2",Vdashl:"\u2AE6",Vee:"\u22C1",vee:"\u2228",veebar:"\u22BB",veeeq:"\u225A",vellip:"\u22EE",Verbar:"\u2016",verbar:"|",Vert:"\u2016",vert:"|",VerticalBar:"\u2223",VerticalLine:"|",VerticalSeparator:"\u2758",VerticalTilde:"\u2240",VeryThinSpace:"\u200A",Vfr:"\u{1D519}",vfr:"\u{1D533}",vltri:"\u22B2",vnsub:"\u2282\u20D2",vnsup:"\u2283\u20D2",Vopf:"\u{1D54D}",vopf:"\u{1D567}",vprop:"\u221D",vrtri:"\u22B3",Vscr:"\u{1D4B1}",vscr:"\u{1D4CB}",vsubnE:"\u2ACB\uFE00",vsubne:"\u228A\uFE00",vsupnE:"\u2ACC\uFE00",vsupne:"\u228B\uFE00",Vvdash:"\u22AA",vzigzag:"\u299A",Wcirc:"\u0174",wcirc:"\u0175",wedbar:"\u2A5F",Wedge:"\u22C0",wedge:"\u2227",wedgeq:"\u2259",weierp:"\u2118",Wfr:"\u{1D51A}",wfr:"\u{1D534}",Wopf:"\u{1D54E}",wopf:"\u{1D568}",wp:"\u2118",wr:"\u2240",wreath:"\u2240",Wscr:"\u{1D4B2}",wscr:"\u{1D4CC}",xcap:"\u22C2",xcirc:"\u25EF",xcup:"\u22C3",xdtri:"\u25BD",Xfr:"\u{1D51B}",xfr:"\u{1D535}",xhArr:"\u27FA",xharr:"\u27F7",Xi:"\u039E",xi:"\u03BE",xlArr:"\u27F8",xlarr:"\u27F5",xmap:"\u27FC",xnis:"\u22FB",xodot:"\u2A00",Xopf:"\u{1D54F}",xopf:"\u{1D569}",xoplus:"\u2A01",xotime:"\u2A02",xrArr:"\u27F9",xrarr:"\u27F6",Xscr:"\u{1D4B3}",xscr:"\u{1D4CD}",xsqcup:"\u2A06",xuplus:"\u2A04",xutri:"\u25B3",xvee:"\u22C1",xwedge:"\u22C0",Yacute:"\xDD",yacute:"\xFD",YAcy:"\u042F",yacy:"\u044F",Ycirc:"\u0176",ycirc:"\u0177",Ycy:"\u042B",ycy:"\u044B",yen:"\xA5",Yfr:"\u{1D51C}",yfr:"\u{1D536}",YIcy:"\u0407",yicy:"\u0457",Yopf:"\u{1D550}",yopf:"\u{1D56A}",Yscr:"\u{1D4B4}",yscr:"\u{1D4CE}",YUcy:"\u042E",yucy:"\u044E",Yuml:"\u0178",yuml:"\xFF",Zacute:"\u0179",zacute:"\u017A",Zcaron:"\u017D",zcaron:"\u017E",Zcy:"\u0417",zcy:"\u0437",Zdot:"\u017B",zdot:"\u017C",zeetrf:"\u2128",ZeroWidthSpace:"\u200B",Zeta:"\u0396",zeta:"\u03B6",Zfr:"\u2128",zfr:"\u{1D537}",ZHcy:"\u0416",zhcy:"\u0436",zigrarr:"\u21DD",Zopf:"\u2124",zopf:"\u{1D56B}",Zscr:"\u{1D4B5}",zscr:"\u{1D4CF}",zwj:"\u200D",zwnj:"\u200C"}),e.entityMap=e.HTML_ENTITIES}),$r=Gr.NAMESPACE,Oo=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,af=new RegExp("[\\-\\.0-9"+Oo.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),uf=new RegExp("^"+Oo.source+af.source+"*(?::"+Oo.source+af.source+"*)?$"),Vr=0,ot=1,qt=2,zr=3,Kt=4,Jt=5,Hr=6,pi=7;function Qt(t,e){this.message=t,this.locator=e,Error.captureStackTrace&&Error.captureStackTrace(this,Qt)}Qt.prototype=new Error,Qt.prototype.name=Qt.name;function lf(){}lf.prototype={parse:function(t,e,r){var n=this.domBuilder;n.startDocument(),df(e,e={}),Y_(t,e,r,n,this.errorHandler),n.endDocument()}};function Y_(t,e,r,n,i){function s(O){if(O>65535){O-=65536;var Q=55296+(O>>10),Ft=56320+(O&1023);return String.fromCharCode(Q,Ft)}else return String.fromCharCode(O)}function o(O){var Q=O.slice(1,-1);return Object.hasOwnProperty.call(r,Q)?r[Q]:Q.charAt(0)==="#"?s(parseInt(Q.substr(1).replace("x","0x"))):(i.error("entity not found:"+O),O)}function a(O){if(O>b){var Q=t.substring(b,O).replace(/&#?\w+;/g,o);p&&u(b),n.characters(Q,0,O-b),b=O}}function u(O,Q){for(;O>=c&&(Q=d.exec(t));)l=Q.index,c=l+Q[0].length,p.lineNumber++;p.columnNumber=O-l+1}for(var l=0,c=0,d=/.*(?:\r\n?|\n)|.*$/g,p=n.locator,f=[{currentNSMap:e}],g={},b=0;;){try{var m=t.indexOf("<",b);if(m<0){if(!t.substr(b).match(/^\s*$/)){var x=n.doc,y=x.createTextNode(t.substr(b));x.appendChild(y),n.currentElement=y}return}switch(m>b&&a(m),t.charAt(m+1)){case"/":var F=t.indexOf(">",m+3),_=t.substring(m+2,F).replace(/[ \t\n\r]+$/g,""),A=f.pop();F<0?(_=t.substring(m+2).replace(/[\s<].*/,""),i.error("end tag name: "+_+" is not complete:"+A.tagName),F=m+1+_.length):_.match(/\s</)&&(_=_.replace(/[\s<].*/,""),i.error("end tag name: "+_+" maybe not complete"),F=m+1+_.length);var T=A.localNSMap,P=A.tagName==_,M=P||A.tagName&&A.tagName.toLowerCase()==_.toLowerCase();if(M){if(n.endElement(A.uri,A.localName,_),T)for(var S in T)Object.prototype.hasOwnProperty.call(T,S)&&n.endPrefixMapping(S);P||i.fatalError("end tag name: "+_+" is not match the current start tagName:"+A.tagName)}else f.push(A);F++;break;case"?":p&&u(m),F=Q_(t,m,n);break;case"!":p&&u(m),F=J_(t,m,n,i);break;default:p&&u(m);var C=new ff,w=f[f.length-1].currentNSMap,F=Z_(t,m,C,w,o,i),N=C.length;if(!C.closed&&K_(t,F,C.tagName,g)&&(C.closed=!0,r.nbsp||i.warning("unclosed xml attribute")),p&&N){for(var D=cf(p,{}),I=0;I<N;I++){var q=C[I];u(q.offset),q.locator=cf(p,{})}n.locator=D,hf(C,n,w)&&f.push(C),n.locator=p}else hf(C,n,w)&&f.push(C);$r.isHTML(C.uri)&&!C.closed?F=q_(t,F,C.tagName,o,n):F++}}catch(O){if(O instanceof Qt)throw O;i.error("element parse error: "+O),F=-1}F>b?b=F:a(Math.max(m,b)+1)}}function cf(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function Z_(t,e,r,n,i,s){function o(f,g,b){r.attributeNames.hasOwnProperty(f)&&s.fatalError("Attribute "+f+" redefined"),r.addValue(f,g.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,i),b)}for(var a,u,l=++e,c=Vr;;){var d=t.charAt(l);switch(d){case"=":if(c===ot)a=t.slice(e,l),c=zr;else if(c===qt)c=zr;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(c===zr||c===ot)if(c===ot&&(s.warning('attribute value must after "="'),a=t.slice(e,l)),e=l+1,l=t.indexOf(d,e),l>0)u=t.slice(e,l),o(a,u,e-1),c=Jt;else throw new Error("attribute value no end '"+d+"' match");else if(c==Kt)u=t.slice(e,l),o(a,u,e),s.warning('attribute "'+a+'" missed start quot('+d+")!!"),e=l+1,c=Jt;else throw new Error('attribute value must after "="');break;case"/":switch(c){case Vr:r.setTagName(t.slice(e,l));case Jt:case Hr:case pi:c=pi,r.closed=!0;case Kt:case ot:break;case qt:r.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return s.error("unexpected end of input"),c==Vr&&r.setTagName(t.slice(e,l)),l;case">":switch(c){case Vr:r.setTagName(t.slice(e,l));case Jt:case Hr:case pi:break;case Kt:case ot:u=t.slice(e,l),u.slice(-1)==="/"&&(r.closed=!0,u=u.slice(0,-1));case qt:c===qt&&(u=a),c==Kt?(s.warning('attribute "'+u+'" missed quot(")!'),o(a,u,e)):((!$r.isHTML(n[""])||!u.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+u+'" missed value!! "'+u+'" instead!!'),o(u,u,e));break;case zr:throw new Error("attribute value missed!!")}return l;case"\x80":d=" ";default:if(d<=" ")switch(c){case Vr:r.setTagName(t.slice(e,l)),c=Hr;break;case ot:a=t.slice(e,l),c=qt;break;case Kt:var u=t.slice(e,l);s.warning('attribute "'+u+'" missed quot(")!!'),o(a,u,e);case Jt:c=Hr;break}else switch(c){case qt:var p=r.tagName;(!$r.isHTML(n[""])||!a.match(/^(?:disabled|checked|selected)$/i))&&s.warning('attribute "'+a+'" missed value!! "'+a+'" instead2!!'),o(a,a,e),e=l,c=ot;break;case Jt:s.warning('attribute space is required"'+a+'"!!');case Hr:c=ot,e=l;break;case zr:c=Kt,e=l;break;case pi:throw new Error("elements closed character '/' and '>' must be connected to")}}l++}}function hf(t,e,r){for(var n=t.tagName,i=null,d=t.length;d--;){var s=t[d],o=s.qName,a=s.value,p=o.indexOf(":");if(p>0)var u=s.prefix=o.slice(0,p),l=o.slice(p+1),c=u==="xmlns"&&l;else l=o,u=null,c=o==="xmlns"&&"";s.localName=l,c!==!1&&(i==null&&(i={},df(r,r={})),r[c]=i[c]=a,s.uri=$r.XMLNS,e.startPrefixMapping(c,a))}for(var d=t.length;d--;){s=t[d];var u=s.prefix;u&&(u==="xml"&&(s.uri=$r.XML),u!=="xmlns"&&(s.uri=r[u||""]))}var p=n.indexOf(":");p>0?(u=t.prefix=n.slice(0,p),l=t.localName=n.slice(p+1)):(u=null,l=t.localName=n);var f=t.uri=r[u||""];if(e.startElement(f,l,n,t),t.closed){if(e.endElement(f,l,n),i)for(u in i)Object.prototype.hasOwnProperty.call(i,u)&&e.endPrefixMapping(u)}else return t.currentNSMap=r,t.localNSMap=i,!0}function q_(t,e,r,n,i){if(/^(?:script|textarea)$/i.test(r)){var s=t.indexOf("</"+r+">",e),o=t.substring(e+1,s);if(/[&<]/.test(o))return/^script$/i.test(r)?(i.characters(o,0,o.length),s):(o=o.replace(/&#?\w+;/g,n),i.characters(o,0,o.length),s)}return e+1}function K_(t,e,r,n){var i=n[r];return i==null&&(i=t.lastIndexOf("</"+r+">"),i<e&&(i=t.lastIndexOf("</"+r)),n[r]=i),i<e}function df(t,e){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}function J_(t,e,r,n){var i=t.charAt(e+2);switch(i){case"-":if(t.charAt(e+3)==="-"){var s=t.indexOf("-->",e+4);return s>e?(r.comment(t,e+4,s-e-4),s+3):(n.error("Unclosed comment"),-1)}else return-1;default:if(t.substr(e+3,6)=="CDATA["){var s=t.indexOf("]]>",e+9);return r.startCDATA(),r.characters(t,e+9,s-e-9),r.endCDATA(),s+3}var o=ex(t,e),a=o.length;if(a>1&&/!doctype/i.test(o[0][0])){var u=o[1][0],l=!1,c=!1;a>3&&(/^public$/i.test(o[2][0])?(l=o[3][0],c=a>4&&o[4][0]):/^system$/i.test(o[2][0])&&(c=o[3][0]));var d=o[a-1];return r.startDTD(u,l,c),r.endDTD(),d.index+d[0].length}}return-1}function Q_(t,e,r){var n=t.indexOf("?>",e);if(n){var i=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(i){var s=i[0].length;return r.processingInstruction(i[1],i[2]),n+2}else return-1}return-1}function ff(){this.attributeNames={}}ff.prototype={setTagName:function(t){if(!uf.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},addValue:function(t,e,r){if(!uf.test(t))throw new Error("invalid attribute:"+t);this.attributeNames[t]=this.length,this[this.length++]={qName:t,value:e,offset:r}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}};function ex(t,e){var r,n=[],i=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(i.lastIndex=e,i.exec(t);r=i.exec(t);)if(n.push(r),r[1])return n}var tx=lf,rx=Qt,pf={XMLReader:tx,ParseError:rx},nx=ko.DOMImplementation,gf=Gr.NAMESPACE,ix=pf.ParseError,sx=pf.XMLReader;function mf(t){return t.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function bf(t){this.options=t||{locator:{}}}bf.prototype.parseFromString=function(t,e){var r=this.options,n=new sx,i=r.domBuilder||new Wr,s=r.errorHandler,o=r.locator,a=r.xmlns||{},u=/\/x?html?$/.test(e),l=u?of.HTML_ENTITIES:of.XML_ENTITIES;o&&i.setDocumentLocator(o),n.errorHandler=ox(s,i,o),n.domBuilder=r.domBuilder||i,u&&(a[""]=gf.HTML),a.xml=a.xml||gf.XML;var c=r.normalizeLineEndings||mf;return t&&typeof t=="string"?n.parse(c(t),a,l):n.errorHandler.error("invalid doc source"),i.doc};function ox(t,e,r){if(!t){if(e instanceof Wr)return e;t=e}var n={},i=t instanceof Function;r=r||{};function s(o){var a=t[o];!a&&i&&(a=t.length==2?function(u){t(o,u)}:t),n[o]=a&&function(u){a("[xmldom "+o+"]	"+u+Uo(r))}||function(){}}return s("warning"),s("error"),s("fatalError"),n}function Wr(){this.cdata=!1}function er(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}Wr.prototype={startDocument:function(){this.doc=new nx().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,r,n){var i=this.doc,s=i.createElementNS(t,r||e),o=n.length;gi(this,s),this.currentElement=s,this.locator&&er(this.locator,s);for(var a=0;a<o;a++){var t=n.getURI(a),u=n.getValue(a),r=n.getQName(a),l=i.createAttributeNS(t,r);this.locator&&er(n.getLocator(a),l),l.value=l.nodeValue=u,s.setAttributeNode(l)}},endElement:function(t,e,r){var n=this.currentElement,i=n.tagName;this.currentElement=n.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var r=this.doc.createProcessingInstruction(t,e);this.locator&&er(this.locator,r),gi(this,r)},ignorableWhitespace:function(t,e,r){},characters:function(t,e,r){if(t=vf.apply(this,arguments),t){if(this.cdata)var n=this.doc.createCDATASection(t);else var n=this.doc.createTextNode(t);this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(t)&&this.doc.appendChild(n),this.locator&&er(this.locator,n)}},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,r){t=vf.apply(this,arguments);var n=this.doc.createComment(t);this.locator&&er(this.locator,n),gi(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,r){var n=this.doc.implementation;if(n&&n.createDocumentType){var i=n.createDocumentType(t,e,r);this.locator&&er(this.locator,i),gi(this,i),this.doc.doctype=i}},warning:function(t){console.warn("[xmldom warning]	"+t,Uo(this.locator))},error:function(t){console.error("[xmldom error]	"+t,Uo(this.locator))},fatalError:function(t){throw new ix(t,this.locator)}};function Uo(t){if(t)return`
@`+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}function vf(t,e,r){return typeof t=="string"?t.substr(e,r):t.length>=e+r||e?new java.lang.String(t,e,r)+"":t}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){Wr.prototype[t]=function(){return null}});function gi(t,e){t.currentElement?t.currentElement.appendChild(e):t.doc.appendChild(e)}var ax=Wr,ux=mf,lx=bf,cx={__DOMHandler:ax,normalizeLineEndings:ux,DOMParser:lx},hx=ko.DOMImplementation,dx=ko.XMLSerializer,yf=cx.DOMParser,TT={DOMImplementation:hx,XMLSerializer:dx,DOMParser:yf};const fx={createCanvas:(t,e)=>new OffscreenCanvas(t!=null?t:0,e!=null?e:0),getCanvasRenderingContext2D:()=>OffscreenCanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>globalThis.location.href,getFontFaceSet:()=>globalThis.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>new yf().parseFromString(t,"text/xml")};var px={__proto__:null};function _f(t,e,r){const n=r?e.maxSupportedFragmentPrecision:e.maxSupportedVertexPrecision;if(t.substring(0,9)!=="precision"){let i=r?e.requestedFragmentPrecision:e.requestedVertexPrecision;if(i==="highp"&&n!=="highp"&&(i="mediump"),t.substring(0,8)!=="#version")return`precision ${i} float;
${t}`;const s=t.indexOf(`
`);return`${t.substring(0,s+1)}precision ${i} float;
${t.substring(s+1)}`}else if(n!=="highp"&&t.substring(0,15)==="precision highp")return t.replace("precision highp","precision mediump");return t}const xf={};let Xr=xf;function Af(){return(Xr===xf||Xr!=null&&Xr.isContextLost())&&(Xr=Z.get().createCanvas().getContext("webgl2",{})),Xr}let mi;function Cf(){if(!mi){mi="mediump";const t=Af();t&&t.getShaderPrecisionFormat&&(mi=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision?"highp":"mediump")}return mi}const gx={},mx={};function wf(t,{name:e="pixi-program"},r=!0){e=e.replace(/\s+/g,"-"),e+=r?"-fragment":"-vertex";const n=r?gx:mx;if(n[e]?(n[e]++,e+=`-${n[e]}`):n[e]=1,t.indexOf("#define SHADER_NAME")!==-1)return t;const i=`#define SHADER_NAME ${e}`;if(t.substring(0,8)!=="#version")return`${i}
${t}`;const s=t.indexOf(`
`);return`${t.substring(0,s+1)}${i}
${t.substring(s+1)}`}function Tf(t,{version:e="300 es"}){return t.substring(0,8)==="#version"?t:`#version ${e}
${t}`}var bx=Object.defineProperty,Sf=Object.getOwnPropertySymbols,vx=Object.prototype.hasOwnProperty,yx=Object.prototype.propertyIsEnumerable,Ef=(t,e,r)=>e in t?bx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,If=(t,e)=>{for(var r in e||(e={}))vx.call(e,r)&&Ef(t,r,e[r]);if(Sf)for(var r of Sf(e))yx.call(e,r)&&Ef(t,r,e[r]);return t};const Lo={ensurePrecision:_f,setProgramName:wf,setProgramVersion:Tf},tr=class{constructor(t){t=If(If({},tr.defaultOptions),t);const e={ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:Cf()},setProgramName:{name:t.name},setProgramVersion:{version:"300 es"}};let r=t.fragment,n=t.vertex;Object.keys(Lo).forEach(i=>{var s;const o=(s=e[i])!=null?s:{};r=Lo[i](r,o,!0),n=Lo[i](n,o,!1)}),this.fragment=r,this.vertex=n,this.key=`${this.vertex}:${this.fragment}`}destroy(){this.fragment=null,this.vertex=null,this.attributeData=null,this.uniformData=null,this.uniformBlockData=null,this.transformFeedbackVaryings=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return tr.programCached[e]||(tr.programCached[e]=new tr(t)),tr.programCached[e]}};let Be=tr;Be.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"},Be.programCached=Object.create(null);function bi(t){var e,r,n;const i=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,s=/@group\((\d+)\)/,o=/@binding\((\d+)\)/,a=/var(<[^>]+>)? (\w+)/,u=/:\s*(\w+)/,l=/struct\s+(\w+)\s*{([^}]+)}/g,c=/(\w+)\s*:\s*([\w\<\>]+)/g,d=/struct\s+(\w+)/,p=(e=t.match(i))==null?void 0:e.map(g=>({group:parseInt(g.match(s)[1],10),binding:parseInt(g.match(o)[1],10),name:g.match(a)[2],isUniform:g.match(a)[1]==="<uniform>",type:g.match(u)[1]}));if(!p)return{groups:[],structs:[]};const f=(n=(r=t.match(l))==null?void 0:r.map(g=>{const b=g.match(d)[1],m=g.match(c).reduce((x,y)=>{const[_,A]=y.split(":");return x[_.trim()]=A.trim(),x},{});return m?{name:b,members:m}:null}).filter(({name:g})=>p.some(b=>b.type===g)))!=null?n:[];return{groups:p,structs:f}}var rr=(t=>(t[t.VERTEX=1]="VERTEX",t[t.FRAGMENT=2]="FRAGMENT",t[t.COMPUTE=4]="COMPUTE",t))(rr||{});function Pf({groups:t}){const e=[];for(let r=0;r<t.length;r++){const n=t[r];e[n.group]||(e[n.group]=[]),n.isUniform?e[n.group].push({binding:n.binding,visibility:rr.VERTEX|rr.FRAGMENT,buffer:{type:"uniform"}}):n.type==="sampler"?e[n.group].push({binding:n.binding,visibility:rr.FRAGMENT,sampler:{type:"filtering"}}):n.type==="texture_2d"&&e[n.group].push({binding:n.binding,visibility:rr.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return e}function Bf({groups:t}){const e=[];for(let r=0;r<t.length;r++){const n=t[r];e[n.group]||(e[n.group]={}),e[n.group][n.name]=n.binding}return e}function Mf(t,e){const r=new Set,n=new Set,i=[...t.structs,...e.structs].filter(o=>r.has(o.name)?!1:(r.add(o.name),!0)),s=[...t.groups,...e.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return n.has(a)?!1:(n.add(a),!0)});return{structs:i,groups:s}}const jr=class{constructor({fragment:t,vertex:e,layout:r,gpuLayout:n,name:i}){if(this._layoutKey=0,this.name=i,this.fragment=t,this.vertex=e,t.source===e.source){const s=bi(t.source);this.structsAndGroups=s}else{const s=bi(e.source),o=bi(t.source);this.structsAndGroups=Mf(s,o)}this.layout=r!=null?r:Bf(this.structsAndGroups),this.gpuLayout=n!=null?n:Pf(this.structsAndGroups)}destroy(){this._gpuLayout=null,this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return jr.programCached[e]||(jr.programCached[e]=new jr(t)),jr.programCached[e]}};let Oe=jr;Oe.programCached=Object.create(null);function Df(t,e){switch(t){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*e);case"vec3<f32>":return new Float32Array(3*e);case"vec4<f32>":return new Float32Array(4*e);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var _x=Object.defineProperty,Rf=Object.getOwnPropertySymbols,xx=Object.prototype.hasOwnProperty,Ax=Object.prototype.propertyIsEnumerable,Ff=(t,e,r)=>e in t?_x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gf=(t,e)=>{for(var r in e||(e={}))xx.call(e,r)&&Ff(t,r,e[r]);if(Rf)for(var r of Rf(e))Ax.call(e,r)&&Ff(t,r,e[r]);return t};const kf=class{constructor(t,e){this.touched=0,this.uid=J("uniform"),this.resourceType="uniformGroup",this.resourceId=this.uid,this.isUniformGroup=!0,this.dirtyId=0;var r,n;e=Gf(Gf({},kf.DEFAULT),e),this.uniformStructures=t;const i={};for(const s in t){const o=t[s];o.name=s,o.size=(r=o.size)!=null?r:1,(n=o.value)!=null||(o.value=Df(o.type,o.size)),i[s]=o.value}this.uniforms=i,this.dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this.signature=Object.keys(i).map(s=>`${s}-${t[s].type}`).join("-")}update(){this.dirtyId++}};let oe=kf;oe.DEFAULT={ubo:!1,isStatic:!1};class He{constructor(e){this.resources=Object.create(null),this._dirty=!0;let r=0;for(const n in e){const i=e[n];this.setResource(i,r++)}this.updateKey()}update(){this.updateKey()}updateKey(){if(!this._dirty)return;this._dirty=!1;const e=[];let r=0;for(const n in this.resources)e[r++]=this.resources[n].resourceId;this.key=e.join("|")}setResource(e,r){var n,i;const s=this.resources[r];e!==s&&(s&&((n=e.off)==null||n.call(e,"change",this.onResourceChange,this)),(i=e.on)==null||i.call(e,"change",this.onResourceChange,this),this.resources[r]=e,this._dirty=!0)}getResource(e){return this.resources[e]}touch(e){const r=this.resources;for(const n in r)r[n].touched=e}destroy(){var e;const r=this.resources;for(const n in r){const i=r[n];(e=i.off)==null||e.call(i,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(){this._dirty=!0,this.update()}}var We=(t=>(t[t.WEBGL=1]="WEBGL",t[t.WEBGPU=2]="WEBGPU",t))(We||{});class Ue extends ge{constructor({gpuProgram:e,glProgram:r,groups:n,resources:i,groupMap:s,compatibleRenderers:o}){super(),this.uniformBindMap=Object.create(null),this.gpuProgram=e,this.glProgram=r,o===void 0&&(o=0,e&&(o|=We.WEBGPU),r&&(o|=We.WEBGL)),this.compatibleRenderers=o;const a={};if(i&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!i&&!n)throw new Error("[Shader] Must provide either resources or groups descriptor");if(!e&&n&&!s)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&s)for(const u in s)for(const l in s[u]){const c=s[u][l];a[c]={group:u,binding:l,name:c}}else if(e&&n&&!s){const u=e.structsAndGroups.groups;s={},u.forEach(l=>{s[l.group]=s[l.group]||{},s[l.group][l.binding]=l.name,a[l.name]=l})}else if(i){if(e){const u=e.structsAndGroups.groups;s={},u.forEach(l=>{s[l.group]=s[l.group]||{},s[l.group][l.binding]=l.name,a[l.name]=l})}else{s={},n={99:new He};let u=0;for(const l in i)a[l]={group:99,binding:u,name:l},s[99]=s[99]||{},s[99][u]=l,u++}n={};for(const u in i){const l=u;let c=i[u];!c.source&&!c.resourceType&&(c=new oe(c));const d=a[l];d&&(n[d.group]=n[d.group]||new He,n[d.group].setResource(c,d.binding))}}this.groups=n,this.uniformBindMap=s,this.resources=this._buildResourceAccessor(n,a)}addResource(e,r,n){var i,s;(i=this.uniformBindMap)[r]||(i[r]={}),(s=this.uniformBindMap[r])[n]||(s[n]=e)}_buildResourceAccessor(e,r){const n={};for(const i in r){const s=r[i];Object.defineProperty(n,s.name,{get(){return e[s.group].getResource(s.binding)},set(o){e[s.group].setResource(o,s.binding)}})}return n}destroy(e=!1){var r,n;this.emit("destroy",this),e&&((r=this.gpuProgram)==null||r.destroy(),(n=this.glProgram)==null||n.destroy()),this.gpuProgram=null,this.glProgram=null,this.groups=null,this.removeAllListeners(),this.uniformBindMap=null,this.resources=null}}const Cx={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8},No=0,$o=1,Vo=2,zo=3,Ho=4,Wo=5;class Me{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<No)}set blend(e){!!(this.data&1<<No)!==e&&(this.data^=1<<No)}get offsets(){return!!(this.data&1<<$o)}set offsets(e){!!(this.data&1<<$o)!==e&&(this.data^=1<<$o)}set cullMode(e){if(e==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=e==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<Vo)}set culling(e){!!(this.data&1<<Vo)!==e&&(this.data^=1<<Vo)}get depthTest(){return!!(this.data&1<<zo)}set depthTest(e){!!(this.data&1<<zo)!==e&&(this.data^=1<<zo)}get depthMask(){return!!(this.data&1<<Wo)}set depthMask(e){!!(this.data&1<<Wo)!==e&&(this.data^=1<<Wo)}get clockwiseFrontFace(){return!!(this.data&1<<Ho)}set clockwiseFrontFace(e){!!(this.data&1<<Ho)!==e&&(this.data^=1<<Ho)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!=="none",this._blendMode=e,this._blendModeId=Cx[e]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new Me;return e.depthTest=!1,e.blend=!0,e}}var wx=Object.defineProperty,Of=Object.getOwnPropertySymbols,Tx=Object.prototype.hasOwnProperty,Sx=Object.prototype.propertyIsEnumerable,Uf=(t,e,r)=>e in t?wx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lf=(t,e)=>{for(var r in e||(e={}))Tx.call(e,r)&&Uf(t,r,e[r]);if(Of)for(var r of Of(e))Sx.call(e,r)&&Uf(t,r,e[r]);return t};const Nf=class extends Ue{constructor(t){var e;t=Lf(Lf({},Nf.defaultOptions),t),super(t),this.enabled=!0,this._state=Me.for2d(),this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=(e=t.antialias)!=null?e:"inherit",this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.addResource("filterUniforms",0,0),this.addResource("uSampler",0,1)}apply(t,e,r,n){t.applyFilter(this,e,r,n)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}};let Le=Nf;Le.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"inherit",blendRequired:!1};var $f=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 fragColor;

uniform float uBlend;

uniform sampler2D uSampler;
uniform sampler2D backTexture;

{FUNCTIONS}

void main()
{ 
    vec4 back = texture(backTexture, vTextureCoord);
    vec4 front = texture(uSampler, vTextureCoord);

    {MAIN}
}
`,Vf=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 backgroundUv;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform vec4 backgroundFrame;
uniform vec4 outputTexture;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    
    position.x = position.x * (2.0 / outputTexture.x) - 1.0;
    position.y = position.y * (2.0*outputTexture.z / outputTexture.y) - outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,zf=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,
};

struct BlendUniforms {
  uBlend:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;
@group(0) @binding(3) var backTexture: texture_2d<f32>;

@group(1) @binding(0) var<uniform> blendUniforms : BlendUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

{FUNCTIONS}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>
) -> @location(0) vec4<f32> {


   var back =  textureSample(backTexture, mySampler, uv);
   var front = textureSample(uSampler, mySampler, uv);
   
   var out = vec4<f32>(0.0,0.0,0.0,0.0);

   {MAIN}

   return out;
}`,Ex=Object.defineProperty,Hf=Object.getOwnPropertySymbols,Ix=Object.prototype.hasOwnProperty,Px=Object.prototype.propertyIsEnumerable,Wf=(t,e,r)=>e in t?Ex(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Xf=(t,e)=>{for(var r in e||(e={}))Ix.call(e,r)&&Wf(t,r,e[r]);if(Hf)for(var r of Hf(e))Px.call(e,r)&&Wf(t,r,e[r]);return t};class ie extends Le{constructor(e){const r=e.gpu,n=jf(Xf({source:zf},r)),i=new Oe({vertex:{source:n,entryPoint:"mainVertex"},fragment:{source:n,entryPoint:"mainFragment"}}),s=e.gl,o=jf(Xf({source:$f},s)),a=new Be({vertex:Vf,fragment:o}),u=new oe({uBlend:{value:1,type:"f32"}});super({gpuProgram:i,glProgram:a,blendRequired:!0,resources:{blendUniforms:u,backTexture:E.EMPTY}})}}function jf(t){const{source:e,functions:r,main:n}=t;return e.replace("{FUNCTIONS}",r).replace("{MAIN}",n)}const vi=`
	float getLuminosity(vec3 c) {
		return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;
	}

	vec3 setLuminosity(vec3 c, float lum) {
		float modLum = lum - getLuminosity(c);
		vec3 color = c.rgb + vec3(modLum);

		// clip back into legal range
		modLum = getLuminosity(color);
		vec3 modLumVec = vec3(modLum);

		float cMin = min(color.r, min(color.g, color.b));
		float cMax = max(color.r, max(color.g, color.b));

		if(cMin < 0.0) {
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0) {
			color = mix(modLumVec, color, (1.0 - modLum) / (cMax - modLum));
		}

		return color;
	}

	float getSaturation(vec3 c) {
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	vec3 setSaturationMinMidMax(vec3 cSorted, float s) {
		vec3 colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x) {
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else {
			colorSorted.y = 0.0;
			colorSorted.z = 0.0;
		}

		colorSorted.x = 0.0;

		return colorSorted;
	}

	vec3 setSaturation(vec3 c, float s) {
		vec3 color = c;

		if(color.r <= color.g && color.r <= color.b) {
			if(color.g <= color.b) {
				color = setSaturationMinMidMax(color.rgb, s).rgb;
			}
			else {
				color = setSaturationMinMidMax(color.rbg, s).rbg;
			}
		}
		else if(color.g <= color.r && color.g <= color.b) {
			if(color.r <= color.b) {
				color = setSaturationMinMidMax(color.grb, s).grb;
			}
			else {
				color = setSaturationMinMidMax(color.gbr, s).gbr;
			}
		}
		else {
			// Using bgr for both fixes part of hue
			if(color.r <= color.g) {
				color = setSaturationMinMidMax(color.brg, s).brg;
			}
			else {
				color = setSaturationMinMidMax(color.bgr, s).bgr;
			}
		}

		return color;
	}
    `,yi=`
	fn getLuminosity(c: vec3<f32>) -> f32
	{
		return 0.3*c.r + 0.59*c.g + 0.11*c.b;
	}

	fn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32>
	{
		var modLum: f32 = lum - getLuminosity(c);
		var color: vec3<f32> = c.rgb + modLum;

		// clip back into legal range
		modLum = getLuminosity(color);
		let modLumVec = vec3<f32>(modLum);

		let cMin: f32 = min(color.r, min(color.g, color.b));
		let cMax: f32 = max(color.r, max(color.g, color.b));

		if(cMin < 0.0)
		{
			color = mix(modLumVec, color, modLum / (modLum - cMin));
		}

		if(cMax > 1.0)
		{
			color = mix(modLumVec, color, (1 - modLum) / (cMax - modLum));
		}

		return color;
	}

	fn getSaturation(c: vec3<f32>) -> f32
	{
		return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
	}

	fn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32>
	{
		var colorSorted = cSorted;

		if(colorSorted.z > colorSorted.x)
		{
			colorSorted.y = (((colorSorted.y - colorSorted.x) * s) / (colorSorted.z - colorSorted.x));
			colorSorted.z = s;
		}
		else
		{
			colorSorted.y = 0;
			colorSorted.z = 0;
		}

		colorSorted.x = 0;

		return colorSorted;
	}

	fn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32>
	{
		var color = c;

		if (color.r <= color.g && color.r <= color.b)
		{
			if (color.g <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rgb, s)).rgb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.rbg, s)).rbg;
			}
		}
		else if (color.g <= color.r && color.g <= color.b)
		{
			if (color.r <= color.b)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.grb, s)).grb;
			}
			else
			{
				color = vec3<f32>(setSaturationMinMidMax(color.gbr, s)).gbr;
			}
		}
		else
		{
			// Using bgr for both fixes part of hue
			if (color.r <= color.g)
			{
				color = vec3<f32>(setSaturationMinMidMax(color.brg, s)).brg;
			}
			else
			{
				color  = vec3<f32>(setSaturationMinMidMax(color.bgr, s)).bgr;
			}
		}

		return color;
	}
	`;class Yf extends ie{constructor(){super({gl:{functions:`
                ${vi}

                vec3 blendColor(vec3 base, vec3 blend,  float opacity)
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendColor(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                ${yi}

                fn blendColorOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (setLuminosity(blend, getLuminosity(base)) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendColorOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}Yf.extension={name:"color",type:v.BlendMode};class Zf extends ie{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0 - ((1.0 - base) / blend)), 0.0);
                }

                vec3 blendColorBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendColorBurn(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn blendColorBurn(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorBurn(base.r, blend.r),
                        colorBurn(base.g, blend.g),
                        colorBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendColorBurn(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}Zf.extension={name:"color-burn",type:v.BlendMode};class qf extends ie{constructor(){super({gl:{functions:`
                float colorDodge(float base, float blend)
                {
                    return base / (1.0 - blend);
                }

                vec3 blendColorDodge(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendColorDodge(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return base / (1.0 - blend);
                }

                fn blendColorDodge(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        colorDodge(base.r, blend.r),
                        colorDodge(base.g, blend.g),
                        colorDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                    out = vec4<f32>(blendColorDodge(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}qf.extension={name:"color-dodge",type:v.BlendMode};class Kf extends ie{constructor(){super({gl:{functions:`
                vec3 blendDarken(vec3 base, vec3 blend, float opacity)
                {
                    return (min(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendDarken(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendDarken(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (min(blend,base) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendDarken(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}Kf.extension={name:"darken",type:v.BlendMode};class Jf extends ie{constructor(){super({gl:{functions:`
                vec3 blendDifference(vec3 base, vec3 blend,  float opacity)
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendDifference(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn blendDifference(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (abs(blend - base) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDifference(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}Jf.extension={name:"difference",type:v.BlendMode};class Qf extends ie{constructor(){super({gl:{functions:`
                float divide(float base, float blend)
                {
                    return (blend > 0.0) ? clamp(base / blend, 0.0, 1.0) : 1.0;
                }

                vec3 blendDivide(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendDivide(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn divide(base: f32, blend: f32) -> f32
                {
                    return select(1.0, clamp(base / blend, 0.0, 1.0), blend > 0.0);
                }

                fn blendDivide(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        divide(base.r, blend.r),
                        divide(base.g, blend.g),
                        divide(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendDivide(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}Qf.extension={name:"divide",type:v.BlendMode};class ep extends ie{constructor(){super({gl:{functions:`
                vec3 exclusion(vec3 base, vec3 blend)
                {
                    return base + blend - 2.0 * base * blend;
                }

                vec3 blendExclusion(vec3 base, vec3 blend, float opacity)
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendExclusion(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn exclusion(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return base+blend-2.0*base*blend;
                }

                fn blendExclusion(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (exclusion(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendExclusion(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}ep.extension={name:"exclusion",type:v.BlendMode};class tp extends ie{constructor(){super({gl:{functions:`
                float hardLight(float base, float blend)
                {
                    return (blend < 0.5) ? 2.0 * base * blend : 1.0 - 2.0 * (1.0 - base) * (1.0 - blend);
                }

                vec3 blendHardLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendHardLight(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn hardLight(base: f32, blend: f32) -> f32
                {
                    return select(1.0 - 2.0 * (1.0 - base) * (1.0 - blend), 2.0 * base * blend, blend < 0.5);
                }

                fn blendHardLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        hardLight(base.r, blend.r),
                        hardLight(base.g, blend.g),
                        hardLight(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendHardLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}tp.extension={name:"hard-light",type:v.BlendMode};class rp extends ie{constructor(){super({gl:{functions:`
                float hardMix(float base, float blend)
                {
                    return (base + blend >= 1.0) ? 1.0 : 0.0;
                }

                vec3 blendHardMix(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blended = vec3(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendHardMix(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn hardMix(base: f32, blend: f32) -> f32
                {
                    return select(0.0, 1.0, base + blend >= 1.0);
                }

                fn blendHardMix(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        hardMix(base.r, blend.r),
                        hardMix(base.g, blend.g),
                        hardMix(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendHardMix(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}rp.extension={name:"hard-mix",type:v.BlendMode};class np extends ie{constructor(){super({gl:{functions:`
                vec3 blendLighten(vec3 base, vec3 blend, float opacity)
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLighten(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendLighten(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    return (max(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLighten(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}np.extension={name:"lighten",type:v.BlendMode};class ip extends ie{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend)
                {
                    return max(0.0, base + blend - 1.0);
                }

                vec3 blendLinearBurn(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLinearBurn(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn blendLinearBurn(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearBurn(base.r, blend.r),
                        linearBurn(base.g, blend.g),
                        linearBurn(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendLinearBurn(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}ip.extension={name:"linear-burn",type:v.BlendMode};class sp extends ie{constructor(){super({gl:{functions:`
                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                vec3 blendLinearDodge(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );
                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLinearDodge(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1, base + blend);
                }

                fn blendLinearDodge(base:vec3<f32>, blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearDodge(base.r, blend.r),
                        linearDodge(base.g, blend.g),
                        linearDodge(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearDodge(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}sp.extension={name:"linear-dodge",type:v.BlendMode};class op extends ie{constructor(){super({gl:{functions:`
                float linearBurn(float base, float blend) {
                    return max(0.0, base + blend - 1.0);
                }

                float linearDodge(float base, float blend) {
                    return min(1.0, base + blend);
                }

                float linearLight(float base, float blend) {
                    return (blend <= 0.5) ? linearBurn(base,2.0*blend) : linearBurn(base,2.0*(blend-0.5));
                }

                vec3 blendLinearLight(vec3 base, vec3 blend, float opacity) {
                    vec3 blended = vec3(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendLinearLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn linearBurn(base: f32, blend: f32) -> f32
                {
                    return max(0.0, base + blend - 1.0);
                }

                fn linearDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base + blend);
                }

                fn linearLight(base: f32, blend: f32) -> f32
                {
                    return select(linearBurn(base,2.0*(blend-0.5)), linearBurn(base,2.0*blend), blend <= 0.5);
                }

                fn blendLinearLightOpacity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        linearLight(base.r, blend.r),
                        linearLight(base.g, blend.g),
                        linearLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLinearLightOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}op.extension={name:"linear-light",type:v.BlendMode};class ap extends ie{constructor(){super({gl:{functions:`
                ${vi}

                vec3 blendLuminosity(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendLuminosity = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendLuminosity(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                ${yi}

                fn blendLuminosity(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendLuminosity: vec3<f32> = setLuminosity(base, getLuminosity(blend));
                    return (blendLuminosity * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendLuminosity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}ap.extension={name:"luminosity",type:v.BlendMode};class up extends ie{constructor(){super({gl:{functions:`
                vec3 negation(vec3 base, vec3 blend)
                {
                    return 1.0-abs(1.0-base-blend);
                }

                vec3 blendNegation(vec3 base, vec3 blend, float opacity)
                {
                    return (negation(base, blend) * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendNegation(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn blendNegation(base: vec3<f32>, blend: vec3<f32>) -> vec3<f32>
                {
                    return 1.0-abs(1.0-base-blend);
                }

                fn blendNegationOpacity(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    return (blendNegation(base, blend) * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendNegationOpacity(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}up.extension={name:"negation",type:v.BlendMode};class lp extends ie{constructor(){super({gl:{functions:`
                float overlay(float base, float blend)
                {
                    return (blend < 0.5) ? (2.0*base*blend) : (1.0-2.0*(1.0-base)*(1.0-blend));
                }

                vec3 blendOverlay(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendOverlay(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn overlay(base: f32, blend: f32) -> f32
                {
                    return select((1.0-2.0*(1.0-base)*(1.0-blend)), (2.0*base*blend), base < 0.5);
                }

                fn blendOverlay(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        overlay(base.r, blend.r),
                        overlay(base.g, blend.g),
                        overlay(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendOverlay(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}lp.extension={name:"overlay",type:v.BlendMode};class cp extends ie{constructor(){super({gl:{functions:`
                float pinLight(float base, float blend)
                {
                    return (blend <= 0.5) ? min(base, 2.0 * blend) : max(base, 2.0 * (blend - 0.5));
                }

                vec3 blendPinLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendPinLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn pinLight(base: f32, blend: f32) -> f32
                {
                    return select(max(base,2.0*(blend-0.5)), min(base,2.0*blend), blend <= 0.5);
                }

                fn blendPinLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        pinLight(base.r, blend.r),
                        pinLight(base.g, blend.g),
                        pinLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendPinLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}cp.extension={name:"pin-light",type:v.BlendMode};class hp extends ie{constructor(){super({gl:{functions:`
                ${vi}

                vec3 blendSaturation(vec3 base, vec3 blend,  float opacity)
                {
                    vec3 blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendSaturation(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                ${yi}

                fn blendSaturation(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blendSaturation = setLuminosity(setSaturation(base, getSaturation(blend)), getLuminosity(base));
                    return (blendSaturation * opacity + base * (1.0 - opacity));
                }
            `,main:`
                out = vec4<f32>(blendSaturation(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
            `}})}}hp.extension={name:"saturation",type:v.BlendMode};class dp extends ie{constructor(){super({gl:{functions:`
                float softLight(float base, float blend)
                {
                    return (blend < 0.5) ? (2.0 * base * blend + base * base * (1.0 - 2.0 * blend)) : (sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend));
                }

                vec3 blendSoftLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendSoftLight(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn softLight(base: f32, blend: f32) -> f32
                {
                    return select(2.0 * base * blend + base * base * (1.0 - 2.0 * blend), sqrt(base) * (2.0 * blend - 1.0) + 2.0 * base * (1.0 - blend), blend < 0.5);
                }

                fn blendSoftLight(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        softLight(base.r, blend.r),
                        softLight(base.g, blend.g),
                        softLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSoftLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}dp.extension={name:"soft-light",type:v.BlendMode};class fp extends ie{constructor(){super({gl:{functions:`
                float subtract(float base, float blend)
                {
                    return max(0.0, base - blend);
                }

                vec3 blendSubtract(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                fragColor = vec4(blendSubtract(back.rgb, front.rgb, front.a), uBlend);
                `},gpu:{functions:`
                fn subtract(base: f32, blend: f32) -> f32
                {
                    return max(0, base - blend);
                }

                fn blendSubtract(base:vec3<f32>,  blend:vec3<f32>,  opacity:f32) -> vec3<f32>
                {
                    let blended = vec3<f32>(
                        subtract(base.r, blend.r),
                        subtract(base.g, blend.g),
                        subtract(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendSubtract(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}fp.extension={name:"subtract",type:v.BlendMode};class pp extends ie{constructor(){super({gl:{functions:`
                float colorBurn(float base, float blend)
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                float colorDodge(float base, float blend)
                {
                    return min(1.0, base / (1.0-blend));
                }

                float vividLight(float base, float blend)
                {
                    return (blend < 0.5) ? colorBurn(base,(2.0*blend)) : colorDodge(base,(2.0*(blend-0.5)));
                }

                vec3 blendVividLight(vec3 base, vec3 blend, float opacity)
                {
                    vec3 blended = vec3(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
            `,main:`
                fragColor = vec4(blendVividLight(back.rgb, front.rgb, front.a), uBlend);
            `},gpu:{functions:`
                fn colorBurn(base:f32, blend:f32) -> f32
                {
                    return max((1.0-((1.0-base)/blend)),0.0);
                }

                fn colorDodge(base: f32, blend: f32) -> f32
                {
                    return min(1.0, base / (1.0-blend));
                }

                fn vividLight(base: f32, blend: f32) -> f32
                {
                    return select(colorDodge(base,(2.0*(blend-0.5))), colorBurn(base,(2.0*blend)), blend<0.5);
                }

                fn blendVividLight(base: vec3<f32>, blend: vec3<f32>, opacity: f32) -> vec3<f32>
                {
                    let blended: vec3<f32> = vec3<f32>(
                        vividLight(base.r, blend.r),
                        vividLight(base.g, blend.g),
                        vividLight(base.b, blend.b)
                    );

                    return (blended * opacity + base * (1.0 - opacity));
                }
                `,main:`
                out = vec4<f32>(blendVividLight(back.rgb, front.rgb, front.a), blendUniforms.uBlend);
                `}})}}pp.extension={name:"vivid-light",type:v.BlendMode},V.add(Yf,Zf,qf,Kf,Jf,Qf,ep,tp,rp,np,ip,op,sp,ap,up,lp,cp,hp,dp,fp,pp);var Xo=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  backgroundFrame:vec4<f32>,
  globalFrame:vec4<f32>,
};

struct AlphaUniforms {
  uAlpha:f32,
};

@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;

@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var iTexture: texture_2d<f32>;
@group(1) @binding(2) var iSampler : sampler;

@group(2) @binding(0) var<uniform> alphaUniforms : AlphaUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * max(gfu.outputFrame.zw, vec2(0.)) + gfu.outputFrame.xy;

    return vec4((globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {
  return textureSample(iTexture, iSampler, uv) * alphaUniforms.uAlpha;
}`,Bx=Object.defineProperty,gp=Object.getOwnPropertySymbols,Mx=Object.prototype.hasOwnProperty,Dx=Object.prototype.propertyIsEnumerable,mp=(t,e,r)=>e in t?Bx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bp=(t,e)=>{for(var r in e||(e={}))Mx.call(e,r)&&mp(t,r,e[r]);if(gp)for(var r of gp(e))Dx.call(e,r)&&mp(t,r,e[r]);return t};const vp=class extends Le{constructor(t){t=bp(bp({},vp.DEFAULT_OPTIONS),t);const e=new Oe({vertex:{source:Xo,entryPoint:"mainVertex"},fragment:{source:Xo,entryPoint:"mainFragment"}}),r=new oe({uAlpha:{value:t.alpha,type:"f32"}});super({gpuProgram:e,resources:{filterUniforms:r}})}get alpha(){return this.resources.filterUniforms.uniforms.uAlpha}set alpha(t){this.resources.filterUniforms.uniforms.uAlpha=t}};let yp=vp;yp.DEFAULT_OPTIONS={alpha:1};function It(t){return t+=t===0?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t+1}function Rx(t){return!(t&t-1)&&!!t}function Fx(t){let e=(t>65535?1:0)<<4;t>>>=e;let r=(t>255?1:0)<<3;return t>>>=r,e|=r,r=(t>15?1:0)<<2,t>>>=r,e|=r,r=(t>3?1:0)<<1,t>>>=r,e|=r,e|t>>1}var Gx=Object.defineProperty,kx=Object.defineProperties,Ox=Object.getOwnPropertyDescriptors,_p=Object.getOwnPropertySymbols,Ux=Object.prototype.hasOwnProperty,Lx=Object.prototype.propertyIsEnumerable,xp=(t,e,r)=>e in t?Gx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nx=(t,e)=>{for(var r in e||(e={}))Ux.call(e,r)&&xp(t,r,e[r]);if(_p)for(var r of _p(e))Lx.call(e,r)&&xp(t,r,e[r]);return t},$x=(t,e)=>kx(t,Ox(e));let Vx=0;class Ap{constructor(e){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1}createTexture(e,r,n){const i=new fe($x(Nx({},this.textureOptions),{width:e,height:r,resolution:1,antialias:n}));return new E({source:i,label:`texturePool_${Vx++}`})}getOptimalTexture(e,r,n=1,i){let s=Math.ceil(e*n-1e-6),o=Math.ceil(r*n-1e-6);s=It(s),o=It(o);const a=(s<<17)+(o<<1)+(i?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let u=this._texturePool[a].pop();return u||(u=this.createTexture(s,o,i)),u.source._resolution=n,u.source.width=s/n,u.source.height=o/n,u.source.pixelWidth=s,u.source.pixelHeight=o,u.frameX=0,u.frameY=0,u.frameWidth=e,u.frameHeight=r,u.layout.update(),this._poolKeyHash[u.id]=a,u}getSameSizeTexture(e,r=!1){const n=e.source;return this.getOptimalTexture(e.width,e.height,n._resolution,r)}returnTexture(e){const r=this._poolKeyHash[e.id];this._texturePool[r].push(e)}clear(e){if(e=e!==!1,e)for(const r in this._texturePool){const n=this._texturePool[r];if(n)for(let i=0;i<n.length;i++)n[i].destroy(!0)}this._texturePool={}}}const pe=new Ap,jo={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},zx=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","out vec4 fragColor;","void main(void)","{","    fragColor = vec4(0.0);","    %blur%","}"].join(`
`);function Cp(t){const e=jo[t],r=e.length;let n=zx,i="";const s="fragColor += texture(uSampler, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<t;a++){let u=s.replace("%index%",a.toString());o=a,a>=r&&(o=t-a-1),u=u.replace("%value%",e[o].toString()),i+=u,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",t.toString()),n}const Hx=`
    in vec2 aPosition;

    uniform float strength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;
    uniform vec4 inputPixel;
    uniform vec4 outputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    
    position.x = position.x * (2.0 / outputTexture.x) - 1.0;
    position.y = position.y * (2.0*outputTexture.z / outputTexture.y) - outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = inputSize.%dimension% * strength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function wp(t,e){const r=Math.ceil(t/2);let n=Hx,i="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let o=0;o<t;o++){let a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(r-1)}.0`),i+=a,i+=`
`}return n=n.replace("%blur%",i),n=n.replace("%size%",t.toString()),n=n.replace("%dimension%",e?"z":"w"),n}function Tp(t,e){const r=wp(e,t),n=Cp(e);return Be.from({vertex:r,fragment:n,name:`blur-${t?"horizontal":"vertical"}-pass-filter`})}var Sp=`

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,
};

struct BlurUniforms {
  strength:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;

@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    %blur-struct%
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.globalFrame.zw;
}


@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {

  let filteredCord = filterTextureCoord(aPosition);

  let strength = gfu.inputSize.w * blurUniforms.strength;

  return VSOutput(
   filterVertexPosition(aPosition),
    %blur-vertex-out%
  );
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  %blur-fragment-in%
) -> @location(0) vec4<f32> {

    var   fragColor = vec4(0.0);

    %blur-sampling%

    return fragColor;
}`;function Ep(t,e){const r=jo[e],n=r.length,i=[],s=[],o=[];for(let d=0;d<e;d++){i[d]=`@location(${d}) offset${d}: vec2<f32>,`,t?s[d]=`filteredCord + vec2(${d-n+1} * strength, 0.0),`:s[d]=`filteredCord + vec2(0.0, ${d-n+1} * strength),`;const p=d<n?d:e-d-1,f=r[p].toString();o[d]=`fragColor += textureSample(uSampler, mySampler, offset${d}) * ${f};`}const a=i.join(`
`),u=s.join(`
`),l=o.join(`
`),c=Sp.replace("%blur-struct%",a).replace("%blur-vertex-out%",u).replace("%blur-fragment-in%",a).replace("%blur-sampling%",l);return Oe.from({vertex:{source:c,entryPoint:"mainVertex"},fragment:{source:c,entryPoint:"mainFragment"}})}var Wx=Object.defineProperty,Ip=Object.getOwnPropertySymbols,Xx=Object.prototype.hasOwnProperty,jx=Object.prototype.propertyIsEnumerable,Pp=(t,e,r)=>e in t?Wx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Yo=(t,e)=>{for(var r in e||(e={}))Xx.call(e,r)&&Pp(t,r,e[r]);if(Ip)for(var r of Ip(e))jx.call(e,r)&&Pp(t,r,e[r]);return t};const Bp=class extends Le{constructor(t){t=Yo(Yo({},Bp.defaultOptions),t);const e=Tp(t.horizontal,t.kernelSize),r=Ep(t.horizontal,t.kernelSize);super(Yo({glProgram:e,gpuProgram:r,resources:{blurUniforms:{strength:{value:0,type:"f32"}}}},t)),this.horizontal=t.horizontal,this._quality=0,this.quality=t.quality,this.blur=t.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(t,e,r,n){if(this._uniforms.strength=this.strength/this.passes,this.passes===1)t.applyFilter(this,e,r,n);else{const i=pe.getSameSizeTexture(e);let s=e,o=i;this._state.blend=!1;for(let a=0;a<this.passes-1;a++){t.applyFilter(this,s,o,t.renderer.type===We.WEBGPU);const u=o;o=s,s=u}this._state.blend=!0,t.applyFilter(this,s,r,n),pe.returnTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};let Yr=Bp;Yr.defaultOptions={strength:8,quality:4,kernelSize:5};var Yx=Object.defineProperty,Zx=Object.defineProperties,qx=Object.getOwnPropertyDescriptors,Mp=Object.getOwnPropertySymbols,Kx=Object.prototype.hasOwnProperty,Jx=Object.prototype.propertyIsEnumerable,Dp=(t,e,r)=>e in t?Yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Zr=(t,e)=>{for(var r in e||(e={}))Kx.call(e,r)&&Dp(t,r,e[r]);if(Mp)for(var r of Mp(e))Jx.call(e,r)&&Dp(t,r,e[r]);return t},Qx=(t,e)=>Zx(t,qx(e));class Rp extends Le{constructor(...e){var r;let n=(r=e[0])!=null?r:{};typeof n=="number"&&(G($,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),n={strength:n},e[1]&&(n.quality=e[1]),e[2]&&(n.resolution=e[2]),e[3]&&(n.kernelSize=e[3])),n=Zr(Zr({},Yr.defaultOptions),n),super(Qx(Zr({},n),{compatibleRenderers:We.WEBGL|We.WEBGPU,resources:{}})),this._repeatEdgePixels=!1,this.blurXFilter=new Yr(Zr({horizontal:!1},n)),this.blurYFilter=new Yr(Zr({horizontal:!0},n)),this.quality=n.quality,this.blur=n.strength,this.repeatEdgePixels=!1}apply(e,r,n,i){const s=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(s&&o){const a=pe.getSameSizeTexture(r);this.blurXFilter.apply(e,r,a,!0),this.blurYFilter.apply(e,a,n,i),pe.returnTexture(a)}else o?this.blurYFilter.apply(e,r,n,i):this.blurXFilter.apply(e,r,n,i)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}Rp.defaultOptions={strength:8,quality:4,kernelSize:5};var Zo=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform vec4 outputTexture;
// uniform vec4 globalFrame;
// uniform float flipped;


vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    
    position.x = position.x * (2.0 / outputTexture.x) - 1.0;
    position.y = position.y * (2.0*outputTexture.z / outputTexture.y) - outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Fp=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 fragColor;

uniform float uColorMatrix[20];
uniform float uAlpha;

uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;
    
    float[20] cm = uColorMatrix;


    if (uAlpha == 0.0) {
        fragColor = color;
        return;
    }

    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    vec4 result;

    result.r = (cm[0] * color.r);
        result.r += (cm[1] * color.g);
        result.r += (cm[2] * color.b);
        result.r += (cm[3] * color.a);
        result.r += cm[4];

    result.g = (cm[5] * color.r);
        result.g += (cm[6] * color.g);
        result.g += (cm[7] * color.b);
        result.g += (cm[8] * color.a);
        result.g += cm[9];

    result.b = (cm[10] * color.r);
       result.b += (cm[11] * color.g);
       result.b += (cm[12] * color.b);
       result.b += (cm[13] * color.a);
       result.b += cm[14];

    result.a = (cm[15] * color.r);
       result.a += (cm[16] * color.g);
       result.a += (cm[17] * color.b);
       result.a += (cm[18] * color.a);
       result.a += cm[19];

    vec3 rgb = mix(color.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    fragColor = vec4(rgb, result.a);
}
`,qo=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,
};

struct ColorMatrixUniforms {
  uColorMatrix:array<vec4<f32>, 5>,
  uAlpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;
@group(0) @binding(3) var backTexture: texture_2d<f32>;
@group(1) @binding(0) var<uniform> colorMatrixUniforms : ColorMatrixUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
  };
  
fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
  );
}


@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
) -> @location(0) vec4<f32> {


  var c = textureSample(uSampler, mySampler, uv);
  
  if (colorMatrixUniforms.uAlpha == 0.0) {
    return c;
  }

 
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.r /= c.a;
      c.g /= c.a;
      c.b /= c.a;
    }

    var cm = colorMatrixUniforms.uColorMatrix;


    var result = vec4<f32>(0.);

    result.r = (cm[0][0] * c.r);
    result.r += (cm[0][1] * c.g);
    result.r += (cm[0][2] * c.b);
    result.r += (cm[0][3] * c.a);
    result.r += cm[1][0];

    result.g = (cm[1][1] * c.r);
    result.g += (cm[1][2] * c.g);
    result.g += (cm[1][3] * c.b);
    result.g += (cm[2][0] * c.a);
    result.g += cm[2][1];

    result.b = (cm[2][2] * c.r);
    result.b += (cm[2][3] * c.g);
    result.b += (cm[3][0] * c.b);
    result.b += (cm[3][1] * c.a);
    result.b += cm[3][2];

    result.a = (cm[3][3] * c.r);
    result.a += (cm[4][0] * c.g);
    result.a += (cm[4][1] * c.b);
    result.a += (cm[4][2] * c.a);
    result.a += cm[4][3];

    var rgb = mix(c.rgb, result.rgb, colorMatrixUniforms.uAlpha);

    rgb.r *= result.a;
    rgb.g *= result.a;
    rgb.b *= result.a;

    return vec4(rgb, result.a);
}`;class e1 extends Le{constructor(){const e=new oe({uColorMatrix:{value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],type:"vec4<f32>",size:5},uAlpha:{value:1,type:"f32"}}),r=Oe.from({vertex:{source:qo,entryPoint:"mainVertex"},fragment:{source:qo,entryPoint:"mainFragment"}}),n=Be.from({vertex:Zo,fragment:Fp,name:"color-matrix-filter"});super({gpuProgram:r,glProgram:n,resources:{colorMatrixUniforms:e}}),this.alpha=1}_loadMatrix(e,r=!1){let n=e;r&&(this._multiply(n,this.matrix,e),n=this._colorMatrix(n)),this.resources.colorMatrixUniforms.uniforms.uColorMatrix=n,this.resources.colorMatrixUniforms.update()}_multiply(e,r,n){return e[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],e[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],e[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],e[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],e[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],e[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],e[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],e[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],e[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],e[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],e[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],e[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],e[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],e[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],e[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],e[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],e[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],e[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],e[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],e[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],e}_colorMatrix(e){const r=new Float32Array(e);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r}brightness(e,r){const n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,r)}tint(e,r){const[n,i,s]=X.shared.setValue(e).toArray(),o=[n,0,0,0,0,0,i,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(o,r)}greyscale(e,r){const n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,r)}grayscale(e,r){this.greyscale(e,r)}blackAndWhite(e){const r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,e)}hue(e,r){e=(e||0)/180*Math.PI;const n=Math.cos(e),i=Math.sin(e),s=Math.sqrt,o=1/3,a=s(o),u=n+(1-n)*o,l=o*(1-n)-a*i,c=o*(1-n)+a*i,d=o*(1-n)+a*i,p=n+o*(1-n),f=o*(1-n)-a*i,g=o*(1-n)-a*i,b=o*(1-n)+a*i,m=n+o*(1-n),x=[u,l,c,0,0,d,p,f,0,0,g,b,m,0,0,0,0,0,1,0];this._loadMatrix(x,r)}contrast(e,r){const n=(e||0)+1,i=-.5*(n-1),s=[n,0,0,0,i,0,n,0,0,i,0,0,n,0,i,0,0,0,1,0];this._loadMatrix(s,r)}saturate(e=0,r){const n=e*2/3+1,i=(n-1)*-.5,s=[n,i,i,0,0,i,n,i,0,0,i,i,n,0,0,0,0,0,1,0];this._loadMatrix(s,r)}desaturate(){this.saturate(-1)}negative(e){const r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,e)}sepia(e){const r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,e)}technicolor(e){const r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,e)}polaroid(e){const r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,e)}toBGR(e){const r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,e)}kodachrome(e){const r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,e)}browni(e){const r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,e)}vintage(e){const r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,e)}colorTone(e,r,n,i,s){e=e||.2,r=r||.15,n=n||16770432,i=i||3375104;const o=X.shared,[a,u,l]=o.setValue(n).toArray(),[c,d,p]=o.setValue(i).toArray(),f=[.3,.59,.11,0,0,a,u,l,e,0,c,d,p,r,0,a-c,u-d,l-p,0,0];this._loadMatrix(f,s)}night(e,r){e=e||.1;const n=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)}predator(e,r){const n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,r)}lsd(e){const r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.resources.colorMatrixUniforms.uniforms.uColorMatrix}set matrix(e){this.resources.colorMatrixUniforms.uniforms.uColorMatrix=e}get alpha(){return this.resources.colorMatrixUniforms.uniforms.uAlpha}set alpha(e){this.resources.colorMatrixUniforms.uniforms.uAlpha=e}}var Gp=`
in vec2 vTextureCoord;
in vec2 vFilterUv;

out vec4 fragColor;

uniform sampler2D uSampler;
uniform sampler2D mapTexture;

uniform vec4 filterArea;
uniform vec4 filterClamp;
uniform vec4 inputClamp;
uniform highp vec4 inputSize;
uniform mat2 rotation;
uniform vec2 scale;


void main()
{
vec4 map = texture(mapTexture, vFilterUv);
    
    vec2 offset = inputSize.zw * (rotation * (map.xy - 0.5)) * scale; 

    fragColor = texture(uSampler, clamp(vTextureCoord + offset, inputClamp.xy, inputClamp.zw));
}
`,kp=`in vec2 aPosition;
out vec2 vTextureCoord;
out vec2 vFilterUv;


uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform vec4 outputTexture;

uniform mat3 filterMatrix;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    
    position.x = position.x * (2.0 / outputTexture.x) - 1.0;
    position.y = position.y * (2.0*outputTexture.z / outputTexture.y) - outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

vec2 getFilterCoord( void )
{
  return ( filterMatrix * vec3( filterTextureCoord(), 1.0)  ).xy;
}


void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
    vFilterUv = getFilterCoord();
}
`,Ko=`struct GlobalUniforms {
  projectionMatrix:mat3x3<f32>,
  worldTransformMatrix:mat3x3<f32>,
  worldAlpha: f32
}

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,
};

struct DisplacementUniforms {
  filterMatrix:mat3x3<f32>,
  scale:vec2<f32>,
  rotation:mat2x2<f32>
};



@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : DisplacementUniforms;
@group(1) @binding(1) var mapTexture: texture_2d<f32>;
@group(1) @binding(2) var mapSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.filterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{

  
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var map = textureSample(mapTexture, mapSampler, filterUv);
    
    var offset =  gfu.inputSize.zw * (filterUniforms.rotation * (map.xy - 0.5)) * filterUniforms.scale; 
   
     return textureSample(uSampler, mySampler, clamp(uv + offset, gfu.inputClamp.xy, gfu.inputClamp.zw));
}`;class t1 extends Le{constructor(...e){var r;let n=e[0];n instanceof $e&&(e[1]&&G($,"DisplacementFilter now uses options object instead of params. {sprite, scale}"),n={sprite:n,scale:e[1]});let i=(r=n.scale)!=null?r:20;typeof i=="number"&&(i=new Y(i,i));const s=new oe({filterMatrix:{value:new R,type:"mat3x3<f32>"},scale:{value:i,type:"vec2<f32>"},rotation:{value:new Float32Array([0,0,0,0]),type:"vec4<f32>"}}),o=Be.from({vertex:kp,fragment:Gp,name:"displacement-filter"}),a=Oe.from({vertex:{source:Ko,entryPoint:"mainVertex"},fragment:{source:Ko,entryPoint:"mainFragment"}}),u=n.sprite.texture.source;super({gpuProgram:a,glProgram:o,resources:{filterUniforms:s,mapTexture:u,mapSampler:u.style}}),this._sprite=n.sprite,this._sprite.renderable=!1}apply(e,r,n,i){const s=this.resources.filterUniforms.uniforms;e.calculateSpriteMatrix(s.filterMatrix,this._sprite);const o=this._sprite.worldTransform,a=Math.sqrt(o.a*o.a+o.b*o.b),u=Math.sqrt(o.c*o.c+o.d*o.d);a!==0&&u!==0&&(s.rotation[0]=o.a/a,s.rotation[1]=o.b/a,s.rotation[2]=o.c/u,s.rotation[3]=o.d/u),this.resources.mapTexture=this._sprite.texture.source,e.applyFilter(this,r,n,i)}get scale(){return this.resources.filterUniforms.uniforms.scale}}var Op=`
in vec2 vTextureCoord;
in vec4 vColor;

out vec4 fragColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * 0.2);
    float diff = (randomValue - 0.5) *  0.5;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    fragColor = color;
}
`,Jo=`

struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,
};

struct NoiseUniforms {
  uNoise:f32,
  uSeed:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;
@group(0) @binding(3) var backTexture: texture_2d<f32>;

@group(1) @binding(0) var<uniform> noiseUniforms : NoiseUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition)
  );
}

fn rand(co:vec2<f32>) -> f32
{
  return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}



@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var pixelPosition =  globalTextureCoord(position.xy);// / (getSize());//-  gfu.outputFrame.xy);
  
    
    var sample = textureSample(uSampler, mySampler, uv);
    var randomValue =  rand(pixelPosition.xy * noiseUniforms.uSeed);
    var diff = (randomValue - 0.5) * noiseUniforms.uNoise;
  
    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (sample.a > 0.0) {
      sample.r /= sample.a;
      sample.g /= sample.a;
      sample.b /= sample.a;
    }

    sample.r += diff;
    sample.g += diff;
    sample.b += diff;

    // Premultiply alpha again.
    sample.r *= sample.a;
    sample.g *= sample.a;
    sample.b *= sample.a;
    
    return sample;
}`,r1=Object.defineProperty,Up=Object.getOwnPropertySymbols,n1=Object.prototype.hasOwnProperty,i1=Object.prototype.propertyIsEnumerable,Lp=(t,e,r)=>e in t?r1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Np=(t,e)=>{for(var r in e||(e={}))n1.call(e,r)&&Lp(t,r,e[r]);if(Up)for(var r of Up(e))i1.call(e,r)&&Lp(t,r,e[r]);return t};const $p=class extends Le{constructor(t={}){var e,r,n;t=Np(Np({},$p.DEFAULT),t);const i=new Oe({vertex:{source:Jo,entryPoint:"mainVertex"},fragment:{source:Jo,entryPoint:"mainFragment"}}),s=new Be({vertex:Zo,fragment:Op,name:"noise-filter"});super({gpuProgram:i,glProgram:s,resources:{noiseUniforms:new oe({uNoise:{value:t.noise,type:"f32"},uSeed:{value:(e=t.seed)!=null?e:Math.random(),type:"f32"}})},resolution:1});const o=(r=t.noise)!=null?r:.5,a=(n=t.seed)!=null?n:Math.random();this.noise=o,this.seed=a}get noise(){return this.resources.noiseUniforms.uniforms.uNoise}set noise(t){this.resources.noiseUniforms.uniforms.uNoise=t}get seed(){return this.resources.noiseUniforms.uniforms.uSeed}set seed(t){this.resources.noiseUniforms.uniforms.uSeed=t}};let Vp=$p;Vp.DEFAULT={noise:.5,seed:void 0};var zp=`
in vec2 vTextureCoord;
in vec4 vColor;

uniform vec4 inputSize;
uniform vec4 inputClamp;

out vec4 fragColor;

uniform vec2 uCenter;
uniform float uTime;
uniform float uSpeed;
uniform vec4 uWave;

uniform sampler2D uSampler;


const float PI = 3.14159;

void main()
{
    float uAmplitude = uWave[0];
    float uWavelength = uWave[1];
    float uBrightness = uWave[2];
    float uRadius = uWave[3];

    float halfWavelength = uWavelength * 0.5 / inputSize.x;
    float maxRadius = uRadius / inputSize.x;
    float currentRadius = uTime * uSpeed / inputSize.x;

    float fade = 1.0;

    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            fragColor = texture(uSampler, vTextureCoord);
            return;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }

    vec2 dir = vec2(vTextureCoord - uCenter / inputSize.xy);
    dir.y *= inputSize.y / inputSize.x;
    float dist = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        fragColor = texture(uSampler, vTextureCoord);
        return;
    }

    vec2 diffUV = normalize(dir);

    float diff = (dist - currentRadius) / halfWavelength;

    float p = 1.0 - pow(abs(diff), 2.0);

    // float powDiff = diff * pow(p, 2.0) * ( amplitude * fade );
    float powDiff = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );

    vec2 offset = diffUV * powDiff / inputSize.xy;

    // Do clamp :
    vec2 coord = vTextureCoord + offset;
    vec2 clampedCoord = clamp(coord, inputClamp.xy, inputClamp.zw);
    vec4 color = texture(uSampler, clampedCoord);
    if (coord != clampedCoord) {
        color *= max(0.0, 1.0 - length(coord - clampedCoord));
    }

    // No clamp :
    // fragColor = texture(uSampler, vTextureCoord + offset);

    color.rgb *= 1.0 + (uBrightness - 1.0) * p * fade;

    fragColor = color;
}
`,Hp=`in vec2 aPosition;
out vec2 vTextureCoord;

uniform globalUniforms {
  mat3 projectionMatrix;
  mat3 worldTransformMatrix;
  float worldAlpha;
};

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Qo=`struct GlobalUniforms {
    projectionMatrix:mat3x3<f32>,
    worldTransformMatrix:mat3x3<f32>,
    worldAlpha: f32
}

struct GlobalFilterUniforms {
    inputSize:vec4<f32>,
    inputPixel:vec4<f32>,
    inputClamp:vec4<f32>,
    outputFrame:vec4<f32>,
    backgroundFrame:vec4<f32>,
    globalFrame:vec4<f32>,
};

struct ShockWaveUniforms {
    uTime: f32,
    uOffset: vec2<f32>,
    uSpeed: f32,
    uWave: vec4<f32>,
};
@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
@group(1) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(1) @binding(1) var uSampler: texture_2d<f32>;
@group(1) @binding(2) var mySampler : sampler;
@group(1) @binding(3) var backTexture: texture_2d<f32>;
@group(2) @binding(0) var<uniform> shockwaveUniforms : ShockWaveUniforms;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) backgroundUv : vec2<f32>,
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;
    return vec4((globalUniforms.projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn filterBackgroundTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * gfu.backgroundFrame.zw;
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}
fn getSize() -> vec2<f32>
{
    return gfu.globalFrame.zw;
}

@vertex
fn mainVertex(
    @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
    return VSOutput(
        filterVertexPosition(aPosition),
        filterTextureCoord(aPosition),
        filterBackgroundTextureCoord(aPosition),
    );
}

@fragment
fn mainFragment(
    @location(0) uv: vec2<f32>,
    @location(1) backgroundUv: vec2<f32>,
    @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    let uTime = shockwaveUniforms.uTime;
    let uOffset = shockwaveUniforms.uOffset;
    let uSpeed = shockwaveUniforms.uSpeed;
    let uAmplitude = shockwaveUniforms.uWave[0];
    let uWavelength = shockwaveUniforms.uWave[1];
    let uBrightness = shockwaveUniforms.uWave[2];
    let uRadius = shockwaveUniforms.uWave[3];
    let halfWavelength: f32 = uWavelength * 0.5 / gfu.inputSize.x;
    let maxRadius: f32 = uRadius / gfu.inputSize.x;
    let currentRadius: f32 = uTime * uSpeed / gfu.inputSize.x;
    var fade: f32 = 1.0;
    var returnColorOnly: bool = false;
    
    if (maxRadius > 0.0) {
        if (currentRadius > maxRadius) {
            returnColorOnly = true;
        }
        fade = 1.0 - pow(currentRadius / maxRadius, 2.0);
    }
    var dir: vec2<f32> = vec2<f32>(uv - uOffset / gfu.inputSize.xy);
    dir.y *= gfu.inputSize.y / gfu.inputSize.x;

    let dist:f32 = length(dir);

    if (dist <= 0.0 || dist < currentRadius - halfWavelength || dist > currentRadius + halfWavelength) {
        returnColorOnly = true;
    }

    let diffUV: vec2<f32> = normalize(dir);
    let diff: f32 = (dist - currentRadius) / halfWavelength;
    let p: f32 = 1.0 - pow(abs(diff), 2.0);
    let powDiff: f32 = 1.25 * sin(diff * PI) * p * ( uAmplitude * fade );
    let offset: vec2<f32> = diffUV * powDiff / gfu.inputSize.xy;
    // Do clamp :
    let coord: vec2<f32> = uv + offset;
    let clampedCoord: vec2<f32> = clamp(coord, gfu.inputClamp.xy, gfu.inputClamp.zw);

    var clampedColor: vec4<f32> = textureSample(uSampler, mySampler, clampedCoord);
    
    if (boolVec2(coord, clampedCoord)) 
    {
        clampedColor *= max(0.0, 1.0 - length(coord - clampedCoord));
    }
    // No clamp :
    return select(clampedColor * vec4<f32>(vec3<f32>(1.0 + (uBrightness - 1.0) * p * fade), clampedColor.a), textureSample(uSampler, mySampler, uv), returnColorOnly);
}

fn boolVec2(x: vec2<f32>, y: vec2<f32>) -> bool
{
    if (x.x == y.x && x.y == y.y)
    {
        return true;
    }
    
    return false;
}

const PI: f32 = 3.14159265358979323846264;
`,s1=Object.defineProperty,Wp=Object.getOwnPropertySymbols,o1=Object.prototype.hasOwnProperty,a1=Object.prototype.propertyIsEnumerable,Xp=(t,e,r)=>e in t?s1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,jp=(t,e)=>{for(var r in e||(e={}))o1.call(e,r)&&Xp(t,r,e[r]);if(Wp)for(var r of Wp(e))a1.call(e,r)&&Xp(t,r,e[r]);return t};const Yp=class extends Le{constructor(t={}){t=jp(jp({},Yp.DEFAULT),t);const e=new Oe({vertex:{source:Qo,entryPoint:"mainVertex"},fragment:{source:Qo,entryPoint:"mainFragment"}}),r=new Be({vertex:Hp,fragment:zp,name:"shockwave-filter"});super({gpuProgram:e,glProgram:r,resources:{shockwaveUniforms:new oe({uTime:{value:0,type:"f32"},uCenter:{value:t.center,type:"vec2<f32>"},uSpeed:{value:t.speed,type:"f32"},uWave:{value:new Float32Array(4),type:"vec4<f32>"}})},resolution:1}),this.time=0,this.uniforms=this.resources.shockwaveUniforms.uniforms,Object.assign(this,t)}apply(t,e,r,n){this.uniforms.uTime=this.time,t.applyFilter(this,e,r,n)}get center(){return this.uniforms.uCenter}set center(t){this.uniforms.uCenter=t}get centerX(){return this.uniforms.uCenter.x}set centerX(t){this.uniforms.uCenter.x=t}get centerY(){return this.uniforms.uCenter.y}set centerY(t){this.uniforms.uCenter.y=t}get speed(){return this.uniforms.uSpeed}set speed(t){this.uniforms.uSpeed=t}get amplitude(){return this.uniforms.uWave[0]}set amplitude(t){this.uniforms.uWave[0]=t}get wavelength(){return this.uniforms.uWave[1]}set wavelength(t){this.uniforms.uWave[1]=t}get brightness(){return this.uniforms.uWave[2]}set brightness(t){this.uniforms.uWave[2]=t}get radius(){return this.uniforms.uWave[3]}set radius(t){this.uniforms.uWave[3]=t}};let Zp=Yp;Zp.DEFAULT={center:{x:0,y:0},speed:500,amplitude:30,wavelength:160,brightness:1,radius:-1};class ea{constructor(e){this._renderer=e}push(e,r,n){this._renderer.renderPipes.batch.break(n),n.add({type:"filter",canBundle:!1,action:"pushFilter",container:r,filterEffect:e})}pop(e,r,n){this._renderer.renderPipes.batch.break(n),n.add({type:"filter",action:"popFilter",canBundle:!1})}execute(e){e.action==="pushFilter"?this._renderer.filter.push(e):e.action==="popFilter"&&this._renderer.filter.pop()}destroy(){this._renderer=null}}ea.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"filter"};class De extends ge{constructor({data:e,size:r,usage:n,label:i}){super(),this.resourceType="buffer",this.resourceId=J("bufferResource"),this.touched=0,this.uid=J("buffer"),this._updateID=1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,r=r!=null?r:e==null?void 0:e.byteLength;const s=!!e;this.descriptor={size:r,usage:n,mappedAtCreation:s,label:i}}get data(){return this._data}set data(e){if(this._data!==e){const r=this._data;this._data=e,r.length!==e.length?(this.descriptor.size=e.byteLength,this.resourceId=J("bufferResource"),this.emit("change",this)):this.emit("update",this)}}update(e){this._updateSize=e||this.descriptor.size,this._updateID++,this.emit("update",this)}destroy(){this.emit("destroy",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}var W=(t=>(t[t.MAP_READ=1]="MAP_READ",t[t.MAP_WRITE=2]="MAP_WRITE",t[t.COPY_SRC=4]="COPY_SRC",t[t.COPY_DST=8]="COPY_DST",t[t.INDEX=16]="INDEX",t[t.VERTEX=32]="VERTEX",t[t.UNIFORM=64]="UNIFORM",t[t.STORAGE=128]="STORAGE",t[t.INDIRECT=256]="INDIRECT",t[t.QUERY_RESOLVE=512]="QUERY_RESOLVE",t[t.STATIC=1024]="STATIC",t))(W||{});function ta(t,e){if(!(t instanceof De)){let r=e?W.INDEX:W.VERTEX;t instanceof Array&&(e?(t=new Uint32Array(t),r=W.INDEX|W.COPY_DST):(t=new Float32Array(t),r=W.VERTEX|W.COPY_DST)),t=new De({data:t,label:"index-mesh-buffer",usage:r})}return t}class _i extends ge{constructor({attributes:e,indexBuffer:r,topology:n}){super(),this.uid=J("geometry"),this._layoutKey=0,this.attributes=e,this.buffers=[];for(const i in e){const s=e[i];s.buffer=ta(s.buffer,!1),this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this))}r&&(this.indexBuffer=ta(r,!0),this.buffers.push(this.indexBuffer)),this.topology=n||"triangle-list"}onBufferUpdate(){this.emit("update",this)}getAttribute(e){return this.attributes[e]}getIndex(){return this.indexBuffer}getBuffer(e){return this.getAttribute(e).buffer}getSize(){for(const e in this.attributes){const r=this.attributes[e];return this.getBuffer(e).data.length/(r.stride/4||r.size)}return 0}destroy(e=!1){this.emit("destroy",this),this.removeAllListeners(),e&&this.buffers.forEach(r=>r.destroy()),this.attributes=null,this.buffers=null}}function qp(t,e){e.clear();const r=e.matrix;for(let n=0;n<t.length;n++){const i=t[n];i.layerVisibleRenderable<3||(e.matrix=i.worldTransform,i.view.addBounds(e))}return e.matrix=r,e}const u1=new _i({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),shaderLocation:0,format:"float32x2",stride:2*4,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class ra{constructor(e){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new oe({inputSize:{value:new Float32Array(4),type:"vec4<f32>"},inputPixel:{value:new Float32Array(4),type:"vec4<f32>"},inputClamp:{value:new Float32Array(4),type:"vec4<f32>"},outputFrame:{value:new Float32Array(4),type:"vec4<f32>"},globalFrame:{value:new Float32Array(4),type:"vec4<f32>"},outputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new He({}),this.renderer=e}push(e){var r,n;const i=this.renderer,s=e.filterEffect.filters;this._filterStack[this._filterStackIndex]||(this._filterStack[this._filterStackIndex]=this._getFilterData());const o=this._filterStack[this._filterStackIndex];this._filterStackIndex++;const a=o.bounds;if(e.renderables?qp(e.renderables,a):br(e.container,!0,a),s.length===0){o.skip=!0;return}let u=i.renderTarget.rootRenderTarget.colorTexture.source._resolution,l=0,c=i.renderTarget.rootRenderTarget.colorTexture.source.antialias,d=!1,p=!1;for(let f=0;f<s.length;f++){const g=s[f];if(u=Math.min(u,g.resolution),l+=g.padding,g.antialias!=="inherit"&&(g.antialias==="on"?c=!0:c=!1),!(g.compatibleRenderers&i.type)){p=!1;break}if(g.blendRequired&&!((n=(r=i.backBuffer)==null?void 0:r.useBackBuffer)==null||n)){p=!1;break}p=g.enabled||p,d=d||g.blendRequired}if(!p){o.skip=!0;return}if(a.scale(u).fit(i.renderTarget.rootRenderTarget.viewport).scale(1/u).pad(l).ceil(),!a.isPositive){o.skip=!0;return}o.skip=!1,o.bounds=a,o.blendRequired=d,o.container=e.container,o.filterEffect=e.filterEffect,o.previousRenderSurface=i.renderTarget.renderTarget,o.inputTexture=pe.getOptimalTexture(a.width,a.height,u,c),i.renderTarget.bind(o.inputTexture,!0),i.globalUniforms.push({offset:a})}pop(){var e,r;const n=this.renderer;this._filterStackIndex--;const i=this._filterStack[this._filterStackIndex];if(i.skip)return;this._activeFilterData=i;const s=i.inputTexture,o=i.bounds;let a=E.EMPTY;if((r=(e=n.renderTarget).finishRenderPass)==null||r.call(e),i.blendRequired){n.encoder.finishRenderPass();const l=this._filterStackIndex>0?this._filterStack[this._filterStackIndex-1].bounds:null;a=this.getBackTexture(i.previousRenderSurface,o,l)}i.backTexture=a;const u=i.filterEffect.filters;if(this._globalFilterBindGroup.setResource(s.source.style,2),this._globalFilterBindGroup.setResource(a.source,3),n.globalUniforms.pop(),u.length===1)u[0].apply(this,s,i.previousRenderSurface,!1),pe.returnTexture(s);else{let l=i.inputTexture,c=pe.getOptimalTexture(o.width,o.height,l.source._resolution,!1),d=0;for(d=0;d<u.length-1;++d){u[d].apply(this,l,c,!0);const p=l;l=c,c=p}u[d].apply(this,l,i.previousRenderSurface,!1),pe.returnTexture(l),pe.returnTexture(c)}i.blendRequired&&pe.returnTexture(a)}getBackTexture(e,r,n){const i=e.colorTexture.source._resolution,s=pe.getOptimalTexture(r.width,r.height,i,!1);let o=r.minX,a=r.minY;n&&(o-=n.minX,a-=n.minY),o=Math.floor(o*i),a=Math.floor(a*i);const u=Math.ceil(r.width*i),l=Math.ceil(r.height*i);return this.renderer.renderTarget.copyToTexture(e,s,{x:o,y:a},{width:u,height:l}),s}applyFilter(e,r,n,i){const s=this.renderer,o=this._filterStack[this._filterStackIndex],a=o.bounds,u=Y.shared,l=o.previousRenderSurface===this.renderer.renderTarget.getRenderTarget(n);let c=this.renderer.renderTarget.rootRenderTarget.colorTexture.source._resolution;this._filterStackIndex>0&&(c=this._filterStack[this._filterStackIndex-1].inputTexture.source._resolution);const d=this._filterGlobalUniforms,p=d.uniforms,f=p.outputFrame,g=p.inputSize,b=p.inputPixel,m=p.inputClamp,x=p.globalFrame,y=p.outputTexture;l?(this._filterStackIndex>0&&(u.x=this._filterStack[this._filterStackIndex-1].bounds.minX,u.y=this._filterStack[this._filterStackIndex-1].bounds.minY),f[0]=a.minX-u.x,f[1]=a.minY-u.y):(f[0]=0,f[1]=0),f[2]=r.frameWidth,f[3]=r.frameHeight,g[0]=r.source.width,g[1]=r.source.height,g[2]=1/g[0],g[3]=1/g[1],b[0]=r.source.pixelWidth,b[1]=r.source.pixelHeight,b[2]=1/b[0],b[3]=1/b[1],m[0]=.5*b[2],m[1]=.5*b[3],m[2]=r.frameWidth*g[2]-.5*b[2],m[3]=r.frameHeight*g[3]-.5*b[3];const _=this.renderer.renderTarget.rootRenderTarget.colorTexture;x[0]=u.x*c,x[1]=u.y*c,x[2]=_.source.width*c,x[3]=_.source.height*c;const A=this.renderer.renderTarget.getRenderTarget(n);if(y[0]=A.colorTexture.frameWidth,y[1]=A.colorTexture.frameHeight,y[2]=A.isRoot?-1:1,d.update(),s.renderPipes.uniformBatch){const T=s.renderPipes.uniformBatch.getUniformBufferResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(T,0)}else this._globalFilterBindGroup.setResource(d,0);this._globalFilterBindGroup.setResource(r.source,1),this._globalFilterBindGroup.setResource(r.source.style,2),s.renderTarget.bind(n,!!i),e.groups[0]=this._globalFilterBindGroup,s.encoder.draw({geometry:u1,shader:e,state:e._state,topology:"triangle-list"})}_getFilterData(){return{skip:!1,inputTexture:null,bounds:new be,container:null,filterEffect:null,blendRequired:!1,previousRenderSurface:null}}calculateSpriteMatrix(e,r){const n=this._activeFilterData,i=e.set(n.inputTexture._source.width,0,0,n.inputTexture._source.height,n.bounds.minX,n.bounds.minY),s=r.worldTransform.copyTo(R.shared);return s.invert(),i.prepend(s),i.scale(1/r.texture.frameWidth,1/r.texture.frameHeight),i.translate(r.anchor.x,r.anchor.y),i}}ra.extension={type:[v.WebGLSystem,v.WebGPUSystem],name:"filter"};var Kp=`in vec2 vMaskCoord;
in vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mapTexture;

uniform float alpha;
uniform vec4 maskClamp;

out vec4 fragColor;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    // TODO look into why this is needed
    float npmAlpha = alpha; 
    vec4 original = texture(uSampler, vTextureCoord);
    vec4 masky = texture(mapTexture, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    fragColor = original;
}
`,Jp=`in vec2 aPosition;

out vec2 vTextureCoord;
out vec2 vMaskCoord;


uniform vec4 inputSize;
uniform vec4 outputFrame;
uniform vec4 outputTexture;
uniform mat3 filterMatrix;

vec4 filterVertexPosition(  vec2 aPosition )
{
    vec2 position = aPosition * outputFrame.zw + outputFrame.xy;
       
    position.x = position.x * (2.0 / outputTexture.x) - 1.0;
    position.y = position.y * (2.0*outputTexture.z / outputTexture.y) - outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord(  vec2 aPosition )
{
    return aPosition * (outputFrame.zw * inputSize.zw);
}

vec2 getFilterCoord( vec2 aPosition )
{
    return  ( filterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}   

void main(void)
{
    gl_Position = filterVertexPosition(aPosition);
    vTextureCoord = filterTextureCoord(aPosition);
    vMaskCoord = getFilterCoord(aPosition);
}
`,na=`struct GlobalFilterUniforms {
  inputSize:vec4<f32>,
  inputPixel:vec4<f32>,
  inputClamp:vec4<f32>,
  outputFrame:vec4<f32>,
  globalFrame:vec4<f32>,
  outputTexture:vec4<f32>,  
};

struct MaskUniforms {
  filterMatrix:mat3x3<f32>,
  maskClamp:vec4<f32>,
  alpha:f32,
};


@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uSampler: texture_2d<f32>;
@group(0) @binding(2) var mySampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;
@group(1) @binding(1) var mapTexture: texture_2d<f32>;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.outputFrame.zw + gfu.outputFrame.xy;

    position.x = position.x * (2.0 / gfu.outputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.outputTexture.z / gfu.outputTexture.y) - gfu.outputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.outputFrame.zw * gfu.inputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.globalFrame.zw) + (gfu.globalFrame.xy / gfu.globalFrame.zw);  
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.filterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{

  
  return gfu.globalFrame.zw;
}
  
@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var maskClamp = filterUniforms.maskClamp;

     var clip = step(3.5,
        step(maskClamp.x, filterUv.x) +
        step(maskClamp.y, filterUv.y) +
        step(filterUv.x, maskClamp.z) +
        step(filterUv.y, maskClamp.w));

    var mask = textureSample(mapTexture, mySampler, filterUv);
    var source = textureSample(uSampler, mySampler, uv);
    
    var npmAlpha = 0.0;

    var alphaMul = 1.0 - npmAlpha * (1.0 - mask.a);

    var a = (alphaMul * mask.r) * clip;

    return vec4(source.rgb * a, source.a) * a;
  
}`;class Qp extends Le{constructor({sprite:e}){const r=new Gs(e.texture),n=new oe({filterMatrix:{value:new R,type:"mat3x3<f32>"},maskClamp:{value:r.uClampFrame,type:"vec4<f32>"},alpha:{value:1,type:"f32"}}),i=new Oe({vertex:{source:na,entryPoint:"mainVertex"},fragment:{source:na,entryPoint:"mainFragment"}}),s=Be.from({vertex:Jp,fragment:Kp,name:"mask-filter"});super({gpuProgram:i,glProgram:s,resources:{filterUniforms:n,mapTexture:e.texture.source}}),this.sprite=e,this._textureMatrix=r}apply(e,r,n,i){this._textureMatrix.texture=this.sprite.texture,e.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.filterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.mapTexture=this.sprite.texture.source,e.applyFilter(this,r,n,i)}}class ia{constructor(e=0,r=0,n=0,i=0,s=0,o=0){this.type="triangle",this.x=e,this.y=r,this.x2=n,this.y2=i,this.x3=s,this.y3=o}contains(e,r){const n=(this.x-this.x3)*(r-this.y3)-(this.y-this.y3)*(e-this.x3),i=(this.x2-this.x)*(r-this.y)-(this.y2-this.y)*(e-this.x);if(n<0!=i<0&&n!==0&&i!==0)return!1;const s=(this.x3-this.x2)*(r-this.y2)-(this.y3-this.y2)*(e-this.x2);return s===0||s<0==n+i<=0}clone(){return new ia(this.x,this.y,this.x2,this.y2,this.x3,this.y3)}copyFrom(e){return this.x=e.x,this.y=e.y,this.x2=e.x2,this.y2=e.y2,this.x3=e.x3,this.y3=e.y3,this}copyTo(e){return e.copyFrom(this),e}getBounds(e){e=e||new te;const r=Math.min(this.x,this.x2,this.x3),n=Math.max(this.x,this.x2,this.x3),i=Math.min(this.y,this.y2,this.y3),s=Math.max(this.y,this.y2,this.y3);return e.x=r,e.y=i,e.width=n-r,e.height=s-i,e}}function sa(t,e,r){if(t)for(const n in t){const i=n.toLocaleLowerCase(),s=e[i];if(s){let o=t[n];n==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),r&&s.push(`//----${r}----//`),s.push(o)}}}const eg=/\{\{(.*?)\}\}/g;function oa(t){var e,r;const n={};return((r=(e=t.match(eg))==null?void 0:e.map(i=>i.replace(/[{()}]/g,"")))!=null?r:[]).forEach(i=>{n[i]=[]}),n}function tg(t,e){let r;const n=/@in\s+([^;]+);/g;for(;(r=n.exec(t))!==null;)e.push(r[1])}function aa(t,e,r=!1){const n=[];tg(e,n),t.forEach(a=>{a.header&&tg(a.header,n)});const i=n;r&&i.sort();const s=i.map((a,u)=>`       @location(${u}) ${a},`).join(`
`);let o=e.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${s}
`),o}function rg(t,e){let r;const n=/@out\s+([^;]+);/g;for(;(r=n.exec(t))!==null;)e.push(r[1])}function l1(t){const e=/\b(\w+)\s*:/g.exec(t);return e?e[1]:""}function c1(t){const e=/@.*?\s+/g;return t.replace(e,"")}function ng(t,e){const r=[];rg(e,r),t.forEach(u=>{u.header&&rg(u.header,r)});let n=0;const i=r.sort().map(u=>u.indexOf("builtin")>-1?u:`@location(${n++}) ${u}`).join(`,
`),s=r.sort().map(u=>`       var ${c1(u)};`).join(`
`),o=`return VSOutput(
                ${r.sort().map(u=>` ${l1(u)}`).join(`,
`)});`;let a=e.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${i}
`),a=a.replace("{{start}}",`
${s}
`),a=a.replace("{{return}}",`
${o}
`),a}function ua(t,e){let r=t;for(const n in e){const i=e[n];i.join(`
`).length?r=r.replace(`{{${n}}}`,`//-----${n} START-----//
${i.join(`
`)}
//----${n} FINISH----//`):r=r.replace(`{{${n}}}`,"")}return r}const Pt=Object.create(null),la=new Map;let h1=0;function ig({template:t,bits:e}){const r=og(t,e);if(Pt[r])return Pt[r];const{vertex:n,fragment:i}=d1(t,e);return Pt[r]=ag(n,i,e),Pt[r]}function sg({template:t,bits:e}){const r=og(t,e);return Pt[r]||(Pt[r]=ag(t.vertex,t.fragment,e)),Pt[r]}function d1(t,e){const r=e.map(o=>o.vertex).filter(o=>!!o),n=e.map(o=>o.fragment).filter(o=>!!o);let i=aa(r,t.vertex);i=ng(r,i);const s=aa(n,t.fragment,!0);return{vertex:i,fragment:s}}function og(t,e){return e.map(r=>(la.has(r)||la.set(r,h1++),la.get(r))).sort((r,n)=>r-n).join("-")+t.vertex+t.fragment}function ag(t,e,r){const n=oa(t),i=oa(e);return r.forEach(s=>{sa(s.vertex,n,s.name),sa(s.fragment,i,s.name)}),{vertex:ua(t,n),fragment:ua(e,i)}}const ug=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.worldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;

        {{start}}
        
        vColor = vec4<f32>(1., 1., 1., 1.);
        vUV = aUV;

        {{main}}

        var modelViewProjectionMatrix = globalUniforms.projectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);
       
        vColor *= globalUniforms.worldAlpha;

        {{end}}

        {{return}}
    };
`,lg=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;
   
    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {
        
        {{start}}

        var outColor:vec4<f32>;
      
        {{main}}
        
        return outColor * vColor;
      };
`,cg=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = worldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;

        {{start}}
        
        vColor = vec4(1.);
        vUV = aUV;

        {{main}}

        mat3 modelViewProjectionMatrix = projectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= worldAlpha;

        {{end}}
    }
`,hg=`
   
    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {
        
        {{start}}

        vec4 outColor;
      
        {{main}}
        
        finalColor = outColor * vColor;
    }
`,dg={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            projectionMatrix:mat3x3<f32>,
            worldTransformMatrix:mat3x3<f32>,
            worldAlpha: f32,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},fg={name:"global-uniforms-bit",vertex:{header:`
          uniform globalUniforms {
            mat3 projectionMatrix;
            mat3 worldTransformMatrix;
            float worldAlpha;
            vec2 uResolution;
          };
        `}};var f1=Object.defineProperty,pg=Object.getOwnPropertySymbols,p1=Object.prototype.hasOwnProperty,g1=Object.prototype.propertyIsEnumerable,gg=(t,e,r)=>e in t?f1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,m1=(t,e)=>{for(var r in e||(e={}))p1.call(e,r)&&gg(t,r,e[r]);if(pg)for(var r of pg(e))g1.call(e,r)&&gg(t,r,e[r]);return t};function nr({bits:t,name:e}){const r=ig({template:{fragment:lg,vertex:ug},bits:[dg,...t]});return new Oe({name:e,vertex:{source:r.vertex,entryPoint:"main"},fragment:{source:r.fragment,entryPoint:"main"}})}function ir({bits:t,name:e}){return new Be(m1({name:e},sg({template:{vertex:cg,fragment:hg},bits:[fg,...t]})))}const xi={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Ai={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},ca={};function b1(t){const e=[];if(t===1)e.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),e.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let r=0;for(let n=0;n<t;n++)e.push(`@group(1) @binding(${r++}) var textureSource${n+1}: texture_2d<f32>;`),e.push(`@group(1) @binding(${r++}) var textureSampler${n+1}: sampler;`)}return e.join(`
`)}function v1(t){const e=[];if(t===1)e.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{e.push("switch vTextureId {");for(let r=0;r<t;r++)r===t-1?e.push("  default:{"):e.push(`  case ${r}:{`),e.push(`      outColor = textureSampleGrad(textureSource${r+1}, textureSampler${r+1}, vUV, uvDx, uvDy);`),e.push("      break;}");e.push("}")}return e.join(`
`)}function Ci(t){return ca[t]||(ca[t]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;
    
                ${b1(16)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);
    
                ${v1(16)}
            `}}),ca[t]}const ha={};function y1(t){const e=[];for(let r=0;r<t;r++)r>0&&e.push("else"),r<t-1&&e.push(`if(vTextureId < ${r}.5)`),e.push("{"),e.push(`	outColor = texture(uSamplers[${r}], vUV);`),e.push("}");return e.join(`
`)}function wi(t){return ha[t]||(ha[t]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;
              
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;
    
                uniform sampler2D uSamplers[${t}];
              
            `,main:`
    
                ${y1(16)}
            `}}),ha[t]}const sr={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32> 
            {
                return (floor((position * 0.5 + 0.5) * targetSize) / targetSize) * 2.0 - 1.0;
            }
        `}},or={name:"round-pixels-bit",vertex:{header:`   
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {       
                return (floor((position * 0.5 + 0.5) * targetSize) / targetSize) * 2.0 - 1.0;
            }
        `}},Re=16,mg=new Int32Array(Re);for(let t=0;t<Re;t++)mg[t]=t;const Ti=new oe({uSamplers:{value:mg,type:"u32",size:Re}},{isStatic:!0});class da{constructor(){this._didUpload=!1,this._tempState=Me.for2d()}init(){const e=new oe({tint:{value:new Float32Array([1,1,1,1]),type:"f32"},translationMatrix:{value:new R,type:"mat3x3<f32>"}}),r=ir({name:"batch",bits:[Ai,wi(Re),or]});this._shader=new Ue({glProgram:r,resources:{uniforms:e,batchSamplers:Ti}})}start(e,r){const n=e.renderer;n.shader.bind(this._shader,this._didUpload),n.shader.bindUniformBlock(n.globalUniforms.uniformGroup,"globalUniforms",0),n.geometry.bind(r,this._shader.glProgram)}execute(e,r){const n=e.renderer;this._didUpload=!0,this._tempState.blendMode=r.blendMode,n.state.set(this._tempState);const i=r.textures.textures;for(let s=0;s<i.length;s++)n.texture.bind(i[s],s);n.geometry.draw("triangle-list",r.size,r.start)}destroy(){this._shader.destroy(!0),this._shader=null}}da.extension={type:[v.WebGLPipesAdaptor],name:"batch"};const bg=new Float32Array(1),vg=new Uint32Array(1);class fa extends _i{constructor(){const e=new De({data:bg,label:"attribute-batch-buffer",usage:W.VERTEX|W.COPY_DST}),r=new De({data:vg,label:"index-batch-buffer",usage:W.INDEX|W.COPY_DST}),n=6*4;super({attributes:{aPosition:{buffer:e,shaderLocation:0,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,shaderLocation:1,format:"float32x2",stride:n,offset:8},aColor:{buffer:e,shaderLocation:2,format:"unorm8x4",stride:n,offset:16},aTextureIdAndRound:{buffer:e,shaderLocation:3,format:"uint16x2",stride:n,offset:20}},indexBuffer:r})}reset(){this.indexBuffer.data=vg,this.buffers[0].data=bg}}function _1(t){const e=[];let r=0;for(let n=0;n<t;n++)e[r]={texture:{sampleType:"float",viewDimension:"2d",multisampled:!1},binding:r,visibility:GPUShaderStage.FRAGMENT},r++,e[r]={sampler:{type:"filtering"},binding:r,visibility:GPUShaderStage.FRAGMENT},r++;return e}function x1(t){const e={};let r=0;for(let n=0;n<t;n++)e[`textureSource${n+1}`]=r++,e[`textureSampler${n+1}`]=r++;return e}const yg={};function Si(t,e){let r=0;for(let n=0;n<e;n++)r=r*31+t[n].uid>>>0;return yg[r]||A1(t,r)}function A1(t,e){const r={};let n=0;for(let s=0;s<Re;s++){const o=s<t.length?t[s]:E.EMPTY.source;r[n++]=o.source,r[n++]=o.style}const i=new He(r);return yg[e]=i,i}const Ei=Me.for2d();class pa{init(){const e=nr({name:"batch",bits:[xi,Ci(Re),sr]});this._shader=new Ue({gpuProgram:e,groups:{}})}start(e,r){const n=e.renderer,i=n.encoder,s=this._shader.gpuProgram;this._geometry=r,i.setGeometry(r),Ei.blendMode="normal",n.pipeline.getPipeline(r,s,Ei);const o=n.globalUniforms.bindGroup;i.setBindGroup(0,o,s)}execute(e,r){const n=this._shader.gpuProgram,i=e.renderer,s=i.encoder;if(!r.bindGroup){const u=r.textures;r.bindGroup=Si(u.textures,u.count)}Ei.blendMode=r.blendMode;const o=i.bindGroup.getBindGroup(r.bindGroup,n,1),a=i.pipeline.getPipeline(this._geometry,n,Ei);r.bindGroup.touch(i.textureGC.count),s.setPipeline(a),s.renderPassEncoder.setBindGroup(1,o),s.renderPassEncoder.drawIndexed(r.size,1,r.start)}destroy(){this._shader.destroy(!0),this._shader=null}}pa.extension={type:[v.WebGPUPipesAdaptor],name:"batch"};class ga{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}function Ii(t,e){const r=t.byteLength/8|0,n=new Float64Array(t,0,r),i=new Float64Array(e,0,r);for(let a=0;a<r;a++)i[a]=n[a];const s=new Uint8Array(t,r*8),o=new Uint8Array(e,r*8);for(let a=0;a<s.length;a++)o[a]=s[a]}const _g={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var le=(t=>(t[t.DISABLED=0]="DISABLED",t[t.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",t[t.MASK_ACTIVE=2]="MASK_ACTIVE",t[t.RENDERING_MASK_REMOVE=3]="RENDERING_MASK_REMOVE",t[t.NONE=4]="NONE",t))(le||{});function xg(t,e){return e.alphaMode==="no-premultiply-alpha"&&_g[t]||t}class ma{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let e=0;e<this.count;e++){const r=this.textures[e];this.textures[e]=null,this.ids[r.uid]=null}this.count=0}}class ba{constructor(){this.type="batch",this.action="startBatch",this.start=0,this.size=0,this.blendMode="normal",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}let qr=0;class va{constructor(e=4,r=6){this.uid=J("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._vertexSize=6,this._elements=[],this._batchPool=[],this._batchPoolIndex=0,this._textureBatchPool=[],this._textureBatchPoolIndex=0,this.attributeBuffer=new ga(e*this._vertexSize*4),this.indexBuffer=new Uint32Array(r)}begin(){this.batchIndex=0,this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0,this._batchPoolIndex=0,this._textureBatchPoolIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(e){this._elements[this.elementSize++]=e,e.indexStart=this.indexSize,e.location=this.attributeSize,e.batcher=this,this.indexSize+=e.indexSize,this.attributeSize+=e.vertexSize*this._vertexSize}checkAndUpdateTexture(e,r){const n=e.batch.textures.ids[r._source.uid];return!n&&n!==0?!1:(e.textureId=n,e.texture=r,!0)}updateElement(e){this.dirty=!0,e.packAttributes(this.attributeBuffer.float32View,this.attributeBuffer.uint32View,e.location,e.textureId)}break(e){const r=this._elements;let n=this._textureBatchPool[this._textureBatchPoolIndex++]||new ma;if(n.clear(),!r[this.elementStart])return;const i=r[this.elementStart];let s=xg(i.blendMode,i.texture._source);this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const o=this.attributeBuffer.float32View,a=this.attributeBuffer.uint32View,u=this.indexBuffer;let l=this._batchIndexSize,c=this._batchIndexStart,d="startBatch",p=this._batchPool[this._batchPoolIndex++]||new ba;for(let f=this.elementStart;f<this.elementSize;++f){const g=r[f];r[f]=null;const b=g.texture._source,m=xg(g.blendMode,b),x=s!==m;if(b._batchTick===qr&&!x){g.textureId=b._textureBindLocation,l+=g.indexSize,g.packAttributes(o,a,g.location,g.textureId),g.packIndex(u,g.indexStart,g.location/this._vertexSize),g.batch=p;continue}b._batchTick=qr,(n.count>=Re||x)&&(this._finishBatch(p,c,l-c,n,s,e,d),d="renderBatch",c=l,s=m,n=this._textureBatchPool[this._textureBatchPoolIndex++]||new ma,n.clear(),p=this._batchPool[this._batchPoolIndex++]||new ba,++qr),g.textureId=b._textureBindLocation=n.count,n.ids[b.uid]=n.count,n.textures[n.count++]=b,g.batch=p,l+=g.indexSize,g.packAttributes(o,a,g.location,g.textureId),g.packIndex(u,g.indexStart,g.location/this._vertexSize)}n.count>0&&(this._finishBatch(p,c,l-c,n,s,e,d),c=l,++qr),this.elementStart=this.elementSize,this._batchIndexStart=c,this._batchIndexSize=l}_finishBatch(e,r,n,i,s,o,a){e.gpuBindGroup=null,e.action=a,e.batcher=this,e.textures=i,e.blendMode=s,e.start=r,e.size=n,++qr,o.add(e)}finish(e){this.break(e)}ensureAttributeBuffer(e){e*4<this.attributeBuffer.size||this._resizeAttributeBuffer(e*4)}ensureIndexBuffer(e){e<this.indexBuffer.length||this._resizeIndexBuffer(e)}_resizeAttributeBuffer(e){const r=Math.max(e,this.attributeBuffer.size*2),n=new ga(r);Ii(this.attributeBuffer.rawBinaryData,n.rawBinaryData),this.attributeBuffer=n}_resizeIndexBuffer(e){const r=this.indexBuffer,n=Math.max(e,r.length*2),i=new Uint32Array(n);Ii(r.buffer,i.buffer),this.indexBuffer=i}destroy(){for(let e=0;e<this.batches.length;e++)this.batches[e].destroy();this.batches=null;for(let e=0;e<this._elements.length;e++)this._elements[e].batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}class ya{constructor(e,r){this.state=Me.for2d(),this._batches=Object.create(null),this._geometries=Object.create(null),this.renderer=e,this._adaptor=r,this._adaptor.init()}buildStart(e){if(!this._batches[e.uid]){const r=new va;this._batches[e.uid]=r,this._geometries[r.uid]=new fa}this._activeBatch=this._batches[e.uid],this._activeGeometry=this._geometries[this._activeBatch.uid],this._activeBatch.begin()}addToBatch(e){this._activeBatch.add(e)}break(e){this._activeBatch.break(e)}buildEnd(e){const r=this._activeBatch,n=this._activeGeometry;r.finish(e),n.indexBuffer.data=r.indexBuffer,n.indexBuffer.update(r.indexSize*4),n.buffers[0].data=r.attributeBuffer.float32View}upload(e){const r=this._batches[e.uid],n=this._geometries[r.uid];r.dirty&&(r.dirty=!1,n.buffers[0].update(r.attributeSize*4))}execute(e){if(e.action==="startBatch"){const r=e.batcher,n=this._geometries[r.uid];this._adaptor.start(this,n)}this._adaptor.execute(this,e)}destroy(){this.state=null,this.renderer=null,this._adaptor.destroy(),this._adaptor=null;for(const e in this._batches)this._batches[e].destroy();this._batches=null;for(const e in this._geometries)this._geometries[e].destroy();this._geometries=null}}ya.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"batch"};function C1(t){const e=t.split(/([\n{}])/g).map(n=>n.trim()).filter(n=>n.length);let r="";return e.map(n=>{let i=r+n;return n==="{"?r+="    ":n==="}"&&(r=r.substr(0,r.length-4),i=r+n),i}).join(`
`)}var w1=Object.defineProperty,T1=Object.defineProperties,S1=Object.getOwnPropertyDescriptors,Ag=Object.getOwnPropertySymbols,E1=Object.prototype.hasOwnProperty,I1=Object.prototype.propertyIsEnumerable,Cg=(t,e,r)=>e in t?w1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wg=(t,e)=>{for(var r in e||(e={}))E1.call(e,r)&&Cg(t,r,e[r]);if(Ag)for(var r of Ag(e))I1.call(e,r)&&Cg(t,r,e[r]);return t},Tg=(t,e)=>T1(t,S1(e));const ar={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}},Sg=Tg(wg({},ar),{vertex:Tg(wg({},ar.vertex),{header:ar.vertex.header.replace("group(1)","group(2)")})}),Kr={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}},Eg={name:"texture-bit",fragment:{header:`
            @group(2) @binding(0) var uTexture: texture_2d<f32>;
            @group(2) @binding(1) var uSampler: sampler;

         
        `,main:`
            outColor = textureSample(uTexture, uSampler, vUV);
        `}},Ig={name:"texture-bit",fragment:{header:`
        uniform sampler2D uTexture;

         
        `,main:`
            outColor = texture(uTexture, vUV);
        `}};class Pg extends ge{constructor({original:e,view:r}){super(),this.uid=J("renderable"),this.view=r,this._original=e,this.layerTransform=new R,this.layerColor=4294967295,this.layerVisibleRenderable=3,this.view.owner=this}get layerBlendMode(){return this._original.layerBlendMode}onViewUpdate(){this.didViewUpdate=!0,this._original.layerGroup.onChildViewUpdate(this)}get isRenderable(){return this._original.isRenderable}}function Bg(t,e){const r=t.root,n=t.instructionSet;n.reset(),e.batch.buildStart(n),e.blendMode.buildStart(),e.colorMask.buildStart(),r.sortableChildren&&r.sortChildren(),Mg(r,n,e,!0),e.batch.buildEnd(n),e.blendMode.buildEnd(n)}function Jr(t,e,r){t.layerVisibleRenderable<3||!t.includeInBuild||(t.sortableChildren&&t.sortChildren(),t.isSimple?P1(t,e,r):Mg(t,e,r,!1))}function P1(t,e,r){const n=t.view;if(n&&(r.blendMode.setBlendMode(t,t.layerBlendMode,e),t.didViewUpdate=!1,r[n.renderPipeId].addRenderable(t,e)),!t.isLayerRoot){const i=t.children,s=i.length;for(let o=0;o<s;o++)Jr(i[o],e,r)}}function Mg(t,e,r,n){var i;if(n){const s=t.layerGroup;if(s.root.view){const o=(i=s.proxyRenderable)!=null?i:B1(s);o&&(r.blendMode.setBlendMode(o,o.layerBlendMode,e),r[o.view.renderPipeId].addRenderable(o,e))}}else for(let s=0;s<t.effects.length;s++){const o=t.effects[s];r[o.pipe].push(o,t,e)}if(!n&&t.isLayerRoot)r.layer.addLayerGroup(t.layerGroup,e);else{const s=t.view;s&&(r.blendMode.setBlendMode(t,t.layerBlendMode,e),t.didViewUpdate=!1,r[s.renderPipeId].addRenderable(t,e));const o=t.children;if(o.length)for(let a=0;a<o.length;a++)Jr(o[a],e,r)}if(!n)for(let s=t.effects.length-1;s>=0;s--){const o=t.effects[s];r[o.pipe].pop(o,t,e)}}function B1(t){const e=t.root;t.proxyRenderable=new Pg({original:e,view:e.view})}const M1=new be;class D1 extends _n{constructor(){super({filters:[new Qp({sprite:new $e(E.EMPTY)})]})}get sprite(){return this.filters[0].sprite}set sprite(e){this.filters[0].sprite=e}}class _a{constructor(e){this._activeMaskStage=[],this._renderer=e}push(e,r,n){const i=this._renderer;if(i.renderPipes.batch.break(n),n.add({type:"alphaMask",action:"pushMaskBegin",mask:e,canBundle:!1,maskedContainer:r}),e.renderMaskToTexture){const s=e.mask;s.includeInBuild=!0,Jr(s,n,i.renderPipes),s.includeInBuild=!1}i.renderPipes.batch.break(n),n.add({type:"alphaMask",action:"pushMaskEnd",mask:e,maskedContainer:r,canBundle:!1})}pop(e,r,n){this._renderer.renderPipes.batch.break(n),n.add({type:"alphaMask",action:"popMaskEnd",mask:e,canBundle:!1})}execute(e){const r=this._renderer,n=e.mask.renderMaskToTexture;if(e.action==="pushMaskBegin"){const i=H.get(D1);if(n){e.mask.mask.measurable=!0;const s=br(e.mask.mask,!0,M1);e.mask.mask.measurable=!1,s.ceil();const o=pe.getOptimalTexture(s.width,s.height,1,!1),a=r.renderTarget.push(o,!0);r.globalUniforms.push({projectionData:a,offset:s,worldColor:4294967295});const u=i.sprite;u.texture=o,u.worldTransform.tx=s.minX,u.worldTransform.ty=s.minY,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer,filterTexture:o})}else i.sprite=e.mask.mask,this._activeMaskStage.push({filterEffect:i,maskedContainer:e.maskedContainer})}else if(e.action==="pushMaskEnd"){const i=this._activeMaskStage[this._activeMaskStage.length-1];n&&(r.renderTarget.pop(),r.globalUniforms.pop()),r.filter.push({type:"filter",action:"pushFilter",container:i.maskedContainer,filterEffect:i.filterEffect,canBundle:!1})}else if(e.action==="popMaskEnd"){r.filter.pop();const i=this._activeMaskStage.pop();n&&pe.returnTexture(i.filterTexture),H.return(i.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}_a.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"alphaMask"};class xa{constructor(e){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=e}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(e,r,n){this._renderer.renderPipes.batch.break(n);const i=this._colorStack;i[this._colorStackIndex]=i[this._colorStackIndex-1]&e.mask;const s=this._colorStack[this._colorStackIndex];s!==this._currentColor&&(this._currentColor=s,n.add({type:"colorMask",colorMask:s,canBundle:!1})),this._colorStackIndex++}pop(e,r,n){this._renderer.renderPipes.batch.break(n);const i=this._colorStack;this._colorStackIndex--;const s=i[this._colorStackIndex-1];s!==this._currentColor&&(this._currentColor=s,n.add({type:"colorMask",colorMask:s,canBundle:!1}))}execute(e){this._renderer.colorMask.setMask(e.colorMask)}destroy(){this._colorStack=null}}xa.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"colorMask"};class R1{constructor(e){this.priority=0,this.pipe="scissorMask",this.mask=e,this.mask.renderable=!1,this.mask.measurable=!1}addBounds(e,r){si(this.mask,e,r)}addLocalBounds(e,r){oi(this.mask,e,r)}containsPoint(e,r){const n=this.mask;return r(n,e)}reset(){this.mask.measurable=!0,this.mask=null}destroy(){this.reset()}}var we=(t=>(t[t.NONE=0]="NONE",t[t.COLOR=16384]="COLOR",t[t.STENCIL=1024]="STENCIL",t[t.DEPTH=256]="DEPTH",t[t.COLOR_DEPTH=16640]="COLOR_DEPTH",t[t.COLOR_STENCIL=17408]="COLOR_STENCIL",t[t.DEPTH_STENCIL=1280]="DEPTH_STENCIL",t[t.ALL=17664]="ALL",t))(we||{});class Aa{constructor(e){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=e}push(e,r,n){const i=e,s=this._renderer;s.renderPipes.batch.break(n),s.renderPipes.blendMode.setBlendMode(i.mask,"none",n),n.add({type:"stencilMask",action:"pushMaskBegin",mask:e,canBundle:!1});const o=i.mask;o.includeInBuild=!0,this._maskHash.has(i)||this._maskHash.set(i,{instructionsStart:0,instructionsLength:0});const a=this._maskHash.get(i);a.instructionsStart=n.instructionSize,Jr(o,n,s.renderPipes),o.includeInBuild=!1,s.renderPipes.batch.break(n),n.add({type:"stencilMask",action:"pushMaskEnd",mask:e,canBundle:!1});const u=n.instructionSize-a.instructionsStart-1;a.instructionsLength=u;const l=s.renderTarget.renderTarget.uid;this._maskStackHash[l]===void 0&&(this._maskStackHash[l]=0),this._maskStackHash[l]++}pop(e,r,n){const i=e,s=this._renderer,o=s.renderTarget.renderTarget.uid;this._maskStackHash[o]--,s.renderPipes.batch.break(n),s.renderPipes.blendMode.setBlendMode(i.mask,"none",n),n.add({type:"stencilMask",action:"popMaskBegin",canBundle:!1});const a=this._maskHash.get(e);if(this._maskStackHash[o]!==0)for(let u=0;u<a.instructionsLength;u++)n.instructions[n.instructionSize++]=n.instructions[a.instructionsStart++];n.add({type:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(e){var r;const n=this._renderer,i=n.renderTarget.renderTarget.uid;let s=(r=this._maskStackHash[i])!=null?r:0;e.action==="pushMaskBegin"?(s++,n.stencil.setStencilMode(le.RENDERING_MASK_ADD,s),n.colorMask.setMask(0)):e.action==="pushMaskEnd"?(n.stencil.setStencilMode(le.MASK_ACTIVE,s),n.colorMask.setMask(15)):e.action==="popMaskBegin"?(s--,s!==0?(n.stencil.setStencilMode(le.RENDERING_MASK_REMOVE,s),n.colorMask.setMask(0)):n.renderTarget.clear(we.STENCIL)):e.action==="popMaskEnd"&&(s===0?n.stencil.setStencilMode(le.DISABLED,s):n.stencil.setStencilMode(le.MASK_ACTIVE,s),n.colorMask.setMask(15)),this._maskStackHash[i]=s}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}Aa.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"stencilMask"};var Qr=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(Qr||{});class Dg{constructor(e,r){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=r}}class Ca{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._renderer=e}destroy(){const e=this;this.destroyAll(!0),this._renderer=null,this._gl=null,this._gpuBuffers=null,e._boundBufferBases=null}contextChange(){this.destroyAll(!0),this._gl=this._renderer.gl}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){const{_gl:r}=this,n=this.getGlBuffer(e);r.bindBuffer(n.type,n.buffer)}bindBufferBase(e,r){const{_gl:n}=this;if(this._boundBufferBases[r]!==e){const i=this.getGlBuffer(e);this._boundBufferBases[r]=e,n.bindBufferBase(n.UNIFORM_BUFFER,r,i.buffer)}}bindBufferRange(e,r,n){const{_gl:i}=this;n=n||0;const s=this.getGlBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,r||0,s.buffer,n*256,256)}updateBuffer(e){const{_gl:r}=this,n=this.getGlBuffer(e);if(e._updateID===n.updateID)return n;if(n.updateID=e._updateID,r.bindBuffer(n.type,n.buffer),n.byteLength>=e.data.byteLength)r.bufferSubData(n.type,0,e.data,0,e._updateSize/4);else{const i=e.descriptor.usage&W.STATIC?r.STATIC_DRAW:r.DYNAMIC_DRAW;n.byteLength=e.data.byteLength,r.bufferData(n.type,e.data,i)}return n}destroyAll(e){const r=this._gl;if(!e)for(const n in this._gpuBuffers)r.deleteBuffer(this._gpuBuffers[n].buffer);this._gpuBuffers={}}onBufferDestroy(e,r){const n=this._gpuBuffers[e.uid],i=this._gl;r||i.deleteBuffer(n.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){const{_gl:r}=this;let n=Qr.ARRAY_BUFFER;e.descriptor.usage&W.INDEX?n=Qr.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&W.UNIFORM&&(n=Qr.UNIFORM_BUFFER);const i=new Dg(r.createBuffer(),n);return this._gpuBuffers[e.uid]=i,e.on("destroy",this.onBufferDestroy,this),i}}Ca.extension={type:[v.WebGLSystem],name:"buffer"};class Pi{constructor(e){this._renderer=e,this.webGLVersion=2,this.extensions=Object.create(null),this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()}init(e){var r;if(e!=null&&e.context)this.initFromContext(e.context);else{const n=this._renderer.background.alpha<1,i=(r=e.premultipliedAlpha)!=null?r:!0,s=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.initFromOptions({alpha:n,premultipliedAlpha:i,antialias:s,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this._renderer.runners.contextChange.emit(e);const r=this._renderer.view.canvas;r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}initFromOptions(e){const r=this.createContext(this._renderer.view.canvas,e);this.initFromContext(r)}createContext(e,r){const n=e.getContext("webgl2",r);return this.webGLVersion=2,this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,r={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};Object.assign(this.extensions,r,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault()}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}validateContext(e){const r=e.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),r&&r.stencil;const i=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i}}Pi.extension={type:[v.WebGLSystem],name:"context"},Pi.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"};var Bi=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(Bi||{}),wa=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(wa||{}),Rg=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(Rg||{}),z=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(z||{});const Fg={uint8x2:{type:z.UNSIGNED_BYTE,size:2,normalised:!1},uint8x4:{type:z.UNSIGNED_BYTE,size:4,normalised:!1},sint8x2:{type:z.BYTE,size:2,normalised:!1},sint8x4:{type:z.BYTE,size:4,normalised:!1},unorm8x2:{type:z.UNSIGNED_BYTE,size:2,normalised:!0},unorm8x4:{type:z.UNSIGNED_BYTE,size:4,normalised:!0},snorm8x2:{type:z.BYTE,size:2,normalised:!0},snorm8x4:{type:z.BYTE,size:4,normalised:!0},uint16x2:{type:z.UNSIGNED_SHORT,size:2,normalised:!1},uint16x4:{type:z.UNSIGNED_SHORT,size:4,normalised:!1},sint16x2:{type:z.SHORT,size:2,normalised:!1},sint16x4:{type:z.SHORT,size:4,normalised:!1},unorm16x2:{type:z.UNSIGNED_SHORT,size:2,normalised:!0},unorm16x4:{type:z.UNSIGNED_SHORT,size:4,normalised:!0},snorm16x2:{type:z.SHORT,size:2,normalised:!0},snorm16x4:{type:z.SHORT,size:4,normalised:!0},float16x2:{type:z.HALF_FLOAT,size:2,normalised:!1},float16x4:{type:z.HALF_FLOAT,size:4,normalised:!1},float32:{type:z.FLOAT,size:1,normalised:!1},float32x2:{type:z.FLOAT,size:2,normalised:!1},float32x3:{type:z.FLOAT,size:3,normalised:!1},float32x4:{type:z.FLOAT,size:4,normalised:!1},uint32:{type:z.UNSIGNED_INT,size:1,normalised:!1},uint32x2:{type:z.UNSIGNED_INT,size:2,normalised:!1},uint32x3:{type:z.UNSIGNED_INT,size:3,normalised:!1},uint32x4:{type:z.UNSIGNED_INT,size:4,normalised:!1},sint32:{type:z.INT,size:1,normalised:!1},sint32x2:{type:z.INT,size:2,normalised:!1},sint32x3:{type:z.INT,size:3,normalised:!1},sint32x4:{type:z.INT,size:4,normalised:!1}};function Gg(t){var e;return(e=Fg[t])!=null?e:Fg.float32}const Ta={5126:4,5123:2,5121:1},F1={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class Sa{constructor(e){this._geometryVaoHash={},this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!0}contextChange(){this.gl=this._renderer.gl}bind(e,r){const n=this.gl;this._activeGeometry=e;const i=this.getVao(e,r);this._activeVao!==i&&(this._activeVao=i,n.bindVertexArray(i)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,r=this._renderer.buffer;for(let n=0;n<e.buffers.length;n++){const i=e.buffers[n];r.updateBuffer(i)}}checkCompatibility(e,r){const n=e.attributes,i=r.attributeData;for(const s in i)if(!n[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(e,r){const n=e.attributes,i=r.attributeData,s=["g",e.uid];for(const o in n)i[o]&&s.push(o,i[o].location);return s.join("-")}getVao(e,r){var n;return((n=this._geometryVaoHash[e.uid])==null?void 0:n[r.key])||this.initGeometryVao(e,r)}initGeometryVao(e,r,n=!0){const i=this._renderer.gl,s=this._renderer.buffer;this._renderer.shader.getProgramData(r),this.checkCompatibility(e,r);const o=this.getSignature(e,r);this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this));const a=this._geometryVaoHash[e.uid];let u=a[o];if(u)return a[r.key]=u,u;const l=e.buffers,c=e.attributes,d={},p={};for(const f in l)d[f]=0,p[f]=0;for(const f in c)!c[f].size&&r.attributeData[f]?c[f].size=r.attributeData[f].size:c[f].size,d[c[f].buffer.uid]+=c[f].size*Ta[c[f].type];for(const f in c){const g=c[f],b=g.size;g.stride===void 0&&(d[g.buffer.uid]===b*Ta[g.type]?g.stride=0:g.stride=d[g.buffer.uid]),g.start===void 0&&(g.start=p[g.buffer.uid],p[g.buffer.uid]+=b*Ta[g.type])}u=i.createVertexArray(),i.bindVertexArray(u);for(let f=0;f<l.length;f++){const g=l[f];s.bind(g)}return this.activateVao(e,r),a[r.key]=u,a[o]=u,i.bindVertexArray(null),u}onGeometryDestroy(e,r){const n=this._geometryVaoHash[e.uid],i=this.gl;if(n){if(r)for(const s in n)this._activeVao!==n[s]&&this.unbind(),i.deleteVertexArray(n[s]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){const r=this.gl;for(const n in this._geometryVaoHash){if(e)for(const i in this._geometryVaoHash[n]){const s=this._geometryVaoHash[n];this._activeVao!==s&&this.unbind(),r.deleteVertexArray(s[i])}this._geometryVaoHash[n]=null}}activateVao(e,r){const n=this._renderer.gl,i=this._renderer.buffer,s=e.attributes;e.indexBuffer&&i.bind(e.indexBuffer);let o=null;for(const a in s){const u=s[a],l=u.buffer,c=i.getGlBuffer(l);if(r.attributeData[a]){o!==c&&(i.bind(l),o=c);const d=r.attributeData[a].location;n.enableVertexAttribArray(d);const p=Gg(u.format);if(n.vertexAttribPointer(d,p.size,p.type,p.normalised,u.stride,u.offset),u.instance)if(this.hasInstance)n.vertexAttribDivisor(d,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,r,n,i){const{gl:s}=this._renderer,o=this._activeGeometry,a=F1[o.topology||e];if(o.indexBuffer){const u=o.indexBuffer.data.BYTES_PER_ELEMENT,l=u===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;o.instanced?s.drawElementsInstanced(a,r||o.indexBuffer.data.length,l,(n||0)*u,o.instanceCount||1):s.drawElements(a,r||o.indexBuffer.data.length,l,(n||0)*u)}else o.instanced?s.drawArraysInstanced(a,n,r||o.getSize(),i||1):s.drawArrays(a,n,r||o.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}Sa.extension={type:[v.WebGLSystem],name:"geometry"};var G1=Object.defineProperty,kg=Object.getOwnPropertySymbols,k1=Object.prototype.hasOwnProperty,O1=Object.prototype.propertyIsEnumerable,Og=(t,e,r)=>e in t?G1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ug=(t,e)=>{for(var r in e||(e={}))k1.call(e,r)&&Og(t,r,e[r]);if(kg)for(var r of kg(e))O1.call(e,r)&&Og(t,r,e[r]);return t};const U1=new Be({vertex:`
        out vec2 vUv;

        void main() {
            vUv = vec2((gl_VertexID << 1) & 2, (gl_VertexID & 2));

            gl_Position = vec4(vUv * 2.0f + -1.0f, 0.0f, 1.0f);

            // flip dem UVs
            vUv.y = 1.0f - vUv.y;
        }`,fragment:`
        in vec2 vUv;
        out vec4 fragColor;

        uniform sampler2D uTexture;

        void main() {
            fragColor = texture(uTexture, vUv);
        }`,name:"big-triangle"}),Lg=new Ue({glProgram:U1,resources:{uTexture:E.WHITE.source}}),Ng=class{constructor(t){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=t}init(t={}){const{useBackBuffer:e,antialias:r}=Ug(Ug({},Ng.defaultOptions),t);this.useBackBuffer=e,this._antialias=r}renderStart({target:t,clear:e,clearColor:r}){if(this._useBackBufferThisRender=this.useBackBuffer&&!!t,this.useBackBuffer){const n=this._renderer.renderTarget.getRenderTarget(t);this._targetTexture=n.colorTexture,t=this._getBackBufferTexture(n.colorTexture)}r!=null||(r=this._renderer.background.colorRgba),this._renderer.renderTarget.start(t,e,r)}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const t=this._renderer;if(t.renderTarget.finishRenderPass(),!this._useBackBufferThisRender)return;const e=t.gl;t.renderTarget.bind(this._targetTexture,!1),Lg.resources.uTexture=this._backBufferTexture.source,t.shader.bind(Lg,!1),t.state.set(Me.for2d()),e.drawArrays(e.TRIANGLES,0,3)}_getBackBufferTexture(t){const e=t.source;return this._backBufferTexture=this._backBufferTexture||new E({source:new fe({width:e.width,height:e.height,resolution:e._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(e.width,e.height,e._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};let Mi=Ng;Mi.extension={type:[v.WebGLSystem],name:"backBuffer"},Mi.defaultOptions={useBackBuffer:!1};class Ea{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(e&8),!!(e&4),!!(e&2),!!(e&1)))}}Ea.extension={type:[v.WebGLSystem],name:"colorMask"};class Ia{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,r){this._renderer.geometry.bind(e,r.glProgram)}finishRenderPass(){}draw(e){const r=this._renderer,{geometry:n,shader:i,state:s,skipSync:o,topology:a,size:u,start:l,instanceCount:c}=e;r.shader.bind(i,o),r.geometry.bind(n,r.shader.activeProgram),s&&r.state.set(s),r.geometry.draw(a,u,l,c)}destroy(){const e=this;e._renderer=null}}Ia.extension={type:[v.WebGLSystem],name:"encoder"};class $g{constructor(){this.width=-1,this.height=-1,this.msaaRenderBuffer=[],this.msaa=!1,this.dirtyId=-1}}function Pa(t){const e=t.colorTexture.source.resource;return e instanceof HTMLCanvasElement&&document.body.contains(e)}function Vg(t,e,r,n,i,s){const o=s?1:-1;return t.identity(),t.a=1/n*2,t.d=o*(1/i*2),t.tx=-1-e*t.a,t.ty=-o-r*t.d,t}var L1=Object.defineProperty,zg=Object.getOwnPropertySymbols,N1=Object.prototype.hasOwnProperty,$1=Object.prototype.propertyIsEnumerable,Hg=(t,e,r)=>e in t?L1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Wg=(t,e)=>{for(var r in e||(e={}))N1.call(e,r)&&Hg(t,r,e[r]);if(zg)for(var r of zg(e))$1.call(e,r)&&Hg(t,r,e[r]);return t};const Xg=class{constructor(t={}){if(this.uid=J("renderTarget"),this.width=0,this.height=0,this.resolution=1,this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._projectionMatrix=new R,this._size=new Float32Array(2),t=Wg(Wg({},Xg.defaultDescriptor),t),this.width=t.width,this.height=t.height,this.resolution=t.resolution,this.stencil=t.stencil,this._viewport=new te(0,0,this.width,this.height),typeof t.colorTextures=="number")for(let e=0;e<t.colorTextures;e++)this.colorTextures.push(new E({source:new fe({width:this.width,height:this.height,resolution:t.resolution,antialias:t.antialias})}));else{this.colorTextures=[...t.colorTextures];const e=this.colorTexture.source;this._resize(e.width,e.height,e._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),t.depthTexture&&(this.depthTexture=new E({source:new fe({width:this.width,height:this.height,resolution:this.resolution,format:"stencil8"})}))}get size(){const t=this._size;return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t}get pixelWidth(){return this.width*this.resolution}get pixelHeight(){return this.height*this.resolution}get colorTexture(){return this.colorTextures[0]}get projectionMatrix(){const t=this.colorTexture;return Vg(this._projectionMatrix,0,0,t.frameWidth,t.frameHeight,!this.isRoot),this._projectionMatrix}get viewport(){const t=this.colorTexture,e=t.source,r=e.pixelWidth,n=e.pixelHeight,i=this._viewport,s=t.layout.frame;return i.x=s.x*r|0,i.y=s.y*n|0,i.width=s.width*r|0,i.height=s.height*n|0,i}onSourceResize(t){this._resize(t.width,t.height,t._resolution,!0)}_resize(t,e,r=this.resolution,n=!1){this.width=t,this.height=e,this.resolution=r,this.dirtyId++,this.colorTextures.forEach((i,s)=>{n&&s===0||i.source.resize(t,e,r)}),this.depthTexture&&this.depthTexture.source.resize(t,e,r)}destroy(){throw new Error("Method not implemented.")}};let ur=Xg;ur.defaultDescriptor={width:0,height:0,resolution:1,colorTextures:1,stencil:!0,antialias:!1};var V1=Object.defineProperty,jg=Object.getOwnPropertySymbols,z1=Object.prototype.hasOwnProperty,H1=Object.prototype.propertyIsEnumerable,Yg=(t,e,r)=>e in t?V1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,W1=(t,e)=>{for(var r in e||(e={}))z1.call(e,r)&&Yg(t,r,e[r]);if(jg)for(var r of jg(e))H1.call(e,r)&&Yg(t,r,e[r]);return t};const Ba=new Map;function Di(t,e){if(!Ba.has(t)){const r=new E({source:new ai(W1({resource:t},e))});Ba.set(t,r)}return Ba.get(t)}class Ma{constructor(e){this.onRenderTargetChange=new In("onRenderTargetChange"),this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._defaultClearColor=[0,0,0,0],this._clearColorCache=[0,0,0,0],this._viewPortCache={x:0,y:0,width:0,height:0},this.rootProjectionMatrix=new R,this._renderer=e}contextChange(e){this._gl=e}start(e,r=!0,n){this._renderTargetStack.length=0;const i=this.getRenderTarget(e);this.rootRenderTarget=i,this.renderingToScreen=Pa(this.rootRenderTarget),this.rootProjectionMatrix=i.projectionMatrix,this.push(i,r,n)}bind(e,r=!0,n){const i=this.getRenderTarget(e);this.renderTarget=i;const s=this.getGpuRenderTarget(i);i.dirtyId!==s.dirtyId&&(s.dirtyId=i.dirtyId,this._resizeGpuRenderTarget(i));const o=this._gl;o.bindFramebuffer(o.FRAMEBUFFER,s.framebuffer),i.colorTextures.forEach(c=>{this._renderer.texture.unbind(c)});const a=i.viewport;let u=a.y;i.isRoot&&(u=this._renderer.view.canvas.height-a.height);const l=this._viewPortCache;return(l.x!==a.x||l.y!==u||l.width!==a.width||l.height!==a.height)&&(l.x=a.x,l.y=u,l.width=a.width,l.height=a.height,o.viewport(a.x,u,a.width,a.height)),this.clear(r,n),this.onRenderTargetChange.emit(i),i}clear(e,r){if(!e)return;typeof e=="boolean"&&(e=e?we.ALL:we.NONE);const n=this._gl;if(e&we.COLOR){r!=null||(r=this._defaultClearColor);const i=this._clearColorCache,s=r;(i[0]!==s[0]||i[1]!==s[1]||i[2]!==s[2]||i[3]!==s[3])&&(i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],n.clearColor(s[0],s[1],s[2],s[3]))}n.clear(e)}push(e,r=!0,n){const i=this.bind(e,r,n);return this._renderTargetStack.push(i),i}pop(){this._renderTargetStack.pop(),this.bind(this._renderTargetStack[this._renderTargetStack.length-1],!1)}getRenderTarget(e){var r;return(r=this._renderSurfaceToRenderTargetHash.get(e))!=null?r:this._initRenderTarget(e)}_initRenderTarget(e){let r=null;return e instanceof HTMLCanvasElement&&(e=Di(e)),e instanceof ur?r=e:e instanceof E&&(r=new ur({colorTextures:[e]}),e.source.resource instanceof HTMLCanvasElement&&(r.isRoot=!0),e.source.on("destroy",()=>{r.destroy()})),this._renderSurfaceToRenderTargetHash.set(e,r),r}finishRenderPass(e){e=e||this.renderTarget;const r=this.getGpuRenderTarget(e);if(!r.msaa)return;const n=this._renderer.gl;n.bindFramebuffer(n.FRAMEBUFFER,r.resolveTargetFramebuffer),n.bindFramebuffer(n.READ_FRAMEBUFFER,r.framebuffer),n.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,n.COLOR_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,r.framebuffer)}copyToTexture(e,r,n,i){const s=this._renderer,o=this.getGpuRenderTarget(e),a=s.gl;return this.finishRenderPass(e),a.bindFramebuffer(a.FRAMEBUFFER,o.resolveTargetFramebuffer),s.texture.bind(r,0),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,n.x,n.y,i.width,i.height),r}getGpuRenderTarget(e){return this._gpuRenderTargetHash[e.uid]||this._initGpuRenderTarget(e)}_initGpuRenderTarget(e){const r=this._renderer.gl,n=new $g;return e.colorTexture.source.resource instanceof HTMLCanvasElement?(this._gpuRenderTargetHash[e.uid]=n,n.framebuffer=null,n):(this._initColor(e,n),e.stencil&&this._initStencil(n),r.bindFramebuffer(r.FRAMEBUFFER,null),this._gpuRenderTargetHash[e.uid]=n,n)}_resizeGpuRenderTarget(e){if(e.isRoot)return;const r=this.getGpuRenderTarget(e);this._resizeColor(e,r),e.stencil&&this._resizeStencil(r)}_initColor(e,r){const n=this._renderer,i=n.gl,s=i.createFramebuffer();if(r.resolveTargetFramebuffer=s,i.bindFramebuffer(i.FRAMEBUFFER,s),r.width=e.colorTexture.source.pixelWidth,r.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach((o,a)=>{const u=o.source;u.antialias&&(r.msaa=!0),n.texture.bindSource(u,0);const l=n.texture.getGlSource(u).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+a,3553,l,0)}),r.msaa){const o=i.createFramebuffer();r.framebuffer=o,i.bindFramebuffer(i.FRAMEBUFFER,o),e.colorTextures.forEach((a,u)=>{const l=i.createRenderbuffer();r.msaaRenderBuffer[u]=l})}else r.framebuffer=s}_resizeColor(e,r){const n=e.colorTexture.source;if(r.width=n.pixelWidth,r.height=n.pixelHeight,e.colorTextures.forEach((i,s)=>{s!==0&&i.source.resize(n.width,n.height,n._resolution)}),r.msaa){const i=this._renderer,s=i.gl,o=r.framebuffer;s.bindFramebuffer(s.FRAMEBUFFER,o),e.colorTextures.forEach((a,u)=>{const l=a.source;i.texture.bindSource(l,0);const c=i.texture.getGlSource(l).internalFormat,d=r.msaaRenderBuffer[u];s.bindRenderbuffer(s.RENDERBUFFER,d),s.renderbufferStorageMultisample(s.RENDERBUFFER,4,c,l.pixelWidth,l.pixelHeight),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+u,s.RENDERBUFFER,d)})}}_initStencil(e){const r=this._renderer.gl,n=r.createRenderbuffer();e.depthStencilRenderBuffer=n,r.bindRenderbuffer(r.RENDERBUFFER,n),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n)}_resizeStencil(e){const r=this._renderer.gl;r.bindRenderbuffer(r.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?r.renderbufferStorageMultisample(r.RENDERBUFFER,4,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH24_STENCIL8,e.width,e.height)}}Ma.extension={type:[v.WebGLSystem],name:"renderTarget"};const Xe=[];Xe[le.NONE]=void 0,Xe[le.DISABLED]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilWriteMask:0,stencilReadMask:0,stencilBack:{compare:"always",passOp:"keep"}},Xe[le.RENDERING_MASK_ADD]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"increment-clamp"}},Xe[le.RENDERING_MASK_ADD]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"increment-clamp"}},Xe[le.RENDERING_MASK_REMOVE]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilBack:{compare:"always",passOp:"decrement-clamp"}},Xe[le.MASK_ACTIVE]={format:"stencil8",depthCompare:"always",depthWriteEnabled:!1,stencilWriteMask:0,stencilBack:{compare:"equal",passOp:"keep"}};class Da{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:le.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP}}onRenderTargetChange(e){if(this._activeRenderTarget===e)return;this._activeRenderTarget=e;let r=this._renderTargetStencilState[e.uid];r||(r=this._renderTargetStencilState[e.uid]={stencilMode:le.DISABLED,stencilReference:0}),this.setStencilMode(r.stencilMode,r.stencilReference)}setStencilMode(e,r){const n=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,s=Xe[e],o=this._stencilCache;if(n.stencilMode=e,n.stencilReference=r,e===le.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),(e!==o.stencilMode||o.stencilReference!==r)&&(o.stencilMode=e,o.stencilReference=r,i.stencilFunc(this._comparisonFuncMapping[s.stencilBack.compare],r,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[s.stencilBack.passOp]))}}Da.extension={type:[v.WebGLSystem],name:"stencil"};class X1{}class Zg{constructor(e,r){this.program=e,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}class Ri extends ge{constructor({buffer:e,offset:r,size:n}){super(),this.uid=J("buffer"),this.touched=0,this.resourceType="bufferResource",this.resourceId=J("buffer"),this.bufferResource=!0,this.buffer=e,this.offset=r,this.size=n,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this.resourceId=J("buffer"),this.emit("change",this)}destroy(e=!1){e&&this.buffer.destroy(),this.buffer=null}}function Ra(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),n}function Fa(t){const e=new Array(t);for(let r=0;r<e.length;r++)e[r]=!1;return e}function Ga(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Fa(2*e);case"bvec3":return Fa(3*e);case"bvec4":return Fa(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const j1={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function qg(t){return j1[t]}let Fi=null;const Kg={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function ka(t,e){if(!Fi){const r=Object.keys(Kg);Fi={};for(let n=0;n<r.length;++n){const i=r[n];Fi[t[i]]=Kg[i]}}return Fi[e]}function Jg(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=e.getActiveAttrib(t,i);if(s.name.startsWith("gl_"))continue;const o=ka(e,s.type),a={type:o,name:s.name,size:qg(o),location:e.getAttribLocation(t,s.name)};r[s.name]=a}return r}function Qg(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let i=0;i<n;i++){const s=e.getActiveUniformBlockName(t,i),o=e.getUniformBlockIndex(t,s),a=e.getActiveUniformBlockParameter(t,i,e.UNIFORM_BLOCK_DATA_SIZE);r[s]={name:s,index:o,size:a}}return r}function em(t,e){const r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;i++){const s=e.getActiveUniform(t,i),o=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),u=ka(e,s.type);r[o]={name:o,index:i,type:u,size:s.size,isArray:a,value:Ga(u,s.size)}}return r}function tm(t,e){const r=t.getShaderSource(e).split(`
`).map((l,c)=>`${c}: ${l}`),n=t.getShaderInfoLog(e),i=n.split(`
`),s={},o=i.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!s[l]?(s[l]=!0,!0):!1),a=[""];o.forEach(l=>{r[l-1]=`%c${r[l-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=r.join(`
`);a[0]=u,console.error(n),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}function rm(t,e,r,n){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||tm(t,r),t.getShaderParameter(n,t.COMPILE_STATUS)||tm(t,n),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function nm(t,e){const r=Ra(t,t.VERTEX_SHADER,e.vertex),n=Ra(t,t.FRAGMENT_SHADER,e.fragment),i=t.createProgram();t.attachShader(i,r),t.attachShader(i,n);const s=e.transformFeedbackVaryings;s&&(typeof t.transformFeedbackVaryings!="function"||t.transformFeedbackVaryings(i,s.names,s.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||rm(t,i,r,n),e.attributeData=Jg(i,t),e.uniformData=em(i,t),e.uniformBlockData=Qg(i,t),t.deleteShader(r),t.deleteShader(n);const o={};for(const a in e.uniformData){const u=e.uniformData[a];o[a]={location:t.getUniformLocation(i,a),value:Ga(u.type,u.size)}}return new Zg(i,o)}const tt={textureCount:0,blockIndex:0};class Oa{constructor(e){this.activeProgram=null,this._programDataHash=Object.create(null),this._nextIndex=0,this._boundUniformsIdsToIndexHash=Object.create(null),this._boundIndexToUniformsHash=Object.create(null),this._renderer=e}contextChange(e){this._gl=e,this._maxBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS)}bind(e,r){if(this._setProgram(e.glProgram),r)return;tt.textureCount=0,tt.blockIndex=0;const n=this._gl,i=this.getProgramData(e.glProgram);for(const s in e.groups){const o=e.groups[s];for(const a in o.resources){const u=o.resources[a];if(u instanceof oe)u.ubo?this.bindUniformBlock(u,e.uniformBindMap[s][a],tt.blockIndex++):this._updateUniformGroup(u);else if(u instanceof Ri)this.bindUniformBlock(u,e.uniformBindMap[s][a],tt.blockIndex++);else if(u instanceof fe){this._renderer.texture.bind(u,tt.textureCount);const l=e.uniformBindMap[s][a],c=i.uniformData[l];c&&(c.value!==tt.textureCount&&n.uniform1i(c.location,tt.textureCount),tt.textureCount++)}else u instanceof Tr}}}_updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this.activeProgram,tt)}bindUniformBlock(e,r,n=0){const i=this._renderer.buffer,s=this.getProgramData(this.activeProgram),o=e.bufferResource;o&&this._renderer.uniformBuffer.updateUniformGroup(e),i.updateBuffer(e.buffer);let a=this._boundUniformsIdsToIndexHash[e.uid];if(a===void 0){const c=this._nextIndex++%this._maxBindings,d=this._boundIndexToUniformsHash[c];d&&(this._boundUniformsIdsToIndexHash[d.uid]=void 0),a=this._boundUniformsIdsToIndexHash[e.uid]=c,this._boundIndexToUniformsHash[c]=e,o?i.bindBufferRange(e.buffer,c,e.offset):i.bindBufferBase(e.buffer,c)}const u=this._gl,l=this.activeProgram.uniformBlockData[r].index;s.uniformBlockBindings[n]!==a&&(s.uniformBlockBindings[n]=a,u.uniformBlockBinding(s.program,l,a))}_setProgram(e){if(this.activeProgram===e)return;this.activeProgram=e;const r=this.getProgramData(e);this._gl.useProgram(r.program)}getProgramData(e){return this._programDataHash[e.key]||this._createProgramData(e)}_createProgramData(e){const r=e.key;return this._programDataHash[r]=nm(this._gl,e),this._programDataHash[r]}destroy(){for(const e of Object.keys(this._programDataHash))this._programDataHash[e].destroy(),this._programDataHash[e]=null;this._programDataHash=null,this._boundUniformsIdsToIndexHash=null}}Oa.extension={type:[v.WebGLSystem],name:"shader"};let en;function Y1(){if(typeof en=="boolean")return en;try{en=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch(t){en=!1}return en}const Gi=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e instanceof E),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}],Z1={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},q1={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function im(t,e){const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in t.uniforms){const i=e[n];if(!i){t.uniforms[n]instanceof oe?t.uniforms[n].ubo?r.push(`
                        renderer.shader.bindUniformBlock(uv.${n}, "${n}");
                    `):r.push(`
                        renderer.shader.updateUniformGroup(uv.${n});
                    `):t.uniforms[n]instanceof Ri&&r.push(`
                        renderer.shader.bindBufferResource(uv.${n}, "${n}");
                    `);continue}const s=t.uniforms[n];let o=!1;for(let a=0;a<Gi.length;a++)if(Gi[a].test(i,s)){r.push(Gi[a].code(n,s)),o=!0;break}if(!o){const a=(i.size===1&&!i.isArray?Z1:q1)[i.type].replace("location",`ud["${n}"].location`);r.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${a};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}class Ua{constructor(e){this.destroyed=!1,this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this._systemCheck(),this.gl=null,this._cache={}}_systemCheck(){if(!Y1())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e}updateUniformGroup(e,r,n){const i=this._renderer.shader.getProgramData(r);(!e.isStatic||e.dirtyId!==i.uniformDirtyGroups[e.uid])&&(i.uniformDirtyGroups[e.uid]=e.dirtyId,this._getUniformSyncFunction(e,r)(i.uniformData,e.uniforms,this._renderer,n))}_getUniformSyncFunction(e,r){var n;return((n=this._uniformGroupSyncHash[e.signature])==null?void 0:n[r.key])||this._createUniformSyncFunction(e,r)}_createUniformSyncFunction(e,r){const n=this._uniformGroupSyncHash[e.signature]||(this._uniformGroupSyncHash[e.signature]={}),i=this._getSignature(e,r.uniformData,"u");return this._cache[i]||(this._cache[i]=im(e,r.uniformData)),n[r.key]=this._cache[i],n[r.key]}_getSignature(e,r,n){const i=e.uniforms,s=[`${n}-`];for(const o in i)s.push(o),r[o]&&s.push(r[o].type);return s.join("-")}destroy(){this._renderer=null,this.destroyed=!0,this._cache=null}}Ua.extension={type:[v.WebGLSystem],name:"uniformGroup"};function K1(t){return t=t.replaceAll("texture2D","texture").replaceAll("gl_FragColor","fragColor").replaceAll("varying","in"),t=`
        out vec4 fragColor;
    ${t}
    `,t}function sm(t){const e={};return e.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.add=[t.ONE,t.ONE],e.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e}const J1=0,Q1=1,eA=2,tA=3,rA=4,nA=5,La=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[J1]=this.setBlend,this.map[Q1]=this.setOffset,this.map[eA]=this.setCullFace,this.map[tA]=this.setDepthTest,this.map[rA]=this.setFrontFace,this.map[nA]=this.setDepthMask,this.checks=[],this.defaultState=new Me,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModesMap=sm(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this._updateCheck(La._checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this._updateCheck(La._checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const e=this.blendModesMap[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static _checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static _checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};let Na=La;Na.extension={type:[v.WebGLSystem],name:"state"};class om{constructor(e){this.target=wa.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=z.UNSIGNED_BYTE,this.internalFormat=Bi.RGBA,this.format=Bi.RGBA,this.samplerType=0}}const am={id:"image",upload(t,e,r){e.width===t.width||e.height===t.height?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,t.width,t.height,0,e.format,e.type,t.resource),e.width=t.width,e.height=t.height}},iA={"bc2-rgba-unorm":!0,"bc3-rgba-unorm":!0,"bc7-rgba-unorm":!0,"etc2-rgba8unorm":!0,"astc-4x4-unorm":!0},um={id:"compressed",upload(t,e,r){r.pixelStorei(r.UNPACK_ALIGNMENT,4);let n=t.pixelWidth,i=t.pixelHeight;const s=!!iA[t.format];for(let o=0;o<t.resource.length;o++){const a=t.resource[o];s?r.compressedTexImage2D(r.TEXTURE_2D,o,e.internalFormat,n,i,0,a):r.texImage2D(r.TEXTURE_2D,o,e.internalFormat,n,i,0,e.format,e.type,a),n=Math.max(n>>1,1),i=Math.max(i>>1,1)}}},$a={id:"image",upload(t,e,r){const n=t.alphaMode==="premultiply-alpha-on-upload";r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n);const i=e.width,s=e.height,o=t.pixelWidth,a=t.pixelHeight,u=t.resourceWidth,l=t.resourceHeight;u<o||l<a?((i!==o||s!==a)&&r.texImage2D(e.target,0,e.internalFormat,o,a,0,e.format,e.type,null),r.texSubImage2D(r.TEXTURE_2D,0,0,0,u,l,e.format,e.type,t.resource)):i===o||s===a?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,o,a,0,e.format,e.type,t.resource),e.width=o,e.height=a}},lm={id:"video",upload(t,e,r){if(!t.isValid){r.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null);return}$a.upload(t,e,r)}},Va={linear:9729,nearest:9728},cm={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},ki={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},hm={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function za(t,e,r,n,i,s){const o=s;if(e[i](o,e.TEXTURE_WRAP_S,ki[t.addressModeU]),e[i](o,e.TEXTURE_WRAP_T,ki[t.addressModeV]),e[i](o,e.TEXTURE_WRAP_R,ki[t.addressModeW]),e[i](o,e.TEXTURE_MAG_FILTER,Va[t.magFilter]),r){const a=cm[t.minFilter][t.mipmapFilter];e[i](o,e.TEXTURE_MIN_FILTER,a)}else e[i](o,e.TEXTURE_MIN_FILTER,Va[t.minFilter]);if(n&&t.maxAnisotropy>1){const a=Math.min(t.maxAnisotropy,e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[i](o,n.TEXTURE_MAX_ANISOTROPY_EXT,a)}t.compare&&e[i](o,e.TEXTURE_COMPARE_FUNC,hm[t.compare])}function dm(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}var sA=Object.defineProperty,fm=Object.getOwnPropertySymbols,oA=Object.prototype.hasOwnProperty,aA=Object.prototype.propertyIsEnumerable,pm=(t,e,r)=>e in t?sA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,tn=(t,e)=>{for(var r in e||(e={}))oA.call(e,r)&&pm(t,r,e[r]);if(fm)for(var r of fm(e))aA.call(e,r)&&pm(t,r,e[r]);return t};function gm(t,e){return tn(tn(tn(tn(tn({r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.SRGB8_ALPHA8,rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:t.RGBA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8},e.s3tc?{"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{}),e.s3tc_sRGB?{"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{}),e.bptc?{"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{}),e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{}),e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{})}function mm(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}function uA(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const n=t[r+3];if(n!==0){const i=255.001/n;t[r]=t[r]*i+.5,t[r+1]=t[r+1]*i+.5,t[r+2]=t[r+2]*i+.5}}}const lA=new te,cA=4;class Ha{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:$a,buffer:am,video:lm,compressed:um},this._useSeparateSamplers=!1,this._renderer=e}contextChange(e){if(this._gl=e,!this._mapFormatToInternalFormat){const r=this._renderer.context.extensions;this._mapFormatToInternalFormat=gm(e,r),this._mapFormatToType=mm(e),this._mapFormatToFormat=dm(e)}for(let r=0;r<16;r++)this.bind(E.EMPTY,r)}bind(e,r=0){const n=e.source;e?(this.bindSource(n,r),this._useSeparateSamplers&&this._bindSampler(n.style,r)):(this.bindSource(null,r),this._useSeparateSamplers&&this._bindSampler(null,r))}bindSource(e,r=0){const n=this._gl;if(e.touched=this._renderer.textureGC.count,this._boundTextures[r]!==e){this._boundTextures[r]=e,this._activateLocation(r),e=e||E.EMPTY.source;const i=this.getGlSource(e);n.bindTexture(i.target,i.texture)}}_bindSampler(e,r=0){const n=this._gl;if(!e){this._boundSamplers[r]=null,n.bindSampler(r,null);return}const i=this._getGlSampler(e);this._boundSamplers[r]!==i&&(this._boundSamplers[r]=i,n.bindSampler(r,i))}unbind(e){const r=e.source,n=this._boundTextures,i=this._gl;for(let s=0;s<n.length;s++)if(n[s]===r){this._activateLocation(s);const o=this.getGlSource(r);i.bindTexture(o.target,null),n[s]=null}}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){const r=this._gl,n=new om(r.createTexture());if(n.type=this._mapFormatToType[e.format],n.internalFormat=this._mapFormatToInternalFormat[e.format],n.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps){const i=Math.max(e.width,e.height);e.mipLevelCount=Math.floor(Math.log2(i))+1}return this._glTextures[e.uid]=n,e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),this.managedTextures.push(e),this.onSourceUpdate(e),this.onStyleChange(e),n}onStyleChange(e){const r=this._gl,n=this._glTextures[e.uid];r.bindTexture(r.TEXTURE_2D,n.texture),this._boundTextures[this._activeTextureLocation]=e,za(e.style,r,e.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D)}onSourceUnload(e){const r=this._glTextures[e.uid];r&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(r.texture))}onSourceUpdate(e){const r=this._gl,n=this.getGlSource(e);r.bindTexture(r.TEXTURE_2D,n.texture),this._boundTextures[this._activeTextureLocation]=e,this._uploads[e.uploadMethodId]?(this._uploads[e.uploadMethodId].upload(e,n,this._gl),e.autoGenerateMipmaps&&e.mipLevelCount>1&&r.generateMipmap(n.target)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.pixelWidth,e.pixelHeight,0,r.RGBA,r.UNSIGNED_BYTE,null)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){const r=this._gl,n=this._gl.createSampler();return this._glSamplers[e.resourceId]=n,za(e,r,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",n),this._glSamplers[e.resourceId]}_getGlSampler(e){return this._glSamplers[e.resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){const{pixels:r,width:n,height:i}=this.getPixels(e),s=Z.get().createCanvas();s.width=n,s.height=i;const o=s.getContext("2d");if(o){const a=o.createImageData(n,i);a.data.set(r),o.putImageData(a,0,0)}return s}getPixels(e){const r=e.source.resolution,n=lA;n.x=e.frameX,n.y=e.frameY,n.width=e.frameWidth,n.height=e.frameHeight;const i=Math.max(Math.round(n.width*r),1),s=Math.max(Math.round(n.height*r),1),o=new Uint8Array(cA*i*s),a=this._renderer,u=a.renderTarget.getRenderTarget(e),l=a.renderTarget.getGpuRenderTarget(u),c=a.gl;return c.bindFramebuffer(c.FRAMEBUFFER,l.resolveTargetFramebuffer),c.readPixels(Math.round(n.x*r),Math.round(n.y*r),i,s,c.RGBA,c.UNSIGNED_BYTE,o),{pixels:new Uint8ClampedArray(o.buffer),width:i,height:s}}destroy(){const e=this;e._renderer=null}}Ha.extension={type:[v.WebGLSystem],name:"texture"};class Wa{init(){const e=new oe({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new R,type:"mat3x3<f32>"}}),r=ir({name:"graphics",bits:[Ai,wi(Re),Kr,or]});this.shader=new Ue({glProgram:r,resources:{localUniforms:e,batchSamplers:Ti}})}execute(e,r){const n=r.view.context,i=n.customShader||this.shader,s=e.renderer,o=s.graphicsContext,{geometry:a,instructions:u}=o.getContextRenderData(n);s.shader.bind(i),s.shader.bindUniformBlock(s.globalUniforms.uniformGroup,"globalUniforms"),s.geometry.bind(a,i.glProgram);const l=u.instructions;for(let c=0;c<u.instructionSize;c++){const d=l[c];if(d.size){for(let p=0;p<d.textures.textures.length;p++)s.texture.bind(d.textures.textures[p],p);s.geometry.draw("triangle-list",d.size,d.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}Wa.extension={type:[v.WebGLPipesAdaptor],name:"graphics"};class Xa{init(){const e=ir({name:"mesh",bits:[Kr,Ig,or]});this._shader=new Ue({glProgram:e,resources:{uTexture:E.EMPTY.source}}),this._shader.addResource("globalUniforms",0,0),this._shader.addResource("localUniforms",1,0)}execute(e,r){const n=e.renderer,i=r.view;let s=i._shader;if(!s){s=this._shader;const o=i.texture.source;s.resources.uTexture=o,s.resources.uSampler=o.style}s.groups[0]=n.globalUniforms.bindGroup,s.groups[1]=e.localUniformsBindGroup,n.encoder.draw({geometry:i._geometry,shader:s,state:i.state})}destroy(){this._shader.destroy(!0),this._shader=null}}Xa.extension={type:[v.WebGLPipesAdaptor],name:"mesh"};function ja(t,e){const r=t.instructionSet,n=r.instructions;for(let i=0;i<r.instructionSize;i++){const s=n[i];e[s.type].execute(s)}}class Ya{constructor(e){this._renderer=e}addLayerGroup(e,r){this._renderer.renderPipes.batch.break(r),r.add(e)}execute(e){e.isRenderable&&(this._renderer.globalUniforms.push({projectionData:this._renderer.renderTarget.renderTarget,worldTransformMatrix:e.worldTransform,worldColor:e.worldColor}),ja(e,this._renderer.renderPipes),this._renderer.globalUniforms.pop())}destroy(){this._renderer=null}}Ya.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"layer"};function Za(t,e=[]){e.push(t);for(let r=0;r<t.layerGroupChildren.length;r++)Za(t.layerGroupChildren[r],e);return e}function qa(t,e,r){const n=t>>16&255,i=t>>8&255,s=t&255,o=e>>16&255,a=e>>8&255,u=e&255,l=n+(o-n)*r,c=i+(a-i)*r,d=s+(u-s)*r;return(l<<16)+(c<<8)+d}const bm=16777215+16777215;function Oi(t,e){const r=(t>>24&255)/255,n=(e>>24&255)/255,i=r*n*255,s=t&16777215,o=e&16777215;let a=16777215;return s+(o<<32)!==bm&&(s===16777215?a=o:o===16777215?a=s:a=qa(s,o,.5)),a+(i<<24)}function hA(t,e,r){const n=(r>>24&255)/255,i=e*n*255,s=((t&255)<<16)+(t&65280)+(t>>16&255),o=r&16777215;let a=16777215;return s+(o<<32)!==bm&&(s===16777215?a=o:o===16777215?a=s:a=qa(s,o,.5)),a+(i<<24)}const dA=new K;function Ka(t,e=!1){vm(t);const r=t.childrenToUpdate,n=t.updateTick;t.updateTick++;for(const i in r){const s=r[i],o=s.list,a=s.index;for(let u=0;u<a;u++)Ja(o[u],n,0);s.index=0}if(e)for(let i=0;i<t.layerGroupChildren.length;i++)Ka(t.layerGroupChildren[i],e)}function vm(t){t.layerGroupParent?(t.worldTransform.appendFrom(t.root.layerTransform,t.layerGroupParent.worldTransform),t.worldColor=Oi(t.root.layerColor,t.layerGroupParent.worldColor)):(t.worldTransform.copyFrom(t.root.layerTransform),t.worldColor=t.root.localColor)}function Ja(t,e,r){if(e===t.updateTick)return;t.updateTick=e,t.didChange=!1;const n=t.localTransform;Ye(n,t);const i=t.parent;if(i&&!i.isLayerRoot?(r=r|t._updateFlags,t.layerTransform.appendFrom(n,i.layerTransform),r&&ym(t,i,r)):(r=t._updateFlags,t.layerTransform.copyFrom(n),r&&ym(t,dA,r)),!t.isLayerRoot){const s=t.children,o=s.length;for(let u=0;u<o;u++)Ja(s[u],e,r);const a=t.layerGroup;t.view&&!a.structureDidChange&&a.updateRenderable(t)}}function ym(t,e,r){r&Cn&&(t.layerColor=Oi(t.localColor,e.layerColor)),r&ys&&(t.layerBlendMode=t.localBlendMode==="inherit"?e.layerBlendMode:t.localBlendMode),r&wn&&(t.layerVisibleRenderable=t.localVisibleRenderable&e.layerVisibleRenderable),t._updateFlags=0}function _m(t,e){const{list:r,index:n}=t.childrenRenderablesToUpdate;let i=!1;for(let s=0;s<n;s++){const o=r[s],a=o.view;if(i=e[a.renderPipeId].validateRenderable(o),i)break}return t.structureDidChange=i,i&&(t.childrenRenderablesToUpdate.index=0),i}class Qa{constructor(e){this._renderer=e}render({container:e,transform:r}){e.layer=!0;const n=this._renderer,i=Za(e.layerGroup,[]),s=n.renderPipes;for(let o=0;o<i.length;o++){const a=i[o];a.runOnRender(),a.instructionSet.renderPipes=s,a.structureDidChange||_m(a,s),Ka(a),a.structureDidChange?(a.structureDidChange=!1,Bg(a,s)):fA(a),n.renderPipes.batch.upload(a.instructionSet)}r&&e.layerGroup.worldTransform.copyFrom(r),n.globalUniforms.start({projectionData:n.renderTarget.rootRenderTarget,worldTransformMatrix:e.layerGroup.worldTransform}),ja(e.layerGroup,s),s.uniformBatch&&(s.uniformBatch.renderEnd(),s.uniformBuffer.renderEnd())}destroy(){const e=this;e._renderer=null}}Qa.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"layer"};function fA(t){const{list:e,index:r}=t.childrenRenderablesToUpdate;for(let n=0;n<r;n++){const i=e[n];i.didViewUpdate&&t.updateRenderable(i)}t.childrenRenderablesToUpdate.index=0}function eu(t,e,r,n,i,s,o,a=null){let u=0;r*=e,i*=s;const l=a.a,c=a.b,d=a.c,p=a.d,f=a.tx,g=a.ty;for(;u<o;){const b=t[r],m=t[r+1];n[i]=l*b+d*m+f,n[i+1]=c*b+p*m+g,i+=s,r+=e,u++}}function tu(t,e,r,n){let i=0;for(e*=r;i<n;)t[e]=0,t[e+1]=0,e+=r,i++}function Ui(t,e,r,n,i){const s=e.a,o=e.b,a=e.c,u=e.d,l=e.tx,c=e.ty;r=r||0,n=n||2,i=i||t.length/n-r;let d=r*n;for(let p=0;p<i;p++){const f=t[d],g=t[d+1];t[d]=s*f+a*g+l,t[d+1]=o*f+u*g+c,d+=n}}class Li{constructor(){this.batcher=null,this.batch=null,this.applyTransform=!0,this.roundPixels=0}get blendMode(){return this.applyTransform?this.renderable.layerBlendMode:"normal"}packIndex(e,r,n){const i=this.geometryData.indices;for(let s=0;s<this.indexSize;s++)e[r++]=i[s+this.indexOffset]+n-this.vertexOffset}packAttributes(e,r,n,i){const s=this.geometryData,o=this.renderable,a=s.vertices,u=s.uvs,l=this.vertexOffset*2,c=(this.vertexOffset+this.vertexSize)*2,d=this.color,p=d>>16|d&65280|(d&255)<<16;if(this.applyTransform){const f=Oi(p+(this.alpha*255<<24),o.layerColor),g=o.layerTransform,b=i<<16|this.roundPixels&65535,m=g.a,x=g.b,y=g.c,_=g.d,A=g.tx,T=g.ty;for(let P=l;P<c;P+=2){const M=a[P],S=a[P+1];e[n]=m*M+y*S+A,e[n+1]=x*M+_*S+T,e[n+2]=u[P],e[n+3]=u[P+1],r[n+4]=f,r[n+5]=b,n+=6}}else{const f=p+(this.alpha*255<<24);for(let g=l;g<c;g+=2)e[n]=a[g],e[n+1]=a[g+1],e[n+2]=u[g],e[n+3]=u[g+1],r[n+4]=f,r[n+5]=i,n+=6}}get vertSize(){return this.vertexSize}copyTo(e){e.indexOffset=this.indexOffset,e.indexSize=this.indexSize,e.vertexOffset=this.vertexOffset,e.vertexSize=this.vertexSize,e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.geometryData=this.geometryData}}const Bt={build(t,e){let r,n,i,s,o,a;if(t.type==="circle"){const A=t;r=A.x,n=A.y,o=a=A.radius,i=s=0}else if(t.type==="ellipse"){const A=t;r=A.x,n=A.y,o=A.halfWidth,a=A.halfHeight,i=s=0}else{const A=t,T=A.width/2,P=A.height/2;r=A.x+T,n=A.y+P,o=a=Math.max(0,Math.min(A.radius,Math.min(T,P))),i=T-o,s=P-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return e;const u=Math.ceil(2.3*Math.sqrt(o+a)),l=u*8+(i?4:0)+(s?4:0);if(l===0)return e;if(u===0)return e[0]=e[6]=r+i,e[1]=e[3]=n+s,e[2]=e[4]=r-i,e[5]=e[7]=n-s,e;let c=0,d=u*4+(i?2:0)+2,p=d,f=l,g=i+o,b=s,m=r+g,x=r-g,y=n+b;if(e[c++]=m,e[c++]=y,e[--d]=y,e[--d]=x,s){const A=n-b;e[p++]=x,e[p++]=A,e[--f]=A,e[--f]=m}for(let A=1;A<u;A++){const T=Math.PI/2*(A/u),P=i+Math.cos(T)*o,M=s+Math.sin(T)*a,S=r+P,C=r-P,w=n+M,F=n-M;e[c++]=S,e[c++]=w,e[--d]=w,e[--d]=C,e[p++]=C,e[p++]=F,e[--f]=F,e[--f]=S}g=i,b=s+a,m=r+g,x=r-g,y=n+b;const _=n-b;return e[c++]=m,e[c++]=y,e[--f]=_,e[--f]=m,i&&(e[c++]=x,e[c++]=y,e[--f]=_,e[--f]=x),e},triangulate(t,e,r,n,i,s){if(t.length===0)return;let o=0,a=0;const u=t.length/4;o+=t[0],a+=t[1],o+=t[u|0],a+=t[(u|0)+1],o+=t[u*2|0],a+=t[(u*2|0)+1],o+=t[u*3|0],a+=t[(u*3|0)+1],o/=4,a/=4;let l=n;e[l*r]=o,e[l*r+1]=a,l++;const c=n;e[l*r]=t[0],e[l*r+1]=t[1],l++;for(let d=2;d<t.length;d+=2)e[l*r]=t[d],e[l*r+1]=t[d+1],i[s++]=l,i[s++]=c,i[s++]=l-1,l++;i[s++]=l-1,i[s++]=c,i[s++]=c+1}},xm=1e-4,ru=1e-4;function Am(t){const e=t.length;if(e<6)return 1;let r=0;for(let n=0,i=t[e-2],s=t[e-1];n<e;n+=2){const o=t[n],a=t[n+1];r+=(o-i)*(a+s),i=o,s=a}return r<0?-1:1}function Cm(t,e,r,n,i,s,o,a){const u=t-r*i,l=e-n*i,c=t+r*s,d=e+n*s;let p,f;o?(p=n,f=-r):(p=-n,f=r);const g=u+p,b=l+f,m=c+p,x=d+f;return a.push(g,b),a.push(m,x),2}function Mt(t,e,r,n,i,s,o,a){const u=r-t,l=n-e;let c=Math.atan2(u,l),d=Math.atan2(i-t,s-e);a&&c<d?c+=Math.PI*2:!a&&c>d&&(d+=Math.PI*2);let p=c;const f=d-c,g=Math.abs(f),b=Math.sqrt(u*u+l*l),m=(15*g*Math.sqrt(b)/Math.PI>>0)+1,x=f/m;if(p+=x,a){o.push(t,e),o.push(r,n);for(let y=1,_=p;y<m;y++,_+=x)o.push(t,e),o.push(t+Math.sin(_)*b,e+Math.cos(_)*b);o.push(t,e),o.push(i,s)}else{o.push(r,n),o.push(t,e);for(let y=1,_=p;y<m;y++,_+=x)o.push(t+Math.sin(_)*b,e+Math.cos(_)*b),o.push(t,e);o.push(i,s),o.push(t,e)}return m*2}function wm(t,e,r,n,i,s,o,a,u){const l=xm;if(t.length===0)return;const c=e;let d=c.alignment;if(e.alignment!==.5){let ee=Am(t);r&&(ee*=-1),d=(d-.5)*ee+.5}const p=new Y(t[0],t[1]),f=new Y(t[t.length-2],t[t.length-1]),g=n,b=Math.abs(p.x-f.x)<l&&Math.abs(p.y-f.y)<l;if(g){t=t.slice(),b&&(t.pop(),t.pop(),f.set(t[t.length-2],t[t.length-1]));const ee=(p.x+f.x)*.5,ut=(f.y+p.y)*.5;t.unshift(ee,ut),t.push(ee,ut)}const m=i,x=t.length/2;let y=t.length;const _=m.length/2,A=c.width/2,T=A*A,P=c.miterLimit*c.miterLimit;let M=t[0],S=t[1],C=t[2],w=t[3],F=0,N=0,D=-(S-w),I=M-C,q=0,O=0,Q=Math.sqrt(D*D+I*I);D/=Q,I/=Q,D*=A,I*=A;const Ft=d,k=(1-Ft)*2,U=Ft*2;g||(c.cap==="round"?y+=Mt(M-D*(k-U)*.5,S-I*(k-U)*.5,M-D*k,S-I*k,M+D*U,S+I*U,m,!0)+2:c.cap==="square"&&(y+=Cm(M,S,D,I,k,U,!0,m))),m.push(M-D*k,S-I*k),m.push(M+D*U,S+I*U);for(let ee=1;ee<x-1;++ee){M=t[(ee-1)*2],S=t[(ee-1)*2+1],C=t[ee*2],w=t[ee*2+1],F=t[(ee+1)*2],N=t[(ee+1)*2+1],D=-(S-w),I=M-C,Q=Math.sqrt(D*D+I*I),D/=Q,I/=Q,D*=A,I*=A,q=-(w-N),O=C-F,Q=Math.sqrt(q*q+O*O),q/=Q,O/=Q,q*=A,O*=A;const ut=C-M,pn=S-w,gn=C-F,mn=N-w,O0=ut*gn+pn*mn,is=pn*gn-mn*ut,bn=is<0;if(Math.abs(is)<.001*Math.abs(O0)){m.push(C-D*k,w-I*k),m.push(C+D*U,w+I*U),O0>=0&&(c.join==="round"?y+=Mt(C,w,C-D*k,w-I*k,C-q*k,w-O*k,m,!1)+4:y+=2,m.push(C-q*U,w-O*U),m.push(C+q*k,w+O*k));continue}const U0=(-D+M)*(-I+w)-(-D+C)*(-I+S),L0=(-q+F)*(-O+w)-(-q+C)*(-O+N),ss=(ut*L0-gn*U0)/is,os=(mn*U0-pn*L0)/is,gl=(ss-C)*(ss-C)+(os-w)*(os-w),Gt=C+(ss-C)*k,kt=w+(os-w)*k,Ot=C-(ss-C)*U,Ut=w-(os-w)*U,Jw=Math.min(ut*ut+pn*pn,gn*gn+mn*mn),N0=bn?k:U,Qw=Jw+N0*N0*T;gl<=Qw?c.join==="bevel"||gl/T>P?(bn?(m.push(Gt,kt),m.push(C+D*U,w+I*U),m.push(Gt,kt),m.push(C+q*U,w+O*U)):(m.push(C-D*k,w-I*k),m.push(Ot,Ut),m.push(C-q*k,w-O*k),m.push(Ot,Ut)),y+=2):c.join==="round"?bn?(m.push(Gt,kt),m.push(C+D*U,w+I*U),y+=Mt(C,w,C+D*U,w+I*U,C+q*U,w+O*U,m,!0)+4,m.push(Gt,kt),m.push(C+q*U,w+O*U)):(m.push(C-D*k,w-I*k),m.push(Ot,Ut),y+=Mt(C,w,C-D*k,w-I*k,C-q*k,w-O*k,m,!1)+4,m.push(C-q*k,w-O*k),m.push(Ot,Ut)):(m.push(Gt,kt),m.push(Ot,Ut)):(m.push(C-D*k,w-I*k),m.push(C+D*U,w+I*U),c.join==="round"?bn?y+=Mt(C,w,C+D*U,w+I*U,C+q*U,w+O*U,m,!0)+2:y+=Mt(C,w,C-D*k,w-I*k,C-q*k,w-O*k,m,!1)+2:c.join==="miter"&&gl/T<=P&&(bn?(m.push(Ot,Ut),m.push(Ot,Ut)):(m.push(Gt,kt),m.push(Gt,kt)),y+=2),m.push(C-q*k,w-O*k),m.push(C+q*U,w+O*U),y+=2)}M=t[(x-2)*2],S=t[(x-2)*2+1],C=t[(x-1)*2],w=t[(x-1)*2+1],D=-(S-w),I=M-C,Q=Math.sqrt(D*D+I*I),D/=Q,I/=Q,D*=A,I*=A,m.push(C-D*k,w-I*k),m.push(C+D*U,w+I*U),g||(c.cap==="round"?y+=Mt(C-D*(k-U)*.5,w-I*(k-U)*.5,C-D*k,w-I*k,C+D*U,w+I*U,m,!1)+2:c.cap==="square"&&(y+=Cm(C,w,D,I,k,U,!1,m)));const Kw=ru*ru;for(let ee=_;ee<y+_-2;++ee)M=m[ee*2],S=m[ee*2+1],C=m[(ee+1)*2],w=m[(ee+1)*2+1],F=m[(ee+2)*2],N=m[(ee+2)*2+1],!(Math.abs(M*(w-N)+C*(N-S)+F*(S-w))<Kw)&&a.push(ee,ee+1,ee+2)}var nu=Ni,pA=Ni;function Ni(t,e,r){r=r||2;var n=e&&e.length,i=n?e[0]*r:t.length,s=Tm(t,0,i,r,!0),o=[];if(!s||s.next===s.prev)return o;var a,u,l,c,d,p,f;if(n&&(s=yA(t,e,s,r)),t.length>80*r){a=l=t[0],u=c=t[1];for(var g=r;g<i;g+=r)d=t[g],p=t[g+1],d<a&&(a=d),p<u&&(u=p),d>l&&(l=d),p>c&&(c=p);f=Math.max(l-a,c-u),f=f!==0?32767/f:0}return rn(s,o,r,a,u,f,0),o}function Tm(t,e,r,n,i){var s,o;if(i===ou(t,e,r,n)>0)for(s=e;s<r;s+=n)o=Im(s,t[s],t[s+1],o);else for(s=r-n;s>=e;s-=n)o=Im(s,t[s],t[s+1],o);return o&&$i(o,o.next)&&(sn(o),o=o.next),o}function Dt(t,e){if(!t)return t;e||(e=t);var r=t,n;do if(n=!1,!r.steiner&&($i(r,r.next)||ne(r.prev,r,r.next)===0)){if(sn(r),r=e=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==e);return e}function rn(t,e,r,n,i,s,o){if(t){!o&&s&&wA(t,n,i,s);for(var a=t,u,l;t.prev!==t.next;){if(u=t.prev,l=t.next,s?mA(t,n,i,s):gA(t)){e.push(u.i/r|0),e.push(t.i/r|0),e.push(l.i/r|0),sn(t),t=l.next,a=l.next;continue}if(t=l,t===a){o?o===1?(t=bA(Dt(t),e,r),rn(t,e,r,n,i,s,2)):o===2&&vA(t,e,r,n,i,s):rn(Dt(t),e,r,n,i,s,1);break}}}}function gA(t){var e=t.prev,r=t,n=t.next;if(ne(e,r,n)>=0)return!1;for(var i=e.x,s=r.x,o=n.x,a=e.y,u=r.y,l=n.y,c=i<s?i<o?i:o:s<o?s:o,d=a<u?a<l?a:l:u<l?u:l,p=i>s?i>o?i:o:s>o?s:o,f=a>u?a>l?a:l:u>l?u:l,g=n.next;g!==e;){if(g.x>=c&&g.x<=p&&g.y>=d&&g.y<=f&&lr(i,a,s,u,o,l,g.x,g.y)&&ne(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function mA(t,e,r,n){var i=t.prev,s=t,o=t.next;if(ne(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,l=o.x,c=i.y,d=s.y,p=o.y,f=a<u?a<l?a:l:u<l?u:l,g=c<d?c<p?c:p:d<p?d:p,b=a>u?a>l?a:l:u>l?u:l,m=c>d?c>p?c:p:d>p?d:p,x=iu(f,g,e,r,n),y=iu(b,m,e,r,n),_=t.prevZ,A=t.nextZ;_&&_.z>=x&&A&&A.z<=y;){if(_.x>=f&&_.x<=b&&_.y>=g&&_.y<=m&&_!==i&&_!==o&&lr(a,c,u,d,l,p,_.x,_.y)&&ne(_.prev,_,_.next)>=0||(_=_.prevZ,A.x>=f&&A.x<=b&&A.y>=g&&A.y<=m&&A!==i&&A!==o&&lr(a,c,u,d,l,p,A.x,A.y)&&ne(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;_&&_.z>=x;){if(_.x>=f&&_.x<=b&&_.y>=g&&_.y<=m&&_!==i&&_!==o&&lr(a,c,u,d,l,p,_.x,_.y)&&ne(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;A&&A.z<=y;){if(A.x>=f&&A.x<=b&&A.y>=g&&A.y<=m&&A!==i&&A!==o&&lr(a,c,u,d,l,p,A.x,A.y)&&ne(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function bA(t,e,r){var n=t;do{var i=n.prev,s=n.next.next;!$i(i,s)&&Sm(i,n,n.next,s)&&nn(i,s)&&nn(s,i)&&(e.push(i.i/r|0),e.push(n.i/r|0),e.push(s.i/r|0),sn(n),sn(n.next),n=t=s),n=n.next}while(n!==t);return Dt(n)}function vA(t,e,r,n,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&EA(o,a)){var u=Em(o,a);o=Dt(o,o.next),u=Dt(u,u.next),rn(o,e,r,n,i,s,0),rn(u,e,r,n,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function yA(t,e,r,n){var i=[],s,o,a,u,l;for(s=0,o=e.length;s<o;s++)a=e[s]*n,u=s<o-1?e[s+1]*n:t.length,l=Tm(t,a,u,n,!1),l===l.next&&(l.steiner=!0),i.push(SA(l));for(i.sort(_A),s=0;s<i.length;s++)r=xA(i[s],r);return r}function _A(t,e){return t.x-e.x}function xA(t,e){var r=AA(t,e);if(!r)return e;var n=Em(r,t);return Dt(n,n.next),Dt(r,r.next)}function AA(t,e){var r=e,n=t.x,i=t.y,s=-1/0,o;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var a=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s&&(s=a,o=r.x<r.next.x?r:r.next,a===n))return o}r=r.next}while(r!==e);if(!o)return null;var u=o,l=o.x,c=o.y,d=1/0,p;r=o;do n>=r.x&&r.x>=l&&n!==r.x&&lr(i<c?n:s,i,l,c,i<c?s:n,i,r.x,r.y)&&(p=Math.abs(i-r.y)/(n-r.x),nn(r,t)&&(p<d||p===d&&(r.x>o.x||r.x===o.x&&CA(o,r)))&&(o=r,d=p)),r=r.next;while(r!==u);return o}function CA(t,e){return ne(t.prev,t,e.prev)<0&&ne(e.next,t,t.next)<0}function wA(t,e,r,n){var i=t;do i.z===0&&(i.z=iu(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,TA(i)}function TA(t){var e,r,n,i,s,o,a,u,l=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,n=r,a=0,e=0;e<l&&(a++,n=n.nextZ,!!n);e++);for(u=l;a>0||u>0&&n;)a!==0&&(u===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;r=n}s.nextZ=null,l*=2}while(o>1);return t}function iu(t,e,r,n,i){return t=(t-r)*i|0,e=(e-n)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function SA(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function lr(t,e,r,n,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(n-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function EA(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!IA(t,e)&&(nn(t,e)&&nn(e,t)&&PA(t,e)&&(ne(t.prev,t,e.prev)||ne(t,e.prev,e))||$i(t,e)&&ne(t.prev,t,t.next)>0&&ne(e.prev,e,e.next)>0)}function ne(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function $i(t,e){return t.x===e.x&&t.y===e.y}function Sm(t,e,r,n){var i=zi(ne(t,e,r)),s=zi(ne(t,e,n)),o=zi(ne(r,n,t)),a=zi(ne(r,n,e));return!!(i!==s&&o!==a||i===0&&Vi(t,r,e)||s===0&&Vi(t,n,e)||o===0&&Vi(r,t,n)||a===0&&Vi(r,e,n))}function Vi(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function zi(t){return t>0?1:t<0?-1:0}function IA(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Sm(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function nn(t,e){return ne(t.prev,t,t.next)<0?ne(t,e,t.next)>=0&&ne(t,t.prev,e)>=0:ne(t,e,t.prev)<0||ne(t,t.next,e)<0}function PA(t,e){var r=t,n=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==t);return n}function Em(t,e){var r=new su(t.i,t.x,t.y),n=new su(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function Im(t,e,r,n){var i=new su(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function sn(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function su(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Ni.deviation=function(t,e,r,n){var i=e&&e.length,s=i?e[0]*r:t.length,o=Math.abs(ou(t,0,s,r));if(i)for(var a=0,u=e.length;a<u;a++){var l=e[a]*r,c=a<u-1?e[a+1]*r:t.length;o-=Math.abs(ou(t,l,c,r))}var d=0;for(a=0;a<n.length;a+=3){var p=n[a]*r,f=n[a+1]*r,g=n[a+2]*r;d+=Math.abs((t[p]-t[g])*(t[f+1]-t[p+1])-(t[p]-t[f])*(t[g+1]-t[p+1]))}return o===0&&d===0?0:Math.abs((d-o)/o)};function ou(t,e,r,n){for(var i=0,s=e,o=r-n;s<r;s+=n)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}Ni.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[i][s][o]);i>0&&(n+=t[i-1].length,r.holes.push(n))}return r},nu.default=pA;function au(t,e,r,n,i,s,o){const a=nu(t,e,2);if(!a)return;for(let l=0;l<a.length;l+=3)s[o++]=a[l]+i,s[o++]=a[l+1]+i,s[o++]=a[l+2]+i;let u=i*n;for(let l=0;l<t.length;l+=2)r[u]=t[l],r[u+1]=t[l+1],u+=n}const BA=[],uu={build(t,e){for(let r=0;r<t.points.length;r++)e[r]=t.points[r];return e},triangulate(t,e,r,n,i,s){au(t,BA,e,r,n,i,s)}},lu={build(t,e){const r=t,n=r.x,i=r.y,s=r.width,o=r.height;return s>=0&&o>=0&&(e[0]=n,e[1]=i,e[2]=n+s,e[3]=i,e[4]=n+s,e[5]=i+o,e[6]=n,e[7]=i+o),e},triangulate(t,e,r,n,i,s){let o=0;n*=r,e[n+o]=t[0],e[n+o+1]=t[1],o+=r,e[n+o]=t[2],e[n+o+1]=t[3],o+=r,e[n+o]=t[6],e[n+o+1]=t[7],o+=r,e[n+o]=t[4],e[n+o+1]=t[5],o+=r;const a=n/r;i[s++]=a,i[s++]=a+1,i[s++]=a+2,i[s++]=a+1,i[s++]=a+3,i[s++]=a+2}},cu={build(t,e){return e[0]=t.x,e[1]=t.y,e[2]=t.x2,e[3]=t.y2,e[4]=t.x3,e[5]=t.y3,e},triangulate(t,e,r,n,i,s){let o=0;n*=r,e[n+o]=t[0],e[n+o+1]=t[1],o+=r,e[n+o]=t[2],e[n+o+1]=t[3],o+=r,e[n+o]=t[4],e[n+o+1]=t[5];const a=n/r;i[s++]=a,i[s++]=a+1,i[s++]=a+2}},hu={rectangle:lu,polygon:uu,triangle:cu,circle:Bt,ellipse:Bt,roundedRectangle:Bt},MA=new te;function Pm(t){const e={vertices:[],uvs:[],indices:[]},r=[];for(let n=0;n<t.instructions.length;n++){const i=t.instructions[n];if(i.action==="texture")DA(i.data,r,e);else if(i.action==="fill"||i.action==="stroke"){const s=i.action==="stroke",o=i.data.path.shapePath,a=i.data.style,u=i.data.hole;s&&u&&Bm(u.shapePath,a,null,!0,r,e),Bm(o,a,u,s,r,e)}}return r}function DA(t,e,r){const{vertices:n,uvs:i,indices:s}=r,o=s.length,a=n.length/2,u=[],l=hu.rectangle,c=MA,d=t.image;c.x=t.dx,c.y=t.dy,c.width=t.dw,c.height=t.dh;const p=t.transform;l.build(c,u),p&&Ui(u,p),l.triangulate(u,n,2,a,s,o);const f=d.layout.uvs;i.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const g=H.get(Li);g.indexOffset=o,g.indexSize=s.length-o,g.vertexOffset=a,g.vertexSize=n.length/2-a,g.color=t.style,g.alpha=t.alpha,g.texture=d,g.geometryData=r,e.push(g)}function Bm(t,e,r,n,i,s){const{vertices:o,uvs:a,indices:u}=s,l=t.shapePrimitives.length-1;t.shapePrimitives.forEach(({shape:c,transform:d},p)=>{var f;const g=u.length,b=o.length/2,m=[],x=hu[c.type];if(x.build(c,m),d&&Ui(m,d),n){const T=(f=c.closePath)!=null?f:!0;wm(m,e,!1,T,o,2,b,u,g)}else if(r&&l===p){l!==0&&console.warn("[Pixi Graphics] only the last shape have be cut out");const T=[],P=m.slice();RA(r.shapePath).forEach(M=>{T.push(P.length/2),P.push(...M)}),au(P,T,o,2,b,u,g)}else x.triangulate(m,o,2,b,u,g);const y=a.length/2,_=e.texture;if(_!==E.WHITE){const T=e.matrix;d&&T.append(d.clone().invert()),eu(o,2,b,a,y,2,o.length/2-b,T)}else tu(a,y,2,o.length/2-b);const A=H.get(Li);A.indexOffset=g,A.indexSize=u.length-g,A.vertexOffset=b,A.vertexSize=o.length/2-b,A.color=e.color,A.alpha=e.alpha,A.texture=_,A.geometryData=s,i.push(A)})}function RA(t){if(!t)return[];const e=t.shapePrimitives,r=[];for(let n=0;n<e.length;n++){const i=e[n].shape,s=[];hu[i.type].build(i,s),r.push(s)}return r}class Mm{}class Dm{constructor(){this.geometry=new fa,this.instructions=new ms}init(){this.geometry.reset(),this.instructions.reset()}}class du{constructor(){this._activeBatchers=[],this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._needsContextNeedsRebuild=[]}prerender(){this._returnActiveBatchers()}getContextRenderData(e){return this._graphicsDataContextHash[e.uid]||this._initContextRenderData(e)}updateGpuContext(e){let r=this._gpuContextHash[e.uid]||this._initContext(e);if(e.dirty){r?this._cleanGraphicsContextData(e):r=this._initContext(e);const n=Pm(e);let i=0;const s=e.batchMode;let o=!0;if(e.customShader||s==="no-batch")o=!1;else if(s==="auto"){for(let a=0;a<n.length;a++)if(i+=n[a].vertexSize,i>400){o=!1;break}}r=this._gpuContextHash[e.uid]={isBatchable:o,batches:n},e.dirty=!1}return r}getGpuContext(e){return this._gpuContextHash[e.uid]||this._initContext(e)}_returnActiveBatchers(){for(let e=0;e<this._activeBatchers.length;e++)H.return(this._activeBatchers[e]);this._activeBatchers.length=0}_initContextRenderData(e){const r=H.get(Dm),n=this._gpuContextHash[e.uid].batches;let i=0,s=0;n.forEach(l=>{l.applyTransform=!1,i+=l.geometryData.vertices.length,s+=l.geometryData.indices.length});const o=H.get(va);this._activeBatchers.push(o),o.ensureAttributeBuffer(i),o.ensureIndexBuffer(s),o.begin();for(let l=0;l<n.length;l++){const c=n[l];o.add(c)}o.finish(r.instructions);const a=r.geometry;a.indexBuffer.data=o.indexBuffer,a.buffers[0].data=o.attributeBuffer.float32View,a.indexBuffer.update(o.indexSize*4),a.buffers[0].update(o.attributeSize*4);const u=o.batches;for(let l=0;l<u.length;l++){const c=u[l];c.bindGroup=Si(c.textures.textures,c.textures.count)}return this._graphicsDataContextHash[e.uid]=r,r}_initContext(e){const r=new Mm;return this._gpuContextHash[e.uid]=r,e.on("update",this.onGraphicsContextUpdate,this),e.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[e.uid]}onGraphicsContextUpdate(e){this._needsContextNeedsRebuild.push(e)}onGraphicsContextDestroy(e){this._cleanGraphicsContextData(e),this._gpuContextHash[e.uid]=null}_cleanGraphicsContextData(e){const r=this._gpuContextHash[e.uid];r.isBatchable||this._graphicsDataContextHash[e.uid]&&(H.return(this.getContextRenderData(e)),this._graphicsDataContextHash[e.uid]=null),r.batches&&r.batches.forEach(n=>{H.return(n)})}destroy(){for(const e of this._needsContextNeedsRebuild)this._cleanGraphicsContextData(e),this._gpuContextHash[e.uid]=null;this._needsContextNeedsRebuild.length=0}}du.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"graphicsContext"};function FA(t,e,r,n){r[n++]=(t>>16&255)/255,r[n++]=(t>>8&255)/255,r[n++]=(t&255)/255,r[n++]=e}function fu(t,e,r){e[r++]=(t&255)/255,e[r++]=(t>>8&255)/255,e[r++]=(t>>16&255)/255,e[r++]=(t>>24&255)/255}class pu{constructor(e,r){this.state=Me.for2d(),this._renderableBatchesHash=Object.create(null),this.renderer=e,this._adaptor=r,this._adaptor.init()}validateRenderable(e){const r=e.view.context,n=!!this._renderableBatchesHash[e.uid],i=this.renderer.graphicsContext.updateGpuContext(r);return!!(i.isBatchable||n!==i.isBatchable)}addRenderable(e,r){const n=this.renderer.graphicsContext.updateGpuContext(e.view.context);e.view._didUpdate&&(e.view._didUpdate=!1,this._rebuild(e)),n.isBatchable?this._addToBatcher(e,r):(this.renderer.renderPipes.batch.break(r),r.add({type:"graphics",renderable:e}))}updateRenderable(e){const r=this._renderableBatchesHash[e.uid];if(r)for(let n=0;n<r.length;n++){const i=r[n];i.batcher.updateElement(i)}}destroyRenderable(e){this._removeBatchForRenderable(e.uid)}execute({renderable:e}){if(!e.isRenderable)return;const r=this.renderer,n=e.view.context;if(!r.graphicsContext.getGpuContext(n).batches.length)return;const i=n.customShader||this._adaptor.shader;this.state.blendMode=e.layerBlendMode;const s=i.resources.localUniforms.uniforms;s.uTransformMatrix=e.layerTransform,s.uRound=r._roundPixels|e.view.roundPixels,fu(e.layerColor,s.uColor,0),this._adaptor.execute(this,e)}_rebuild(e){const r=!!this._renderableBatchesHash[e.uid],n=this.renderer.graphicsContext.updateGpuContext(e.view.context);r&&this._removeBatchForRenderable(e.uid),n.isBatchable&&this._initBatchesForRenderable(e),e.view.batched=n.isBatchable}_addToBatcher(e,r){const n=this.renderer.renderPipes.batch,i=this._getBatchesForRenderable(e);for(let s=0;s<i.length;s++){const o=i[s];n.addToBatch(o,r)}}_getBatchesForRenderable(e){return this._renderableBatchesHash[e.uid]||this._initBatchesForRenderable(e)}_initBatchesForRenderable(e){const r=e.view.context,n=this.renderer.graphicsContext.getGpuContext(r),i=this.renderer._roundPixels|e.view.roundPixels,s=n.batches.map(o=>{const a=H.get(Li);return o.copyTo(a),a.renderable=e,a.roundPixels=i,a});return this._renderableBatchesHash[e.uid]=s,e.on("destroyed",()=>{this.destroyRenderable(e)}),s}_removeBatchForRenderable(e){this._renderableBatchesHash[e].forEach(r=>{H.return(r)}),this._renderableBatchesHash[e]=null}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null;for(const e in this._renderableBatchesHash)this._removeBatchForRenderable(e);this._renderableBatchesHash=null}}pu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"graphics"};class Rm{constructor(){this.batcher=null,this.batch=null,this.roundPixels=0}get blendMode(){return this.renderable.layerBlendMode}reset(){this.renderable=null,this.texture=null,this.batcher=null,this.batch=null}packIndex(e,r,n){const i=this.renderable.view.geometry.indices;for(let s=0;s<i.length;s++)e[r++]=i[s]+n}packAttributes(e,r,n,i){const s=this.renderable,o=this.renderable.view.geometry,a=s.layerTransform,u=i<<16|this.roundPixels&65535,l=a.a,c=a.b,d=a.c,p=a.d,f=a.tx,g=a.ty,b=o.positions,m=o.uvs,x=s.layerColor;for(let y=0;y<b.length;y+=2){const _=b[y],A=b[y+1];e[n]=l*_+d*A+f,e[n+1]=c*_+p*A+g,e[n+2]=m[y],e[n+3]=m[y+1],r[n+4]=x,r[n+5]=u,n+=6}}get vertexSize(){return this.renderable.view.geometry.positions.length/2}get indexSize(){return this.renderable.view.geometry.indices.length}}class gu{constructor(e,r){this.localUniforms=new oe({uTransformMatrix:{value:new R,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new He({0:this.localUniforms}),this._renderableHash=Object.create(null),this._gpuBatchableMeshHash=Object.create(null),this.renderer=e,this._adaptor=r,this._adaptor.init()}validateRenderable(e){const r=this._getRenderableData(e),n=r.batched,i=e.view.batched;if(r.batched=i,n!==i)return!0;if(i){const s=e.view._geometry;if(s.indices.length!==r.indexSize||s.positions.length!==r.vertexSize)return r.indexSize=s.indices.length,r.vertexSize=s.positions.length,!0;const o=this._getBatchableMesh(e),a=e.view.texture;if(o.texture._source!==a._source&&o.texture._source!==a._source)return o.batcher.checkAndUpdateTexture(o,a)}return!1}addRenderable(e,r){const n=this.renderer.renderPipes.batch,{batched:i}=this._getRenderableData(e);if(i){const s=this._getBatchableMesh(e);s.texture=e.view._texture,n.addToBatch(s)}else n.break(r),r.add({type:"mesh",renderable:e})}updateRenderable(e){if(e.view.batched){const r=this._gpuBatchableMeshHash[e.uid];r.texture=e.view._texture,r.batcher.updateElement(r)}}destroyRenderable(e){this._renderableHash[e.uid]=null;const r=this._gpuBatchableMeshHash[e.uid];H.return(r),this._gpuBatchableMeshHash[e.uid]=null}execute({renderable:e}){if(!e.isRenderable)return;const r=e.view;r.state.blendMode=e.layerBlendMode;const n=this.localUniforms;n.uniforms.uTransformMatrix=e.layerTransform,n.uniforms.uRound=this.renderer._roundPixels|e.view.roundPixels,n.update(),fu(e.layerColor,n.uniforms.uColor,0),this._adaptor.execute(this,e)}_getRenderableData(e){return this._renderableHash[e.uid]||this._initRenderableData(e)}_initRenderableData(e){const r=e.view;return this._renderableHash[e.uid]={batched:r.batched,indexSize:r._geometry.indices.length,vertexSize:r._geometry.positions.length},e.on("destroyed",()=>{this.destroyRenderable(e)}),this._renderableHash[e.uid]}_getBatchableMesh(e){return this._gpuBatchableMeshHash[e.uid]||this._initBatchableMesh(e)}_initBatchableMesh(e){const r=H.get(Rm);return r.renderable=e,r.texture=e.view._texture,r.roundPixels=this.renderer._roundPixels|e.view.roundPixels,this._gpuBatchableMeshHash[e.uid]=r,r.renderable=e,r}destroy(){for(const e in this._gpuBatchableMeshHash)this._gpuBatchableMeshHash[e]&&H.return(this._gpuBatchableMeshHash[e]);this._gpuBatchableMeshHash=null,this._renderableHash=null,this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}gu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"mesh"};class Hi{constructor(){this.vertexSize=4,this.indexSize=6,this.location=0,this.batcher=null,this.batch=null,this.roundPixels=0}get blendMode(){return this.renderable.layerBlendMode}packAttributes(e,r,n,i){const s=this.renderable,o=this.texture,a=s.layerTransform,u=a.a,l=a.b,c=a.c,d=a.d,p=a.tx,f=a.ty,g=this.bounds,b=g[1],m=g[0],x=g[3],y=g[2],_=o._layout.uvs,A=s.layerColor,T=i<<16|this.roundPixels&65535;e[n+0]=u*m+c*y+p,e[n+1]=d*y+l*m+f,e[n+2]=_.x0,e[n+3]=_.y0,r[n+4]=A,r[n+5]=T,e[n+6]=u*b+c*y+p,e[n+7]=d*y+l*b+f,e[n+8]=_.x1,e[n+9]=_.y1,r[n+10]=A,r[n+11]=T,e[n+12]=u*b+c*x+p,e[n+13]=d*x+l*b+f,e[n+14]=_.x2,e[n+15]=_.y2,r[n+16]=A,r[n+17]=T,e[n+18]=u*m+c*x+p,e[n+19]=d*x+l*m+f,e[n+20]=_.x3,e[n+21]=_.y3,r[n+22]=A,r[n+23]=T}packIndex(e,r,n){e[r]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3}reset(){this.renderable=null,this.texture=null,this.batcher=null,this.batch=null,this.bounds=null}}let cr;class mu{constructor(e){this._gpuSpriteHash=Object.create(null),this._renderer=e,cr=this._gpuSpriteHash}addRenderable(e,r){const n=this._getGpuSprite(e);e.view._didUpdate&&this._updateBatchableSprite(e,n),this._renderer.renderPipes.batch.addToBatch(n)}updateRenderable(e){const r=cr[e.uid];e.view._didUpdate&&this._updateBatchableSprite(e,r),r.batcher.updateElement(r)}validateRenderable(e){const r=e.view._texture,n=this._getGpuSprite(e);return n.texture._source!==r._source?!n.batcher.checkAndUpdateTexture(n,r):!1}destroyRenderable(e){const r=cr[e.uid];H.return(r),cr[e.uid]=null}_updateBatchableSprite(e,r){const n=e.view;n._didUpdate=!1,r.bounds=n.bounds,r.texture=n._texture}_getGpuSprite(e){return cr[e.uid]||this._initGPUSprite(e)}_initGPUSprite(e){const r=H.get(Hi);r.renderable=e;const n=e.view;return r.texture=n._texture,r.bounds=n.bounds,r.roundPixels=this._renderer._roundPixels|n.roundPixels,cr[e.uid]=r,e.view._didUpdate=!1,e.on("destroyed",()=>{this.destroyRenderable(e)}),r}destroy(){for(const e in this._gpuSpriteHash)H.return(this._gpuSpriteHash[e]);this._gpuSpriteHash=null,this._renderer=null}}mu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"sprite"};class Wi extends ge{constructor({original:e,view:r}){super(),this.uid=J("renderable"),this.didViewUpdate=!1,this.view=r,e&&this.init(e)}init(e){this._original=e,this.layerTransform=e.layerTransform}get layerColor(){return this._original.layerColor}get layerBlendMode(){return this._original.layerBlendMode}get layerVisibleRenderable(){return this._original.layerVisibleRenderable}get isRenderable(){return this._original.isRenderable}}const Fm=new vt;class on{constructor(e){this.uid=J("meshView"),this.renderPipeId="mesh",this.canBundle=!0,this.owner=Xt,this.state=Me.for2d(),this.roundPixels=0;var r,n,i;this.shader=e.shader,this.texture=(i=(n=e.texture)!=null?n:(r=this.shader)==null?void 0:r.texture)!=null?i:E.WHITE,this._geometry=e.geometry,this._geometry.on("update",this.onUpdate,this)}set shader(e){this._shader!==e&&(this._shader=e,this.onUpdate())}get shader(){return this._shader}set geometry(e){var r;this._geometry!==e&&((r=this._geometry)==null||r.off("update",this.onUpdate,this),e.on("update",this.onUpdate,this),this._geometry=e,this.onUpdate())}get geometry(){return this._geometry}set texture(e){this._texture!==e&&(this.shader&&(this.shader.texture=e),this._texture=e,this.onUpdate())}get texture(){return this._texture}get batched(){return this._shader?!1:this._geometry.batchMode==="auto"?this._geometry.positions.length/2<=100:this._geometry.batchMode==="batch"}addBounds(e){e.addVertexData(this.geometry.positions,0,this.geometry.positions.length)}containsPoint(e){const{x:r,y:n}=e,i=this.geometry.getBuffer("aPosition").data,s=Fm.points,o=this.geometry.getIndex().data,a=o.length,u=this.geometry.topology==="triangle-strip"?3:1;for(let l=0;l+2<a;l+=u){const c=o[l]*2,d=o[l+1]*2,p=o[l+2]*2;if(s[0]=i[c],s[1]=i[c+1],s[2]=i[d],s[3]=i[d+1],s[4]=i[p],s[5]=i[p+1],Fm.contains(r,n))return!0}return!1}onUpdate(){this.owner.onViewUpdate()}destroy(e=!1){if(typeof e=="boolean"?e:e!=null&&e.texture){const r=typeof e=="boolean"?e:e==null?void 0:e.textureSource;this._texture.destroy(r)}this._texture=null,this._geometry=null,this._shader=null}}var GA=Object.defineProperty,Gm=Object.getOwnPropertySymbols,kA=Object.prototype.hasOwnProperty,OA=Object.prototype.propertyIsEnumerable,km=(t,e,r)=>e in t?GA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Om=(t,e)=>{for(var r in e||(e={}))kA.call(e,r)&&km(t,r,e[r]);if(Gm)for(var r of Gm(e))OA.call(e,r)&&km(t,r,e[r]);return t};const Um=class extends _i{constructor(...t){var e;let r=(e=t[0])!=null?e:{};r instanceof Float32Array&&(G($,"use new MeshGeometry({ positions, uvs, indices }) instead"),r={positions:r,uvs:t[1],indices:t[2]}),r=Om(Om({},Um.defaultOptions),r);const n=r.positions||new Float32Array([0,0,1,0,1,1,0,1]),i=r.uvs||new Float32Array([0,0,1,0,1,1,0,1]),s=r.indices||new Uint32Array([0,1,2,0,2,3]),o=new De({data:n,label:"attribute-mesh-positions",usage:W.VERTEX|W.COPY_DST}),a=new De({data:i,label:"attribute-mesh-uvs",usage:W.VERTEX|W.COPY_DST}),u=new De({data:s,label:"index-mesh-buffer",usage:W.INDEX|W.COPY_DST});super({attributes:{aPosition:{buffer:o,shaderLocation:0,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:a,shaderLocation:1,format:"float32x2",stride:2*4,offset:0}},indexBuffer:u,topology:r.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};let hr=Um;hr.defaultOptions={topology:"triangle-list"};class bu extends hr{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}const Lm={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            vUV = (tilingUniforms.uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            } 

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},Nm={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;
        
        `,main:`
            vUV = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);
        
        outColor = texture(uTexture, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0
    
        `}};class $m extends Ue{constructor(e){const r=nr({name:"tiling-sprite-shader",bits:[ar,Lm,sr]}),n=ir({name:"tiling-sprite-shader",bits:[Kr,Nm,or]}),i=new oe({uMapCoord:{value:new R,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new R,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,200,.5,.5]),type:"vec4<f32>"}});super({glProgram:n,gpuProgram:r,resources:{tilingUniforms:i,uTexture:e.texture.source,uSampler:e.texture.source.style}})}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture=e,this.resources.uTexture=e.source,this.resources.uSampler=e.source.style)}}const UA=new bu;class vu{constructor(e){this._renderableHash=Object.create(null),this._gpuBatchedTilingSprite=Object.create(null),this._gpuTilingSprite=Object.create(null),this._renderer=e}validateRenderable(e){const r=e.view.texture.textureMatrix;let n=!1;const i=this._getRenderableData(e);return i.batched!==r.isSimple&&(i.batched=r.isSimple,n=!0),n}addRenderable(e,r){e.view._didUpdate&&(e.view._didUpdate=!1,this._rebuild(e));const{batched:n}=this._getRenderableData(e);if(n){const i=this._getBatchedTilingSprite(e);this._renderer.renderPipes.mesh.addRenderable(i,r)}else{const i=this._getGpuTilingSprite(e);this._renderer.renderPipes.mesh.addRenderable(i.meshRenderable,r)}}updateRenderable(e){e.view._didUpdate&&(e.view._didUpdate=!1,this._rebuild(e));const{batched:r}=this._getRenderableData(e);if(r){const n=this._getBatchedTilingSprite(e);this._renderer.renderPipes.mesh.updateRenderable(n)}else{const n=this._getGpuTilingSprite(e);this._renderer.renderPipes.mesh.updateRenderable(n.meshRenderable)}}destroyRenderable(e){this._renderableHash[e.uid]=null,this._gpuTilingSprite[e.uid]=null,this._gpuBatchedTilingSprite[e.uid]=null}_getRenderableData(e){return this._renderableHash[e.uid]||this._initRenderableData(e)}_initRenderableData(e){const r={batched:!0};return this._renderableHash[e.uid]=r,this.validateRenderable(e),e.on("destroyed",()=>{this.destroyRenderable(e)}),r}_rebuild(e){const r=this._getRenderableData(e),n=e.view,i=n.texture.textureMatrix;if(r.batched){const s=this._getBatchedTilingSprite(e);s.view.texture=n.texture;const o=n.texture.source.style;o.addressMode!=="repeat"&&(o.addressMode="repeat",o.update()),this._updateBatchPositions(e),this._updateBatchUvs(e)}else{const s=this._getGpuTilingSprite(e),{meshRenderable:o}=s,a=o.view;a.shader.texture=n.texture;const u=a.shader.resources.tilingUniforms,l=n.width,c=n.height,d=n.texture.width,p=n.texture.height,f=n._tileTransform.matrix,g=u.uniforms.uTextureTransform;g.set(f.a*d/l,f.b*d/c,f.c*p/l,f.d*p/c,f.tx/l,f.ty/c),g.invert(),u.uniforms.uMapCoord=i.mapCoord,u.uniforms.uClampFrame=i.uClampFrame,u.uniforms.uClampOffset=i.uClampOffset,u.uniforms.uTextureTransform=g,u.uniforms.uSizeAnchor[0]=l,u.uniforms.uSizeAnchor[1]=c,u.uniforms.uSizeAnchor[2]=e.view.anchor.x,u.uniforms.uSizeAnchor[3]=e.view.anchor.y,u.update()}}_getGpuTilingSprite(e){return this._gpuTilingSprite[e.uid]||this._initGpuTilingSprite(e)}_initGpuTilingSprite(e){const r=e.view,n=r.texture.source.style;n.addressMode="repeat",n.update();const i=new on({geometry:UA,shader:new $m({texture:r.texture})}),s=new Wi({original:e,view:i}),o=new R,a={meshRenderable:s,textureMatrix:o};return this._gpuTilingSprite[e.uid]=a,a}_getBatchedTilingSprite(e){return this._gpuBatchedTilingSprite[e.uid]||this._initBatchedTilingSprite(e)}_initBatchedTilingSprite(e){const r=new on({geometry:new bu,texture:e.view.texture});r.roundPixels=this._renderer._roundPixels|e.view.roundPixels;const n=new Wi({original:e,view:r});return this._gpuBatchedTilingSprite[e.uid]=n,n}_updateBatchPositions(e){const r=this._getBatchedTilingSprite(e),n=e.view,i=r.view.geometry.getBuffer("aPosition").data,s=n.anchor.x,o=n.anchor.y;i[0]=-s*n.width,i[1]=-o*n.height,i[2]=(1-s)*n.width,i[3]=-o*n.height,i[4]=(1-s)*n.width,i[5]=(1-o)*n.height,i[6]=-s*n.width,i[7]=(1-o)*n.height}_updateBatchUvs(e){const r=e.view,n=r.texture.frameWidth,i=r.texture.frameHeight,s=this._getBatchedTilingSprite(e).view.geometry.getBuffer("aUV").data;let o=0,a=0;r._applyAnchorToTexture&&(o=r.anchor.x,a=r.anchor.y),s[0]=s[6]=-o,s[2]=s[4]=1-o,s[1]=s[3]=-a,s[5]=s[7]=1-a;const u=R.shared;u.copyFrom(r._tileTransform.matrix),u.tx/=r.width,u.ty/=r.height,u.invert(),u.scale(r.width/n,r.height/i),LA(s,2,0,u)}destroy(){this._renderableHash=null,this._gpuTilingSprite=null,this._gpuBatchedTilingSprite=null,this._renderer=null}}vu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"tilingSprite"};function LA(t,e,r,n){let i=0;const s=t.length/(e||2),o=n.a,a=n.b,u=n.c,l=n.d,c=n.tx,d=n.ty;for(r*=e;i<s;){const p=t[r],f=t[r+1];t[r]=o*p+u*f+c,t[r+1]=a*p+l*f+d,r+=e,i++}}class yu{constructor(e){this.uid=J("graphicsView"),this.canBundle=!0,this.owner=Xt,this.renderPipeId="graphics",this.roundPixels=0,this._context=e||new it,this._context.on("update",this.onGraphicsContextUpdate,this)}set context(e){e!==this._context&&(this._context.off("update",this.onGraphicsContextUpdate,this),this._context=e,this._context.on("update",this.onGraphicsContextUpdate,this),this.onGraphicsContextUpdate())}get context(){return this._context}addBounds(e){e.addBounds(this._context.bounds)}containsPoint(e){return this._context.containsPoint(e)}onGraphicsContextUpdate(){this._didUpdate=!0,this.owner.onViewUpdate()}destroy(e=!1){this.owner=null,(typeof e=="boolean"?e:e!=null&&e.context)&&this._context.destroy(e),this._context=null}}const Vm={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:` 
            outColor = vColor * calculateMSDFAlpha(outColor, localUniforms.uDistance);
        `}},zm={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, distance:f32) -> f32 {
                
                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));
            
                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                return alpha;
            }
        `}},Hm={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, float distance) {
                
                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));
               
                // SDF
                median = min(median, msdfColor.a);
            
                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
           
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                return alpha;
            }

            uniform float uDistance;
        `,main:`

            outColor = vColor * calculateMSDFAlpha(outColor, uDistance);
        `}};class Wm extends Ue{constructor(){const e=new oe({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new R,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}}),r=nr({name:"sdf-shader",bits:[xi,Ci(Re),Vm,zm,sr]}),n=ir({name:"sdf-shader",bits:[Ai,wi(Re),Kr,Hm,or]});super({glProgram:n,gpuProgram:r,resources:{localUniforms:e,batchSamplers:Ti}})}}const Xm=["_fontFamily","_fontStyle","_fontVariant","_fontWeight","_breakWords","_align","_leading","_letterSpacing","_lineHeight","_textBaseline","_whiteSpace","_wordWrap","_wordWrapWidth","_padding","_cssOverrides"];function _u(t){const e=[];let r=0;for(let n=0;n<Xm.length;n++){const i=Xm[n];e[r++]=t[i]}return r=jm(t._fill,e,r),r=NA(t._stroke,e,r),e.join("-")}function jm(t,e,r){var n;return t&&(e[r++]=t.color,e[r++]=t.alpha,e[r++]=(n=t.fill)==null?void 0:n.uid),r}function NA(t,e,r){return t&&(r=jm(t,e,r),e[r++]=t.width,e[r++]=t.alignment,e[r++]=t.cap,e[r++]=t.join,e[r++]=t.miterLimit),r}var $A=Object.defineProperty,Ym=Object.getOwnPropertySymbols,VA=Object.prototype.hasOwnProperty,zA=Object.prototype.propertyIsEnumerable,Zm=(t,e,r)=>e in t?$A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,an=(t,e)=>{for(var r in e||(e={}))VA.call(e,r)&&Zm(t,r,e[r]);if(Ym)for(var r of Ym(e))zA.call(e,r)&&Zm(t,r,e[r]);return t};const dr=class extends ge{constructor(t={}){super(),HA(t);const e=an(an({},dr.defaultTextStyle),t);for(const r in dr.defaultTextStyle){const n=r;this[n]=e[r]}this.dropShadow=null,typeof e.fill=="string"?this.fontSize=parseInt(e.fontSize,10):this.fontSize=e.fontSize,t.dropShadow&&(t.dropShadow instanceof Boolean?t.dropShadow===!0&&(this.dropShadow=an({},dr.defaultTextStyle.dropShadow)):this.dropShadow=an(an({},dr.defaultTextStyle.dropShadow),t.dropShadow)),this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow=t,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t,this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._fill=wt(t,it.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalFill&&(this._originalFill=t,this._stroke=wt(t,it.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=_u(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new dr({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth})}destroy(t=!1){var e,r,n,i;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(e=this._fill)!=null&&e.texture&&this._fill.texture.destroy(s),(r=this._originalFill)!=null&&r.texture&&this._originalFill.texture.destroy(s),(n=this._stroke)!=null&&n.texture&&this._stroke.texture.destroy(s),(i=this._originalStroke)!=null&&i.texture&&this._originalStroke.texture.destroy(s)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}};let Rt=dr;Rt.defaultTextStyle={align:"left",breakWords:!1,dropShadow:{alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5},fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};function HA(t){var e,r;const n=t;if(typeof n.dropShadow=="boolean"&&(G($,"dropShadow is now an object, not a boolean"),t.dropShadow={alpha:(e=n.dropShadowAlpha)!=null?e:1,angle:n.dropShadowAngle,blur:(r=n.dropShadowBlur)!=null?r:0,color:n.dropShadowColor,distance:n.dropShadowDistance}),n.strokeThickness){G($,"strokeThickness is now a part of stroke");const i=n.stroke;t.stroke={color:i,width:n.strokeThickness}}if(Array.isArray(n.fill)){G($,"gradient fill is now a fill pattern: `new FillGradient(...)`");const i=new Er(0,0,0,t.fontSize*1.7),s=n.fill.map(o=>X.shared.setValue(o).toNumber());s.forEach((o,a)=>{var u;const l=(u=n.fillGradientStops[a])!=null?u:a/s.length;i.addColorStop(l,o)}),t.fill={fill:i}}}class qm{constructor(e){this._canvasPool=Object.create(null),this.canvasOptions=e||{},this.enableFullScreen=!1}_createCanvasAndContext(e,r){const n=Z.get().createCanvas();n.width=e,n.height=r;const i=n.getContext("2d");return{canvas:n,context:i}}getOptimalCanvasAndContext(e,r,n=1){e=Math.ceil(e*n-1e-6),r=Math.ceil(r*n-1e-6),e=It(e),r=It(r);const i=(e<<17)+(r<<1);this._canvasPool[i]||(this._canvasPool[i]=[]);let s=this._canvasPool[i].pop();return s||(s=this._createCanvasAndContext(e,r)),s}returnCanvasAndContext(e){const{width:r,height:n}=e.canvas,i=(r<<17)+(n<<1);this._canvasPool[i].push(e)}clear(){this._canvasPool={}}}const rt=new qm,WA=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function un(t){const e=typeof t.fontSize=="number"?`${t.fontSize}px`:t.fontSize;let r=t.fontFamily;Array.isArray(t.fontFamily)||(r=t.fontFamily.split(","));for(let n=r.length-1;n>=0;n--){let i=r[n].trim();!/([\"\'])[^\'\"]+\1/.test(i)&&!WA.includes(i)&&(i=`"${i}"`),r[n]=i}return`${t.fontStyle} ${t.fontVariant} ${t.fontWeight} ${e} ${r.join(",")}`}const xu={willReadFrequently:!0},B=class{static get experimentalLetterSpacingSupported(){let t=B._experimentalLetterSpacingSupported;if(t!==void 0){const e=Z.get().getCanvasRenderingContext2D().prototype;t=B._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,i,s,o,a,u){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=u}static measureText(t=" ",e,r=B._canvas,n=e.wordWrap){var i;const s=`${t}:${e.styleKey}`;if(B._measurementCache[s])return B._measurementCache[s];const o=un(e),a=B.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const u=B.__context;u.font=o;const l=(n?B._wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),c=new Array(l.length);let d=0;for(let m=0;m<l.length;m++){const x=B._measureText(l[m],e.letterSpacing,u);c[m]=x,d=Math.max(d,x)}const p=((i=e._stroke)==null?void 0:i.width)||0;let f=d+p;e.dropShadow&&(f+=e.dropShadow.distance);const g=e.lineHeight||a.fontSize+p;let b=Math.max(g,a.fontSize+p*2)+(l.length-1)*(g+e.leading);return e.dropShadow&&(b+=e.dropShadow.distance),new B(t,e,f,b,l,c,g+e.leading,d,a)}static _measureText(t,e,r){let n=!1;B.experimentalLetterSpacingSupported&&(B.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let i=r.measureText(t).width;return i>0&&(n?i-=e:i+=(B.graphemeSegmenter(t).length-1)*e),i}static _wordWrap(t,e,r=B._canvas){const n=r.getContext("2d",xu);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:u,whiteSpace:l}=e,c=B._collapseSpaces(l),d=B._collapseNewlines(l);let p=!c;const f=e.wordWrapWidth+u,g=B._tokenize(t);for(let b=0;b<g.length;b++){let m=g[b];if(B._isNewline(m)){if(!d){o+=B._addLine(s),p=!c,s="",i=0;continue}m=" "}if(c){const y=B.isBreakingSpace(m),_=B.isBreakingSpace(s[s.length-1]);if(y&&_)continue}const x=B._getFromCache(m,u,a,n);if(x>f)if(s!==""&&(o+=B._addLine(s),s="",i=0),B.canBreakWords(m,e.breakWords)){const y=B.wordWrapSplit(m);for(let _=0;_<y.length;_++){let A=y[_],T=A,P=1;for(;y[_+P];){const S=y[_+P];if(!B.canBreakChars(T,S,m,_,e.breakWords))A+=S;else break;T=S,P++}_+=P-1;const M=B._getFromCache(A,u,a,n);M+i>f&&(o+=B._addLine(s),p=!1,s="",i=0),s+=A,i+=M}}else{s.length>0&&(o+=B._addLine(s),s="",i=0);const y=b===g.length-1;o+=B._addLine(m,!y),p=!1,s="",i=0}else x+i>f&&(p=!1,o+=B._addLine(s),s="",i=0),(s.length>0||!B.isBreakingSpace(m)||p)&&(s+=m,i+=x)}return o+=B._addLine(s,!1),o}static _addLine(t,e=!0){return t=B._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,r,n){let i=r[t];return typeof i!="number"&&(i=B._measureText(t,e,n)+e,r[t]=i),i}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!B.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:B._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:B._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const i=t[n],s=t[n+1];if(B.isBreakingSpace(i,s)||B._isNewline(i)){r!==""&&(e.push(r),r=""),e.push(i);continue}r+=i}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,i){return!0}static wordWrapSplit(t){return B.graphemeSegmenter(t)}static measureFont(t){if(B._fonts[t])return B._fonts[t];const e=B._context;e.font=t;const r=e.measureText(B.METRICS_STRING+B.BASELINE_SYMBOL),n={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return B._fonts[t]=n,n}static clearMetrics(t=""){t?delete B._fonts[t]:B._fonts={}}static get _canvas(){if(!B.__canvas){let t;try{const e=new OffscreenCanvas(0,0),r=e.getContext("2d",xu);if(r!=null&&r.measureText)return B.__canvas=e,e;t=Z.get().createCanvas()}catch(e){t=Z.get().createCanvas()}t.width=t.height=10,B.__canvas=t}return B.__canvas}static get _context(){return B.__context||(B.__context=B._canvas.getContext("2d",xu)),B.__context}};let ae=B;ae.METRICS_STRING="|\xC9q\xC5",ae.BASELINE_SYMBOL="M",ae.BASELINE_MULTIPLIER=1.4,ae.HEIGHT_MULTIPLIER=2,ae.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map(r=>r.segment)}return t=>[...t]})(),ae.experimentalLetterSpacing=!1,ae._fonts={},ae._newlines=[10,13],ae._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],ae._measurementCache={};function ln(t,e){if(t.texture===E.WHITE&&!t.fill)return X.shared.setValue(t.color).toHex();if(t.fill){if(t.fill instanceof qs){const r=t.fill,n=e.createPattern(r.texture.source.resource,"repeat"),i=r.transform.copyTo(R.shared);return i.scale(r.texture.frameWidth,r.texture.frameHeight),n.setTransform(i),n}else if(t.fill instanceof Er){const r=t.fill;if(r.type==="linear"){const n=e.createLinearGradient(r.x0,r.y0,r.x1,r.y1);return r.gradientStops.forEach(i=>{n.addColorStop(i.offset,X.shared.setValue(i.color).toHex())}),n}}}else{const r=e.createPattern(t.texture.source.resource,"repeat"),n=t.matrix.copyTo(R.shared);return n.scale(t.texture.frameWidth,t.texture.frameHeight),r.setTransform(n),r}return"red"}function Au(t){if(t==="")return[];typeof t=="string"&&(t=[t]);const e=[];for(let r=0,n=t.length;r<n;r++){const i=t[r];if(Array.isArray(i)){if(i.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${i.length}.`);if(i[0].length===0||i[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const s=i[0].charCodeAt(0),o=i[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(let a=s,u=o;a<=u;a++)e.push(String.fromCharCode(a))}else e.push(...Array.from(i))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}class Xi extends Os{constructor(e){var r,n,i;super(),this.resolution=1,this.pages=[],this._padding=4,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentPageIndex=-1,this._skipKerning=!1;const s=e,o=s.style.clone();o.fontSize=this.baseMeasurementFontSize,s.overrideFill&&(o._fill.color=16777215,o._fill.alpha=1,o._fill.texture=E.WHITE,o._fill.fill=null),this._style=o,this._skipKerning=(r=s.skipKerning)!=null?r:!1,this.resolution=(n=s.resolution)!=null?n:1,this._padding=(i=s.padding)!=null?i:4;const a=un(o),u=this;u.fontMetrics=ae.measureFont(a),u.lineHeight=o.lineHeight||this.fontMetrics.fontSize||o.fontSize}ensureCharacters(e){var r,n,i,s;const o=Au(e).filter(_=>!this._currentChars.includes(_)).filter((_,A,T)=>T.indexOf(_)===A);if(!o.length)return;this._currentChars=[...this._currentChars,...o];let a;this._currentPageIndex===-1?a=this._nextPage():a=this.pages[this._currentPageIndex];let{canvas:u,context:l}=a.canvasAndContext,c=a.texture.source;const d=this._style;let p=this._currentX,f=this._currentY;const g=this.baseRenderedFontSize/this.baseMeasurementFontSize,b=this._padding*g,m=d.fontStyle==="italic"?2:1;let x=0,y=!1;for(let _=0;_<o.length;_++){const A=o[_],T=ae.measureText(A,d,u,!1),P=m*T.width*g,M=T.height*g,S=P+b*2,C=M+b*2;if(y=!1,A!==`
`&&A!=="\r"&&A!=="	"&&A!==" "&&(y=!0,x=Math.ceil(Math.max(C,x))),p+S>512&&(f+=x,x=C,p=0,f+x>512)){c.update();const F=this._nextPage();u=F.canvasAndContext.canvas,l=F.canvasAndContext.context,c=F.texture.source,f=0}const w=P/g-((n=(r=d.dropShadow)==null?void 0:r.distance)!=null?n:0)-((s=(i=d._stroke)==null?void 0:i.width)!=null?s:0);if(this.chars[A]={id:A.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:w,kerning:{}},y){this._drawGlyph(l,T,p+b,f+b,g,d);const F=c.width*g,N=c.height*g,D=new te(p/F,f/N,S/F,C/N);this.chars[A].texture=new E({source:c,layout:{frame:D}}),p+=Math.ceil(S)}}c.update(),this._currentX=p,this._currentY=f,this._skipKerning&&this._applyKerning(o,l)}get pageTextures(){return G($,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(e,r){const n=this._measureCache;for(let i=0;i<e.length;i++){const s=e[i];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let u=n[s];u||(u=n[s]=r.measureText(s).width);let l=n[a];l||(l=n[a]=r.measureText(a).width);let c=r.measureText(s+a).width,d=c-(u+l);d&&(this.chars[s].kerning[a]=d),c=r.measureText(s+a).width,d=c-(u+l),d&&(this.chars[a].kerning[s]=d)}}}_nextPage(){this._currentPageIndex++;const e=this.resolution,r=rt.getOptimalCanvasAndContext(512,512,e);this._setupContext(r.context,this._style,e);const n=e*(this.baseRenderedFontSize/this.baseMeasurementFontSize),i=new E({source:new xt({resource:r.canvas,resolution:n,alphaMode:"premultiply-alpha-on-upload"})}),s={canvasAndContext:r,texture:i};return this.pages[this._currentPageIndex]=s,s}_setupContext(e,r,n){var i;r.fontSize=this.baseRenderedFontSize,e.scale(n,n),e.font=un(r),r.fontSize=this.baseMeasurementFontSize,e.textBaseline=r.textBaseline;const s=r._stroke,o=(i=s==null?void 0:s.width)!=null?i:0;if(s&&(e.lineWidth=o,e.lineJoin=s.join,e.miterLimit=s.miterLimit,e.strokeStyle=ln(s,e)),r._fill&&(e.fillStyle=ln(r._fill,e)),r.dropShadow){const a=r.dropShadow,u=X.shared.setValue(a.color).toArray(),l=a.blur*n,c=a.distance*n;e.shadowColor=`rgba(${u[0]*255},${u[1]*255},${u[2]*255},${a.alpha})`,e.shadowBlur=l,e.shadowOffsetX=Math.cos(a.angle)*c,e.shadowOffsetY=Math.sin(a.angle)*c}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}_drawGlyph(e,r,n,i,s,o){var a;const u=r.text,l=r.fontProperties,c=o._stroke,d=((a=c==null?void 0:c.width)!=null?a:0)*s,p=n+d/2,f=i-d/2,g=l.descent*s,b=r.lineHeight*s;o.stroke&&d&&e.strokeText(u,p,f+b-g),o._fill&&e.fillText(u,p,f+b-g)}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{canvasAndContext:r,texture:n}=this.pages[e];rt.returnCanvasAndContext(r),n.destroy(!0)}this.pages=null}}function Cu(t,e,r){const n={width:0,height:0,offsetY:0,scale:e.fontSize/r.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=r.baseLineOffset;let i=n.lines[0],s=null,o=!0;const a={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},u=f=>{const g=i.width;for(let b=0;b<a.index;b++){const m=f.positions[b];i.chars.push(f.chars[b]),i.charPositions.push(m+g)}i.width+=f.width,o=!1,a.width=0,a.index=0,a.chars.length=0},l=()=>{let f=i.chars.length-1,g=i.chars[f];for(;g===" ";)i.width-=r.chars[g].xAdvance,g=i.chars[--f];n.width=Math.max(n.width,i.width),i={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},o=!0,n.lines.push(i),n.height+=r.lineHeight},c=r.baseMeasurementFontSize/e.fontSize,d=e.letterSpacing*c,p=e.wordWrapWidth*c;for(let f=0;f<t.length+1;f++){let g;const b=f===t.length;b||(g=t[f]);const m=r.chars[g];if(/(?:\s)/.test(g)||g==="\r"||g===`
`||b){if(!o&&e.wordWrap&&i.width+a.width-d>p?(l(),u(a),b||i.charPositions.push(0)):(a.start=i.width,u(a),b||i.charPositions.push(0)),g==="\r"||g===`
`)i.width!==0&&l();else if(!b){const x=m.xAdvance+(m.kerning[s]||0)+d;i.width+=x,i.spaceWidth=x,i.spacesIndex.push(i.charPositions.length),i.chars.push(g)}}else{const x=m.kerning[s]||0,y=m.xAdvance+x+d;a.positions[a.index++]=a.width+x,a.chars.push(g),a.width+=y}s=g}return l(),e.align==="center"?XA(n):e.align==="right"?jA(n):e.align==="justify"&&YA(n),n}function XA(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],n=t.width/2-r.width/2;for(let i=0;i<r.charPositions.length;i++)r.charPositions[i]+=n}}function jA(t){for(let e=0;e<t.lines.length;e++){const r=t.lines[e],n=t.width-r.width;for(let i=0;i<r.charPositions.length;i++)r.charPositions[i]+=n}}function YA(t){const e=t.width;for(let r=0;r<t.lines.length;r++){const n=t.lines[r];let i=0,s=n.spacesIndex[i++],o=0;const a=n.spacesIndex.length,u=(e-n.width)/a;for(let l=0;l<n.charPositions.length;l++)l===s&&(s=n.spacesIndex[i++],o+=u),n.charPositions[l]+=o}}var ZA=Object.defineProperty,Km=Object.getOwnPropertySymbols,qA=Object.prototype.hasOwnProperty,KA=Object.prototype.propertyIsEnumerable,Jm=(t,e,r)=>e in t?ZA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wu=(t,e)=>{for(var r in e||(e={}))qA.call(e,r)&&Jm(t,r,e[r]);if(Km)for(var r of Km(e))KA.call(e,r)&&Jm(t,r,e[r]);return t};class JA{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1}}getFont(e,r){var n;let i=r.fontFamily,s=!0;r._fill.fill&&(i+=r._fill.fill.uid,s=!1),re.has(i)||re.set(i,new Xi(wu({style:r,overrideFill:s},this.defaultOptions)));const o=re.get(i);return(n=o.ensureCharacters)==null||n.call(o,e),o}getLayout(e,r){const n=this.getFont(e,r);return Cu(e.split(""),r,n)}measureText(e,r){return this.getLayout(e,r)}install(e,r,n){if(!e)throw new Error("[BitmapFontManager] Property `name` is required.");n=wu(wu({},this.defaultOptions),n);const i=r instanceof Rt?r:new Rt(r),s=i._fill.fill!==null&&i._fill.fill!==void 0,o=new Xi({style:i,overrideFill:s,skipKerning:n.skipKerning,padding:n.padding,resolution:n.resolution}),a=Au(n.chars);return o.ensureCharacters(a.join("")),re.set(e,o),o}}const Tu=new JA;class QA extends Wi{constructor(){super({view:new yu})}}class Su{constructor(e){this._gpuBitmapText={},this._renderer=e}validateRenderable(e){const r=this._getGpuBitmapText(e);return e.view._didUpdate&&(e.view._didUpdate=!1,this._updateContext(e,r.view.context)),this._renderer.renderPipes.graphics.validateRenderable(r)}addRenderable(e,r){const n=this._getGpuBitmapText(e);e.view._didUpdate&&(e.view._didUpdate=!1,this._updateContext(e,n.view.context)),this._renderer.renderPipes.graphics.addRenderable(n,r),n.view.context.customShader&&this._updateDistanceField(e)}destroyRenderable(e){this._destroyRenderableByUid(e.uid)}_destroyRenderableByUid(e){H.return(this._gpuBitmapText[e]),this._gpuBitmapText[e]=null}updateRenderable(e){const r=this._getGpuBitmapText(e);this._renderer.renderPipes.graphics.updateRenderable(r),r.view.context.customShader&&this._updateDistanceField(e)}_updateContext(e,r){var n;const i=e.view,s=Tu.getFont(i.text,i._style);r.clear(),s.distanceField.type!=="none"&&(r.customShader||(this._sdfShader||(this._sdfShader=new Wm),r.customShader=this._sdfShader));const o=Array.from(i.text),a=i._style;let u=(((n=a._stroke)==null?void 0:n.width)||0)/2;u+=s.baseLineOffset;const l=Cu(o,a,s);let c=0;const d=a.padding,p=l.scale;r.translate(-i.anchor._x*l.width-d,-i.anchor._y*(l.height+l.offsetY)-d).scale(p,p);const f=a._fill.color;for(let g=0;g<l.lines.length;g++){const b=l.lines[g];for(let m=0;m<b.charPositions.length;m++){const x=o[c++],y=s.chars[x];y!=null&&y.texture&&r.texture(y.texture,f,Math.round(b.charPositions[m]+y.xOffset),Math.round(u+y.yOffset))}u+=s.lineHeight}}_getGpuBitmapText(e){return this._gpuBitmapText[e.uid]||this._initGpuText(e)}_initGpuText(e){e.view._style.update();const r=H.get(QA,e);return this._gpuBitmapText[e.uid]=r,r.view.roundPixels=this._renderer._roundPixels|e.view.roundPixels,this._updateContext(e,r.view.context),e.on("destroyed",()=>{this.destroyRenderable(e)}),this._gpuBitmapText[e.uid]}_updateDistanceField(e){var r;const n=this._getGpuBitmapText(e).view.context,i=e.view,s=i._style.fontFamily,o=re.get(s),{a,b:u,c:l,d:c}=e.layerTransform,d=Math.sqrt(a*a+u*u),p=Math.sqrt(l*l+c*c),f=(Math.abs(d)+Math.abs(p))/2,g=o.baseRenderedFontSize/i._style.fontSize,b=(r=i.resolution)!=null?r:this._renderer.resolution,m=f*o.distanceField.range*(1/g)*b;n.customShader.resources.localUniforms.uniforms.uDistance=m}destroy(){var e;for(const r in this._gpuBitmapText)this._destroyRenderableByUid(r);this._gpuBitmapText=null,(e=this._sdfShader)==null||e.destroy(!0),this._sdfShader=null,this._renderer=null}}Su.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"bitmapText"};class Eu{constructor(e){this._gpuText=Object.create(null),this._renderer=e}validateRenderable(e){var r;const n=this._getGpuText(e),i=e.view._getKey();if(n.currentKey!==i){const s=e.view,o=(r=s.resolution)!=null?r:this._renderer.resolution,{width:a,height:u}=this._renderer.canvasText.getTextureSize(s.text,o,s._style);return!(this._renderer.canvasText.getReferenceCount(n.currentKey)===1&&a===n.texture._source.width&&u===n.texture._source.height)}return!1}addRenderable(e,r){const n=this._getGpuText(e).batchableSprite;e.view._didUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(n)}updateRenderable(e){const r=this._getGpuText(e).batchableSprite;e.view._didUpdate&&this._updateText(e),r.batcher.updateElement(r)}destroyRenderable(e){this._destroyRenderableById(e.uid)}_destroyRenderableById(e){const r=this._gpuText[e];this._renderer.canvasText.decreaseReferenceCount(r.currentKey),H.return(r.batchableSprite),this._gpuText[e]=null}_updateText(e){const r=e.view._getKey(),n=this._getGpuText(e),i=n.batchableSprite;n.currentKey!==r&&this._updateGpuText(e),e.view._didUpdate=!1;const s=e.view._style.padding;Fr(i.bounds,e.view.anchor,i.texture,s)}_updateGpuText(e){var r;const n=this._getGpuText(e),i=n.batchableSprite,s=e.view;n.texture&&this._renderer.canvasText.decreaseReferenceCount(n.currentKey);const o=(r=s.resolution)!=null?r:this._renderer.resolution;n.texture=i.texture=this._renderer.canvasText.getTexture(s.text,o,s._style,s._getKey()),n.currentKey=s._getKey(),i.texture=n.texture}_getGpuText(e){return this._gpuText[e.uid]||this._initGpuText(e)}_initGpuText(e){e.view._style.update();const r={texture:null,currentKey:"--",batchableSprite:H.get(Hi)};return r.batchableSprite.renderable=e,r.batchableSprite.bounds=[0,1,0,0],r.batchableSprite.roundPixels=this._renderer._roundPixels|e.view.roundPixels,this._gpuText[e.uid]=r,this._updateText(e),e.on("destroyed",()=>{this.destroyRenderable(e)}),r}destroy(){for(const e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}}Eu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"text"};const eC=new be;function Iu(t,e,r,n){const i=eC;i.minX=0,i.minY=0,i.maxX=t.width/n|0,i.maxY=t.height/n|0;const s=pe.getOptimalTexture(i.width,i.height,n,!1);return s.source.uploadMethodId="image",s.source.resource=t,s.source.alphaMode="premultiply-alpha-on-upload",s.frameWidth=e/n,s.frameHeight=r/n,s.source.update(),s.layout.updateUvs(),s}class Pu{constructor(){this._activeTextures={}}getTextureSize(e,r,n){const i=ae.measureText(e||" ",n);let s=Math.ceil(Math.ceil(Math.max(1,i.width)+n.padding*2)*r),o=Math.ceil(Math.ceil(Math.max(1,i.height)+n.padding*2)*r);return s=Math.ceil(s-1e-6),o=Math.ceil(o-1e-6),s=It(s),o=It(o),{width:s,height:o}}getTexture(e,r,n,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].texture;const s=ae.measureText(e||" ",n),o=Math.ceil(Math.ceil(Math.max(1,s.width)+n.padding*2)*r),a=Math.ceil(Math.ceil(Math.max(1,s.height)+n.padding*2)*r),u=rt.getOptimalCanvasAndContext(o,a),{canvas:l}=u;this.renderTextToCanvas(e,n,r,u);const c=Iu(l,o,a,r);return this._activeTextures[i]={canvasAndContext:u,texture:c,usageCount:1},c}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}decreaseReferenceCount(e){const r=this._activeTextures[e];if(r.usageCount--,r.usageCount===0){rt.returnCanvasAndContext(r.canvasAndContext),pe.returnTexture(r.texture);const n=r.texture.source;n.resource=null,n.uploadMethodId="unknown",n.alphaMode="no-premultiply-alpha",this._activeTextures[e]=null}}getReferenceCount(e){return this._activeTextures[e].usageCount}renderTextToCanvas(e,r,n,i){var s,o,a,u,l,c;const{canvas:d,context:p}=i,f=un(r),g=ae.measureText(e||" ",r),b=g.lines,m=g.lineHeight,x=g.lineWidths,y=g.maxLineWidth,_=g.fontProperties,A=d.height;if(p.resetTransform(),p.scale(n,n),p.clearRect(0,0,g.width+4,g.height+4),(s=r._stroke)!=null&&s.width){const S=r._stroke;p.lineWidth=S.width,p.miterLimit=S.miterLimit,p.lineJoin=S.join,p.lineCap=S.cap}p.font=f;let T,P;const M=r.dropShadow?2:1;for(let S=0;S<M;++S){const C=r.dropShadow&&S===0,w=C?Math.ceil(Math.max(1,A)+r.padding*2):0,F=w*n;if(C){p.fillStyle="black",p.strokeStyle="black";const I=r.dropShadow,q=I.color,O=I.alpha;p.shadowColor=X.shared.setValue(q).setAlpha(O).toRgbaString();const Q=I.blur*n,Ft=I.distance*n;p.shadowBlur=Q,p.shadowOffsetX=Math.cos(I.angle)*Ft,p.shadowOffsetY=Math.sin(I.angle)*Ft+F}else p.globalAlpha=(a=(o=r._fill)==null?void 0:o.alpha)!=null?a:1,p.fillStyle=r._fill?ln(r._fill,p):null,(u=r._stroke)!=null&&u.width&&(p.strokeStyle=ln(r._stroke,p)),p.shadowColor="black";let N=(m-_.fontSize)/2;m-_.fontSize<0&&(N=0);const D=(c=(l=r._stroke)==null?void 0:l.width)!=null?c:0;for(let I=0;I<b.length;I++)T=D/2,P=D/2+I*m+_.ascent+N,r.align==="right"?T+=y-x[I]:r.align==="center"&&(T+=(y-x[I])/2),r._stroke&&this._drawLetterSpacing(b[I],r,i,T+r.padding,P+r.padding-w,!0),r._fill!==void 0&&this._drawLetterSpacing(b[I],r,i,T+r.padding,P+r.padding-w)}}_drawLetterSpacing(e,r,n,i,s,o=!1){const{context:a}=n,u=r.letterSpacing;let l=!1;if(ae.experimentalLetterSpacingSupported&&(ae.experimentalLetterSpacing?(a.letterSpacing=`${u}px`,a.textLetterSpacing=`${u}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),u===0||l){o?a.strokeText(e,i,s):a.fillText(e,i,s);return}let c=i;const d=ae.graphemeSegmenter(e);let p=a.measureText(e).width,f=0;for(let g=0;g<d.length;++g){const b=d[g];o?a.strokeText(b,c,s):a.fillText(b,c,s);let m="";for(let x=g+1;x<d.length;++x)m+=d[x];f=a.measureText(m).width,c+=p-f+u,p=f}}destroy(){this._activeTextures=null}}Pu.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"canvasText"};class Bu{constructor(e){this._gpuText=Object.create(null),this._renderer=e}validateRenderable(e){const r=this._getGpuText(e),n=e.view._getKey();return r.textureNeedsUploading?(r.textureNeedsUploading=!1,!0):r.currentKey!==n}addRenderable(e){const r=this._getGpuText(e).batchableSprite;e.view._didUpdate&&this._updateText(e),this._renderer.renderPipes.batch.addToBatch(r)}updateRenderable(e){const r=this._getGpuText(e).batchableSprite;e.view._didUpdate&&this._updateText(e),r.batcher.updateElement(r)}destroyRenderable(e){this._destroyRenderableById(e.uid)}_destroyRenderableById(e){const r=this._gpuText[e];this._renderer.htmlText.decreaseReferenceCount(r.currentKey),H.return(r.batchableSprite),this._gpuText[e]=null}_updateText(e){const r=e.view._getKey(),n=this._getGpuText(e),i=n.batchableSprite;n.currentKey!==r&&this._updateGpuText(e).catch(o=>{console.error(o)}),e.view._didUpdate=!1;const s=e.view._style.padding;Fr(i.bounds,e.view.anchor,i.texture,s)}async _updateGpuText(e){var r;e.view._didUpdate=!1;const n=this._getGpuText(e);if(n.generatingTexture)return;const i=e.view._getKey();this._renderer.htmlText.decreaseReferenceCount(n.currentKey),n.generatingTexture=!0,n.currentKey=i;const s=e.view,o=(r=s.resolution)!=null?r:this._renderer.resolution,a=await this._renderer.htmlText.getManagedTexture(s.text,o,s._style,s._getKey()),u=n.batchableSprite;u.texture=n.texture=a,n.generatingTexture=!1,n.textureNeedsUploading=!0,e.view.onUpdate();const l=e.view._style.padding;Fr(u.bounds,e.view.anchor,u.texture,l)}_getGpuText(e){return this._gpuText[e.uid]||this._initGpuText(e)}_initGpuText(e){e.view._style.update();const r={texture:E.EMPTY,currentKey:"--",batchableSprite:H.get(Hi),textureNeedsUploading:!1,generatingTexture:!1},n=r.batchableSprite;return n.renderable=e,n.texture=E.EMPTY,n.bounds=[0,1,0,0],n.roundPixels=this._renderer._roundPixels|e.view.roundPixels,this._gpuText[e.uid]=r,e.on("destroyed",()=>{this.destroyRenderable(e)}),r}destroy(){for(const e in this._gpuText)this._destroyRenderableById(e);this._gpuText=null,this._renderer=null}}Bu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"htmlText"};function Qm(){const{userAgent:t}=Z.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}function eb(t,e){const r=e.fontFamily,n=[],i={},s=/font-family:([^;"\s]+)/g,o=t.match(s);function a(u){i[u]||(n.push(u),i[u]=!0)}if(Array.isArray(r))for(let u=0;u<r.length;u++)a(r[u]);else a(r);o&&o.forEach(u=>{const l=u.split(":")[1].trim();a(l)});for(const u in e.tagStyles){const l=e.tagStyles[u].fontFamily;a(l)}return n}async function tb(t){const e=await(await Z.get().fetch(t)).blob(),r=new FileReader;return await new Promise((n,i)=>{r.onloadend=()=>n(r.result),r.onerror=i,r.readAsDataURL(e)})}async function Mu(t,e){const r=await tb(e);return`@font-face {
        font-family: "${t.fontFamily}";
        src: url('${r}');
        font-weight: ${t.fontWeight};
        font-style: ${t.fontStyle};
    }`}var tC=Object.defineProperty,rC=Object.defineProperties,nC=Object.getOwnPropertyDescriptors,rb=Object.getOwnPropertySymbols,iC=Object.prototype.hasOwnProperty,sC=Object.prototype.propertyIsEnumerable,nb=(t,e,r)=>e in t?tC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,oC=(t,e)=>{for(var r in e||(e={}))iC.call(e,r)&&nb(t,r,e[r]);if(rb)for(var r of rb(e))sC.call(e,r)&&nb(t,r,e[r]);return t},aC=(t,e)=>rC(t,nC(e));async function ib(t,e){const r=t.filter(n=>re.has(n)).map((n,i)=>{if(!cn.has(n)){const{url:s}=re.get(n);i===0?cn.set(n,Mu(e,s)):cn.set(n,Mu(aC(oC({},hn.defaultFontOptions),{fontFamily:n}),s))}return cn.get(n)});return(await Promise.all(r)).join(`
`)}function sb(t,e,r,n,i){const{domElement:s,styleElement:o,svgRoot:a}=i;s.innerHTML=`<style>${e.cssStyle}</style><div>${t}</div>`,s.setAttribute("style",`transform: scale(${r});transform-origin: top left; display: inline-block`),o.textContent=n;const{width:u,height:l}=i.image;return a.setAttribute("width",u.toString()),a.setAttribute("height",l.toString()),new XMLSerializer().serializeToString(a)}function ob(t,e){const r=rt.getOptimalCanvasAndContext(t.width,t.height,e),{context:n}=r;return n.clearRect(0,0,t.width,t.height),n.drawImage(t,0,0),rt.returnCanvasAndContext(r),r.canvas}function ab(t,e,r){return new Promise(async n=>{r&&await new Promise(i=>setTimeout(i,100)),t.onload=()=>{n()},t.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(e)}`,t.crossOrigin="anonymous"})}let ub;function Du(t,e,r,n){n=n||ub||(ub=new Ru);const{domElement:i,styleElement:s,svgRoot:o}=n;i.innerHTML=`<style>${e.cssStyle}</style><div>${t}</div>`,i.setAttribute("style","transform-origin: top left; display: inline-block"),r&&(s.textContent=r),document.body.appendChild(o);const a=i.getBoundingClientRect();o.remove();const u=ae.measureFont(e.fontStyle).descent;return{width:a.width,height:a.height+u}}const lb="http://www.w3.org/2000/svg",cb="http://www.w3.org/1999/xhtml",cn=new Map;class Ru{constructor(){this.svgRoot=document.createElementNS(lb,"svg"),this.foreignObject=document.createElementNS(lb,"foreignObject"),this.domElement=document.createElementNS(cb,"div"),this.styleElement=document.createElementNS(cb,"style"),this.image=new Image;const{foreignObject:e,svgRoot:r,styleElement:n,domElement:i}=this;e.setAttribute("width","10000"),e.setAttribute("height","10000"),e.style.overflow="hidden",r.appendChild(e),e.appendChild(n),e.appendChild(i)}}class hn{constructor(e){this._activeTextures={},this._renderer=e,this._createCanvas=e.type===We.WEBGPU}getTexture(e){return this._buildTexturePromise(e.text,e.resolution,e.style)}getManagedTexture(e,r,n,i){if(this._activeTextures[i])return this._increaseReferenceCount(i),this._activeTextures[i].promise;const s=this._buildTexturePromise(e,r,n).then(o=>(this._activeTextures[i].texture=o,o));return this._activeTextures[i]={texture:null,promise:s,usageCount:1},s}async _buildTexturePromise(e,r,n){const i=H.get(Ru),s=eb(e,n),o=await ib(s,n),a=Du(e,n,o,i),u=Math.ceil(Math.ceil(Math.max(1,a.width)+n.padding*2)*r),l=Math.ceil(Math.ceil(Math.max(1,a.height)+n.padding*2)*r),c=i.image;c.width=u|0,c.height=l|0;const d=sb(e,n,r,o,i);await ab(c,d,Qm()&&s.length>0);let p=c;this._createCanvas&&(p=ob(c,r));const f=Iu(p,c.width,c.height,r);return this._createCanvas&&this._renderer.texture.initSource(f.source),H.return(i),f}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}decreaseReferenceCount(e){const r=this._activeTextures[e];r&&(r.usageCount--,r.usageCount===0&&(r.texture?this._cleanUp(r):r.promise.then(n=>{r.texture=n,this._cleanUp(r)}).catch(()=>{}),this._activeTextures[e]=null))}_cleanUp(e){pe.returnTexture(e.texture),e.texture.source.resource=null,e.texture.source.uploadMethodId="unknown"}getReferenceCount(e){return this._activeTextures[e].usageCount}destroy(){this._activeTextures=null}}hn.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"htmlText"},hn.defaultFontOptions={fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal"};var uC=Object.defineProperty,hb=Object.getOwnPropertySymbols,lC=Object.prototype.hasOwnProperty,cC=Object.prototype.propertyIsEnumerable,db=(t,e,r)=>e in t?uC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fb=(t,e)=>{for(var r in e||(e={}))lC.call(e,r)&&db(t,r,e[r]);if(hb)for(var r of hb(e))cC.call(e,r)&&db(t,r,e[r]);return t};const pb=class{constructor(){this._backgroundColorRgba=[0,0,0,0],this.clearBeforeRender=!0,this._backgroundColor=new X(0),this.color=this._backgroundColor,this.alpha=1}init(t){t=fb(fb({},pb.defaultOptions),t),this.clearBeforeRender=t.clearBeforeRender,this.color=t.background||t.backgroundColor||this._backgroundColor,this.alpha=t.backgroundAlpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor.setValue(t),this._backgroundColorRgba=this._backgroundColor.toArray()}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get colorRgba(){return this._backgroundColorRgba}destroy(){}};let ji=pb;ji.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"background",priority:0},ji.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};const dn={};V.handle(v.BlendMode,t=>{if(!t.name)throw new Error("BlendMode extension must have a name property");dn[t.name]=t.ref},t=>{delete dn[t.name]});class Fu{constructor(e){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=e}setBlendMode(e,r,n){if(this._activeBlendMode===r){this._isAdvanced&&this._renderableList.push(e);return}this._activeBlendMode=r,this._isAdvanced&&this._endAdvancedBlendMode(n),this._isAdvanced=!!dn[r],this._isAdvanced&&(this._beginAdvancedBlendMode(n),this._renderableList.push(e))}_beginAdvancedBlendMode(e){this._renderer.renderPipes.batch.break(e);const r=this._activeBlendMode;if(!dn[r])return;this._filterHash[r]||(this._filterHash[r]=new _n({filters:[new dn[r]]}));const n={type:"filter",action:"pushFilter",renderables:[],filterEffect:this._filterHash[r],canBundle:!1};this._renderableList=n.renderables,e.add(n)}_endAdvancedBlendMode(e){this._renderableList=null,this._renderer.renderPipes.batch.break(e),e.add({type:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(e){this._isAdvanced&&this._endAdvancedBlendMode(e)}destroy(){this._renderer=null,this._renderableList=null;for(const e in this._filterHash)this._filterHash[e].destroy();this._filterHash=null}}Fu.extension={type:[v.WebGLPipes,v.WebGPUPipes,v.CanvasPipes],name:"blendMode"};var hC=Object.defineProperty,gb=Object.getOwnPropertySymbols,dC=Object.prototype.hasOwnProperty,fC=Object.prototype.propertyIsEnumerable,mb=(t,e,r)=>e in t?hC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gu=(t,e)=>{for(var r in e||(e={}))dC.call(e,r)&&mb(t,r,e[r]);if(gb)for(var r of gb(e))fC.call(e,r)&&mb(t,r,e[r]);return t};const bb=class{constructor(t){this._renderer=t}_normalizeOptions(t,e={}){return t instanceof K||t instanceof E?Gu({target:t},e):Gu(Gu({},e),t)}async image(t){const e=new Image;return e.src=await this.base64(t),e}async base64(t){t=this._normalizeOptions(t,bb.defaultImageOptions);const{format:e,quality:r}=t,n=this.canvas(t);if(n.toBlob!==void 0)return new Promise((i,s)=>{n.toBlob(o=>{if(!o){s(new Error("ICanvas.toBlob failed!"));return}const a=new FileReader;a.onload=()=>i(a.result),a.onerror=s,a.readAsDataURL(o)},e,r)});if(n.toDataURL!==void 0)return n.toDataURL(e,r);if(n.convertToBlob!==void 0){const i=await n.convertToBlob({type:e,quality:r});return new Promise((s,o)=>{const a=new FileReader;a.onload=()=>s(a.result),a.onerror=o,a.readAsDataURL(i)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t){t=this._normalizeOptions(t);const e=t.target,r=this._renderer,n=e instanceof E?e:r.textureGenerator.generateTexture(t),i=r.texture.generateCanvas(n);return e instanceof K&&n.destroy(),i}pixels(t){t=this._normalizeOptions(t);const e=t.target,r=this._renderer,n=e instanceof E?e:r.textureGenerator.generateTexture(t),i=r.texture.getPixels(n);return e instanceof K&&n.destroy(),i}texture(t){return t=this._normalizeOptions(t),t.target instanceof E?t.target:this._renderer.textureGenerator.generateTexture(t)}download(t){var e;t=this._normalizeOptions(t);const r=this.canvas(t),n=document.createElement("a");n.download=(e=t.filename)!=null?e:"image.png",n.href=r.toDataURL("image/png"),document.body.appendChild(n),n.click(),document.body.removeChild(n)}log(t){var e;const r=(e=t.width)!=null?e:200;t=this._normalizeOptions(t);const n=this.canvas(t),i=n.toDataURL();console.log(`[Pixi Texture] ${n.width}px ${n.height}px`);const s=["font-size: 1px;",`padding: ${r}px 300px;`,`background: url(${i}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",s)}destroy(){this._renderer=null}};let Yi=bb;Yi.extension={type:[v.WebGLSystem,v.WebGPUSystem],name:"extract"},Yi.defaultImageOptions={format:"png",quality:1};class vb extends E{static create(e){return new E({source:new fe(e)})}resize(e,r,n){return this.source.resize(e,r,n),this}}var pC=Object.defineProperty,gC=Object.defineProperties,mC=Object.getOwnPropertyDescriptors,yb=Object.getOwnPropertySymbols,bC=Object.prototype.hasOwnProperty,vC=Object.prototype.propertyIsEnumerable,_b=(t,e,r)=>e in t?pC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yC=(t,e)=>{for(var r in e||(e={}))bC.call(e,r)&&_b(t,r,e[r]);if(yb)for(var r of yb(e))vC.call(e,r)&&_b(t,r,e[r]);return t},_C=(t,e)=>gC(t,mC(e));const xC=new te,AC=new be,CC=[0,0,0,0];class ku{constructor(e){this._renderer=e}generateTexture(e){var r;e instanceof K&&(e={target:e,frame:void 0,textureSourceOptions:{},resolution:void 0});const n=e.resolution||this._renderer.resolution,i=e.target;let s=e.clearColor;s?s=Array.isArray(s)&&s.length===4?s:X.shared.setValue(s).toArray():s=CC;const o=((r=e.frame)==null?void 0:r.copyTo(xC))||nt(i,AC).rectangle;o.width=Math.max(o.width,1/n)|0,o.height=Math.max(o.height,1/n)|0;const a=vb.create(_C(yC({},e.textureSourceOptions),{width:o.width,height:o.height,resolution:n})),u=R.shared.translate(-o.x,-o.y);return this._renderer.render({container:i,transform:u,target:a,clearColor:s}),a}destroy(){const e=this;e._renderer=null}}ku.extension={type:[v.WebGLSystem,v.WebGPUSystem],name:"textureGenerator"};class Ou{constructor(e){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=e}reset(){this._stackIndex=0;for(let e=0;e<this._activeUniforms.length;e++)this._uniformsPool.push(this._activeUniforms[e]);for(let e=0;e<this._activeBindGroups.length;e++)this._bindGroupPool.push(this._activeBindGroups[e]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(e){this.reset(),this.push(e)}bind({projectionData:e,worldTransformMatrix:r,worldColor:n,offset:i}){const s=this._renderer.renderTarget.renderTarget,o=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{projectionData:s,worldTransformMatrix:new R,worldColor:4294967295,offset:new Y},a={projectionMatrix:(e==null?void 0:e.projectionMatrix)||s.projectionMatrix,resolution:(e==null?void 0:e.size)||s.size,worldTransformMatrix:r||o.worldTransformMatrix,worldColor:n||o.worldColor,offset:i||o.offset,bindGroup:null},u=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(u);const l=u.uniforms;l.projectionMatrix=a.projectionMatrix,l.uResolution=a.resolution,l.worldTransformMatrix.copyFrom(a.worldTransformMatrix),l.worldTransformMatrix.tx-=a.offset.x,l.worldTransformMatrix.ty-=a.offset.y,l.worldAlpha=(a.worldColor>>24&255)/255,u.update();let c;this._renderer.renderPipes.uniformBatch?c=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(u,!1):(this._renderer.uniformBuffer.updateUniformGroup(u),c=this._bindGroupPool.pop()||new He,this._activeBindGroups.push(c),c.setResource(u,0)),a.bindGroup=c,this._currentGlobalUniformData=a}push(e){this.bind(e),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1]}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new oe({projectionMatrix:{value:new R,type:"mat3x3<f32>"},worldTransformMatrix:{value:new R,type:"mat3x3<f32>"},worldAlpha:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}},{ubo:!0,isStatic:!0})}destroy(){const e=this;e._renderer=null}}Ou.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"globalUniforms"};const Uu={f32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"mat2x2<f32>":48,"mat3x3<f32>":48,"mat4x4<f32>":64};function xb(t){const e=t.map(s=>({data:s,offset:0,size:0}));let r=0,n=0,i=0;for(let s=0;s<e.length;s++){const o=e[s];if(r=Uu[o.data.type],!r)throw new Error(`Unknown type ${o.data.type}`);if(o.data.size>1&&(r=Math.max(r,16)*o.data.size),o.size=r,n%r!==0&&n<16){const a=n%r%16;n+=a,i+=a}n+r>16?(i=Math.ceil(i/16)*16,o.offset=i,i+=r,n=r):(o.offset=i,n+=r,i+=r)}return i=Math.ceil(i/16)*16,{uboElements:e,size:i}}const Zi=[{type:"mat3x3<f32>",test:t=>t.value.a!==void 0,code:t=>`
                var ${t}_matrix = uv.${t}.toArray(true);

                data[offset] = ${t}_matrix[0];
                data[offset+1] = ${t}_matrix[1];
                data[offset+2] = ${t}_matrix[2];

                data[offset + 4] = ${t}_matrix[3];
                data[offset + 5] = ${t}_matrix[4];
                data[offset + 6] = ${t}_matrix[5];

                data[offset + 8] = ${t}_matrix[6];
                data[offset + 9] = ${t}_matrix[7];
                data[offset + 10] = ${t}_matrix[8];
            `},{type:"vec4<f32>",test:t=>t.type==="vec4<f32>"&&t.size===1&&t.value.width!==void 0,code:t=>`
                        v = uv.${t};

                        data[offset] = v.x;
                        data[offset+1] = v.y;
                        data[offset+2] = v.width;
                        data[offset+3] = v.height;
                    `},{type:"vec2<f32>",test:t=>t.type==="vec2<f32>"&&t.size===1&&t.value.x!==void 0,code:t=>`
                    v = uv.${t};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                `}],wC={f32:`
        data[offset] = v;
    `,"vec2<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,"vec3<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,"vec4<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,"mat3x3<f32>":`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,"mat4x4<f32>":`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `};function Ab(t){const e=[`
        var v = null;
        var v2 = null;
        var t = 0;
        var index = 0;
    `];let r=0;for(let i=0;i<t.length;i++){const s=t[i],o=s.data.name;let a=!1,u=0;for(let l=0;l<Zi.length;l++)if(Zi[l].test(s.data)){u=s.offset/4,e.push(`offset += ${u-r};`,Zi[l].code(o)),a=!0;break}if(!a)if(s.data.size>1){const l=Math.max(Uu[s.data.type]/16,1),c=s.data.value.length/s.data.size,d=(4-c%4)%4;u=s.offset/4,e.push(`
                    v = uv.${o};
                    offset += ${u-r};

                    let arrayOffset = offset;
                    
                    t = 0;

                    for(var i=0; i < ${s.data.size*l}; i++)
                    {
                        for(var j = 0; j < ${c}; j++)
                        {
                            data[arrayOffset++] = v[t++];
                        }
                        ${d!==0?"arrayOffset += ${remainder};":""}
                    }
                `)}else{const l=wC[s.data.type];u=s.offset/4,e.push(`
                    v = uv.${o};
                    offset += ${u-r};
                    ${l};
                `)}r=u}const n=e.join(`
`);return new Function("uv","data","offset",n)}class Lu{constructor(){this._syncFunctionHash=Object.create(null)}ensureUniformGroup(e){e._syncFunction||this._initUniformGroup(e)}_initUniformGroup(e){const r=e.signature;let n=this._syncFunctionHash[r];if(!n){const i=Object.keys(e.uniformStructures).map(a=>e.uniformStructures[a]),s=xb(i),o=Ab(s.uboElements);n=this._syncFunctionHash[r]={layout:s,syncFunction:o}}return e._syncFunction=n.syncFunction,e.buffer=new De({data:new Float32Array(n.layout.size/4),usage:W.UNIFORM|W.COPY_DST}),e._syncFunction}syncUniformGroup(e,r,n){const i=e._syncFunction||this._initUniformGroup(e);return r||(r=e.buffer.data),n||(n=0),i(e.uniforms,r,n),!0}updateUniformGroup(e){if(e.isStatic&&!e.dirtyId)return!1;e.dirtyId=0;const r=this.syncUniformGroup(e);return e.buffer.update(),r}destroy(){this._syncFunctionHash=null}}Lu.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"uniformBuffer"};let Cb=!1;const Nu="8.0.0-beta.6";function wb(t){if(!Cb){if(Z.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const e=[`%c  %c  %c  %c  %c PixiJS %c v${Nu} (${t}) http://www.pixijs.com/

`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...e)}else globalThis.console&&globalThis.console.log(`PixiJS ${Nu} - ${t} - http://www.pixijs.com/`);Cb=!0}}class qi{constructor(e){this._renderer=e}init(e){e.hello&&wb(this._renderer.name)}}qi.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"hello",priority:0},qi.defaultOptions={hello:!1};var TC=Object.defineProperty,Tb=Object.getOwnPropertySymbols,SC=Object.prototype.hasOwnProperty,EC=Object.prototype.propertyIsEnumerable,Sb=(t,e,r)=>e in t?TC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Eb=(t,e)=>{for(var r in e||(e={}))SC.call(e,r)&&Sb(t,r,e[r]);if(Tb)for(var r of Tb(e))EC.call(e,r)&&Sb(t,r,e[r]);return t};const Ib=class{constructor(t){this._renderer=t,this.count=0,this.checkCount=0}init(t){t=Eb(Eb({},Ib.defaultOptions),t),this.checkCountMax=t.textureGCCheckCountMax,this.maxIdle=t.textureGCAMaxIdle,this.active=t.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this._renderer.texture.managedTextures;for(let e=0;e<t.length;e++){const r=t[e];r.resource&&r.touched>-1&&this.count-r.touched>this.maxIdle&&(r.touched=-1,r.unload())}}destroy(){this._renderer=null}};let fn=Ib;fn.extension={type:[v.WebGLSystem,v.WebGPUSystem],name:"textureGC"},fn.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:3600,textureGCCheckCountMax:600},V.add(fn);var IC=Object.defineProperty,Pb=Object.getOwnPropertySymbols,PC=Object.prototype.hasOwnProperty,BC=Object.prototype.propertyIsEnumerable,Bb=(t,e,r)=>e in t?IC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mb=(t,e)=>{for(var r in e||(e={}))PC.call(e,r)&&Bb(t,r,e[r]);if(Pb)for(var r of Pb(e))BC.call(e,r)&&Bb(t,r,e[r]);return t};const Db=class{get resolution(){return this.texture.source._resolution}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(t){t=Mb(Mb({},Db.defaultOptions),t),t.element&&(G($,"ViewSystem.element has been renamed to ViewSystem.canvas"),t.canvas=t.element),this.screen=new te(0,0,t.width,t.height),this.canvas=t.canvas||Z.get().createCanvas(),this.antialias=!!t.antialias,this.texture=Di(this.canvas,t),this.multiView=!!t.multiView,this.autoDensity&&(this.canvas.style.width=`${this.texture.width}px`,this.canvas.style.height=`${this.texture.height}px`),this.resolution=t.resolution}resize(t,e,r){this.texture.source.resize(t,e,r),this.screen.width=this.texture.frameWidth,this.screen.height=this.texture.frameHeight,this.autoDensity&&(this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`)}destroy(t=!1){(typeof t=="boolean"?t:t!=null&&t.removeView)&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};let Ki=Db;Ki.extension={type:[v.WebGLSystem,v.WebGPUSystem,v.CanvasSystem],name:"view",priority:0},Ki.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};const $u=[ji,ra,du,Ou,qi,Ki,Pu,hn,Qa,Lu,fn,ku,Yi],Vu=[Fu,ya,mu,Ya,gu,pu,Eu,Bu,Su,vu,ea,_a,Aa,xa],MC=[...$u,Mi,Pi,Ca,Ha,Ma,Sa,Ua,Oa,Ia,Na,Da,Ea],DC=[...Vu],RC=[da,Xa,Wa],Rb=[],Fb=[],Gb=[];V.handleByNamedList(v.WebGLSystem,Rb),V.handleByNamedList(v.WebGLPipes,Fb),V.handleByNamedList(v.WebGLPipesAdaptor,Gb),V.add(...MC,...DC,...RC);class kb extends $t{constructor(){const e={name:"webgl2",type:We.WEBGL,systems:Rb,renderPipes:Fb,renderPipeAdaptors:Gb};super(e)}}var FC={__proto__:null,WebGLRenderer:kb};class zu{constructor(e){this._hash=Object.create(null),this._renderer=e}contextChange(e){this._gpu=e}getBindGroup(e,r,n){return e.updateKey(),this._hash[e.key]||this._createBindGroup(e,r,n)}_createBindGroup(e,r,n){var i;const s=this._gpu.device,o=r.layout[n],a=[];for(const l in o){const c=(i=e.resources[l])!=null?i:e.resources[o[l]];let d;if(c.resourceType==="uniformGroup"){const p=c;this._renderer.uniformBuffer.updateUniformGroup(p);const f=p.buffer;d={buffer:this._renderer.buffer.getGPUBuffer(f),offset:0,size:f.descriptor.size}}else if(c.resourceType==="buffer"){const p=c;d={buffer:this._renderer.buffer.getGPUBuffer(p),offset:0,size:p.descriptor.size}}else if(c.resourceType==="bufferResource"){const p=c;d={buffer:this._renderer.buffer.getGPUBuffer(p.buffer),offset:p.offset,size:p.size}}else if(c.resourceType==="textureSampler"){const p=c;d=this._renderer.texture.getGpuSampler(p)}else if(c.resourceType==="textureSource"){const p=c;d=this._renderer.texture.getGpuSource(p).createView({})}a.push({binding:o[l],resource:d})}const u=s.createBindGroup({layout:r._gpuLayout.bindGroups[n],entries:a});return this._hash[e.key]=u,u}destroy(){for(const r of Object.keys(this._hash))this._hash[r]=null;this._hash=null;const e=this;e._renderer=null}}zu.extension={type:[v.WebGPUSystem],name:"bindGroup"};class Hu{constructor(){this._gpuBuffers=Object.create(null)}contextChange(e){this._gpu=e}getGPUBuffer(e){return this._gpuBuffers[e.uid]||this.createGPUBuffer(e)}updateBuffer(e){const r=this._gpuBuffers[e.uid]||this.createGPUBuffer(e);return e._updateID&&e.data&&(e._updateID=0,this._gpu.device.queue.writeBuffer(r,0,e.data.buffer,0,e._updateSize)),r}destroyAll(){for(const e in this._gpuBuffers)this._gpuBuffers[e].destroy();this._gpuBuffers={}}createGPUBuffer(e){const r=this._gpu.device.createBuffer(e.descriptor);return e._updateID=0,e.data&&(Ii(e.data.buffer,r.getMappedRange()),r.unmap()),this._gpuBuffers[e.uid]=r,e.on("update",this.updateBuffer,this),e.on("change",this.onBufferChange,this),e.on("destroy",this.onBufferDestroy,this),r}onBufferChange(e){let r=this._gpuBuffers[e.uid];r.destroy(),r=this.createGPUBuffer(e),e._updateID=0}onBufferDestroy(e){this._gpuBuffers[e.uid].destroy(),this._gpuBuffers[e.uid]=null}destroy(){for(const r of Object.keys(this._gpuBuffers)){const n=Number(r);this._gpuBuffers[n].destroy(),this._gpuBuffers[n]=null}this._gpuBuffers=null;const e=this;e._renderer=null}}Hu.extension={type:[v.WebGPUSystem],name:"buffer"};function GC(t,e){const r=t.descriptor.size,n=e.gpu.device,i=new De({data:new Float32Array(24e5),usage:W.MAP_READ|W.COPY_DST}),s=e.buffer.createGPUBuffer(i),o=n.createCommandEncoder();o.copyBufferToBuffer(e.buffer.getGPUBuffer(t),0,s,0,r),n.queue.submit([o.finish()]),s.mapAsync(GPUMapMode.READ,0,r).then(()=>{s.getMappedRange(0,r),s.unmap()})}class Ob{constructor({minUniformOffsetAlignment:e}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=e,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(e){if(e>this._minUniformOffsetAlignment/4)throw new Error(`UniformBufferBatch: array is too large: ${e*4}`);const r=this.byteIndex;let n=r+e*4;if(n=Math.ceil(n/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,n>this.data.length*4)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=n,r}addGroup(e){const r=this.addEmptyGroup(e.length);for(let n=0;n<e.length;n++)this.data[r/4+n]=e[n];return r}destroy(){this._buffer.destroy(),this._buffer=null,this.data=null}}class Wu{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.pipeline.setColorMask(e))}destroy(){const e=this;e._renderer=null,this._colorMaskCache=null}}Wu.extension={type:[v.WebGPUSystem],name:"colorMask"};class Xu{constructor(e){this._renderer=e}async init(){return this._initPromise?this._initPromise:(this._initPromise=this._createDeviceAndAdaptor({}).then(e=>{this.gpu=e,this._renderer.runners.contextChange.emit(this.gpu)}),this._initPromise)}contextChange(e){this._renderer.gpu=e}async _createDeviceAndAdaptor(e){const r=await navigator.gpu.requestAdapter(e),n=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(s=>r.features.has(s)),i=await r.requestDevice({requiredFeatures:n});return{adapter:r,device:i}}destroy(){this.gpu=null,this._renderer=null}}Xu.extension={type:[v.WebGPUSystem],name:"device"};var kC=Object.defineProperty,Ub=Object.getOwnPropertySymbols,OC=Object.prototype.hasOwnProperty,UC=Object.prototype.propertyIsEnumerable,Lb=(t,e,r)=>e in t?kC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Nb=(t,e)=>{for(var r in e||(e={}))OC.call(e,r)&&Lb(t,r,e[r]);if(Ub)for(var r of Ub(e))UC.call(e,r)&&Lb(t,r,e[r]);return t};class ju{constructor(e){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=e}start(){this.commandFinished=new Promise(e=>{this._resolveCommandFinished=e}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(e,r){this.renderPassEncoder&&this.renderPassEncoder.end(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(r.descriptor),this._setViewport(e.viewport)}_setViewport(e){this.renderPassEncoder.setViewport(e.x,e.y,e.width,e.height,0,1)}setPipelineFromGeometryProgramAndState(e,r,n,i){const s=this._renderer.pipeline.getPipeline(e,r,n,i);this.setPipeline(s)}setPipeline(e){this._boundPipeline!==e&&(this._boundPipeline=e,this.renderPassEncoder.setPipeline(e))}_setVertexBuffer(e,r){this._boundVertexBuffer[e]!==r&&(this._boundVertexBuffer[e]=r,this.renderPassEncoder.setVertexBuffer(e,this._renderer.buffer.updateBuffer(r)))}_setIndexBuffer(e){this._boundIndexBuffer!==e&&(this._boundIndexBuffer=e,this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(e),"uint32"))}setBindGroup(e,r,n){if(this._boundBindGroup[e]===r)return;this._boundBindGroup[e]=r,r.touch(this._renderer.textureGC.count);const i=this._renderer.bindGroup.getBindGroup(r,n,e);this.renderPassEncoder.setBindGroup(e,i)}setGeometry(e){for(const r in e.attributes){const n=e.attributes[r];this._setVertexBuffer(n.shaderLocation,n.buffer)}e.indexBuffer&&this._setIndexBuffer(e.indexBuffer)}_setShaderBindGroups(e,r){for(const n in e.groups){const i=e.groups[n];r||this._syncBindGroup(i),this.setBindGroup(n,i,e.gpuProgram)}}_syncBindGroup(e){for(const r in e.resources){const n=e.resources[r];n.isUniformGroup&&this._renderer.uniformBuffer.updateUniformGroup(n)}}draw(e){const{geometry:r,shader:n,state:i,topology:s,size:o,start:a,instanceCount:u,skipSync:l}=e;this.setPipelineFromGeometryProgramAndState(r,n.gpuProgram,i,s),this.setGeometry(r),this._setShaderBindGroups(n,l),r.indexBuffer?this.renderPassEncoder.drawIndexed(o||r.indexBuffer.data.length,u||1,a||0):this.renderPassEncoder.draw(o||r.getSize(),u||1,a||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished()}restoreRenderPass(){const e=this._renderer.renderTarget.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(e);const r=this._boundPipeline,n=Nb({},this._boundVertexBuffer),i=this._boundIndexBuffer,s=Nb({},this._boundBindGroup);this._clearCache();const o=this._renderer.renderTarget.renderTarget.viewport;this.renderPassEncoder.setViewport(o.x,o.y,o.width,o.height,0,1),this.setPipeline(r);for(const a in n)this._setVertexBuffer(a,n[a]);for(const a in s)this.setBindGroup(a,s[a],null);this._setIndexBuffer(i)}_clearCache(){for(let e=0;e<16;e++)this._boundBindGroup[e]=null,this._boundVertexBuffer[e]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){const e=this;e._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(e){this._gpu=e}}ju.extension={type:[v.WebGPUSystem],name:"encoder"};class Yu{constructor(e){this._renderTargetStencilState=Object.create(null),this._renderer=e,e.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(e){let r=this._renderTargetStencilState[e.uid];r||(r=this._renderTargetStencilState[e.uid]={stencilMode:le.DISABLED,stencilReference:0}),this._activeRenderTarget=e,this.setStencilMode(r.stencilMode,r.stencilReference)}setStencilMode(e,r){const n=this._renderTargetStencilState[this._activeRenderTarget.uid];n.stencilMode=e,n.stencilReference=r;const i=this._renderer;i.pipeline.setStencilMode(e),i.encoder.renderPassEncoder.setStencilReference(r)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this);const e=this;e._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}Yu.extension={type:[v.WebGPUSystem],name:"stencil"};const at=128;class Zu{constructor(e){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=e,this._batchBuffer=new Ob({minUniformOffsetAlignment:at});const r=256/at;for(let n=0;n<r;n++){let i=W.UNIFORM|W.COPY_DST;n===0&&(i|=W.COPY_SRC),this._buffers.push(new De({data:this._batchBuffer.data,usage:i}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const e in this._bindGroupHash)this._bindGroupHash[e]=null;this._batchBuffer.clear()}getUniformBindGroup(e,r){if(!r&&this._bindGroupHash[e.uid])return this._bindGroupHash[e.uid];this._renderer.uniformBuffer.ensureUniformGroup(e);const n=e.buffer.data,i=this._batchBuffer.addEmptyGroup(n.length);return this._renderer.uniformBuffer.syncUniformGroup(e,this._batchBuffer.data,i/4),this._bindGroupHash[e.uid]=this._getBindGroup(i/at),this._bindGroupHash[e.uid]}getUniformBufferResource(e){this._renderer.uniformBuffer.updateUniformGroup(e);const r=e.buffer.data,n=this._batchBuffer.addGroup(r);return this._getBufferResource(n/at)}getArrayBindGroup(e){const r=this._batchBuffer.addGroup(e);return this._getBindGroup(r/at)}getArrayBufferResource(e){const r=this._batchBuffer.addGroup(e)/at;return this._getBufferResource(r)}_getBufferResource(e){if(!this._bufferResources[e]){const r=this._buffers[e%2];this._bufferResources[e]=new Ri({buffer:r,offset:(e/2|0)*256,size:at})}return this._bufferResources[e]}_getBindGroup(e){if(!this._bindGroups[e]){const r=new He({0:this._getBufferResource(e)});this._bindGroups[e]=r}return this._bindGroups[e]}_uploadBindGroups(){const e=this._renderer.buffer,r=this._buffers[0];r.update(this._batchBuffer.byteIndex),e.updateBuffer(r);const n=this._renderer.gpu.device.createCommandEncoder();for(let i=1;i<this._buffers.length;i++){const s=this._buffers[i];n.copyBufferToBuffer(e.getGPUBuffer(r),at,e.getGPUBuffer(s),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([n.finish()])}destroy(){for(let e=0;e<this._bindGroups.length;e++)this._bindGroups[e].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers=null;for(let e=0;e<this._bufferResources.length;e++)this._bufferResources[e].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}Zu.extension={type:[v.WebGPUPipes],name:"uniformBatch"};class LC extends He{constructor(){super({0:new De({data:new Float32Array(128),usage:W.UNIFORM|W.COPY_DST})})}get buffer(){return this.resources[0]}get data(){return this.resources[0].data}}class qu{constructor(e){this._activeBindGroups=[],this._activeBindGroupIndex=0,this._renderer=e}getUniformBindGroup(e){const r=this._renderer;r.uniformBuffer.ensureUniformGroup(e);const n=H.get(LC);return r.uniformBuffer.syncUniformGroup(e,n.data,0),n.buffer.update(e.buffer.data.byteLength),this._activeBindGroups[this._activeBindGroupIndex++]=n,n}renderEnd(){for(let e=0;e<this._activeBindGroupIndex;e++)H.return(this._activeBindGroups[e]);this._activeBindGroupIndex=0}}qu.extension={type:[v.WebGPUPipes],name:"uniformBuffer"};const NC={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function $C(t,e,r,n,i,s,o,a){return t<<26|e<<18|o<<14|r<<8|n<<3|a<<1|i<<4|s}class Ku{constructor(e){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._pipeCache=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=e}contextChange(e){this._gpu=e,this.setStencilMode(le.DISABLED)}setMultisampleCount(e){this._multisampleCount=e}setColorMask(e){this._colorMask=e}setStencilMode(e){this._stencilMode=e,this._stencilState=Xe[e]}setPipeline(e,r,n,i){const s=this.getPipeline(e,r,n);i.setPipeline(s)}getPipeline(e,r,n,i){e._layoutKey||this._generateBufferKey(e),r._layoutKey||(this._generateProgramKey(r),this._renderer.shader.createProgramLayout(r)),i=i||e.topology;const s=$C(e._layoutKey,r._layoutKey,n.data,n._blendModeId,this._stencilMode,this._multisampleCount,this._colorMask,NC[i]);return this._pipeCache[s]?this._pipeCache[s]:(this._pipeCache[s]=this._createPipeline(e,r,n,i),this._pipeCache[s])}_createPipeline(e,r,n,i){const s=this._gpu.device,o=this._createVertexBufferLayouts(e),a=this._renderer.state.getColorTargets(n);let u=this._stencilState;u=Xe[this._stencilMode],a[0].writeMask=this._stencilMode===le.RENDERING_MASK_ADD?0:this._colorMask;const l={vertex:{module:this._getModule(r.vertex.source),entryPoint:r.vertex.entryPoint,buffers:o},fragment:{module:this._getModule(r.fragment.source),entryPoint:r.fragment.entryPoint,targets:a},primitive:{topology:i,cullMode:n.cullMode},layout:r._gpuLayout.pipeline,multisample:{count:this._multisampleCount},depthStencil:u,label:"PIXI Pipeline"};return s.createRenderPipeline(l)}_getModule(e){return this._moduleCache[e]||this._createModule(e)}_createModule(e){const r=this._gpu.device;return this._moduleCache[e]=r.createShaderModule({code:e}),this._moduleCache[e]}_generateProgramKey(e){const{vertex:r,fragment:n}=e,i=r.source+n.source+r.entryPoint+n.entryPoint;return e._layoutKey=Rn(i,"program"),e._layoutKey}_generateBufferKey(e){const r=[];let n=0;const i=Object.keys(e.attributes).sort();for(let o=0;o<i.length;o++){const a=e.attributes[i[o]];r[n++]=a.shaderLocation,r[n++]=a.offset,r[n++]=a.format,r[n++]=a.stride}const s=r.join("");return e._layoutKey=Rn(s,"geometry"),e._layoutKey}_createVertexBufferLayouts(e){if(this._bufferLayoutsCache[e._layoutKey])return this._bufferLayoutsCache[e._layoutKey];const r=[];return e.buffers.forEach(n=>{const i={arrayStride:0,stepMode:"vertex",attributes:[]},s=i.attributes;for(const o in e.attributes){const a=e.attributes[o];a.buffer===n&&(i.arrayStride=a.stride,s.push({shaderLocation:a.shaderLocation,offset:a.offset,format:a.format}))}s.length&&r.push(i)}),this._bufferLayoutsCache[e._layoutKey]=r,r}destroy(){const e=this;e._renderer=null,this._bufferLayoutsCache=null}}Ku.extension={type:[v.WebGPUSystem],name:"pipeline"};class $b{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class Ju{constructor(e){this.rootProjectionMatrix=new R,this.onRenderTargetChange=new In("onRenderTargetChange"),this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._defaultClearColor=[0,0,0,0],this._renderer=e}renderStart({target:e,clear:r,clearColor:n}){this.rootRenderTarget=this.getRenderTarget(e),this.rootProjectionMatrix=this.rootRenderTarget.projectionMatrix,this.renderingToScreen=Pa(this.rootRenderTarget),this._renderTargetStack.length=0,this._renderer.encoder.start(),this.push(this.rootRenderTarget,r,n!=null?n:this._renderer.background.colorRgba)}contextChange(e){this._gpu=e}bind(e,r=!0,n){const i=this.getRenderTarget(e),s=this.renderTarget!==i;return this.renderTarget=i,this._startRenderPass(r,n),s&&this.onRenderTargetChange.emit(i),i}_getGpuColorTexture(e){const r=this._getGpuRenderTarget(e);return r.contexts[0]?r.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(e.colorTextures[0].source)}getDescriptor(e,r,n){typeof r=="boolean"&&(r=r?we.ALL:we.NONE);const i=this._getGpuRenderTarget(e),s=e.colorTextures.map((a,u)=>{const l=i.contexts[u];let c,d;l?c=l.getCurrentTexture().createView():c=this._renderer.texture.getTextureView(a),i.msaaTextures[u]&&(d=c,c=this._renderer.texture.getTextureView(i.msaaTextures[u]));const p=r&we.COLOR?"clear":"load";return n!=null||(n=this._defaultClearColor),{view:c,resolveTarget:d,clearValue:n,storeOp:"store",loadOp:p}});let o;if(e.depthTexture){const a=r&we.STENCIL?"clear":"load";o={view:this._renderer.texture.getGpuSource(e.depthTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:a}}return{colorAttachments:s,depthStencilAttachment:o}}clear(e=we.ALL,r){e&&this._startRenderPass(e,r)}push(e,r=we.ALL,n){const i=this.bind(e,r,n);return this._renderTargetStack.push(i),i}pop(){this._renderTargetStack.pop(),this.bind(this._renderTargetStack[this._renderTargetStack.length-1],!1)}getRenderTarget(e){var r;return(r=this._renderSurfaceToRenderTargetHash.get(e))!=null?r:this._initRenderTarget(e)}copyToTexture(e,r,n,i){const s=this._renderer,o=s.renderTarget._getGpuColorTexture(e),a=s.texture.getGpuSource(r.source);return s.encoder.commandEncoder.copyTextureToTexture({texture:o,origin:n},{texture:a},i),r}restart(){this.bind(this.rootRenderTarget,we.NONE)}destroy(){const e=this;e._renderer=null,this._renderSurfaceToRenderTargetHash.clear()}_startRenderPass(e=!0,r){const n=this.renderTarget,i=this._getGpuRenderTarget(n);(n.width!==i.width||n.height!==i.height)&&this._resizeGpuRenderTarget(n);const s=this.getDescriptor(n,e,r);i.descriptor=s,this._renderer.encoder.beginRenderPass(n,i),this._renderer.pipeline.setMultisampleCount(i.msaaSamples)}_initRenderTarget(e){let r=null;return e instanceof HTMLCanvasElement&&(e=Di(e)),e instanceof ur?r=e:e instanceof E&&(r=new ur({colorTextures:[e],depthTexture:e.source.depthStencil})),r.isRoot=!0,this._renderSurfaceToRenderTargetHash.set(e,r),r}_getGpuRenderTarget(e){return this._gpuRenderTargetHash[e.uid]||this._initGpuRenderTarget(e)}_initGpuRenderTarget(e){e.isRoot=!0;const r=new $b;return e.colorTextures.forEach((n,i)=>{if(n.source.resource instanceof HTMLCanvasElement){const s=e.colorTexture.source.resource.getContext("webgpu");try{s.configure({device:this._gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:"opaque"})}catch(o){console.error(o)}r.contexts[i]=s}if(r.msaa=n.source.antialias,n.source.antialias){const s=new fe({width:0,height:0,sampleCount:4});r.msaaTextures[i]=s}}),r.msaa&&(r.msaaSamples=4,e.depthTexture&&(e.depthTexture.source.sampleCount=4)),this._gpuRenderTargetHash[e.uid]=r,r}_resizeGpuRenderTarget(e){const r=this._getGpuRenderTarget(e);r.width=e.width,r.height=e.height,r.msaa&&e.colorTextures.forEach((n,i)=>{const s=r.msaaTextures[i];s==null||s.resize(n.source.width,n.source.height,n.source._resolution)})}}Ju.extension={type:[v.WebGPUSystem],name:"renderTarget"};class Qu{contextChange(e){this._gpu=e}createProgramLayout(e){const r=this._gpu.device;if(!e._gpuLayout)if(e.gpuLayout){const n=e.gpuLayout.map(s=>r.createBindGroupLayout({entries:s})),i={bindGroupLayouts:n};e._gpuLayout={bindGroups:n,pipeline:r.createPipelineLayout(i)}}else e._gpuLayout={bindGroups:null,pipeline:"auto"}}destroy(){this._gpu=null}}Qu.extension={type:[v.WebGPUSystem],name:"shader"};const Te={};Te.normal={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}},Te.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}},Te.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}},Te.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},Te.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}},Te.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}},Te["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}},Te["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}},Te["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}},Te.erase={alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}};class el{constructor(){this.defaultState=new Me,this.defaultState.blend=!0}contextChange(e){this.gpu=e}getColorTargets(e){return[{format:"bgra8unorm",writeMask:0,blend:Te[e.blendMode]||Te.normal}]}destroy(){this.gpu=null}}el.extension={type:[v.WebGPUSystem],name:"state"};const Vb={type:"image",upload(t,e,r){const n=t.resource,i=(t.pixelWidth|0)*(t.pixelHeight|0),s=n.byteLength/i;r.device.queue.writeTexture({texture:e},n,{offset:0,rowsPerImage:t.pixelWidth,bytesPerRow:t.pixelWidth*s},{width:t.pixelWidth,height:t.pixelHeight,depthOrArrayLayers:1})}},tl={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},VC={blockBytes:4,blockWidth:1,blockHeight:1},zb={type:"compressed",upload(t,e,r){let n=t.pixelWidth,i=t.pixelHeight;const s=tl[t.format]||VC;for(let o=0;o<t.resource.length;o++){const a=t.resource[o],u=Math.ceil(n/s.blockWidth)*s.blockBytes;r.device.queue.writeTexture({texture:e,mipLevel:o},a,{offset:0,bytesPerRow:u},{width:Math.ceil(n/s.blockWidth)*s.blockWidth,height:Math.ceil(i/s.blockHeight)*s.blockHeight,depthOrArrayLayers:1}),n=Math.max(n>>1,1),i=Math.max(i>>1,1)}}},rl={type:"image",upload(t,e,r){const n=t.resource;if(!n)return;const i=t.resourceWidth||t.pixelWidth,s=t.resourceHeight||t.pixelHeight,o=t.alphaMode==="premultiply-alpha-on-upload";r.device.queue.copyExternalImageToTexture({source:n},{texture:e,premultipliedAlpha:o},{width:i,height:s})}},Hb={type:"video",upload(t,e,r){rl.upload(t,e,r)}};class Wb{constructor(e){this.device=e,this.sampler=e.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(e){let r=this.pipelines[e];return r||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),r=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:e}]}}),this.pipelines[e]=r),r}generateMipmap(e){const r=this._getMipmapPipeline(e.format);if(e.dimension==="3d"||e.dimension==="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let n=e;const i=e.depthOrArrayLayers||1,s=e.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!s){const u={size:{width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i},format:e.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:e.mipLevelCount-1};n=this.device.createTexture(u)}const o=this.device.createCommandEncoder({}),a=r.getBindGroupLayout(0);for(let u=0;u<i;++u){let l=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:u,arrayLayerCount:1}),c=s?1:0;for(let d=1;d<e.mipLevelCount;++d){const p=n.createView({baseMipLevel:c++,mipLevelCount:1,dimension:"2d",baseArrayLayer:u,arrayLayerCount:1}),f=o.beginRenderPass({colorAttachments:[{view:p,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),g=this.device.createBindGroup({layout:a,entries:[{binding:0,resource:this.sampler},{binding:1,resource:l}]});f.setPipeline(r),f.setBindGroup(0,g),f.draw(3,1,0,0),f.end(),l=p}}if(!s){const u={width:Math.ceil(e.width/2),height:Math.ceil(e.height/2),depthOrArrayLayers:i};for(let l=1;l<e.mipLevelCount;++l)o.copyTextureToTexture({texture:n,mipLevel:l-1},{texture:e,mipLevel:l},u),u.width=Math.ceil(u.width/2),u.height=Math.ceil(u.height/2)}return this.device.queue.submit([o.finish()]),s||n.destroy(),e}}class nl{constructor(e){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:rl,buffer:Vb,video:Hb,compressed:zb},this._renderer=e}contextChange(e){this._gpu=e}initSource(e){if(e.autoGenerateMipmaps){const u=Math.max(e.pixelWidth,e.pixelHeight);e.mipLevelCount=Math.floor(Math.log2(u))+1}let r=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;e.uploadMethodId!=="compressed"&&(r|=GPUTextureUsage.RENDER_ATTACHMENT,r|=GPUTextureUsage.COPY_SRC);const n=tl[e.format]||{blockBytes:4,blockWidth:1,blockHeight:1},i=Math.ceil(e.pixelWidth/n.blockWidth)*n.blockWidth,s=Math.ceil(e.pixelHeight/n.blockHeight)*n.blockHeight,o={label:e.label,size:{width:i,height:s},format:e.format,sampleCount:e.sampleCount,mipLevelCount:e.mipLevelCount,dimension:e.dimension,usage:r},a=this._gpu.device.createTexture(o);return this._gpuSources[e.uid]=a,e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceResize,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),this.managedTextures.push(e),this.onSourceUpdate(e),a}onSourceUpdate(e){const r=this.getGpuSource(e);r&&(this._uploads[e.uploadMethodId]&&this._uploads[e.uploadMethodId].upload(e,r,this._gpu),e.autoGenerateMipmaps&&e.mipLevelCount>1&&(this._mipmapGenerator||(this._mipmapGenerator=new Wb(this._gpu.device)),this._mipmapGenerator.generateMipmap(r)))}onSourceUnload(e){const r=this._gpuSources[e.uid];r&&(this._gpuSources[e.uid]=null,r.destroy())}onSourceDestroy(e){e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("destroy",this.onSourceDestroy,this),e.off("resize",this.onSourceResize,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}onSourceResize(e){const r=this._gpuSources[e.uid];(r.width!==e.pixelWidth||r.height!==e.pixelHeight)&&(this._textureViewHash[e.uid]=null,this._bindGroupHash[e.uid]=null,this.onSourceUnload(e),this.initSource(e))}_initSampler(e){return this._gpuSamplers[e.resourceId]=this._gpu.device.createSampler(e),this._gpuSamplers[e.resourceId]}getGpuSampler(e){return this._gpuSamplers[e.resourceId]||this._initSampler(e)}getGpuSource(e){return this._gpuSources[e.uid]||this.initSource(e)}getTextureBindGroup(e){var r;return(r=this._bindGroupHash[e.id])!=null?r:this._createTextureBindGroup(e)}_createTextureBindGroup(e){const r=e.source,n=r.uid;return this._bindGroupHash[n]=new He({0:r,1:r.style}),this._bindGroupHash[n]}getTextureView(e){var r;const n=e.source;return(r=this._textureViewHash[n.uid])!=null?r:this._createTextureView(n)}_createTextureView(e){return this._textureViewHash[e.uid]=this.getGpuSource(e).createView(),this._textureViewHash[e.uid]}generateCanvas(e){const r=this._renderer,n=r.gpu.device.createCommandEncoder(),i=Z.get().createCanvas();i.width=e.source.pixelWidth,i.height=e.source.pixelHeight;const s=i.getContext("webgpu");return s.configure({device:r.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:"premultiplied"}),n.copyTextureToTexture({texture:r.texture.getGpuSource(e.source),origin:{x:0,y:0}},{texture:s.getCurrentTexture()},{width:i.width,height:i.height}),r.gpu.device.queue.submit([n.finish()]),i}getPixels(e){const r=this.generateCanvas(e),n=rt.getOptimalCanvasAndContext(r.width,r.height),i=n.context;i.drawImage(r,0,0);const{width:s,height:o}=r,a=i.getImageData(0,0,s,o),u=new Uint8ClampedArray(a.data.buffer);return rt.returnCanvasAndContext(n),{pixels:u,width:s,height:o}}destroy(){for(const e of Object.keys(this._gpuSources)){const r=Number(e);this._gpuSources[r].destroy(),this._gpuSources[r]=null}for(const e of Object.keys(this._bindGroupHash)){const r=Number(e);this._bindGroupHash[r].destroy(),this._bindGroupHash[r]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}nl.extension={type:[v.WebGPUSystem],name:"texture"};class il{init(){const e=new oe({uTransformMatrix:{value:new R,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),r=nr({name:"graphics",bits:[xi,Ci(Re),Sg,sr]});this.shader=new Ue({gpuProgram:r,resources:{localUniforms:e}}),this.shader.addResource("globalUniforms",0,0)}execute(e,r){const n=r.view.context,i=n.customShader||this.shader,s=e.renderer,o=s.graphicsContext,{geometry:a,instructions:u}=o.getContextRenderData(n),l=s.encoder;l.setPipelineFromGeometryProgramAndState(a,i.gpuProgram,e.state),l.setGeometry(a);const c=s.globalUniforms.bindGroup;l.setBindGroup(0,c,i.gpuProgram);const d=s.renderPipes.uniformBatch.getUniformBindGroup(i.resources.localUniforms,!0);l.setBindGroup(2,d,i.gpuProgram);const p=u.instructions;for(let f=0;f<u.instructionSize;f++){const g=p[f];if(i.groups[1]=g.bindGroup,!g.gpuBindGroup){const b=g.textures;g.bindGroup=Si(b.textures,b.count),g.gpuBindGroup=s.bindGroup.getBindGroup(g.bindGroup,i.gpuProgram,1)}l.setBindGroup(1,g.bindGroup,i.gpuProgram),l.renderPassEncoder.drawIndexed(g.size,1,g.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}il.extension={type:[v.WebGPUPipesAdaptor],name:"graphics"};class sl{init(){const e=nr({name:"mesh",bits:[ar,Eg,sr]});this._shader=new Ue({gpuProgram:e,resources:{uTexture:E.EMPTY._source,uSampler:E.EMPTY._source.style}})}execute(e,r){const n=e.renderer,i=r.view;let s=i._shader;s||(s=this._shader,s.groups[2]=n.texture.getTextureBindGroup(i.texture)),s.groups[0]=n.globalUniforms.bindGroup;const o=e.localUniforms;s.groups[1]=n.renderPipes.uniformBatch.getUniformBindGroup(o,!0),n.encoder.draw({geometry:i._geometry,shader:s,state:i.state})}destroy(){this._shader.destroy(!0),this._shader=null}}sl.extension={type:[v.WebGPUPipesAdaptor],name:"mesh"};const zC=[...$u,Xu,Hu,nl,Ju,ju,Qu,el,Ku,Wu,Yu,zu],HC=[...Vu,Zu,qu],WC=[pa,sl,il],Xb=[],jb=[],Yb=[];V.handleByNamedList(v.WebGPUSystem,Xb),V.handleByNamedList(v.WebGPUPipes,jb),V.handleByNamedList(v.WebGPUPipesAdaptor,Yb),V.add(...zC,...HC,...WC);class Zb extends $t{constructor(){const e={name:"webgpu",type:We.WEBGPU,systems:Xb,renderPipes:jb,renderPipeAdaptors:Yb};super(e)}}var XC={__proto__:null,WebGPURenderer:Zb};const jC={POINTS:"point-list",LINES:"line-list",LINE_STRIP:"line-strip",TRIANGLES:"triangle-list",TRIANGLE_STRIP:"triangle-strip"},YC=new Proxy(jC,{get(t,e){return G($,`DRAW_MODES.${e} is deprecated, use '${e}' instead`),t[e]}}),ZC={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};var qb=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(qb||{}),ol=(t=>(t.CLAMP="clamp-to-edge",t.REPEAT="repeat",t.MIRRORED_REPEAT="mirror-repeat",t))(ol||{});const qC=new Proxy(ol,{get(t,e){return G($,`DRAW_MODES.${e} is deprecated, use '${e}' instead`),t[e]}});var al=(t=>(t.NEAREST="nearest",t.LINEAR="linear",t))(al||{});const KC=new Proxy(al,{get(t,e){return G($,`DRAW_MODES.${e} is deprecated, use '${e}' instead`),t[e]}});class JC{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,r,n){const i=r.width,s=r.height;if(n){const o=e.width/2/i,a=e.height/2/s,u=e.x/i+o,l=e.y/s+a;n=L.add(n,L.NW),this.x0=u+o*L.uX(n),this.y0=l+a*L.uY(n),n=L.add(n,2),this.x1=u+o*L.uX(n),this.y1=l+a*L.uY(n),n=L.add(n,2),this.x2=u+o*L.uX(n),this.y2=l+a*L.uY(n),n=L.add(n,2),this.x3=u+o*L.uX(n),this.y3=l+a*L.uY(n)}else this.x0=e.x/i,this.y0=e.y/s,this.x1=(e.x+e.width)/i,this.y1=e.y/s,this.x2=(e.x+e.width)/i,this.y2=(e.y+e.height)/s,this.x3=e.x/i,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}let QC=0;function ew(){return QC++}function tw(t,e){if(t===16777215||!e)return e;if(e===16777215||!t)return t;const r=t>>16&255,n=t>>8&255,i=t&255,s=e>>16&255,o=e>>8&255,a=e&255,u=r*s/255,l=n*o/255,c=i*a/255;return(u<<16)+(l<<8)+c}function rw(t,e,r){const n=t.a,i=t.b,s=t.c,o=t.d,a=t.tx,u=t.ty,l=e.a,c=e.b,d=e.c,p=e.d;r.a=n*l+i*d,r.b=n*c+i*p,r.c=s*l+o*d,r.d=s*c+o*p,r.tx=a*l+u*d+e.tx,r.ty=a*c+u*p+e.ty}var nw=Object.defineProperty,Ji=Object.getOwnPropertySymbols,Kb=Object.prototype.hasOwnProperty,Jb=Object.prototype.propertyIsEnumerable,Qb=(t,e,r)=>e in t?nw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,iw=(t,e)=>{for(var r in e||(e={}))Kb.call(e,r)&&Qb(t,r,e[r]);if(Ji)for(var r of Ji(e))Jb.call(e,r)&&Qb(t,r,e[r]);return t},sw=(t,e)=>{var r={};for(var n in t)Kb.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Ji)for(var n of Ji(t))e.indexOf(n)<0&&Jb.call(t,n)&&(r[n]=t[n]);return r};class ow extends K{constructor(e){e instanceof it&&(e={context:e});const r=e||{},{context:n}=r,i=sw(r,["context"]);super(iw({view:new yu(n),label:"Graphics"},i)),this.allowChildren=!1}get context(){return this.view.context}set context(e){this.view.context=e}_callContextMethod(e,r){return this.view.context[e](...r),this}fill(...e){return this._callContextMethod("fill",e)}stroke(...e){return this._callContextMethod("stroke",e)}texture(...e){return this._callContextMethod("texture",e)}beginPath(...e){return this._callContextMethod("beginPath",e)}cut(...e){return this._callContextMethod("cut",e)}arc(...e){return this._callContextMethod("arc",e)}arcTo(...e){return this._callContextMethod("arcTo",e)}arcToSvg(...e){return this._callContextMethod("arcToSvg",e)}bezierCurveTo(...e){return this._callContextMethod("bezierCurveTo",e)}closePath(...e){return this._callContextMethod("closePath",e)}ellipse(...e){return this._callContextMethod("ellipse",e)}circle(...e){return this._callContextMethod("circle",e)}path(...e){return this._callContextMethod("path",e)}lineTo(...e){return this._callContextMethod("lineTo",e)}moveTo(...e){return this._callContextMethod("moveTo",e)}quadraticCurveTo(...e){return this._callContextMethod("quadraticCurveTo",e)}rect(...e){return this._callContextMethod("rect",e)}roundRect(...e){return this._callContextMethod("roundRect",e)}poly(...e){return this._callContextMethod("poly",e)}star(...e){return this._callContextMethod("star",e)}svg(...e){return this._callContextMethod("svg",e)}restore(...e){return this._callContextMethod("restore",e)}save(...e){return this._callContextMethod("save",e)}getTransform(...e){return this._callContextMethod("getTransform",e)}resetTransform(...e){return this._callContextMethod("resetTransform",e)}rotateTransform(...e){return this._callContextMethod("rotate",e)}scaleTransform(...e){return this._callContextMethod("scale",e)}setTransform(...e){return this._callContextMethod("setTransform",e)}transform(...e){return this._callContextMethod("transform",e)}translateTransform(...e){return this._callContextMethod("translate",e)}clear(...e){return this._callContextMethod("clear",e)}get fillStyle(){return this.view.context.fillStyle}set fillStyle(e){this.view.context.fillStyle=e}get strokeStyle(){return this.view.context.strokeStyle}set strokeStyle(e){this.view.context.strokeStyle=e}beginFill(e,r){return G("8.0.0","Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.endFill(),this.context.fillStyle={color:e,alpha:r},this}endFill(){return G("8.0.0","Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill(),this}drawCircle(...e){return G("8.0.0","Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",e)}drawEllipse(...e){return G("8.0.0","Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",e)}drawPolygon(...e){return G("8.0.0","Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",e)}drawRect(...e){return G("8.0.0","Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",e)}drawRoundedRect(...e){return G("8.0.0","Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",e)}drawStar(...e){return G("8.0.0","Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",e)}get roundPixels(){return!!this.view.roundPixels}set roundPixels(e){this.view.roundPixels=e?1:0}}const aw={rectangle:lu,polygon:uu,triangle:cu,circle:Bt,ellipse:Bt,roundedRectangle:Bt};function uw(t){const e=[],r=[],n=[],i=t.path.shapePath,s=t.textureMatrix;i.shapePrimitives.forEach(({shape:a,transform:u})=>{const l=n.length,c=e.length/2,d=[],p=aw[a.type];p.build(a,d),u&&Ui(d,u),p.triangulate(d,e,2,c,n,l);const f=r.length/2;s?(u&&s.append(u.clone().invert()),eu(e,2,c,r,f,2,e.length/2-c,s)):tu(r,f,2,e.length/2-c)});const o=t.out;return o?(o.positions=new Float32Array(e),o.uvs=new Float32Array(r),o.indices=new Uint32Array(n),o):new hr({positions:new Float32Array(e),uvs:new Float32Array(r),indices:new Uint32Array(n)})}var lw=Object.defineProperty,e0=Object.getOwnPropertySymbols,cw=Object.prototype.hasOwnProperty,hw=Object.prototype.propertyIsEnumerable,t0=(t,e,r)=>e in t?lw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,r0=(t,e)=>{for(var r in e||(e={}))cw.call(e,r)&&t0(t,r,e[r]);if(e0)for(var r of e0(e))hw.call(e,r)&&t0(t,r,e[r]);return t};const n0=class extends hr{constructor(...t){var e;super({});let r=(e=t[0])!=null?e:{};typeof r=="number"&&(G($,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),r={width:r,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(r)}build(t){var e,r,n,i;t=r0(r0({},n0.defaultOptions),t),this.verticesX=(e=this.verticesX)!=null?e:t.verticesX,this.verticesY=(r=this.verticesY)!=null?r:t.verticesY,this.width=(n=this.width)!=null?n:t.width,this.height=(i=this.height)!=null?i:t.height;const s=this.verticesX*this.verticesY,o=[],a=[],u=[],l=this.verticesX-1,c=this.verticesY-1,d=this.width/l,p=this.height/c;for(let g=0;g<s;g++){const b=g%this.verticesX,m=g/this.verticesX|0;o.push(b*d,m*p),a.push(b/l,m/c)}const f=l*c;for(let g=0;g<f;g++){const b=g%l,m=g/l|0,x=m*this.verticesX+b,y=m*this.verticesX+b+1,_=(m+1)*this.verticesX+b,A=(m+1)*this.verticesX+b+1;u.push(x,y,_,y,A,_)}this.buffers[0].data=new Float32Array(o),this.buffers[1].data=new Float32Array(a),this.indexBuffer.data=new Uint32Array(u),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};let ul=n0;ul.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};var dw=Object.defineProperty,i0=Object.getOwnPropertySymbols,fw=Object.prototype.hasOwnProperty,pw=Object.prototype.propertyIsEnumerable,s0=(t,e,r)=>e in t?dw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,o0=(t,e)=>{for(var r in e||(e={}))fw.call(e,r)&&s0(t,r,e[r]);if(i0)for(var r of i0(e))pw.call(e,r)&&s0(t,r,e[r]);return t};const a0=class extends ul{constructor(t){t=o0(o0({},a0.defaultOptions),t),super({width:t.width,height:t.height,verticesX:4,verticesY:4}),this._textureMatrix=new R,this.update(t)}update(t){this.updateUvs(t),this.updatePositions(t)}updatePositions(t){var e,r,n,i,s,o;this.width=(e=t.width)!=null?e:this.width,this.height=(r=t.height)!=null?r:this.height,this._leftWidth=(n=t.leftWidth)!=null?n:this._leftWidth,this._rightWidth=(i=t.rightWidth)!=null?i:this._rightWidth,this._topHeight=(s=t.topHeight)!=null?s:this._topHeight,this._bottomHeight=(o=t.bottomHeight)!=null?o:this._bottomHeight;const a=this.positions,u=this._leftWidth+this._rightWidth,l=this.width>u?1:this.width/u,c=this._topHeight+this._bottomHeight,d=this.height>c?1:this.height/c,p=Math.min(l,d);a[9]=a[11]=a[13]=a[15]=this._topHeight*p,a[17]=a[19]=a[21]=a[23]=this.height-this._bottomHeight*p,a[25]=a[27]=a[29]=a[31]=this.height,a[2]=a[10]=a[18]=a[26]=this._leftWidth*p,a[4]=a[12]=a[20]=a[28]=this.width-this._rightWidth*p,a[6]=a[14]=a[22]=a[30]=this.width,this.getBuffer("aPosition").update()}updateUvs(t){var e,r,n,i,s,o;this._originalWidth=(e=t.originalWidth)!=null?e:this._originalWidth,this._originalHeight=(r=t.originalHeight)!=null?r:this._originalHeight,this._leftWidth=(n=t.leftWidth)!=null?n:this._leftWidth,this._rightWidth=(i=t.rightWidth)!=null?i:this._rightWidth,this._topHeight=(s=t.topHeight)!=null?s:this._topHeight,this._bottomHeight=(o=t.bottomHeight)!=null?o:this._bottomHeight,t.textureMatrix&&this._textureMatrix.copyFrom(t.textureMatrix);const a=this._textureMatrix,u=this.uvs;u[0]=u[8]=u[16]=u[24]=0,u[1]=u[3]=u[5]=u[7]=0,u[6]=u[14]=u[22]=u[30]=1,u[25]=u[27]=u[29]=u[31]=1;const l=1/this._originalWidth,c=1/this._originalHeight;u[2]=u[10]=u[18]=u[26]=l*this._leftWidth,u[9]=u[11]=u[13]=u[15]=c*this._topHeight,u[4]=u[12]=u[20]=u[28]=1-l*this._rightWidth,u[17]=u[19]=u[21]=u[23]=1-c*this._bottomHeight,gw(a,u),this.getBuffer("aUV").update()}};let ll=a0;ll.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};function gw(t,e,r){r!=null||(r=e);const n=t.a,i=t.b,s=t.c,o=t.d,a=t.tx,u=t.ty;for(let l=0;l<e.length;l+=2){const c=e[l],d=e[l+1];r[l]=c*n+d*s+a,r[l+1]=c*i+d*o+u}return r}var mw=Object.defineProperty,Qi=Object.getOwnPropertySymbols,u0=Object.prototype.hasOwnProperty,l0=Object.prototype.propertyIsEnumerable,c0=(t,e,r)=>e in t?mw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,bw=(t,e)=>{for(var r in e||(e={}))u0.call(e,r)&&c0(t,r,e[r]);if(Qi)for(var r of Qi(e))l0.call(e,r)&&c0(t,r,e[r]);return t},vw=(t,e)=>{var r={};for(var n in t)u0.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&Qi)for(var n of Qi(t))e.indexOf(n)<0&&l0.call(t,n)&&(r[n]=t[n]);return r};const fr=class extends K{constructor(t){var e,r,n,i;t instanceof E&&(t={texture:t});const s=t,{leftWidth:o,rightWidth:a,topHeight:u,bottomHeight:l,texture:c}=s,d=vw(s,["leftWidth","rightWidth","topHeight","bottomHeight","texture"]),p=c!=null?c:fr.defaultOptions.texture,f=p.layout.defaultBorders,g=new ll(ct({width:p.width,height:p.height,originalWidth:p.width,originalHeight:p.height,leftWidth:(e=o!=null?o:f==null?void 0:f.left)!=null?e:fr.defaultOptions.leftWidth,topHeight:(r=u!=null?u:f==null?void 0:f.top)!=null?r:fr.defaultOptions.topHeight,rightWidth:(n=a!=null?a:f==null?void 0:f.right)!=null?n:fr.defaultOptions.rightWidth,bottomHeight:(i=l!=null?l:f==null?void 0:f.bottom)!=null?i:fr.defaultOptions.bottomHeight,textureMatrix:p.textureMatrix.mapCoord}));super(bw({view:new on(ct({geometry:g,texture:p})),label:"NineSliceSprite"},d)),this.allowChildren=!1}get width(){return this.view.geometry.width}set width(t){this.view.geometry.updatePositions({width:t})}get height(){return this.view.geometry.height}set height(t){this.view.geometry.updatePositions({height:t})}get leftWidth(){return this.view.geometry._leftWidth}set leftWidth(t){this.view.geometry.updateUvs({leftWidth:t})}get topHeight(){return this.view.geometry._topHeight}set topHeight(t){this.view.geometry.updateUvs({topHeight:t})}get rightWidth(){return this.view.geometry._rightWidth}set rightWidth(t){this.view.geometry.updateUvs({rightWidth:t})}get bottomHeight(){return this.view.geometry._bottomHeight}set bottomHeight(t){this.view.geometry.updateUvs({bottomHeight:t})}get texture(){return this.view.texture}set texture(t){t!==this.view.texture&&(this.view.geometry.updateUvs({originalWidth:t.width,originalHeight:t.height,textureMatrix:t.textureMatrix.mapCoord}),this.view.texture=t)}get roundPixels(){return!!this.view.roundPixels}set roundPixels(t){this.view.roundPixels=t?1:0}};let cl=fr;cl.defaultOptions={texture:E.EMPTY,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10};class yw extends cl{constructor(...e){let r=e[0];r instanceof E&&(G($,"NineSlicePlane now uses the options object {texture, leftWidth, rightWidth, topHeight, bottomHeight}"),r={texture:r,leftWidth:e[1],topHeight:e[2],rightWidth:e[3],bottomHeight:e[4]}),G($,"NineSlicePlane is deprecated. Use NineSliceSprite instead."),super(r)}}function _w(t,e){const{frameWidth:r,frameHeight:n}=t;return e.scale(1/r,1/n),e}var xw=Object.defineProperty,es=Object.getOwnPropertySymbols,h0=Object.prototype.hasOwnProperty,d0=Object.prototype.propertyIsEnumerable,f0=(t,e,r)=>e in t?xw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Aw=(t,e)=>{for(var r in e||(e={}))h0.call(e,r)&&f0(t,r,e[r]);if(es)for(var r of es(e))d0.call(e,r)&&f0(t,r,e[r]);return t},Cw=(t,e)=>{var r={};for(var n in t)h0.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&es)for(var n of es(t))e.indexOf(n)<0&&d0.call(t,n)&&(r[n]=t[n]);return r};class ww extends K{constructor(...e){let r=e[0];r instanceof hr&&(G($,"Mesh: use new Mesh({ geometry, shader }) instead"),r={geometry:r,shader:e[1]},e[3]&&(G($,"Mesh: topology argument has been removed, use geometry.topology instead"),r.geometry.topology=e[3]));const n=r,{geometry:i,shader:s,texture:o}=n,a=Cw(n,["geometry","shader","texture"]);super(Aw({view:new on(ct({geometry:i,shader:s,texture:o})),label:"Mesh"},a)),this.allowChildren=!1}get texture(){return this.view.texture}set texture(e){this.view.texture=e}get geometry(){return this.view.geometry}set geometry(e){this.view.geometry=e}get material(){return G($,"mesh.material property has been removed, use mesh.shader instead"),this.view.shader}get shader(){return this.view.shader}get roundPixels(){return!!this.view.roundPixels}set roundPixels(e){this.view.roundPixels=e?1:0}}class ts extends $e{constructor(e,r=!0){super(e[0]instanceof E?e[0]:e[0].texture),this._textures=null,this._durations=null,this._autoUpdate=r,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=e}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(ve.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(ve.shared.add(this.update,this,ht.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(e){this.stop(),this.currentFrame=e}gotoAndPlay(e){this.currentFrame=e,this.play()}update(e){if(!this._playing)return;const r=e.deltaTime,n=this.animationSpeed*r,i=this.currentFrame;if(this._durations!==null){let s=this._currentTime%1*this._durations[this.currentFrame];for(s+=n/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];const o=Math.sign(this.animationSpeed*r);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=n;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this._updateTexture())}_updateTexture(){const e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this.texture=this._textures[e],this.updateAnchor&&this.anchor.copyFrom(this.texture.layout.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(){this.stop(),super.destroy(),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(e){const r=[];for(let n=0;n<e.length;++n)r.push(E.from(e[n]));return new ts(r)}static fromImages(e){const r=[];for(let n=0;n<e.length;++n)r.push(E.from(e[n]));return new ts(r)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(e){if(e[0]instanceof E)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(let r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this._updateTexture()}get currentFrame(){let e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e}set currentFrame(e){if(e<0||e>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${e}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this._updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(ve.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(ve.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class p0{constructor({matrix:e,observer:r}={}){this.dirty=!0,this._matrix=e!=null?e:new R,this.observer=r,this.position=new ue(this,0,0),this.scale=new ue(this,1,1),this.pivot=new ue(this,0,0),this.skew=new ue(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}onUpdate(e){var r;this.dirty=!0,e===this.skew&&this.updateSkew(),(r=this.observer)==null||r.onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())}}var Tw=Object.defineProperty,g0=Object.getOwnPropertySymbols,Sw=Object.prototype.hasOwnProperty,Ew=Object.prototype.propertyIsEnumerable,m0=(t,e,r)=>e in t?Tw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,b0=(t,e)=>{for(var r in e||(e={}))Sw.call(e,r)&&m0(t,r,e[r]);if(g0)for(var r of g0(e))Ew.call(e,r)&&m0(t,r,e[r]);return t};const v0=class{constructor(t){this.owner=Xt,this.uid=J("tilingSpriteView"),this.renderPipeId="tilingSprite",this.batched=!0,this.roundPixels=0,this._bounds=[0,1,0,0],this._boundsDirty=!0,t=b0(b0({},v0.defaultOptions),t),this.anchor=new ue(this,0,0),this._applyAnchorToTexture=t.applyAnchorToTexture,this.texture=t.texture,this._width=t.width,this._height=t.height,this._tileTransform=new p0({observer:this})}get bounds(){return this._boundsDirty&&(this._updateBounds(),this._boundsDirty=!1),this._bounds}set texture(t){this._texture!==t&&(this._texture=t,this.onUpdate())}get texture(){return this._texture}set width(t){this._width=t,this.onUpdate()}get width(){return this._width}set height(t){this._height=t,this.onUpdate()}get height(){return this._height}_updateBounds(){const t=this._bounds,e=this.anchor,r=this._width,n=this._height;t[1]=-e._x*r,t[0]=t[1]+r,t[3]=-e._y*n,t[2]=t[3]+n}addBounds(t){const e=this.bounds;t.addFrame(e[0],e[2],e[1],e[3])}containsPoint(t){const e=this.bounds[2],r=this.bounds[3],n=-e*this.anchor.x;let i=0;return t.x>=n&&t.x<n+e&&(i=-r*this.anchor.y,t.y>=i&&t.y<i+r)}onUpdate(){this._boundsDirty=!0,this._didUpdate=!0,this.owner.onViewUpdate()}destroy(t=!1){if(this.anchor=null,this._tileTransform=null,this._bounds=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(e)}this._texture=null}};let hl=v0;hl.defaultOptions={texture:E.WHITE,width:256,height:256,applyAnchorToTexture:!1};var Iw=Object.defineProperty,rs=Object.getOwnPropertySymbols,y0=Object.prototype.hasOwnProperty,_0=Object.prototype.propertyIsEnumerable,x0=(t,e,r)=>e in t?Iw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pw=(t,e)=>{for(var r in e||(e={}))y0.call(e,r)&&x0(t,r,e[r]);if(rs)for(var r of rs(e))_0.call(e,r)&&x0(t,r,e[r]);return t},Bw=(t,e)=>{var r={};for(var n in t)y0.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&rs)for(var n of rs(t))e.indexOf(n)<0&&_0.call(t,n)&&(r[n]=t[n]);return r};class Mw extends K{constructor(e){const r=e!=null?e:{},{texture:n,width:i,height:s,applyAnchorToTexture:o}=r,a=Bw(r,["texture","width","height","applyAnchorToTexture"]);super(Pw({view:new hl(ct({texture:n,width:i,height:s,applyAnchorToTexture:o})),label:"TilingSprite"},a)),this.allowChildren=!1}set texture(e){this.view.texture=e}get texture(){return this.view.texture}get anchor(){return this.view.anchor}set anchor(e){this.view.anchor.x=e.x,this.view.anchor.y=e.y}get width(){return this.view.width}set width(e){this.view.width=e}get height(){return this.view.height}set height(e){this.view.height=e}get tilePosition(){return this.view._tileTransform.position}set tilePosition(e){this.view._tileTransform.position.copyFrom(e)}get tileScale(){return this.view._tileTransform.scale}set tileScale(e){this.view._tileTransform.scale.copyFrom(e)}set tileRotation(e){this.view._tileTransform.rotation=e}get tileRotation(){return this.view._tileTransform.rotation}get tileTransform(){return this.view._tileTransform}get roundPixels(){return!!this.view.roundPixels}set roundPixels(e){this.view.roundPixels=e?1:0}}function A0(t){const e=t._stroke,r=t._fill,n=[`div { ${[`color: ${X.shared.setValue(r.color).toHex()}`,`font-size: ${t.fontSize}px`,`font-family: ${t.fontFamily}`,`font-weight: ${t.fontWeight}`,`font-style: ${t.fontStyle}`,`font-variant: ${t.fontVariant}`,`letter-spacing: ${t.letterSpacing}px`,`text-align: ${t.align}`,`padding: ${t.padding}px`,`white-space: ${t.whiteSpace}`,...t.lineHeight?[`line-height: ${t.lineHeight}px`]:[],...t.wordWrap?[`word-wrap: ${t.breakWords?"break-all":"break-word"}`,`max-width: ${t.wordWrapWidth}px`]:[],...e?[w0(e)]:[],...t.dropShadow?[C0(t.dropShadow)]:[],...t.cssOverrides].join(";")} }`];return Dw(t.tagStyles,n),n.join(" ")}function C0(t){const e=X.shared.setValue(t.color).setAlpha(t.alpha).toHexa(),r=Math.round(Math.cos(t.angle)*t.distance),n=Math.round(Math.sin(t.angle)*t.distance),i=`${r}px ${n}px`;return t.blur>0?`text-shadow: ${i} ${t.blur}px ${e}`:`text-shadow: ${i} ${e}`}function w0(t){return[`-webkit-text-stroke-width: ${t.width}px`,`-webkit-text-stroke-color: ${X.shared.setValue(t.color).toHex()}`,`text-stroke-width: ${t.width}px`,`text-stroke-color: ${X.shared.setValue(t.color).toHex()}`,"paint-order: stroke"].join(";")}const T0={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},S0={fill:t=>`color: ${X.shared.setValue(t).toHex()}`,breakWords:t=>`word-wrap: ${t?"break-all":"break-word"}`,stroke:w0,dropShadow:C0};function Dw(t,e){for(const r in t){const n=t[r],i=[];for(const s in n)S0[s]?i.push(S0[s](n[s])):T0[s]&&i.push(T0[s].replace("{{VALUE}}",n[s]));e.push(`${r} { ${i.join(";")} }`)}}class pr extends Rt{constructor(e={}){var r,n;super(e),this._cssOverrides=[],(r=this.cssOverrides)!=null||(this.cssOverrides=e.cssOverrides),this.tagStyles=(n=e.tagStyles)!=null?n:{}}set cssOverrides(e){this._cssOverrides=e instanceof Array?e:[e],this.update()}get cssOverrides(){return this._cssOverrides}_generateKey(){return this._styleKey=_u(this)+this._cssOverrides.join("-"),this._styleKey}update(){this._cssStyle=null,super.update()}clone(){return new pr({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides})}get cssStyle(){return this._cssStyle||(this._cssStyle=A0(this)),this._cssStyle}addOverride(...e){const r=e.filter(n=>!this.cssOverrides.includes(n));r.length>0&&(this.cssOverrides.push(...r),this.update())}removeOverride(...e){const r=e.filter(n=>this.cssOverrides.includes(n));r.length>0&&(this.cssOverrides=this.cssOverrides.filter(n=>!r.includes(n)),this.update())}set fill(e){super.fill=e}set stroke(e){super.stroke=e}}function dl(t,e){return e instanceof Rt||e instanceof pr?e:t==="html"?new pr(e):new Rt(e)}const Rw={canvas:"text",html:"htmlText",bitmap:"bitmapText"};class E0{constructor(e){this.uid=J("textView"),this.renderPipeId="text",this.owner=Xt,this.batched=!0,this.resolution=null,this._didUpdate=!0,this.roundPixels=0,this._bounds=[0,1,0,0],this._boundsDirty=!0;var r,n,i;this.text=(r=e.text)!=null?r:"";const s=(n=e.renderMode)!=null?n:this._detectRenderType(e.style);this._renderMode=s,this._style=dl(s,e.style),this.renderPipeId=Rw[s],this.anchor=new ue(this,0,0),this.resolution=(i=e.resolution)!=null?i:null}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onUpdate())}get text(){return this._text}get style(){return this._style}set style(e){var r;e=e||{},(r=this._style)==null||r.off("update",this.onUpdate,this),this._style=dl(this._renderMode,e),this._style.on("update",this.onUpdate,this),this.onUpdate()}get bounds(){return this._boundsDirty&&(this._updateBounds(),this._boundsDirty=!1),this._bounds}addBounds(e){const r=this.bounds;e.addFrame(r[0],r[2],r[1],r[3])}containsPoint(e){const r=this.bounds[2],n=this.bounds[3],i=-r*this.anchor.x;let s=0;return e.x>=i&&e.x<i+r&&(s=-n*this.anchor.y,e.y>=s&&e.y<s+n)}onUpdate(){this._didUpdate=!0,this._boundsDirty=!0,this.owner.onViewUpdate()}_getKey(){return`${this.text}:${this._style.styleKey}`}_updateBounds(){const e=this._bounds,r=this._style.padding,n=this.anchor;if(this.renderPipeId==="bitmapText"){const i=Tu.measureText(this.text,this._style),s=i.scale,o=i.offsetY*s,a=i.width*s,u=i.height*s;e[0]=-n._x*a-r,e[1]=e[0]+a,e[2]=-n._y*(u+o)-r,e[3]=e[2]+u}else if(this.renderPipeId==="htmlText"){const i=Du(this.text,this._style),{width:s,height:o}=i;e[0]=-n._x*s-r,e[1]=e[0]+s,e[2]=-n._y*o-r,e[3]=e[2]+o}else{const i=ae.measureText(this.text,this._style),{width:s,height:o}=i;e[0]=-n._x*s-r,e[1]=e[0]+s,e[2]=-n._y*o-r,e[3]=e[2]+o}}_detectRenderType(e){if(e instanceof pr)return"html";const r=re.get(e==null?void 0:e.fontFamily);return r instanceof Xi||r instanceof On?"bitmap":"canvas"}destroy(e=!1){this.owner=null,this._bounds=null,this.anchor=null,this._style.destroy(e),this._style=null,this._text=null}}var Fw=Object.defineProperty,ns=Object.getOwnPropertySymbols,I0=Object.prototype.hasOwnProperty,P0=Object.prototype.propertyIsEnumerable,B0=(t,e,r)=>e in t?Fw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gw=(t,e)=>{for(var r in e||(e={}))I0.call(e,r)&&B0(t,r,e[r]);if(ns)for(var r of ns(e))P0.call(e,r)&&B0(t,r,e[r]);return t},kw=(t,e)=>{var r={};for(var n in t)I0.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&ns)for(var n of ns(t))e.indexOf(n)<0&&P0.call(t,n)&&(r[n]=t[n]);return r};class fl extends K{constructor(...e){let r=e[0];(typeof r=="string"||e[1])&&(G($,'use new Text({ text: "hi!", style }) instead'),r={text:r,style:e[1]});const n=r,{style:i,text:s,renderMode:o,resolution:a}=n,u=kw(n,["style","text","renderMode","resolution"]);super(Gw({view:new E0(ct({style:i,text:s,renderMode:o,resolution:a})),label:"Text"},u)),this.allowChildren=!1}get anchor(){return this.view.anchor}set anchor(e){this.view.anchor.x=e.x,this.view.anchor.y=e.y}set text(e){this.view.text=e}get text(){return this.view.text}set style(e){this.view.style=e}get style(){return this.view.style}get roundPixels(){return!!this.view.roundPixels}set roundPixels(e){this.view.roundPixels=e?1:0}}class Ow extends fl{constructor(...e){G($,'use new Text({ text: "hi!", style, renderMode: "bitmap" }) instead');let r=e[0];(typeof r=="string"||e[1])&&(r={text:r,style:e[1]}),r.renderMode="bitmap",super(r)}}class Uw extends fl{constructor(...e){G($,'use new Text({ text: "hi!", style, renderMode: "html" }) instead');let r=e[0];(typeof r=="string"||e[1])&&(r={text:r,style:e[1]}),r.renderMode="html",super(r)}}const Lw=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;async function Nw(t,e,r=200){const n=await e.extract.base64(t);await e.encoder.commandFinished;const i=r;console.log(`logging texture ${t.source.width}px ${t.source.height}px`);const s=["font-size: 1px;",`padding: ${i}px 300px;`,`background: url(${n}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",s)}var $w=Object.defineProperty,Vw=Object.defineProperties,zw=Object.getOwnPropertyDescriptors,M0=Object.getOwnPropertySymbols,Hw=Object.prototype.hasOwnProperty,Ww=Object.prototype.propertyIsEnumerable,D0=(t,e,r)=>e in t?$w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,R0=(t,e)=>{for(var r in e||(e={}))Hw.call(e,r)&&D0(t,r,e[r]);if(M0)for(var r of M0(e))Ww.call(e,r)&&D0(t,r,e[r]);return t},Xw=(t,e)=>Vw(t,zw(e));const jw=["#000080","#228B22","#8B0000","#4169E1","#008080","#800000","#9400D3","#FF8C00","#556B2F","#8B008B"];let Yw=0;function F0(t,e=0,r={color:"#000000"}){t.isLayerRoot&&(r.color=jw[Yw++]);let n="";for(let o=0;o<e;o++)n+="    ";let i=t.label;!i&&t instanceof $e&&(i=`sprite:${t.view.texture.label}`);let s=`%c ${n}|- ${i} (worldX:${t.worldTransform.tx}, layerX:${t.layerTransform.tx}, localX:${t.x})`;t.isLayerRoot&&(s+=" (LayerGroup)"),t.filters&&(s+="(*filters)"),console.log(s,`color:${r.color}; font-weight:bold;`),e++;for(let o=0;o<t.children.length;o++){const a=t.children[o];F0(a,e,R0({},r))}}function G0(t,e=0,r={index:0,color:"#000000"}){let n="";for(let s=0;s<e;s++)n+="    ";const i=`%c ${n}- ${r.index}: ${t.root.label} worldX:${t.worldTransform.tx}`;console.log(i,`color:${r.color}; font-weight:bold;`),e++;for(let s=0;s<t.layerGroupChildren.length;s++){const o=t.layerGroupChildren[s];G0(o,e,Xw(R0({},r),{index:s}))}}let pl=0;const k0=500;function Zw(...t){pl!==k0&&(pl++,pl===k0?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...t))}var qw=`fn getLuminosity(c: vec3<f32>) -> f32 {
  return 0.3 * c.r + 0.59 * c.g + 0.11 * c.b;
}

fn setLuminosity(c: vec3<f32>, lum: f32) -> vec3<f32> {
  let d: f32 = lum - getLuminosity(c);
  let newColor: vec3<f32> = c.rgb + vec3<f32>(d, d, d);

  // clip back into legal range
  let newLum: f32 = getLuminosity(newColor);
  let cMin: f32 = min(newColor.r, min(newColor.g, newColor.b));
  let cMax: f32 = max(newColor.r, max(newColor.g, newColor.b));

  let t1: f32 = newLum / (newLum - cMin);
  let t2: f32 = (1.0 - newLum) / (cMax - newLum);

  let finalColor = mix(vec3<f32>(newLum, newLum, newLum), newColor, select(select(1.0, t2, cMax > 1.0), t1, cMin < 0.0));

  return finalColor;
}

fn getSaturation(c: vec3<f32>) -> f32 {
  return max(c.r, max(c.g, c.b)) - min(c.r, min(c.g, c.b));
}

// Set saturation if color components are sorted in ascending order.
fn setSaturationMinMidMax(cSorted: vec3<f32>, s: f32) -> vec3<f32> {
  var result: vec3<f32>;
  if (cSorted.z > cSorted.x) {
    let newY = (((cSorted.y - cSorted.x) * s) / (cSorted.z - cSorted.x));
    result = vec3<f32>(0.0, newY, s);
  } else {
    result = vec3<f32>(0.0, 0.0, 0.0);
  }
  return vec3<f32>(result.x, result.y, result.z);
}

fn setSaturation(c: vec3<f32>, s: f32) -> vec3<f32> {
    var result: vec3<f32> = c;

    if (c.r <= c.g && c.r <= c.b) {
        if (c.g <= c.b) {
            result = setSaturationMinMidMax(result, s);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.r, result.b, result.g);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.r, temp.b, temp.g);
        }
    } else if (c.g <= c.r && c.g <= c.b) {
        if (c.r <= c.b) {
            var temp: vec3<f32> = vec3<f32>(result.g, result.r, result.b);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.g, temp.r, temp.b);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.g, result.b, result.r);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.g, temp.b, temp.r);
        }
    } else {
        if (c.r <= c.g) {
            var temp: vec3<f32> = vec3<f32>(result.b, result.r, result.g);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.b, temp.r, temp.g);
        } else {
            var temp: vec3<f32> = vec3<f32>(result.b, result.g, result.r);
            temp = setSaturationMinMidMax(temp, s);
            result = vec3<f32>(temp.b, temp.g, temp.r);
        }
    }

    return result;
}`;return h.AbstractBitmapFont=Os,h.AbstractRenderer=$t,h.AccessibilitySystem=En,h.AlphaFilter=yp,h.AlphaMask=xo,h.AlphaMaskPipe=_a,h.AnimatedSprite=ts,h.Application=Es,h.Assets=wr,h.AssetsClass=Lc,h.BLEND_TO_NPM=_g,h.BUFFER_TYPE=Qr,h.BackgroundLoader=Bc,h.BackgroundSystem=ji,h.Batch=ba,h.BatchGeometry=fa,h.BatchTextureArray=ma,h.BatchableGraphics=Li,h.BatchableMesh=Rm,h.BatchableSprite=Hi,h.Batcher=va,h.BatcherPipe=ya,h.BigPool=H,h.BindGroup=He,h.BindGroupSystem=zu,h.BitmapFont=On,h.BitmapFontManager=Tu,h.BitmapText=Ow,h.BitmapTextPipe=Su,h.BlendModeFilter=ie,h.BlendModePipe=Fu,h.BlurFilter=Rp,h.BlurFilterPass=Yr,h.Bounds=be,h.BrowserAdapter=yc,h.Buffer=De,h.BufferImageSource=wo,h.BufferResource=Ri,h.BufferSystem=Hu,h.BufferUsage=W,h.CLEAR=we,h.Cache=re,h.CanvasPool=rt,h.CanvasPoolClass=qm,h.CanvasSource=ai,h.CanvasTextMetrics=ae,h.CanvasTextPipe=Eu,h.CanvasTextSystem=Pu,h.Circle=Ln,h.Color=X,h.ColorMask=Ao,h.ColorMaskPipe=xa,h.ColorMatrixFilter=e1,h.CompressedSource=Xn,h.Container=K,h.DATA_URI=Lw,h.DEG_TO_RAD=Gl,h.DEPRECATED_SCALE_MODES=al,h.DEPRECATED_WRAP_MODES=ol,h.DOMAdapter=Z,h.DRAW_MODES=YC,h.DisplacementFilter=t1,h.DynamicBitmapFont=Xi,h.Ellipse=Nn,h.EventBoundary=yd,h.EventEmitter=ge,h.EventSystem=Dr,h.EventsTicker=Ke,h.ExtensionType=v,h.ExtractSystem=Yi,h.FederatedContainer=Ad,h.FederatedEvent=Lt,h.FederatedMouseEvent=Br,h.FederatedPointerEvent=Pe,h.FederatedWheelEvent=St,h.FillGradient=Er,h.FillPattern=qs,h.Filter=Le,h.FilterEffect=_n,h.FilterPipe=ea,h.FilterSystem=ra,h.FontStylePromiseCache=cn,h.GAUSSIAN_VALUES=jo,h.GLSL_TO_STD40_SIZE=ZC,h.GL_FORMATS=Bi,h.GL_TARGETS=wa,h.GL_TYPES=z,h.GL_WRAP_MODES=Rg,h.GenerateTextureSystem=ku,h.Geometry=_i,h.GlBackBufferSystem=Mi,h.GlBatchAdaptor=da,h.GlBuffer=Dg,h.GlBufferSystem=Ca,h.GlColorMaskSystem=Ea,h.GlContextSystem=Pi,h.GlEncoderSystem=Ia,h.GlGeometrySystem=Sa,h.GlGraphicsAdaptor=Wa,h.GlMeshAdaptor=Xa,h.GlProgram=Be,h.GlProgramData=Zg,h.GlRenderTarget=$g,h.GlRenderTargetSystem=Ma,h.GlShaderSystem=Oa,h.GlStateSystem=Na,h.GlStencilSystem=Da,h.GlTexture=om,h.GlTextureSystem=Ha,h.GlUniformGroupSystem=Ua,h.GlobalUniformSystem=Ou,h.GpuBatchAdaptor=pa,h.GpuBlendModesToPixi=Te,h.GpuColorMaskSystem=Wu,h.GpuDeviceSystem=Xu,h.GpuEncoderSystem=ju,h.GpuGraphicsAdaptor=il,h.GpuGraphicsContext=Mm,h.GpuMeshAdapter=sl,h.GpuMipmapGenerator=Wb,h.GpuProgram=Oe,h.GpuReadBuffer=GC,h.GpuRenderTarget=$b,h.GpuRenderTargetSystem=Ju,h.GpuShaderSystem=Qu,h.GpuStateSystem=el,h.GpuStencilModesToPixi=Xe,h.GpuStencilSystem=Yu,h.GpuTextureSystem=nl,h.GpuUniformBatchPipe=Zu,h.GpuUniformBufferPipe=qu,h.Graphics=ow,h.GraphicsContext=it,h.GraphicsContextRenderData=Dm,h.GraphicsContextSystem=du,h.GraphicsPath=_t,h.GraphicsPipe=pu,h.GraphicsView=yu,h.HTMLText=Uw,h.HTMLTextPipe=Bu,h.HTMLTextRenderData=Ru,h.HTMLTextStyle=pr,h.HTMLTextSystem=hn,h.HelloSystem=qi,h.IGLUniformData=X1,h.ImageSource=xt,h.InstructionSet=ms,h.LayerGroup=Jl,h.LayerPipe=Ya,h.LayerRenderable=Pg,h.LayerSystem=Qa,h.Loader=Rc,h.LoaderParserPriority=Ie,h.MAX_TEXTURES=Re,h.MSAA_QUALITY=qb,h.MaskEffectManager=xn,h.MaskEffectManagerClass=zl,h.MaskFilter=Qp,h.Matrix=R,h.Mesh=ww,h.MeshGeometry=hr,h.MeshPipe=gu,h.MeshView=on,h.NOOP=Bs,h.NineSliceGeometry=ll,h.NineSlicePlane=yw,h.NineSliceSprite=cl,h.NoiseFilter=Vp,h.ObservablePoint=ue,h.PI_2=Rl,h.PipelineSystem=Ku,h.PlaneGeometry=ul,h.Point=Y,h.Polygon=vt,h.Pool=$l,h.PoolGroupClass=Vl,h.ProxyRenderable=Wi,h.QuadGeometry=bu,h.RAD_TO_DEG=Fl,h.Rectangle=te,h.RenderTarget=ur,h.RenderTexture=vb,h.RendererType=We,h.ResizePlugin=Ps,h.Resolver=dt,h.RoundedRectangle=$n,h.SCALE_MODES=KC,h.STENCIL_MODES=le,h.SVGParser=wh,h.SVGToGraphicsPath=gh,h.ScissorMask=R1,h.SdfShader=Wm,h.Shader=Ue,h.ShaderStage=rr,h.ShapePath=xh,h.SharedRenderPipes=Vu,h.SharedSystems=$u,h.ShockwaveFilter=Zp,h.Sprite=$e,h.SpritePipe=mu,h.SpriteView=Td,h.Spritesheet=ni,h.State=Me,h.StencilMask=Co,h.StencilMaskPipe=Aa,h.SystemRunner=In,h.Text=fl,h.TextFormat=Un,h.TextStyle=Rt,h.TextView=E0,h.Texture=E,h.TextureGCSystem=fn,h.TextureLayout=Fs,h.TextureMatrix=Gs,h.TexturePool=pe,h.TexturePoolClass=Ap,h.TextureSource=fe,h.TextureStyle=Tr,h.TextureUvs=JC,h.Ticker=ve,h.TickerListener=Dn,h.TickerPlugin=Is,h.TilingSprite=Mw,h.TilingSpritePipe=vu,h.TilingSpriteShader=$m,h.TilingSpriteView=hl,h.Transform=p0,h.Triangle=ia,h.UPDATE_BLEND=ys,h.UPDATE_COLOR=Cn,h.UPDATE_PRIORITY=ht,h.UPDATE_TRANSFORM=lv,h.UPDATE_VISIBLE=wn,h.UniformBufferBatch=Ob,h.UniformBufferSystem=Lu,h.UniformGroup=oe,h.VERSION=Nu,h.VideoSource=st,h.ViewSystem=Ki,h.ViewableBuffer=ga,h.WGSL_TO_STD40_SIZE=Uu,h.WRAP_MODES=qC,h.WebGLRenderer=kb,h.WebGPURenderer=Zb,h.WebWorkerAdapter=fx,h.WorkerManager=to,h.XMLFormat=Us,h.XMLStringFormat=Ls,h._getGlobalBounds=gs,h.accessibilityTarget=As,h.addBits=sa,h.addMaskBounds=si,h.addMaskLocalBounds=oi,h.alphaWgsl=Xo,h.applyStyleParams=za,h.autoDetectEnvironment=vc,h.autoDetectRenderer=Ec,h.autoDetectSource=Nc,h.basisTranscoderUrls=Kn,h.batchSamplersUniformGroup=Ti,h.bitmapFontCachePlugin=ah,h.blendTemplateFrag=$f,h.blendTemplateVert=Vf,h.blendTemplateWgsl=zf,h.blockDataMap=tl,h.blurTemplateWgsl=Sp,h.browserExt=mc,h.buildAdaptiveBezier=Vs,h.buildAdaptiveQuadratic=bh,h.buildArc=Ws,h.buildArcTo=vh,h.buildArcToSvg=_h,h.buildCircle=Bt,h.buildContextBatches=Pm,h.buildGeometryFromPath=uw,h.buildInstructions=Bg,h.buildLine=wm,h.buildPolygon=uu,h.buildRectangle=lu,h.buildSimpleUvs=tu,h.buildTriangle=cu,h.buildUvs=eu,h.cacheTextureArray=Qc,h.calculateProjection=Vg,h.checkDataUrl=bt,h.checkExtension=Ge,h.childrenHelperMixin=Ol,h.closePointEps=xm,h.collectAllRenderables=Jr,h.collectLayerGroups=Za,h.color32BitToUniform=fu,h.colorBit=xi,h.colorBitGl=Ai,h.colorMatrixFilterFrag=Fp,h.colorMatrixFilterWgsl=qo,h.colorToUniform=FA,h.compareModeToGlCompare=hm,h.compileHighShader=ig,h.compileHighShaderGl=sg,h.compileHighShaderGlProgram=ir,h.compileHighShaderGpuProgram=nr,h.compileHooks=oa,h.compileInputs=aa,h.compileOutputs=ng,h.compileShader=Ra,h.convertFillInputToFillStyle=wt,h.convertToList=Ee,h.copySearchParams=kn,h.createIdFromString=Rn,h.createLevelBuffers=td,h.createLevelBuffersFromKTX=hd,h.createStringVariations=Gc,h.createTexture=Wt,h.createUBOElements=xb,h.crossOrigin=Hh,h.curveEps=ru,h.defaultFilterVert=Zo,h.defaultUniformValue=Df,h.defaultValue=Ga,h.definedProps=ct,h.deprecation=G,h.detectAvif=eh,h.detectBasis=Zh,h.detectDefaults=rh,h.detectMp4=nh,h.detectOgv=ih,h.detectVideoAlphaMode=io,h.detectWebm=sh,h.detectWebp=oh,h.determineCrossOrigin=Wh,h.displacementFrag=Gp,h.displacementVert=kp,h.displacementWgsl=Ko,h.earcut=nu,h.effectsMixin=Hl,h.emptyViewObserver=Xt,h.ensureIsBuffer=ta,h.ensurePrecision=_f,h.ensureTextStyle=dl,h.executeInstructions=ja,h.extensions=V,h.extractFontFamilies=eb,h.extractStructAndGroups=bi,h.fastCopy=Ii,h.findHooksRx=eg,h.findMixin=Wl,h.fontStringFromTextStyle=un,h.formatShader=C1,h.fragmentGPUTemplate=lg,h.fragmentGlTemplate=hg,h.generateBlurFragSource=Cp,h.generateBlurGlProgram=Tp,h.generateBlurProgram=Ep,h.generateBlurVertSource=wp,h.generateGPULayout=_1,h.generateGpuLayoutGroups=Pf,h.generateLayout=x1,h.generateLayoutHash=Bf,h.generateProgram=nm,h.generateTextStyleKey=_u,h.generateTextureBatchBit=Ci,h.generateTextureBatchBitGl=wi,h.generateUID=ew,h.generateUniformBufferSync=Ab,h.generateUniformsSync=im,h.getAttributeData=Jg,h.getBitmapTextLayout=Cu,h.getCanvasFillStyle=ln,h.getCanvasTexture=Di,h.getFilterEffect=Ll,h.getFontCss=ib,h.getFontFamilyName=fh,h.getGlInfoFromFormat=Gg,h.getGlobalBounds=br,h.getGlobalRenderableBounds=qp,h.getLocalBounds=nt,h.getMatrixRelativeToParent=_o,h.getMaxFragmentPrecision=Cf,h.getOrientationOfPoints=Am,h.getParent=jl,h.getPo2TextureFromSource=Iu,h.getResolutionOfUrl=Js,h.getSVGUrl=sb,h.getSupportedCompressedTextureFormats=co,h.getSupportedGPUCompressedTextureFormats=uo,h.getSupportedGlCompressedTextureFormats=ao,h.getSupportedTextureFormats=qn,h.getTemporaryCanvasFromImage=ob,h.getTestContext=Af,h.getTextureBatchBindGroup=Si,h.getTextureDefaultMatrix=_w,h.getTextureFormatFromKTXTexture=pd,h.getUniformBufferData=Qg,h.getUniformData=em,h.glFormatToGPUFormat=dd,h.glUploadBufferImageResource=am,h.glUploadCompressedTextureResource=um,h.glUploadImageResource=$a,h.glUploadVideoResource=lm,h.globalUniformsBit=dg,h.globalUniformsBitGl=fg,h.gpuFormatToBasisTranscoderFormat=rd,h.gpuFormatToKTXBasisTranscoderFormat=gd,h.gpuUploadBufferImageResource=Vb,h.gpuUploadCompressedTextureResource=zb,h.gpuUploadImageResource=rl,h.gpuUploadVideoResource=Hb,h.groupD8=L,h.hslWgsl=qw,h.hslgl=vi,h.hslgpu=yi,h.injectBits=ua,h.isMobile=fc,h.isPow2=Rx,h.isRenderingToScreen=Pa,h.isSafari=Qm,h.isSingleItem=Cr,h.ktxTranscoderUrls=ti,h.loadBasis=ed,h.loadBasisOnWorker=Qh,h.loadDDS=ad,h.loadFontAsBase64=tb,h.loadFontCSS=Mu,h.loadImageBitmap=kh,h.loadJson=lh,h.loadKTX=cd,h.loadKTX2onWorker=ld,h.loadSVGImage=ab,h.loadSvg=Dh,h.loadTextures=ro,h.loadTxt=ch,h.loadVideoTextures=Xh,h.loadWebFont=ph,h.localUniformBit=ar,h.localUniformBitGl=Kr,h.localUniformBitGroup2=Sg,h.localUniformMSDFBit=Vm,h.log2=Fx,h.logDebugTexture=Nw,h.logLayerGroupScene=G0,h.logProgramError=rm,h.logScene=F0,h.mSDFBit=zm,h.mSDFBitGl=Hm,h.mapFormatToGlFormat=dm,h.mapFormatToGlInternalFormat=gm,h.mapFormatToGlType=mm,h.mapSize=qg,h.mapType=ka,h.mapWebGLBlendModesToPixi=sm,h.maskFrag=Kp,h.maskVert=Jp,h.maskWgsl=na,h.measureHtmlText=Du,h.measureMixin=Yl,h.migrateFragmentFromV7toV8=K1,h.mipmapScaleModeToGlFilter=cm,h.mixColors=Oi,h.mixHexColors=qa,h.mixStandardAnd32BitColors=hA,h.multiplyHexColors=tw,h.nextPow2=It,h.noiseFrag=Op,h.noiseWgsl=Jo,h.nonCompressedFormats=qh,h.normalizeExtensionPriority=gr,h.onRenderMixin=Zl,h.parseDDS=od,h.path=ye,h.removeItems=ps,h.removeStructAndGroupDuplicates=Mf,h.resolveCharacters=Au,h.resolveCompressedTextureUrl=po,h.resolveTextureUrl=jh,h.resourceToTexture=$c,h.returnFilterEffect=Nl,h.roundPixelsBit=sr,h.roundPixelsBitGl=or,h.sayHello=wb,h.scaleModeToGlFilter=Va,h.setBasisTranscoderPath=my,h.setKTXTranscoderPath=zy,h.setProgramName=wf,h.setProgramVersion=Tf,h.shockwaveFrag=zp,h.shockwaveVert=Hp,h.shockwaveWgsl=Qo,h.sortMixin=ql,h.spritesheetAsset=wd,h.testImageFormat=ks,h.testVideoFormat=Gn,h.textStyleToCSS=A0,h.textureBit=Eg,h.textureBitGl=Ig,h.tilingBit=Lm,h.tilingBitGl=Nm,h.toLocalGlobalMixin=Kl,h.transformVertices=Ui,h.triangulateWithHoles=au,h.uniformBufferParsers=Zi,h.uniformParsers=Gi,h.unpremultiplyAlpha=uA,h.updateLayerGroupTransforms=Ka,h.updateLayerTransform=vm,h.updateLocalTransform=Ye,h.updateQuadBounds=Fr,h.updateTransformAndChildren=Ja,h.updateTransformBackwards=vr,h.updateWorldTransform=rw,h.v8_0_0=$,h.validFormats=Qn,h.validateRenderables=_m,h.vertexGPUTemplate=ug,h.vertexGlTemplate=cg,h.vkFormatToGPUFormat=fd,h.warn=Zw,h.webworkerExt=bc,h.wrapModeToGlAddress=ki,h.xmlBitmapFontLoader=uh,Object.defineProperty(h,"__esModule",{value:!0}),h}({});
//# sourceMappingURL=pixi.min.js.map
